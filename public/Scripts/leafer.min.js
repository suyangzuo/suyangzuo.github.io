var LeaferUI=function(t){"use strict";const e={toURL(t,e){let i=encodeURIComponent(t);return"text"===e?i="data:text/plain;charset=utf-8,"+i:"svg"===e&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(t){const{prefix:i,suffix:s}=e.image;return!s||t.startsWith("data:")||t.startsWith("blob:")||(t+=(t.includes("?")?"&":"?")+s),i&&"/"===t[0]&&(t=i+t),t}}},i={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=s;return e[t]?e[t]++:(e[t]=1,0)}},s=i;var r;t.Answer=void 0,(r=t.Answer||(t.Answer={}))[r.No=0]="No",r[r.Yes=1]="Yes",r[r.NoAndSkip=2]="NoAndSkip",r[r.YesAndSkip=3]="YesAndSkip";const n={};function o(t){return void 0===t}function a(t){return null==t}function h(t){return"string"==typeof t}const{isFinite:l}=Number;function d(t){return"number"==typeof t}const c=/^-?\d+(?:\.\d+)?$/;const{isArray:u}=Array;function _(t){return t&&"object"==typeof t}function p(t){return"{}"===JSON.stringify(t)}const g={default:(t,e)=>(f(e,t),f(t,e),t),assign(t,e,i){let s;Object.keys(e).forEach(r=>{var n,o;if(s=e[r],(null==s?void 0:s.constructor)===Object&&(null===(n=t[r])||void 0===n?void 0:n.constructor)===Object)return f(t[r],e[r],i&&i[r]);i&&r in i?(null===(o=i[r])||void 0===o?void 0:o.constructor)===Object&&f(t[r]={},e[r],i[r]):t[r]=e[r]})},copyAttrs:(t,e,i)=>(i.forEach(i=>{o(e[i])||(t[i]=e[i])}),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let i=0,s=t.length;i<s;i++)e[t[i]]=!0;return e},stintSet(t,e,i){i||(i=void 0),t[e]!==i&&(t[e]=i)}},{assign:f}=g;class y{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&6===t.length&&1===t[0]}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(!o(e))return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let i;for(let s in this)"_"!==s[0]&&(i=e?e[s]:void 0,t[s]=o(i)?this[s]:i);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(!o(e))return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&!o(this.__input[t])&&(this.__input[t]=void 0)}__getInputData(t,e){const i={};if(t)if(u(t))for(let e of t)i[e]=this.__getInput(e);else for(let e in t)i[e]=this.__getInput(e);else{let t,e,{__input:s}=this;i.tag=this.__leaf.tag;for(let r in this)if("_"!==r[0]&&(t=this["_"+r],!o(t))){if("path"===r&&!this.__pathInputed)continue;e=s?s[r]:void 0,i[r]=o(e)?t:e}}if(e&&e.matrix){const{a:t,b:e,c:s,d:r,e:n,f:o}=this.__leaf.__localMatrix;i.matrix={a:t,b:e,c:s,d:r,e:n,f:o}}return i}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&(e.isBranch||t.__hasMultiPaint)||e.__hasEraser||t.eraser||t.filter?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}let m,v,w;const{max:x}=Math,b=[0,0,0,0],E={zero:[...b],tempFour:b,set:(t,e,i,s,r)=>(void 0===i&&(i=s=r=e),t[0]=e,t[1]=i,t[2]=s,t[3]=r,t),setTemp:(t,e,i,s)=>P(b,t,e,i,s),toTempAB(t,e,i){w=i?d(t)?e:t:[],d(t)?(m=k(t),v=e):d(e)?(m=t,v=k(e)):(m=t,v=e),4!==m.length&&(m=B(m)),4!==v.length&&(v=B(v))},get(t,e){let i;if(!d(t))switch(t.length){case 4:i=o(e)?t:[...t];break;case 2:i=[t[0],t[1],t[0],t[1]];break;case 3:i=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(i||(i=[t,t,t,t]),!o(e))for(let t=0;t<4;t++)i[t]>e&&(i[t]=e);return i},max:(t,e,i)=>d(t)&&d(e)?x(t,e):(S(t,e,i),P(w,x(m[0],v[0]),x(m[1],v[1]),x(m[2],v[2]),x(m[3],v[3]))),add:(t,e,i)=>d(t)&&d(e)?t+e:(S(t,e,i),P(w,m[0]+v[0],m[1]+v[1],m[2]+v[2],m[3]+v[3])),swapAndScale(t,e,i,s){if(d(t))return e===i?t*e:[t*i,t*e];const r=s?t:[],[n,o,a,h]=4===t.length?t:B(t);return P(r,a*i,h*e,n*i,o*e)}},{set:P,get:B,setTemp:k,toTempAB:S}=E,{round:T,pow:R,PI:C}=Math,L={within:(t,e,i)=>(_(e)&&(i=e.max,e=e.min),!o(e)&&t<e&&(t=e),!o(i)&&t>i&&(t=i),t),fourNumber:E.get,formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),L.float(t)),getGapRotation(t,e,i=0){let s=t+i;if(e>1){const t=Math.abs(s%e);(t<1||t>e-1)&&(s=Math.round(s/e)*e)}return s-i},float(t,e){const i=o(e)?1e12:R(10,e);return-0===(t=T(t*i)/i)?0:t},sign:t=>t<0?-1:1,getScaleData(t,e,i,s){if(s||(s={}),e){const t=(d(e)?e:e.width||0)/i.width,r=(d(e)?e:e.height||0)/i.height;s.scaleX=t||r||1,s.scaleY=r||t||1}else t&&L.assignScale(s,t);return s},assignScale(t,e){d(e)?t.scaleX=t.scaleY=e:(t.scaleX=e.x,t.scaleY=e.y)},randInt:O,randColor:t=>`rgba(${O(255)},${O(255)},${O(255)},${t||1})`};function O(t){return Math.round(Math.random()*t)}const D=C/180,I=2*C,A=C/2;function M(){return{x:0,y:0}}function W(){return{x:0,y:0,width:0,height:0}}function F(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:U,cos:z,acos:N,sqrt:Y}=Math,{float:X}=L,H={};function j(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const V={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:j(),tempMatrix:{},set(t,e=1,i=0,s=0,r=1,n=0,o=0){t.a=e,t.b=i,t.c=s,t.d=r,t.e=n,t.f=o},get:F,getWorld:j,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,i){t.e+=e,t.f+=i},translateInner(t,e,i,s){t.e+=t.a*e+t.c*i,t.f+=t.b*e+t.d*i,s&&(t.e-=e,t.f-=i)},scale(t,e,i=e){t.a*=e,t.b*=e,t.c*=i,t.d*=i},pixelScale(t,e,i){i||(i=t),i.a=t.a*e,i.b=t.b*e,i.c=t.c*e,i.d=t.d*e,i.e=t.e*e,i.f=t.f*e},scaleOfOuter(t,e,i,s){G.toInnerPoint(t,e,H),G.scaleOfInner(t,H,i,s)},scaleOfInner(t,e,i,s=i){G.translateInner(t,e.x,e.y),G.scale(t,i,s),G.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:i,b:s,c:r,d:n}=t,o=z(e*=D),a=U(e);t.a=i*o-s*a,t.b=i*a+s*o,t.c=r*o-n*a,t.d=r*a+n*o},rotateOfOuter(t,e,i){G.toInnerPoint(t,e,H),G.rotateOfInner(t,H,i)},rotateOfInner(t,e,i){G.translateInner(t,e.x,e.y),G.rotate(t,i),G.translateInner(t,-e.x,-e.y)},skew(t,e,i){const{a:s,b:r,c:n,d:o}=t;i&&(i*=D,t.a=s+n*i,t.b=r+o*i),e&&(e*=D,t.c=n+s*e,t.d=o+r*e)},skewOfOuter(t,e,i,s){G.toInnerPoint(t,e,H),G.skewOfInner(t,H,i,s)},skewOfInner(t,e,i,s=0){G.translateInner(t,e.x,e.y),G.skew(t,i,s),G.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:i,b:s,c:r,d:n,e:o,f:a}=t;t.a=e.a*i+e.b*r,t.b=e.a*s+e.b*n,t.c=e.c*i+e.d*r,t.d=e.c*s+e.d*n,t.e=e.e*i+e.f*r+o,t.f=e.e*s+e.f*n+a},multiplyParent(t,e,i,s,r){const{e:n,f:a}=t;if(i||(i=t),o(s)&&(s=1!==t.a||t.b||t.c||1!==t.d),s){const{a:s,b:n,c:o,d:a}=t;i.a=s*e.a+n*e.c,i.b=s*e.b+n*e.d,i.c=o*e.a+a*e.c,i.d=o*e.b+a*e.d,r&&(i.scaleX=e.scaleX*r.scaleX,i.scaleY=e.scaleY*r.scaleY)}else i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,r&&(i.scaleX=e.scaleX,i.scaleY=e.scaleY);i.e=n*e.a+a*e.c+e.e,i.f=n*e.b+a*e.d+e.f},divide(t,e){G.multiply(t,G.tempInvert(e))},divideParent(t,e){G.multiplyParent(t,G.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=G;return G.copy(e,t),G.invert(e),e},invert(t){const{a:e,b:i,c:s,d:r,e:n,f:o}=t;if(i||s){const a=1/(e*r-i*s);t.a=r*a,t.b=-i*a,t.c=-s*a,t.d=e*a,t.e=-(n*r-o*s)*a,t.f=-(o*e-n*i)*a}else if(1===e&&1===r)t.e=-n,t.f=-o;else{const i=1/(e*r);t.a=r*i,t.d=e*i,t.e=-n*r*i,t.f=-o*e*i}},toOuterPoint(t,e,i,s){const{x:r,y:n}=e;i||(i=e),i.x=r*t.a+n*t.c,i.y=r*t.b+n*t.d,s||(i.x+=t.e,i.y+=t.f)},toInnerPoint(t,e,i,s){const{a:r,b:n,c:o,d:a}=t,h=1/(r*a-n*o),{x:l,y:d}=e;if(i||(i=e),i.x=(l*a-d*o)*h,i.y=(d*r-l*n)*h,!s){const{e:e,f:s}=t;i.x-=(e*a-s*o)*h,i.y-=(s*r-e*n)*h}},setLayout(t,e,i,s,r){const{x:n,y:a,scaleX:h,scaleY:l}=e;if(o(r)&&(r=e.rotation||e.skewX||e.skewY),r){const{rotation:i,skewX:s,skewY:r}=e,n=i*D,o=z(n),a=U(n);if(s||r){const e=s*D,i=r*D;t.a=(o+i*-a)*h,t.b=(a+i*o)*h,t.c=(e*o-a)*l,t.d=(o+e*a)*l}else t.a=o*h,t.b=a*h,t.c=-a*l,t.d=o*l}else t.a=h,t.b=0,t.c=0,t.d=l;t.e=n,t.f=a,(i=i||s)&&G.translateInner(t,-i.x,-i.y,!s)},getLayout(t,e,i,s){const{a:r,b:n,c:o,d:a,e:h,f:l}=t;let d,c,u,_,p,g=h,f=l;if(n||o){const t=r*a-n*o;if(o&&!s){d=Y(r*r+n*n),c=t/d;const e=r/d;u=n>0?N(e):-N(e)}else{c=Y(o*o+a*a),d=t/c;const e=o/c;u=A-(a>0?N(-e):-N(e))}const e=X(z(u)),i=U(u);d=X(d),c=X(c),_=e?X((o/c+i)/e/D,9):0,p=e?X((n/d-i)/e/D,9):0,u=X(u/D)}else d=r,c=a,u=_=p=0;return(e=i||e)&&(g+=e.x*r+e.y*o,f+=e.x*n+e.y*a,i||(g-=e.x,f-=e.y)),{x:g,y:f,scaleX:d,scaleY:c,rotation:u,skewX:_,skewY:p}},withScale(t,e,i=e){const s=t;if(!e||!i){const{a:s,b:r,c:n,d:o}=t;r||n?i=(s*o-r*n)/(e=Y(s*s+r*r)):(e=s,i=o)}return s.scaleX=e,s.scaleY=i,s},reset(t){G.set(t)}},G=V,{toInnerPoint:K,toOuterPoint:q}=V,{sin:Z,cos:$,abs:Q,sqrt:J,atan2:tt,min:et,round:it}=Math,st={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,i=0){t.x=e,t.y=i},setRadius(t,e,i){t.radiusX=e,t.radiusY=o(i)?e:i},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,i){t.x=e,t.y=i},round(t,e){t.x=e?it(t.x-.5)+.5:it(t.x),t.y=e?it(t.y-.5)+.5:it(t.y)},move(t,e,i){_(e)?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=i)},scale(t,e,i=e){t.x&&(t.x*=e),t.y&&(t.y*=i)},scaleOf(t,e,i,s=i){t.x+=(t.x-e.x)*(i-1),t.y+=(t.y-e.y)*(s-1)},rotate(t,e,i){i||(i=rt.defaultPoint);const s=$(e*=D),r=Z(e),n=t.x-i.x,o=t.y-i.y;t.x=i.x+n*s-o*r,t.y=i.y+n*r+o*s},tempToInnerOf(t,e){const{tempPoint:i}=rt;return ot(i,t),K(e,i,i),i},tempToOuterOf(t,e){const{tempPoint:i}=rt;return ot(i,t),q(e,i,i),i},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:i}=rt;return ot(i,t),rt.toInnerRadiusPointOf(t,e,i),i},toInnerRadiusPointOf(t,e,i){i||(i=t),K(e,t,i),i.radiusX=Math.abs(t.radiusX/e.scaleX),i.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,i){K(e,t,i)},toOuterOf(t,e,i){q(e,t,i)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>nt(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,i,s){const r=Q(i-t),n=Q(s-e);return J(r*r+n*n)},getMinDistanceFrom:(t,e,i,s,r,n)=>et(nt(t,e,i,s),nt(i,s,r,n)),getAngle:(t,e)=>at(t,e)/D,getRotation:(t,e,i,s)=>(s||(s=e),rt.getRadianFrom(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)/D),getRadianFrom(t,e,i,s,r,n,a,h){o(a)&&(a=i,h=s);const l=t-i,d=e-s,c=r-a,u=n-h;return Math.atan2(l*u-d*c,l*c+d*u)},getAtan2:(t,e)=>tt(e.y-t.y,e.x-t.x),getDistancePoint(t,e,i,s){const r=at(t,e);return(e=s?e:{}).x=t.x+$(r)*i,e.y=t.y+Z(r)*i,e},toNumberPoints(t){let e=t;return _(t[0])&&(e=[],t.forEach(t=>e.push(t.x,t.y))),e},reset(t){rt.reset(t)}},rt=st,{getDistanceFrom:nt,copy:ot,getAtan2:at}=rt;class ht{constructor(t,e){this.set(t,e)}set(t,e){return _(t)?st.copy(this,t):st.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new ht(this)}move(t,e){return st.move(this,t,e),this}scale(t,e){return st.scale(this,t,e),this}scaleOf(t,e,i){return st.scaleOf(this,t,e,i),this}rotate(t,e){return st.rotate(this,t,e),this}rotateOf(t,e){return st.rotate(this,e,t),this}getRotation(t,e,i){return st.getRotation(this,t,e,i)}toInnerOf(t,e){return st.toInnerOf(this,t,e),this}toOuterOf(t,e){return st.toOuterOf(this,t,e),this}getCenter(t){return new ht(st.getCenter(this,t))}getDistance(t){return st.getDistance(this,t)}getDistancePoint(t,e,i){return new ht(st.getDistancePoint(this,t,e,i))}getAngle(t){return st.getAngle(this,t)}getAtan2(t){return st.getAtan2(this,t)}reset(){return st.reset(this),this}}const lt=new ht;class dt{constructor(t,e,i,s,r,n){this.set(t,e,i,s,r,n)}set(t,e,i,s,r,n){return _(t)?V.copy(this,t):V.set(this,t,e,i,s,r,n),this}setWith(t){return V.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:i,d:s,e:r,f:n}=this;return{a:t,b:e,c:i,d:s,e:r,f:n}}clone(){return new dt(this)}translate(t,e){return V.translate(this,t,e),this}translateInner(t,e){return V.translateInner(this,t,e),this}scale(t,e){return V.scale(this,t,e),this}scaleWith(t,e){return V.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}pixelScale(t){return V.pixelScale(this,t),this}scaleOfOuter(t,e,i){return V.scaleOfOuter(this,t,e,i),this}scaleOfInner(t,e,i){return V.scaleOfInner(this,t,e,i),this}rotate(t){return V.rotate(this,t),this}rotateOfOuter(t,e){return V.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return V.rotateOfInner(this,t,e),this}skew(t,e){return V.skew(this,t,e),this}skewOfOuter(t,e,i){return V.skewOfOuter(this,t,e,i),this}skewOfInner(t,e,i){return V.skewOfInner(this,t,e,i),this}multiply(t){return V.multiply(this,t),this}multiplyParent(t){return V.multiplyParent(this,t),this}divide(t){return V.divide(this,t),this}divideParent(t){return V.divideParent(this,t),this}invert(){return V.invert(this),this}invertWith(){return V.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,i){V.toOuterPoint(this,t,e,i)}toInnerPoint(t,e,i){V.toInnerPoint(this,t,e,i)}setLayout(t,e,i){return V.setLayout(this,t,e,i),this}getLayout(t,e,i){return V.getLayout(this,t,e,i)}withScale(t,e){return V.withScale(this,t,e)}reset(){V.reset(this)}}const ct=new dt,ut={tempPointBounds:{},setPoint(t,e,i){t.minX=t.maxX=e,t.minY=t.maxY=i},addPoint(t,e,i){t.minX=e<t.minX?e:t.minX,t.minY=i<t.minY?i:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=i>t.maxY?i:t.maxY},addBounds(t,e,i,s,r){_t(t,e,i),_t(t,e+s,i+r)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:_t}=ut;var pt,gt;t.Direction4=void 0,(pt=t.Direction4||(t.Direction4={}))[pt.top=0]="top",pt[pt.right=1]="right",pt[pt.bottom=2]="bottom",pt[pt.left=3]="left",t.Direction9=void 0,(gt=t.Direction9||(t.Direction9={}))[gt.topLeft=0]="topLeft",gt[gt.top=1]="top",gt[gt.topRight=2]="topRight",gt[gt.right=3]="right",gt[gt.bottomRight=4]="bottomRight",gt[gt.bottom=5]="bottom",gt[gt.bottomLeft=6]="bottomLeft",gt[gt.left=7]="left",gt[gt.center=8]="center",gt[gt["top-left"]=0]="top-left",gt[gt["top-right"]=2]="top-right",gt[gt["bottom-right"]=4]="bottom-right",gt[gt["bottom-left"]=6]="bottom-left";const ft=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];ft.forEach(t=>t.type="percent");const yt={directionData:ft,tempPoint:{},get:mt,toPoint(t,e,i,s,r,n){const o=mt(t);i.x=o.x,i.y=o.y,"percent"===o.type&&(i.x*=e.width,i.y*=e.height,r&&(n||(i.x-=r.x,i.y-=r.y),o.x&&(i.x-=1===o.x?r.width:.5===o.x?o.x*r.width:0),o.y&&(i.y-=1===o.y?r.height:.5===o.y?o.y*r.height:0))),s||(i.x+=e.x,i.y+=e.y)},getPoint:(t,e,i)=>(i||(i={}),yt.toPoint(t,e,i,!0),i)};function mt(e){return h(e)?ft[t.Direction9[e]]:e}const{toPoint:vt}=yt,wt={toPoint(t,e,i,s,r,n){vt(t,i,s,r,e,n)}},{tempPointBounds:xt,setPoint:bt,addPoint:Et,toBounds:Pt}=ut,{toOuterPoint:Bt}=V,{float:kt,fourNumber:St}=L,{floor:Tt,ceil:Rt}=Math;let Ct,Lt,Ot,Dt;const It={},At={},Mt={},Wt={tempBounds:Mt,set(t,e=0,i=0,s=0,r=0){t.x=e,t.y=i,t.width=s,t.height=r},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,i,s,r){const{x:n,y:o,width:a,height:h}=e;if(u(i)){const e=St(i);s?Ft.set(t,n+e[3],o+e[0],a-e[1]-e[3],h-e[2]-e[0]):Ft.set(t,n-e[3],o-e[0],a+e[1]+e[3],h+e[2]+e[0])}else s&&(i=-i),Ft.set(t,n-i,o-i,a+2*i,h+2*i);r&&("width"===r?(t.y=o,t.height=h):(t.x=n,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,i){t.x+=e,t.y+=i},scroll(t,e){t.x+=e.scrollX,t.y+=e.scrollY},getByMove:(t,e,i)=>(t=Object.assign({},t),Ft.move(t,e,i),t),toOffsetOutBounds(t,e,i){e?zt(e,t):e=t,i||(i=t),e.offsetX=Ft.maxX(i),e.offsetY=Ft.maxY(i),Ft.move(e,-e.offsetX,-e.offsetY)},scale(t,e,i=e,s){s||st.scale(t,e,i),t.width*=e,t.height*=i},scaleOf(t,e,i,s=i){st.scaleOf(t,e,i,s),t.width*=i,t.height*=s},tempToOuterOf:(t,e)=>(Ft.copy(Mt,t),Ft.toOuterOf(Mt,e),Mt),getOuterOf:(t,e)=>(t=Object.assign({},t),Ft.toOuterOf(t,e),t),toOuterOf(t,e,i){if(i||(i=t),0===e.b&&0===e.c){const{a:s,d:r}=e;s>0?(i.width=t.width*s,i.x=e.e+t.x*s):(i.width=t.width*-s,i.x=e.e+t.x*s-i.width),r>0?(i.height=t.height*r,i.y=e.f+t.y*r):(i.height=t.height*-r,i.y=e.f+t.y*r-i.height)}else It.x=t.x,It.y=t.y,Bt(e,It,At),bt(xt,At.x,At.y),It.x=t.x+t.width,Bt(e,It,At),Et(xt,At.x,At.y),It.y=t.y+t.height,Bt(e,It,At),Et(xt,At.x,At.y),It.x=t.x,Bt(e,It,At),Et(xt,At.x,At.y),Pt(xt,i)},toInnerOf(t,e,i){i||(i=t),Ft.move(i,-e.e,-e.f),Ft.scale(i,1/e.a,1/e.d)},getFitMatrix(t,e,i=1){const s=Math.min(i,Ft.getFitScale(t,e));return new dt(s,0,0,s,-e.x*s,-e.y*s)},getFitScale(t,e,i){const s=t.width/e.width,r=t.height/e.height;return i?Math.max(s,r):Math.min(s,r)},put(t,e,i="center",s=1,r=!0,n){n||(n=e),h(s)&&(s=Ft.getFitScale(t,e,"cover"===s)),Mt.width=r?e.width*=s:e.width*s,Mt.height=r?e.height*=s:e.height*s,wt.toPoint(i,Mt,t,n,!0,!0)},getSpread(t,e,i){const s={};return Ft.copyAndSpread(s,t,e,!1,i),s},spread(t,e,i){Ft.copyAndSpread(t,t,e,!1,i)},shrink(t,e,i){Ft.copyAndSpread(t,t,e,!0,i)},ceil(t){const{x:e,y:i}=t;t.x=Tt(t.x),t.y=Tt(t.y),t.width=e>t.x?Rt(t.width+e-t.x):Rt(t.width),t.height=i>t.y?Rt(t.height+i-t.y):Rt(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=kt(t.x,e),t.y=kt(t.y,e),t.width=kt(t.width,e),t.height=kt(t.height,e)},add(t,e,i){Ct=t.x+t.width,Lt=t.y+t.height,Ot=e.x,Dt=e.y,i||(Ot+=e.width,Dt+=e.height),Ct=Ct>Ot?Ct:Ot,Lt=Lt>Dt?Lt:Dt,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=Ct-t.x,t.height=Lt-t.y},addList(t,e){Ft.setListWithFn(t,e,void 0,!0)},setList(t,e,i=!1){Ft.setListWithFn(t,e,void 0,i)},addListWithFn(t,e,i){Ft.setListWithFn(t,e,i,!0)},setListWithFn(t,e,i,s=!1){let r,n=!0;for(let o=0,a=e.length;o<a;o++)r=i?i(e[o],o):e[o],r&&(r.width||r.height)&&(n?(n=!1,s||zt(t,r)):Ut(t,r));n&&Ft.reset(t)},setPoints(t,e){e.forEach((t,e)=>0===e?bt(xt,t.x,t.y):Et(xt,t.x,t.y)),Pt(xt,t)},setPoint(t,e){Ft.set(t,e.x,e.y)},addPoint(t,e){Ut(t,e,!0)},getPoints(t){const{x:e,y:i,width:s,height:r}=t;return[{x:e,y:i},{x:e+s,y:i},{x:e+s,y:i+r},{x:e,y:i+r}]},hitRadiusPoint:(t,e,i)=>(i&&(e=st.tempToInnerRadiusPointOf(e,i)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,i)=>(i&&(e=st.tempToInnerOf(e,i)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,i)=>(i&&(e=Ft.tempToOuterOf(e,i)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,i)=>(i&&(e=Ft.tempToOuterOf(e,i)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,i){if(i&&(e=Ft.tempToOuterOf(e,i)),!Ft.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:s,y:r,width:n,height:o}=e;return Ct=s+n,Lt=r+o,Ot=t.x+t.width,Dt=t.y+t.height,s=s>t.x?s:t.x,r=r>t.y?r:t.y,Ct=Ct<Ot?Ct:Ot,Lt=Lt<Dt?Lt:Dt,n=Ct-s,o=Lt-r,{x:s,y:r,width:n,height:o}},intersect(t,e,i){Ft.copy(t,Ft.getIntersectData(t,e,i))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,reset(t){Ft.set(t)}},Ft=Wt,{add:Ut,copy:zt}=Ft;class Nt{get minX(){return Wt.minX(this)}get minY(){return Wt.minY(this)}get maxX(){return Wt.maxX(this)}get maxY(){return Wt.maxY(this)}constructor(t,e,i,s){this.set(t,e,i,s)}set(t,e,i,s){return _(t)?Wt.copy(this,t):Wt.set(this,t,e,i,s),this}get(){const{x:t,y:e,width:i,height:s}=this;return{x:t,y:e,width:i,height:s}}clone(){return new Nt(this)}move(t,e){return Wt.move(this,t,e),this}scale(t,e,i){return Wt.scale(this,t,e,i),this}scaleOf(t,e,i){return Wt.scaleOf(this,t,e,i),this}toOuterOf(t,e){return Wt.toOuterOf(this,t,e),this}toInnerOf(t,e){return Wt.toInnerOf(this,t,e),this}getFitMatrix(t,e){return Wt.getFitMatrix(this,t,e)}put(t,e,i){Wt.put(this,t,e,i)}spread(t,e){return Wt.spread(this,t,e),this}shrink(t,e){return Wt.shrink(this,t,e),this}ceil(){return Wt.ceil(this),this}unsign(){return Wt.unsign(this),this}float(t){return Wt.float(this,t),this}add(t){return Wt.add(this,t),this}addList(t){return Wt.setList(this,t,!0),this}setList(t){return Wt.setList(this,t),this}addListWithFn(t,e){return Wt.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return Wt.setListWithFn(this,t,e),this}setPoint(t){return Wt.setPoint(this,t),this}setPoints(t){return Wt.setPoints(this,t),this}addPoint(t){return Wt.addPoint(this,t),this}getPoints(){return Wt.getPoints(this)}hitPoint(t,e){return Wt.hitPoint(this,t,e)}hitRadiusPoint(t,e){return Wt.hitRadiusPoint(this,t,e)}hit(t,e){return Wt.hit(this,t,e)}includes(t,e){return Wt.includes(this,t,e)}intersect(t,e){return Wt.intersect(this,t,e),this}getIntersect(t,e){return new Nt(Wt.getIntersectData(this,t,e))}isSame(t){return Wt.isSame(this,t)}isEmpty(){return Wt.isEmpty(this)}reset(){Wt.reset(this)}}const Yt=new Nt;class Xt{constructor(t,e,i,s,r,n){_(t)?this.copy(t):this.set(t,e,i,s,r,n)}set(t=0,e=0,i=0,s=0,r=0,n=0){this.top=t,this.right=e,this.bottom=i,this.left=s,this.width=r,this.height=n}copy(t){const{top:e,right:i,bottom:s,left:r,width:n,height:o}=t;this.set(e,i,s,r,n,o)}getBoundsFrom(t){const{top:e,right:i,bottom:s,left:r,width:n,height:o}=this;return new Nt(r,e,n||t.width-r-i,o||t.height-e-s)}}const Ht={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{randColor:jt}=L;class Vt{constructor(t){this.repeatMap={},this.name=t}static get(t){return new Vt(t)}static set filter(t){this.filterList=Gt(t)}static set exclude(t){this.excludeList=Gt(t)}static drawRepaint(t,e){const i=jt();t.fillWorld(e,i.replace("1)",".1)")),t.strokeWorld(e,i)}static drawBounds(t,e,i){const s="hit"===Vt.showBounds,r=t.__nowWorld,n=jt();s&&(e.setWorld(r),t.__drawHitPath(e),e.fillStyle=n.replace("1)",".2)"),e.fill()),e.resetTransform(),e.setStroke(n,2),s?e.stroke():e.strokeWorld(r,n)}log(...t){if(Kt.enable){if(Kt.filterList.length&&Kt.filterList.every(t=>t!==this.name))return;if(Kt.excludeList.length&&Kt.excludeList.some(t=>t===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){Kt.enable&&this.warn(...t)}warn(...t){Kt.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function Gt(t){return t?h(t)&&(t=[t]):t=[],t}Vt.filterList=[],Vt.excludeList=[],Vt.showWarn=!0;const Kt=Vt,qt=Vt.get("RunTime"),Zt={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const s=i.create(i.RUNTIME);return $t.currentId=$t.idMap[s]=e?performance.now():Date.now(),$t.currentName=$t.nameMap[s]=t,$t.nameToIdMap[t]=s,s},end(t,e){const i=$t.idMap[t],s=$t.nameMap[t],r=e?(performance.now()-i)/1e3:Date.now()-i;$t.idMap[t]=$t.nameMap[t]=$t.nameToIdMap[s]=void 0,qt.log(s,r,"ms")},endOfName(t,e){const i=$t.nameToIdMap[t];o(i)||$t.end(i,e)}},$t=Zt,Qt=[],Jt={list:{},add(t,...e){this.list[t]=!0,Qt.push(...e)},has(t,e){const i=this.list[t];return!i&&e&&this.need(t),i},need(t){console.error("please install and import plugin: "+(t.includes("-x")?"":"@leafer-in/")+t)}};setTimeout(()=>Qt.forEach(t=>Jt.has(t,!0)));const te={editor:t=>Jt.need("editor")},ee=Vt.get("UICreator"),ie={list:{},register(t){const{__tag:e}=t.prototype;se[e]&&ee.repeat(e),se[e]=t},get(t,e,i,s,r,n){se[t]||ee.error("not register "+t);const a=new se[t](e);return o(i)||(a.x=i,s&&(a.y=s),r&&(a.width=r),n&&(a.height=n)),a}},{list:se}=ie,re=Vt.get("EventCreator"),ne={nameList:{},register(t){let e;Object.keys(t).forEach(i=>{e=t[i],h(e)&&(oe[e]&&re.repeat(e),oe[e]=t)})},changeName(t,e){const i=oe[t];if(i){const s=Object.keys(i).find(e=>i[e]===t);s&&(i[s]=e,oe[e]=i)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new oe[t](...e)},{nameList:oe}=ne;class ae{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:i}=this;for(let s=0,r=i.length;s<r;s++)if(e=i[s],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const s=te.canvas(t);return this.add(s),s}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let i=0,s=this.list.length;i<s;i++)t=this.list[i],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destroy(){this.clear()}}function he(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function le(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})}function de(t){return(e,i)=>{t||(t=i);const s={get(){return this.context[t]},set(e){this.context[t]=e}};"strokeCap"===i&&(s.set=function(e){this.context[t]="none"===e?"butt":e}),Object.defineProperty(e,i,s)}}"function"==typeof SuppressedError&&SuppressedError;const ce=[];function ue(){return(t,e)=>{ce.push(e)}}const _e=[];class pe{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||_e)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;ce.forEach(e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(t,e,i,s,r,n){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,i,s,r,n){_(t)?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,i,s,r,n)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,i,s){}strokeRect(t,e,i,s){}clearRect(t,e,i,s){}drawImage(t,e,i,s,r,n,o,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/s*a;s+=e,e=0,n+=t,a-=t}if(i<0){const t=-i/r*h;r+=i,i=0,o+=t,h-=t}this.context.drawImage(t,e,i,s,r,n,o,a,h);break;case 5:this.context.drawImage(t,e,i,s,r);break;case 3:this.context.drawImage(t,e,i)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,i,s,r,n){}quadraticCurveTo(t,e,i,s){}closePath(){}arc(t,e,i,s,r,n){}arcTo(t,e,i,s,r){}ellipse(t,e,i,s,r,n,o,a){}rect(t,e,i,s){}roundRect(t,e,i,s,r){}createConicGradient(t,e,i){}createLinearGradient(t,e,i,s){}createPattern(t,e){}createRadialGradient(t,e,i,s,r,n){}fillText(t,e,i,s){}measureText(t){}strokeText(t,e,i,s){}destroy(){this.context=null}}he([de("imageSmoothingEnabled")],pe.prototype,"smooth",void 0),he([de("imageSmoothingQuality")],pe.prototype,"smoothLevel",void 0),he([de("globalAlpha")],pe.prototype,"opacity",void 0),he([de()],pe.prototype,"fillStyle",void 0),he([de()],pe.prototype,"strokeStyle",void 0),he([de("lineWidth")],pe.prototype,"strokeWidth",void 0),he([de("lineCap")],pe.prototype,"strokeCap",void 0),he([de("lineJoin")],pe.prototype,"strokeJoin",void 0),he([de("lineDashOffset")],pe.prototype,"dashOffset",void 0),he([de()],pe.prototype,"miterLimit",void 0),he([de()],pe.prototype,"shadowBlur",void 0),he([de()],pe.prototype,"shadowColor",void 0),he([de()],pe.prototype,"shadowOffsetX",void 0),he([de()],pe.prototype,"shadowOffsetY",void 0),he([de()],pe.prototype,"filter",void 0),he([de()],pe.prototype,"font",void 0),he([de()],pe.prototype,"fontKerning",void 0),he([de()],pe.prototype,"fontStretch",void 0),he([de()],pe.prototype,"fontVariantCaps",void 0),he([de()],pe.prototype,"textAlign",void 0),he([de()],pe.prototype,"textBaseline",void 0),he([de()],pe.prototype,"textRendering",void 0),he([de()],pe.prototype,"wordSpacing",void 0),he([de()],pe.prototype,"letterSpacing",void 0),he([de()],pe.prototype,"direction",void 0),he([ue()],pe.prototype,"setTransform",null),he([ue()],pe.prototype,"resetTransform",null),he([ue()],pe.prototype,"getTransform",null),he([ue()],pe.prototype,"save",null),he([ue()],pe.prototype,"restore",null),he([ue()],pe.prototype,"translate",null),he([ue()],pe.prototype,"scale",null),he([ue()],pe.prototype,"rotate",null),he([ue()],pe.prototype,"fill",null),he([ue()],pe.prototype,"stroke",null),he([ue()],pe.prototype,"clip",null),he([ue()],pe.prototype,"fillRect",null),he([ue()],pe.prototype,"strokeRect",null),he([ue()],pe.prototype,"clearRect",null),he([ue()],pe.prototype,"beginPath",null),he([ue()],pe.prototype,"moveTo",null),he([ue()],pe.prototype,"lineTo",null),he([ue()],pe.prototype,"bezierCurveTo",null),he([ue()],pe.prototype,"quadraticCurveTo",null),he([ue()],pe.prototype,"closePath",null),he([ue()],pe.prototype,"arc",null),he([ue()],pe.prototype,"arcTo",null),he([ue()],pe.prototype,"ellipse",null),he([ue()],pe.prototype,"rect",null),he([ue()],pe.prototype,"roundRect",null),he([ue()],pe.prototype,"createConicGradient",null),he([ue()],pe.prototype,"createLinearGradient",null),he([ue()],pe.prototype,"createPattern",null),he([ue()],pe.prototype,"createRadialGradient",null),he([ue()],pe.prototype,"fillText",null),he([ue()],pe.prototype,"measureText",null),he([ue()],pe.prototype,"strokeText",null);const{copy:ge,multiplyParent:fe,pixelScale:ye}=V,{round:me}=Math,ve=new Nt,we=new Nt,xe={width:1,height:1,pixelRatio:1},be=["width","height","pixelRatio"];class Ee extends pe{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap(t){this.config.pixelSnap=t}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,s){super(),this.size={},this.worldTransform={},t||(t=xe),this.manager=s,this.innerId=i.create(i.CNAVAS);const{width:r,height:n,pixelRatio:o}=t;this.autoLayout=!r||!n,this.size.pixelRatio=o||e.devicePixelRatio,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t,e=!0){if(this.isSameSize(t))return;let i;this.context&&!this.unreal&&e&&this.width&&(i=this.getSameCanvas(),i.copyWorld(this));const s=this.size;g.copyAttrs(s,t,be),be.forEach(t=>s[t]||(s[t]=1)),this.bounds=new Nt(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&i&&(this.clearWorld(i.bounds),this.copyWorld(i),i.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:i,pixelSnap:s}=this,r=this.worldTransform;e&&fe(t,e,r),ye(t,i,r),s&&!t.ignorePixelSnap&&(t.half&&t.half*i%2?(r.e=me(r.e-.5)+.5,r.f=me(r.f-.5)+.5):(r.e=me(r.e),r.f=me(r.f))),this.setTransform(r.a,r.b,r.c,r.d,r.e,r.f)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,i,s){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i,s)}setStrokeOptions(t,e){let{strokeCap:i,strokeJoin:s,dashPattern:r,dashOffset:n,miterLimit:a}=t;e&&(e.strokeCap&&(i=e.strokeCap),e.strokeJoin&&(s=e.strokeJoin),o(e.dashPattern)||(r=e.dashPattern),o(e.dashOffset)||(n=e.dashOffset),e.miterLimit&&(a=e.miterLimit)),this.strokeCap=i,this.strokeJoin=s,this.dashPattern=r,this.dashOffset=n,this.miterLimit=a}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,i=1){return!0}setWorldShadow(t,e,i,s){const{pixelRatio:r}=this;this.shadowOffsetX=t*r,this.shadowOffsetY=e*r,this.shadowBlur=i*r,this.shadowColor=s||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,i,s,r=!0){s&&(this.blendMode=s),e?(this.setTempPixelBounds(e,r),i?(this.setTempPixelBounds2(i,r),i=we):i=ve,this.drawImage(t.view,ve.x,ve.y,ve.width,ve.height,i.x,i.y,i.width,i.height)):this.drawImage(t.view,0,0),s&&(this.blendMode="source-over")}copyWorldToInner(t,e,i,s,r=!0){e.b||e.c?(this.save(),this.resetTransform(),this.copyWorld(t,e,Wt.tempToOuterOf(i,e),s,r),this.restore()):(s&&(this.blendMode=s),this.setTempPixelBounds(e,r),this.drawImage(t.view,ve.x,ve.y,ve.width,ve.height,i.x,i.y,i.width,i.height),s&&(this.blendMode="source-over"))}copyWorldByReset(t,e,i,s,r,n=!0){this.resetTransform(),this.copyWorld(t,e,i,s,n),r||this.useWorldTransform()}useGrayscaleAlpha(t){let e,i;this.setTempPixelBounds(t,!0,!0);const{context:s}=this,r=s.getImageData(ve.x,ve.y,ve.width,ve.height),{data:n}=r;for(let t=0,s=n.length;t<s;t+=4)i=.299*n[t]+.587*n[t+1]+.114*n[t+2],(e=n[t+3])&&(n[t+3]=255===e?i:e*(i/255));s.putImageData(r,ve.x,ve.y)}useMask(t,e,i){this.copyWorld(t,e,i,"destination-in")}useEraser(t,e,i){this.copyWorld(t,e,i,"destination-out")}fillWorld(t,e,i,s){i&&(this.blendMode=i),this.fillStyle=e,this.setTempPixelBounds(t,s),this.fillRect(ve.x,ve.y,ve.width,ve.height),i&&(this.blendMode="source-over")}strokeWorld(t,e,i,s){i&&(this.blendMode=i),this.strokeStyle=e,this.setTempPixelBounds(t,s),this.strokeRect(ve.x,ve.y,ve.width,ve.height),i&&(this.blendMode="source-over")}clipWorld(t,e=!0){this.beginPath(),this.setTempPixelBounds(t,e),this.rect(ve.x,ve.y,ve.width,ve.height),this.clip()}clipUI(t){t.windingRule?this.clip(t.windingRule):this.clip()}clearWorld(t,e=!0){this.setTempPixelBounds(t,e),this.clearRect(ve.x,ve.y,ve.width,ve.height)}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}setTempPixelBounds(t,e,i){this.copyToPixelBounds(ve,t,e,i)}setTempPixelBounds2(t,e,i){this.copyToPixelBounds(we,t,e,i)}copyToPixelBounds(t,e,i,s){t.set(e),s&&t.intersect(this.bounds),t.scale(this.pixelRatio),i&&t.ceil()}isSameSize(t){return this.width===t.width&&this.height===t.height&&(!t.pixelRatio||this.pixelRatio===t.pixelRatio)}getSameCanvas(t,e){const{size:i,pixelSnap:s}=this,r=this.manager?this.manager.get(i):te.canvas(Object.assign({},i));return r.save(),t&&(ge(r.worldTransform,this.worldTransform),r.useWorldTransform()),e&&(r.smooth=this.smooth),r.pixelSnap!==s&&(r.pixelSnap=s),r}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const Pe={creator:{},parse(t,e){},convertToCanvasData(t,e){}},Be={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},ke=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Be),Se={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Te={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Re=Object.assign(Object.assign({},Te),Be),Ce=ke,Le={};for(let t in Ce)Le[Ce[t]]=t;const Oe={};for(let t in Ce)Oe[Ce[t]]=Se[t];const De={drawRoundRect(t,e,i,s,r,n){const o=L.fourNumber(n,Math.min(s/2,r/2)),a=e+s,h=i+r;o[0]?t.moveTo(e+o[0],i):t.moveTo(e,i),o[1]?t.arcTo(a,i,a,h,o[1]):t.lineTo(a,i),o[2]?t.arcTo(a,h,e,h,o[2]):t.lineTo(a,h),o[3]?t.arcTo(e,h,e,i,o[3]):t.lineTo(e,h),o[0]?t.arcTo(e,i,a,i,o[0]):t.lineTo(e,i)}},{sin:Ie,cos:Ae,hypot:Me,atan2:We,ceil:Fe,abs:Ue,PI:ze,sqrt:Ne,pow:Ye}=Math,{setPoint:Xe,addPoint:He}=ut,{set:je,toNumberPoints:Ve}=st,{M:Ge,L:Ke,C:qe,Q:Ze,Z:$e}=ke,Qe={},Je={points(t,e,i,s){let r=Ve(e);if(t.push(Ge,r[0],r[1]),i&&r.length>5){let e,n,o,a,h,l,d,c,u,_,p,g,f,y=r.length;const m=!0===i?.5:i;s&&(r=[r[y-2],r[y-1],...r,r[0],r[1],r[2],r[3]],y=r.length);for(let i=2;i<y-2;i+=2)e=r[i-2],n=r[i-1],o=r[i],a=r[i+1],h=r[i+2],l=r[i+3],p=Ne(Ye(o-e,2)+Ye(a-n,2)),g=Ne(Ye(h-o,2)+Ye(l-a,2)),(p||g)&&(f=p+g,p=m*p/f,g=m*g/f,h-=e,l-=n,d=o-p*h,c=a-p*l,2===i?s||t.push(Ze,d,c,o,a):t.push(qe,u,_,d,c,o,a),u=o+g*h,_=a+g*l);s||t.push(Ze,u,_,r[y-2],r[y-1])}else for(let e=2,i=r.length;e<i;e+=2)t.push(Ke,r[e],r[e+1]);s&&t.push($e)},rect(t,e,i,s,r){Pe.creator.path=t,Pe.creator.moveTo(e,i).lineTo(e+s,i).lineTo(e+s,i+r).lineTo(e,i+r).lineTo(e,i)},roundRect(t,e,i,s,r,n){Pe.creator.path=[],De.drawRoundRect(Pe.creator,e,i,s,r,n),t.push(...Pe.convertToCanvasData(Pe.creator.path,!0))},arcTo(t,e,i,s,r,n,o,a,h,l,d){const c=s-e,u=r-i,_=n-s,p=o-r;let g=We(u,c),f=We(p,_);const y=Me(c,u),m=Me(_,p);let v=f-g;if(v<0&&(v+=I),y<1e-12||m<1e-12||v<1e-12||Ue(v-ze)<1e-12)return t&&t.push(Ke,s,r),h&&(Xe(h,e,i),He(h,s,r)),d&&je(d,e,i),void(l&&je(l,s,r));const w=c*p-_*u<0,x=w?-1:1,b=a/Ae(v/2),E=s+b*Ae(g+v/2+A*x),P=r+b*Ie(g+v/2+A*x);return g-=A*x,f-=A*x,ii(t,E,P,a,a,0,g/D,f/D,w,h,l,d)},arc:(t,e,i,s,r,n,o,a,h,l)=>ii(t,e,i,s,s,0,r,n,o,a,h,l),ellipse(t,e,i,s,r,n,o,a,h,l,d,c){const u=n*D,_=Ie(u),p=Ae(u);let g=o*D,f=a*D;g>ze&&(g-=I),f<0&&(f+=I);let y=f-g;y<0?y+=I:y>I&&(y-=I),h&&(y-=I);const m=Fe(Ue(y/A)),v=y/m,w=Ie(v/4),x=8/3*w*w/Ie(v/2);f=g+v;let b,E,P,B,k,S,T,R,C=Ae(g),L=Ie(g),O=P=p*s*C-_*r*L,M=B=_*s*C+p*r*L,W=e+P,F=i+B;t&&t.push(t.length?Ke:Ge,W,F),l&&Xe(l,W,F),c&&je(c,W,F);for(let n=0;n<m;n++)b=Ae(f),E=Ie(f),P=p*s*b-_*r*E,B=_*s*b+p*r*E,k=e+O-x*(p*s*L+_*r*C),S=i+M-x*(_*s*L-p*r*C),T=e+P+x*(p*s*E+_*r*b),R=i+B+x*(_*s*E-p*r*b),t&&t.push(qe,k,S,T,R,e+P,i+B),l&&ei(e+O,i+M,k,S,T,R,e+P,i+B,l,!0),O=P,M=B,C=b,L=E,g=f,f+=v;d&&je(d,e+P,i+B)},quadraticCurveTo(t,e,i,s,r,n,o){t.push(qe,(e+2*s)/3,(i+2*r)/3,(n+2*s)/3,(o+2*r)/3,n,o)},toTwoPointBoundsByQuadraticCurve(t,e,i,s,r,n,o,a){ei(t,e,(t+2*i)/3,(e+2*s)/3,(r+2*i)/3,(n+2*s)/3,r,n,o,a)},toTwoPointBounds(t,e,i,s,r,n,o,a,h,l){const d=[];let c,u,_,p,g,f,y,m,v=t,w=i,x=r,b=o;for(let t=0;t<2;++t)if(1==t&&(v=e,w=s,x=n,b=a),c=-3*v+9*w-9*x+3*b,u=6*v-12*w+6*x,_=3*w-3*v,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;p=-_/u,0<p&&p<1&&d.push(p)}else y=u*u-4*_*c,m=Math.sqrt(y),y<0||(g=(-u+m)/(2*c),0<g&&g<1&&d.push(g),f=(-u-m)/(2*c),0<f&&f<1&&d.push(f));l?He(h,t,e):Xe(h,t,e),He(h,o,a);for(let l=0,c=d.length;l<c;l++)ti(d[l],t,e,i,s,r,n,o,a,Qe),He(h,Qe.x,Qe.y)},getPointAndSet(t,e,i,s,r,n,o,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,_=3*d*t*t,p=t*t*t;l.x=c*e+u*s+_*n+p*a,l.y=c*i+u*r+_*o+p*h},getPoint(t,e,i,s,r,n,o,a,h){const l={};return ti(t,e,i,s,r,n,o,a,h,l),l},getDerivative(t,e,i,s,r){const n=1-t;return 3*n*n*(i-e)+6*n*t*(s-i)+3*t*t*(r-s)}},{getPointAndSet:ti,toTwoPointBounds:ei,ellipse:ii}=Je,{sin:si,cos:ri,sqrt:ni,atan2:oi}=Math,{ellipse:ai}=Je,hi={ellipticalArc(t,i,s,r,n,o,a,h,l,d,c){const u=(l-i)/2,_=(d-s)/2,p=o*D,g=si(p),f=ri(p),y=-f*u-g*_,m=-f*_+g*u,v=r*r,w=n*n,x=m*m,b=y*y,E=v*w-v*x-w*b;let P=0;if(E<0){const t=ni(1-E/(v*w));r*=t,n*=t}else P=(a===h?-1:1)*ni(E/(v*x+w*b));const B=P*r*m/n,k=-P*n*y/r,S=oi((m-k)/n,(y-B)/r),T=oi((-m-k)/n,(-y-B)/r);let R=T-S;0===h&&R>0?R-=I:1===h&&R<0&&(R+=I);const C=i+u+f*B-g*k,L=s+_+g*B+f*k,O=R<0?1:0;c||e.ellipseToCurve?ai(t,C,L,r,n,o,S/D,T/D,O):r!==n||o?t.push(ke.G,C,L,r,n,o,S/D,T/D,O):t.push(ke.O,C,L,r,S/D,T/D,O)}},{M:li,m:di,L:ci,l:ui,H:_i,h:pi,V:gi,v:fi,C:yi,c:mi,S:vi,s:wi,Q:xi,q:bi,T:Ei,t:Pi,A:Bi,a:ki,Z:Si,z:Ti,N:Ri,D:Ci,X:Li,G:Oi,F:Di,O:Ii,P:Ai,U:Mi}=ke,{rect:Wi,roundRect:Fi,arcTo:Ui,arc:zi,ellipse:Ni,quadraticCurveTo:Yi}=Je,{ellipticalArc:Xi}=hi,Hi=Vt.get("PathConvert"),ji={},Vi={current:{dot:0},stringify(t,e){let i,s,r,n=0,o=t.length,a="";for(;n<o;){s=t[n],i=Oe[s],a+=s===r?" ":Le[s];for(let s=1;s<i;s++)a+=L.float(t[n+s],e),s===i-1||(a+=" ");r=s,n+=i}return a},parse(t,e){let i,s,r,n="";const o=[],a=e?Re:Te;for(let e=0,h=t.length;e<h;e++)s=t[e],Ht[s]?("."===s&&(Gi.dot&&(Ki(o,n),n=""),Gi.dot++),"0"===n&&"."!==s&&(Ki(o,n),n=""),n+=s):ke[s]?(n&&(Ki(o,n),n=""),Gi.name=ke[s],Gi.length=Se[s],Gi.index=0,Ki(o,Gi.name),!i&&a[s]&&(i=!0)):"-"===s||"+"===s?"e"===r||"E"===r?n+=s:(n&&Ki(o,n),n=s):n&&(Ki(o,n),n=""),r=s;return n&&Ki(o,n),i?Vi.toCanvasData(o,e):o},toCanvasData(t,e){let i,s,r,n,o,a=0,h=0,l=0,d=0,c=0,u=t.length;const _=[];for(;c<u;){switch(r=t[c],r){case di:t[c+1]+=a,t[c+2]+=h;case li:a=t[c+1],h=t[c+2],_.push(li,a,h),c+=3;break;case pi:t[c+1]+=a;case _i:a=t[c+1],_.push(ci,a,h),c+=2;break;case fi:t[c+1]+=h;case gi:h=t[c+1],_.push(ci,a,h),c+=2;break;case ui:t[c+1]+=a,t[c+2]+=h;case ci:a=t[c+1],h=t[c+2],_.push(ci,a,h),c+=3;break;case wi:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=vi;case vi:o=n===yi||n===vi,l=o?2*a-i:t[c+1],d=o?2*h-s:t[c+2],i=t[c+1],s=t[c+2],a=t[c+3],h=t[c+4],_.push(yi,l,d,i,s,a,h),c+=5;break;case mi:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,r=yi;case yi:i=t[c+3],s=t[c+4],a=t[c+5],h=t[c+6],_.push(yi,t[c+1],t[c+2],i,s,a,h),c+=7;break;case Pi:t[c+1]+=a,t[c+2]+=h,r=Ei;case Ei:o=n===xi||n===Ei,i=o?2*a-i:t[c+1],s=o?2*h-s:t[c+2],e?Yi(_,a,h,i,s,t[c+1],t[c+2]):_.push(xi,i,s,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case bi:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=xi;case xi:i=t[c+1],s=t[c+2],e?Yi(_,a,h,i,s,t[c+3],t[c+4]):_.push(xi,i,s,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case ki:t[c+6]+=a,t[c+7]+=h;case Bi:Xi(_,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case Ti:case Si:_.push(Si),c++;break;case Ri:a=t[c+1],h=t[c+2],e?Wi(_,a,h,t[c+3],t[c+4]):qi(_,t,c,5),c+=5;break;case Ci:a=t[c+1],h=t[c+2],e?Fi(_,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):qi(_,t,c,9),c+=9;break;case Li:a=t[c+1],h=t[c+2],e?Fi(_,a,h,t[c+3],t[c+4],t[c+5]):qi(_,t,c,6),c+=6;break;case Oi:Ni(e?_:qi(_,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,ji),a=ji.x,h=ji.y,c+=9;break;case Di:e?Ni(_,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):qi(_,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case Ii:zi(e?_:qi(_,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,ji),a=ji.x,h=ji.y,c+=7;break;case Ai:e?zi(_,t[c+1],t[c+2],t[c+3],0,360,!1):qi(_,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case Mi:Ui(e?_:qi(_,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,ji),a=ji.x,h=ji.y,c+=6;break;default:return Hi.error(`command: ${r} [index:${c}]`,t),_}n=r}return _},objectToCanvasData(t){const e=[];return t.forEach(t=>{switch(t.name){case"M":e.push(li,t.x,t.y);break;case"L":e.push(ci,t.x,t.y);break;case"C":e.push(yi,t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"Q":e.push(xi,t.x1,t.y1,t.x,t.y);break;case"Z":e.push(Si)}}),e},copyData(t,e,i,s){for(let r=i,n=i+s;r<n;r++)t.push(e[r])},pushData(t,e){Gi.index===Gi.length&&(Gi.index=1,t.push(Gi.name)),t.push(Number(e)),Gi.index++,Gi.dot=0}},{current:Gi,pushData:Ki,copyData:qi}=Vi,{M:Zi,L:$i,C:Qi,Q:Ji,Z:ts,N:es,D:is,X:ss,G:rs,F:ns,O:os,P:as,U:hs}=ke,{getMinDistanceFrom:ls,getRadianFrom:ds}=st,{tan:cs,min:us,abs:_s}=Math,ps={},gs={beginPath(t){t.length=0},moveTo(t,e,i){t.push(Zi,e,i)},lineTo(t,e,i){t.push($i,e,i)},bezierCurveTo(t,e,i,s,r,n,o){t.push(Qi,e,i,s,r,n,o)},quadraticCurveTo(t,e,i,s,r){t.push(Ji,e,i,s,r)},closePath(t){t.push(ts)},rect(t,e,i,s,r){t.push(es,e,i,s,r)},roundRect(t,e,i,s,r,n){if(d(n))t.push(ss,e,i,s,r,n);else{const o=L.fourNumber(n);o?t.push(is,e,i,s,r,...o):t.push(es,e,i,s,r)}},ellipse(t,e,i,s,r,n,o,h,l){a(n)?t.push(ns,e,i,s,r):(a(o)&&(o=0),a(h)&&(h=360),t.push(rs,e,i,s,r,n,o,h,l?1:0))},arc(t,e,i,s,r,n,o){a(r)?t.push(as,e,i,s):(a(n)&&(n=360),t.push(os,e,i,s,r,n,o?1:0))},arcTo(t,e,i,s,r,n,a,h){if(!o(a)){const t=ls(a,h,e,i,s,r);n=us(n,us(t/2,t/2*_s(cs(ds(a,h,e,i,s,r)/2))))}t.push(hs,e,i,s,r,n)},drawEllipse(t,e,i,s,r,n,o,h,l){Je.ellipse(null,e,i,s,r,a(n)?0:n,a(o)?0:o,a(h)?360:h,l,null,null,ps),t.push(Zi,ps.x,ps.y),fs(t,e,i,s,r,n,o,h,l)},drawArc(t,e,i,s,r,n,o){Je.arc(null,e,i,s,a(r)?0:r,a(n)?360:n,o,null,null,ps),t.push(Zi,ps.x,ps.y),ys(t,e,i,s,r,n,o)},drawPoints(t,e,i,s){Je.points(t,e,i,s)}},{ellipse:fs,arc:ys}=gs,{moveTo:ms,lineTo:vs,quadraticCurveTo:ws,bezierCurveTo:xs,closePath:bs,beginPath:Es,rect:Ps,roundRect:Bs,ellipse:ks,arc:Ss,arcTo:Ts,drawEllipse:Rs,drawArc:Cs,drawPoints:Ls}=gs;class Os{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return this.__path=t?h(t)?Pe.parse(t):t:[],this}beginPath(){return Es(this.__path),this.paint(),this}moveTo(t,e){return ms(this.__path,t,e),this.paint(),this}lineTo(t,e){return vs(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,i,s,r,n){return xs(this.__path,t,e,i,s,r,n),this.paint(),this}quadraticCurveTo(t,e,i,s){return ws(this.__path,t,e,i,s),this.paint(),this}closePath(){return bs(this.__path),this.paint(),this}rect(t,e,i,s){return Ps(this.__path,t,e,i,s),this.paint(),this}roundRect(t,e,i,s,r){return Bs(this.__path,t,e,i,s,r),this.paint(),this}ellipse(t,e,i,s,r,n,o,a){return ks(this.__path,t,e,i,s,r,n,o,a),this.paint(),this}arc(t,e,i,s,r,n){return Ss(this.__path,t,e,i,s,r,n),this.paint(),this}arcTo(t,e,i,s,r){return Ts(this.__path,t,e,i,s,r),this.paint(),this}drawEllipse(t,e,i,s,r,n,o,a){return Rs(this.__path,t,e,i,s,r,n,o,a),this.paint(),this}drawArc(t,e,i,s,r,n){return Cs(this.__path,t,e,i,s,r,n),this.paint(),this}drawPoints(t,e,i){return Ls(this.__path,t,e,i),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Ds,L:Is,C:As,Q:Ms,Z:Ws,N:Fs,D:Us,X:zs,G:Ns,F:Ys,O:Xs,P:Hs,U:js}=ke,Vs=Vt.get("PathDrawer"),Gs={drawPathByData(t,e){if(!e)return;let i,s=0,r=e.length;for(;s<r;)switch(i=e[s],i){case Ds:t.moveTo(e[s+1],e[s+2]),s+=3;break;case Is:t.lineTo(e[s+1],e[s+2]),s+=3;break;case As:t.bezierCurveTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6]),s+=7;break;case Ms:t.quadraticCurveTo(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case Ws:t.closePath(),s+=1;break;case Fs:t.rect(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case Us:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],[e[s+5],e[s+6],e[s+7],e[s+8]]),s+=9;break;case zs:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;case Ns:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]*D,e[s+6]*D,e[s+7]*D,e[s+8]),s+=9;break;case Ys:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],0,0,I,!1),s+=5;break;case Xs:t.arc(e[s+1],e[s+2],e[s+3],e[s+4]*D,e[s+5]*D,e[s+6]),s+=7;break;case Hs:t.arc(e[s+1],e[s+2],e[s+3],0,I,!1),s+=4;break;case js:t.arcTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;default:return void Vs.error(`command: ${i} [index:${s}]`,e)}}},{M:Ks,L:qs,C:Zs,Q:$s,Z:Qs,N:Js,D:tr,X:er,G:ir,F:sr,O:rr,P:nr,U:or}=ke,{toTwoPointBounds:ar,toTwoPointBoundsByQuadraticCurve:hr,arcTo:lr,arc:dr,ellipse:cr}=Je,{addPointBounds:ur,copy:_r,addPoint:pr,setPoint:gr,addBounds:fr,toBounds:yr}=ut,mr=Vt.get("PathBounds");let vr,wr,xr;const br={},Er={},Pr={},Br={toBounds(t,e){Br.toTwoPointBounds(t,Er),yr(Er,e)},toTwoPointBounds(t,e){if(!t||!t.length)return gr(e,0,0);let i,s,r,n,o,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(o=t[a],0===a&&(o===Qs||o===Zs||o===$s?gr(e,h,l):gr(e,t[a+1],t[a+2])),o){case Ks:case qs:h=t[a+1],l=t[a+2],pr(e,h,l),a+=3;break;case Zs:r=t[a+5],n=t[a+6],ar(h,l,t[a+1],t[a+2],t[a+3],t[a+4],r,n,br),ur(e,br),h=r,l=n,a+=7;break;case $s:i=t[a+1],s=t[a+2],r=t[a+3],n=t[a+4],hr(h,l,i,s,r,n,br),ur(e,br),h=r,l=n,a+=5;break;case Qs:a+=1;break;case Js:h=t[a+1],l=t[a+2],fr(e,h,l,t[a+3],t[a+4]),a+=5;break;case tr:case er:h=t[a+1],l=t[a+2],fr(e,h,l,t[a+3],t[a+4]),a+=o===tr?9:6;break;case ir:cr(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],br,Pr),0===a?_r(e,br):ur(e,br),h=Pr.x,l=Pr.y,a+=9;break;case sr:h=t[a+1],l=t[a+2],wr=t[a+3],xr=t[a+4],fr(e,h-wr,l-xr,2*wr,2*xr),h+=wr,a+=5;break;case rr:dr(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],br,Pr),0===a?_r(e,br):ur(e,br),h=Pr.x,l=Pr.y,a+=7;break;case nr:h=t[a+1],l=t[a+2],vr=t[a+3],fr(e,h-vr,l-vr,2*vr,2*vr),h+=vr,a+=4;break;case or:lr(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],br,Pr),0===a?_r(e,br):ur(e,br),h=Pr.x,l=Pr.y,a+=6;break;default:return void mr.error(`command: ${o} [index:${a}]`,t)}}},{M:kr,L:Sr,Z:Tr}=ke,{getCenterX:Rr,getCenterY:Cr}=st,{arcTo:Lr}=gs,Or={smooth(t,e,i){let s,r,n,o=0,a=0,h=0,l=0,d=0,c=0,u=0,_=0,p=0;const g=t.length,f=[];for(;o<g;){switch(s=t[o],s){case kr:l=_=t[o+1],d=p=t[o+2],o+=3,t[o]===Sr?(c=t[o+1],u=t[o+2],f.push(kr,Rr(l,c),Cr(d,u))):f.push(kr,l,d);break;case Sr:switch(a=t[o+1],h=t[o+2],o+=3,t[o]){case Sr:Lr(f,a,h,t[o+1],t[o+2],e,_,p);break;case Tr:Lr(f,a,h,l,d,e,_,p);break;default:f.push(Sr,a,h)}_=a,p=h;break;case Tr:r!==Tr&&(Lr(f,l,d,c,u,e,_,p),f.push(Tr)),o+=1;break;default:n=Oe[s];for(let e=0;e<n;e++)f.push(t[o+e]);o+=n}r=s}return s!==Tr&&(f[1]=l,f[2]=d),f}};function Dr(t){return new Os(t)}const Ir=Dr();Pe.creator=Dr(),Pe.parse=Vi.parse,Pe.convertToCanvasData=Vi.toCanvasData;const{drawRoundRect:Ar}=De;function Mr(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,i,s,r){Ar(this,t,e,i,s,r)})}(t)}const Wr={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=Fr.fileType(t);return["jpg","jpeg"].some(t=>t===e)},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},Fr=Wr;Fr.alphaPixelTypes.forEach(t=>Fr.upperCaseTypeMap[t]=t.toUpperCase());const Ur=Vt.get("TaskProcessor");class zr{constructor(t){this.parallel=!0,this.time=1,this.id=i.create(i.TASK),this.task=t}run(){return le(this,void 0,void 0,function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){Ur.error(t)}})}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class Nr{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,i=0;for(let s=0;s<t;s++)s<=this.finishedIndex?(i+=this.list[s].time,s===this.finishedIndex&&(e=i)):e+=this.list[s].time;return this.isComplete?1:i/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&g.assign(this.config,t),this.empty()}add(t,e){let i,s,r,n;const a=new zr(t);return a.parent=this,d(e)?n=e:e&&(s=e.parallel,i=e.start,r=e.time,n=e.delay),r&&(a.time=r),!1===s&&(a.parallel=!1),o(n)?this.push(a,i):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(a,i))},n)),this.isComplete=!1,a}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(t=>{t.isComplete||t.cancel()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];if(t)return t.isCancel?(this.index++,void this.runTask()):void t.run().then(()=>{this.onTask(t),this.index++,this.nextTask()}).catch(t=>{this.onError(t)});this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach(t=>this.runParallelTask(t))}runParallelTask(t){t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(t=>{this.onParallelError(t)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let t;const{config:e,list:i,index:s}=this;this.parallelList=[],this.parallelSuccessNumber=0;let r=s+e.parallel;if(r>i.length&&(r=i.length),e.parallel>1)for(let e=s;e<r&&(t=i[e],t.parallel);e++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const i=e.length,s=this.finishedIndex+i;if(e.length){if(!this.running)return;s<this.total&&(t=this.list[s],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach(t=>{t.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const Yr=Vt.get("Resource"),Xr={tasker:new Nr,map:{},get isComplete(){return Hr.tasker.isComplete},set(t,e){Hr.map[t]&&Yr.repeat(t),Hr.map[t]=e},get:t=>Hr.map[t],remove(t){const e=Hr.map[t];e&&(e.destroy&&e.destroy(),delete Hr.map[t])},loadImage(t,e){return new Promise((i,s)=>{const r=this.setImage(t,t,e);r.load(()=>i(r),t=>s(t))})},setImage(t,e,i){let s;return h(e)?s={url:e}:e.url||(s={url:t,view:e}),s&&(i&&(s.format=i),e=te.image(s)),Hr.set(t,e),e},destroy(){Hr.map={}}},Hr=Xr,jr={maxRecycled:10,recycledList:[],patternTasker:new Nr,get(t){let e=Xr.get(t.url);return e||Xr.set(t.url,e=te.image(t)),e.use++,e},recycle(t){t.use--,setTimeout(()=>{t.use||Vr.recycledList.push(t)})},clearRecycled(){const t=Vr.recycledList;t.length>Vr.maxRecycled&&(t.forEach(t=>!t.use&&t.url&&Xr.remove(t.url)),t.length=0)},hasAlphaPixel:t=>Wr.alphaPixelTypes.some(e=>Vr.isFormat(e,t)),isFormat(t,e){if(e.format)return e.format===t;const{url:i}=e;if(i.startsWith("data:")){if(i.startsWith("data:"+Wr.mineType(t)))return!0}else{if(i.includes("."+t)||i.includes("."+Wr.upperCaseTypeMap[t]))return!0;if("png"===t&&!i.includes("."))return!0}return!1},destroy(){Vr.recycledList=[]}},Vr=jr,{IMAGE:Gr,create:Kr}=i,{floor:qr,max:Zr}=Math;class $r{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){if(this.use=0,this.waitComplete=[],this.innerId=Kr(Gr),this.config=t||(t={url:""}),t.view){const{view:e}=t;this.setView(e.config?e.view:e)}jr.isFormat("svg",t)&&(this.isSVG=!0),jr.hasAlphaPixel(t)&&(this.hasAlphaPixel=!0)}load(t,i){if(!this.loading){this.loading=!0;let{loadImage:t,loadImageWithProgress:i}=e.origin,s=this.config.showProgress&&i&&this.onProgress.bind(this);s&&(t=i),Xr.tasker.add(()=>le(this,void 0,void 0,function*(){return yield t(this.url,s).then(t=>this.setView(t)).catch(t=>{this.error=t,this.onComplete(!1)})}))}return this.waitComplete.push(t,i),this.waitComplete.length-2}unload(t,e){const i=this.waitComplete;if(e){const e=i[t+1];e&&e({type:"stop"})}i[t]=i[t+1]=void 0}setView(t){this.ready=!0,this.width=t.naturalWidth||t.width,this.height=t.naturalHeight||t.height,this.view=t,this.onComplete(!0)}onProgress(t){this.progress=t}onComplete(t){let e;this.waitComplete.forEach((i,s)=>{e=s%2,i&&(t?e||i(this):e&&i(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(t){return this.view}getCanvas(t,i,s,r,n,o,a){if(t||(t=this.width),i||(i=this.height),this.cache){let{params:t,data:e}=this.cache;for(let i in t)if(t[i]!==arguments[i]){e=null;break}if(e)return e}const h=e.origin.createCanvas(Zr(qr(t+(n||0)),1),Zr(qr(i+(o||0)),1)),l=h.getContext("2d");return s&&(l.globalAlpha=s),l.imageSmoothingEnabled=!1!==a,l.drawImage(this.view,0,0,t,i),this.cache=this.use>1?{data:h,params:arguments}:null,h}getPattern(t,i,s,r){const n=e.canvas.createPattern(t,i);try{s&&n.setTransform&&(n.setTransform(s),s=void 0)}catch(t){}return r&&g.stintSet(r,"transform",s),n}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function Qr(t,e,i,s){s||(i.configurable=i.enumerable=!0),Object.defineProperty(t,e,i)}function Jr(t,e){return Object.getOwnPropertyDescriptor(t,e)}function tn(t,e){const i="_"+t;return{get(){const t=this[i];return null==t?e:t},set(t){this[i]=t}}}function en(t,e){return(i,s)=>rn(i,s,t,e&&e(s))}function sn(t){return t}function rn(t,e,i,s){const r={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};Qr(t,e,Object.assign(r,s||{})),On(t,e,i)}function nn(t){return en(t)}function on(t,e){return en(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function an(t,e){return en(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function hn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),_n(this))}}))}function ln(t,e){return en(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function dn(t,e){return en(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function cn(t,e){return en(t,t=>({set(i){this.__setAttr(t,i,e)&&_n(this)}}))}function un(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(_n(this),this.__.__removeNaturalSize())}}))}function _n(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}function pn(t){return en(t,t=>({set(e){const i=this.__;2!==i.__pathInputed&&(i.__pathInputed=e?1:0),e||(i.__pathForRender=void 0),this.__setAttr(t,e),_n(this)}}))}const gn=cn;function fn(t,e){return en(t,t=>({set(i){this.__setAttr(t,i)&&(yn(this),e&&(this.__.__useStroke=!0))}}))}function yn(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&_n(t)}const mn=fn;function vn(t){return en(t,t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}}))}function wn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function xn(t){return en(t,t=>({set(e){if(this.__setAttr(t,e)){const t=this.__;g.stintSet(t,"__useDim",t.dim||t.bright||t.dimskip),this.__layout.surfaceChange()}}}))}function bn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&Pn(this)}}))}function En(t){return en(t,t=>({set(e){const i=this.visible;if(!0===i&&0===e){if(this.animationOut)return this.__runAnimation("out",()=>Bn(this,t,e,i))}else 0===i&&!0===e&&this.animation&&this.__runAnimation("in");Bn(this,t,e,i),this.mask&&Pn(this)}}))}function Pn(t){const{parent:e}=t;if(e){const{__hasMask:t}=e;e.__updateMask(),t!==e.__hasMask&&e.forceUpdate()}}function Bn(t,e,i,s){t.__setAttr(e,i)&&(t.__layout.opacityChanged||t.__layout.opacityChange(),0!==s&&0!==i||_n(t))}function kn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function Sn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(e)}))}}))}function Tn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&this.waitParent(()=>{this.parent.__updateEraser(e)})}}))}function Rn(t){return en(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,"hit"===Vt.showBounds&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function Cn(t){return en(t,t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}}))}function Ln(t){return(e,i)=>{Qr(e,"__DataProcessor",{get:()=>t})}}function On(t,e,i){const s=t.__DataProcessor.prototype,r="_"+e,n=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),a=tn(e,i);if(o(i))a.get=function(){return this[r]};else if("function"==typeof i)a.get=function(){const t=this[r];return null==t?i(this.__leaf):t};else if(_(i)){const t=p(i);a.get=function(){const e=this[r];return null==e?this[r]=t?{}:g.clone(i):e}}const h=t.isBranchLeaf;"width"===e?a.get=function(){const t=this[r];if(null==t){const t=this,e=t.__naturalWidth,s=t.__leaf;return!i||s.pathInputed?s.boxBounds.width:e?t._height&&t.__useNaturalRatio?t._height*e/t.__naturalHeight:e:h&&s.children.length?s.boxBounds.width:i}return t}:"height"===e&&(a.get=function(){const t=this[r];if(null==t){const t=this,e=t.__naturalHeight,s=t.__leaf;return!i||s.pathInputed?s.boxBounds.height:e?t._width&&t.__useNaturalRatio?t._width*e/t.__naturalWidth:e:h&&s.children.length?s.boxBounds.height:i}return t});let l,d=s;for(;!l&&d;)l=Jr(d,e),d=d.__proto__;l&&l.set&&(a.set=l.set),s[n]&&(a.set=s[n],delete s[n]),Qr(s,e,a)}const Dn=new Vt("rewrite"),In=[],An=["destroy","constructor"];function Mn(t){return(e,i)=>{In.push({name:e.constructor.name+"."+i,run:()=>{e[i]=t}})}}function Wn(){return t=>{Fn()}}function Fn(t){In.length&&(In.forEach(e=>{t&&Dn.error(e.name,"Class@rewriteAble()"),e.run()}),In.length=0)}function Un(t,e){return i=>{var s;(t.prototype?(s=t.prototype,Object.getOwnPropertyNames(s)):Object.keys(t)).forEach(s=>{if(!(An.includes(s)||e&&e.includes(s)))if(t.prototype){Jr(t.prototype,s).writable&&(i.prototype[s]=t.prototype[s])}else i.prototype[s]=t[s]})}}function zn(){return t=>{ie.register(t)}}function Nn(){return t=>{ne.register(t)}}setTimeout(()=>Fn(!0));const{copy:Yn,toInnerPoint:Xn,toOuterPoint:Hn,scaleOfOuter:jn,rotateOfOuter:Vn,skewOfOuter:Gn,multiplyParent:Kn,divideParent:qn,getLayout:Zn}=V,$n={},{round:Qn}=Math,Jn={updateAllMatrix(t,e,i){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(i=!0),io(t,e,i),t.isBranch){const{children:s}=t;for(let t=0,r=s.length;t<r;t++)eo(s[t],e,i)}},updateMatrix(t,e,i){const s=t.__layout;e?i&&(s.waitAutoLayout=!0,t.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&t.__updateLocalMatrix(),s.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)so(e[t])}},updateChange(t){const e=t.__layout;e.stateStyleChanged&&t.updateState(),e.opacityChanged&&so(t),t.__updateChange()},updateAllChange(t){if(no(t),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)ro(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},draggable:t=>(t.draggable||t.editable)&&t.hitSelf&&!t.locked,copyCanvasByWorld(t,i,s,r,n,o){r||(r=t.__nowWorld),t.__worldFlipped||e.fullImageShadow?i.copyWorldByReset(s,r,t.__nowWorld,n,o):i.copyWorldToInner(s,r,t.__layout.renderBounds,n)},moveWorld(t,e,i=0,s,r){const n=_(e)?Object.assign({},e):{x:e,y:i};s?Hn(t.localTransform,n,n,!0):t.parent&&Xn(t.parent.scrollWorldTransform,n,n,!0),to.moveLocal(t,n.x,n.y,r)},moveLocal(t,e,i=0,s){_(e)&&(i=e.y,e=e.x),e+=t.x,i+=t.y,t.leafer&&t.leafer.config.pointSnap&&(e=Qn(e),i=Qn(i)),s?t.animate({x:e,y:i},s):(t.x=e,t.y=i)},zoomOfWorld(t,e,i,s,r,n){to.zoomOfLocal(t,oo(t,e),i,s,r,n)},zoomOfLocal(t,e,i,s=i,r,n){const o=t.__localMatrix;if(d(s)||(s&&(n=s),s=i),Yn($n,o),jn($n,e,i,s),to.hasHighPosition(t))to.setTransform(t,$n,r,n);else{const e=t.x+$n.e-o.e,a=t.y+$n.f-o.f;n&&!r?t.animate({x:e,y:a,scaleX:t.scaleX*i,scaleY:t.scaleY*s},n):(t.x=e,t.y=a,t.scaleResize(i,s,!0!==r))}},rotateOfWorld(t,e,i,s){to.rotateOfLocal(t,oo(t,e),i,s)},rotateOfLocal(t,e,i,s){const r=t.__localMatrix;Yn($n,r),Vn($n,e,i),to.hasHighPosition(t)?to.setTransform(t,$n,!1,s):t.set({x:t.x+$n.e-r.e,y:t.y+$n.f-r.f,rotation:L.formatRotation(t.rotation+i)},s)},skewOfWorld(t,e,i,s,r,n){to.skewOfLocal(t,oo(t,e),i,s,r,n)},skewOfLocal(t,e,i,s=0,r,n){Yn($n,t.__localMatrix),Gn($n,e,i,s),to.setTransform(t,$n,r,n)},transformWorld(t,e,i,s){Yn($n,t.worldTransform),Kn($n,e),t.parent&&qn($n,t.parent.scrollWorldTransform),to.setTransform(t,$n,i,s)},transform(t,e,i,s){Yn($n,t.localTransform),Kn($n,e),to.setTransform(t,$n,i,s)},setTransform(t,e,i,s){const r=t.__,n=r.origin&&to.getInnerOrigin(t,r.origin),o=Zn(e,n,r.around&&to.getInnerOrigin(t,r.around));if(to.hasOffset(t)&&(o.x-=r.offsetX,o.y-=r.offsetY),i){const e=o.scaleX/t.scaleX,i=o.scaleY/t.scaleY;if(delete o.scaleX,delete o.scaleY,n){Wt.scale(t.boxBounds,Math.abs(e),Math.abs(i));const s=to.getInnerOrigin(t,r.origin);st.move(o,n.x-s.x,n.y-s.y)}t.set(o),t.scaleResize(e,i,!1)}else t.set(o,s)},getFlipTransform(t,e){const i={a:1,b:0,c:0,d:1,e:0,f:0},s="x"===e?1:-1;return jn(i,to.getLocalOrigin(t,"center"),-1*s,1*s),i},getLocalOrigin:(t,e)=>st.tempToOuterOf(to.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const i={};return yt.toPoint(e,t.boxBounds,i),i},getRelativeWorld:(t,e,i)=>(Yn($n,t.worldTransform),qn($n,e.scrollWorldTransform),i?$n:Object.assign({},$n)),drop(t,e,i,s){t.setTransform(to.getRelativeWorld(t,e,!0),s),e.add(t,i)},hasHighPosition:t=>t.origin||t.around||to.hasOffset(t),hasOffset:t=>t.offsetX||t.offsetY,hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}},animateMove(t,i,s=.3){if(i.x||i.y)if(Math.abs(i.x)<1&&Math.abs(i.y)<1)t.move(i);else{const r=i.x*s,n=i.y*s;i.x-=r,i.y-=n,t.move(r,n),e.requestRender(()=>to.animateMove(t,i,s))}}},to=Jn,{updateAllMatrix:eo,updateMatrix:io,updateAllWorldOpacity:so,updateAllChange:ro,updateChange:no}=to;function oo(t,e){return t.updateLayout(),t.parent?st.tempToInnerOf(e,t.parent.scrollWorldTransform):e}const ao={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:(t,e)=>lo(t,e)&&t.__localBoxBounds,maskLocalStrokeBounds:(t,e)=>lo(t,e)&&t.__layout.localStrokeBounds,maskLocalRenderBounds:(t,e)=>lo(t,e)&&t.__layout.localRenderBounds,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))};let ho;function lo(t,e){return e||(ho=0),t.__.mask&&(ho=1),ho<0?null:(ho&&(ho=-1),!0)}const{updateBounds:co}=Jn,uo={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:i}=t;for(let s=0,r=i.length;s<r;s++)(t=i[s]).isBranch&&(t.__tempNumber=1,e.add(t),_o(t,e))}},pushAllParent(t,e){const{keys:i}=e;if(i)for(;t.parent&&o(i[t.parent.innerId]);)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let i=e.length;const{children:s}=t;for(let t=0,i=s.length;t<i;t++)s[t].isBranch&&e.push(s[t]);for(let t=i,s=e.length;t<s;t++)po(e[t],e)},updateBounds(t,e){const i=[t];po(t,i),go(i,e)},updateBoundsByBranchStack(t,e){let i,s;for(let r=t.length-1;r>-1;r--){i=t[r],s=i.children;for(let t=0,e=s.length;t<e;t++)co(s[t]);e&&e===i||co(i)}}},{pushAllChildBranch:_o,pushAllBranchStack:po,updateBoundsByBranchStack:go}=uo,fo={run(t){if(t&&t.length){const e=t.length;for(let i=0;i<e;i++)t[i]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:yo,updateBounds:mo}=Jn,{toOuterOf:vo,getPoints:wo,copy:xo}=Wt,bo="_localContentBounds",Eo="_worldContentBounds",Po="_worldBoxBounds",Bo="_worldStrokeBounds";class ko{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(t){this._renderBounds=t}get localContentBounds(){return vo(this.contentBounds,this.leaf.__localMatrix,this[bo]||(this[bo]={})),this[bo]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return vo(this.contentBounds,this.leaf.__world,this[Eo]||(this[Eo]={})),this[Eo]}get worldBoxBounds(){return vo(this.boxBounds,this.leaf.__world,this[Po]||(this[Po]={})),this[Po]}get worldStrokeBounds(){return vo(this.strokeBounds,this.leaf.__world,this[Bo]||(this[Bo]={})),this[Bo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),t.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leaf:t}=this,{leafer:i}=t;if(t.isApp)return mo(t);if(i)i.ready?i.watcher.changed&&i.layouter.layout():i.start();else{let i=t;for(;i.parent&&!i.parent.leafer;)i=i.parent;const s=i;if(s.__fullLayouting)return;s.__fullLayouting=!0,e.layout(s),delete s.__fullLayouting}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return V.defaultMatrix;case"page":t=e.zoomLayer;default:return yo(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new Nt(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",i){const{leaf:s}=this;let r,n,o,a=this.getInnerBounds(t);switch(e){case"world":r=s.getWorldPoint(a),n=s.__world;break;case"local":const{scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d}=s.__;o={scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d},r=s.getLocalPointByInner(a);break;case"inner":r=a,n=V.defaultMatrix;break;case"page":e=s.zoomLayer;default:r=s.getWorldPoint(a,e),n=yo(s,e,!0)}if(o||(o=V.getLayout(n)),xo(o,a),st.copy(o,r),i){const{scaleX:t,scaleY:e}=o,i=Math.abs(t),s=Math.abs(e);1===i&&1===s||(o.scaleX/=i,o.scaleY/=s,o.width*=i,o.height*=s)}return o}getLayoutPoints(t,e="world"){const{leaf:i}=this,s=wo(this.getInnerBounds(t));let r;switch(e){case"world":r=null;break;case"local":r=i.parent;break;case"inner":break;case"page":e=i.zoomLayer;default:r=e}return o(r)||s.forEach(t=>i.innerToWorld(t,null,!1,r)),s}shrinkContent(){const{x:t,y:e,width:i,height:s}=this.boxBounds;this._contentBounds={x:t,y:e,width:i,height:s}}spreadStroke(){const{x:t,y:e,width:i,height:s}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:i,height:s},this._localStrokeBounds={x:t,y:e,width:i,height:s},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:i,height:s}=this.renderBounds;this._renderBounds={x:t,y:e,width:i,height:s},this._localRenderBounds={x:t,y:e,width:i,height:s}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class So{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&e.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&e.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&e.event.stop(this.origin)}}class To extends So{constructor(t,e,i){super(t,e),this.parent=i,this.child=e}}To.ADD="child.add",To.REMOVE="child.remove",To.CREATED="created",To.MOUNTED="mounted",To.UNMOUNTED="unmounted",To.DESTROY="destroy";const Ro="property.scroll";class Co extends So{constructor(t,e,i,s,r){super(t,e),this.attrName=i,this.oldValue=s,this.newValue=r}}Co.CHANGE="property.change",Co.LEAFER_CHANGE="property.leafer_change",Co.SCROLL=Ro;const Lo={scrollX:Ro,scrollY:Ro};class Oo extends So{constructor(t,e){super(t),Object.assign(this,e)}}Oo.LOAD="image.load",Oo.LOADED="image.loaded",Oo.ERROR="image.error";class Do extends So{static checkHas(t,e,i){"on"===i?e===Wo?t.__hasWorldEvent=!0:t.__hasLocalEvent=!0:(t.__hasLocalEvent=t.hasEvent(Io)||t.hasEvent(Ao)||t.hasEvent(Mo),t.__hasWorldEvent=t.hasEvent(Wo))}static emitLocal(t){if(t.leaferIsReady){const{resized:e}=t.__layout;"local"!==e&&(t.emit(Io,t),"inner"===e&&t.emit(Ao,t)),t.emit(Mo,t)}}static emitWorld(t){t.leaferIsReady&&t.emit(Wo,this)}}Do.RESIZE="bounds.resize",Do.INNER="bounds.inner",Do.LOCAL="bounds.local",Do.WORLD="bounds.world";const{RESIZE:Io,INNER:Ao,LOCAL:Mo,WORLD:Wo}=Do,Fo={};[Io,Ao,Mo,Wo].forEach(t=>Fo[t]=1);class Uo extends So{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){_(t)?(super(Uo.RESIZE),Object.assign(this,t)):super(t),this.old=e}static isResizing(t){return this.resizingKeys&&!o(this.resizingKeys[t.innerId])}}Uo.RESIZE="resize";class zo extends So{constructor(t,e){super(t),this.data=e}}zo.REQUEST="watch.request",zo.DATA="watch.data";class No extends So{constructor(t,e,i){super(t),e&&(this.data=e,this.times=i)}}No.REQUEST="layout.request",No.START="layout.start",No.BEFORE="layout.before",No.LAYOUT="layout",No.AFTER="layout.after",No.AGAIN="layout.again",No.END="layout.end";class Yo extends So{constructor(t,e,i,s){super(t),e&&(this.times=e),i&&(this.renderBounds=i,this.renderOptions=s)}}Yo.REQUEST="render.request",Yo.CHILD_START="render.child_start",Yo.CHILD_END="render.child_end",Yo.START="render.start",Yo.BEFORE="render.before",Yo.RENDER="render",Yo.AFTER="render.after",Yo.AGAIN="render.again",Yo.END="render.end",Yo.NEXT="render.next";class Xo extends So{}Xo.START="leafer.start",Xo.BEFORE_READY="leafer.before_ready",Xo.READY="leafer.ready",Xo.AFTER_READY="leafer.after_ready",Xo.VIEW_READY="leafer.view_ready",Xo.VIEW_COMPLETED="leafer.view_completed",Xo.STOP="leafer.stop",Xo.RESTART="leafer.restart",Xo.END="leafer.end",Xo.UPDATE_MODE="leafer.update_mode",Xo.TRANSFORM="leafer.transform",Xo.MOVE="leafer.move",Xo.SCALE="leafer.scale",Xo.ROTATE="leafer.rotate",Xo.SKEW="leafer.skew";const{MOVE:Ho,SCALE:jo,ROTATE:Vo,SKEW:Go}=Xo,Ko={x:Ho,y:Ho,scaleX:jo,scaleY:jo,rotation:Vo,skewX:Go,skewY:Go},qo={};class Zo{set event(t){this.on(t)}on(t,e,i){if(!e){let e;if(u(t))t.forEach(t=>this.on(t[0],t[1],t[2]));else for(let i in t)u(e=t[i])?this.on(i,e[0],e[1]):this.on(i,e);return}let s,r,n;i&&("once"===i?r=!0:"boolean"==typeof i?s=i:(s=i.capture,r=i.once));const o=$o(this,s,!0),a=h(t)?t.split(" "):t,l=r?{listener:e,once:r}:{listener:e};a.forEach(t=>{t&&(n=o[t],n?-1===n.findIndex(t=>t.listener===e)&&n.push(l):o[t]=[l],Fo[t]&&Do.checkHas(this,t,"on"))})}off(t,e,i){if(t){const s=h(t)?t.split(" "):t;if(e){let t,r,n;i&&(t="boolean"==typeof i?i:"once"!==i&&i.capture);const o=$o(this,t);s.forEach(t=>{t&&(r=o[t],r&&(n=r.findIndex(t=>t.listener===e),n>-1&&r.splice(n,1),r.length||delete o[t],Fo[t]&&Do.checkHas(this,t,"off")))})}else{const{__bubbleMap:t,__captureMap:e}=this;s.forEach(i=>{t&&delete t[i],e&&delete e[i]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,e,i,s){return e?this.on(t,i?e=e.bind(i):e,s):u(t)&&t.forEach(t=>this.on(t[0],t[2]?t[1]=t[1].bind(t[2]):t[1],t[3])),{type:t,current:this,listener:e,options:s}}off_(t){if(!t)return;const e=u(t)?t:[t];e.forEach(t=>{t&&(t.listener?t.current.off(t.type,t.listener,t.options):u(t.type)&&t.type.forEach(e=>t.current.off(e[0],e[1],e[3])))}),e.length=0}once(t,e,i,s){if(!e)return u(t)&&t.forEach(t=>this.once(t[0],t[1],t[2],t[3]));_(i)?e=e.bind(i):s=i,this.on(t,e,{once:!0,capture:s})}emit(t,e,i){!e&&ne.has(t)&&(e=ne.get(t,{type:t,target:this,current:this}));const s=$o(this,i)[t];if(s){let r;for(let n=0,o=s.length;n<o&&!((r=s[n])&&(r.listener(e),r.once&&(this.off(t,r.listener,i),n--,o--),e&&e.isStopNow));n++);}this.syncEventer&&this.syncEventer.emitEvent(e,i)}emitEvent(t,e){t.current=this,this.emit(t.type,t,e)}hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:i,__captureMap:s}=this,r=i&&i[t],n=s&&s[t];return!!(o(e)?r||n:e?n:r)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function $o(t,e,i){if(e){const{__captureMap:e}=t;return e||(i?t.__captureMap={}:qo)}{const{__bubbleMap:e}=t;return e||(i?t.__bubbleMap={}:qo)}}const{on:Qo,on_:Jo,off:ta,off_:ea,once:ia,emit:sa,emitEvent:ra,hasEvent:na,destroy:oa}=Zo.prototype,aa={on:Qo,on_:Jo,off:ta,off_:ea,once:ia,emit:sa,emitEvent:ra,hasEvent:na,destroyEventer:oa},ha=Vt.get("setAttr"),la={__setAttr(t,e,i){if(this.leaferIsCreated){const s=this.__.__getInput(t);if(!i||l(e)||o(e)||(ha.warn(this.innerName,t,e),e=void 0),_(e)||s!==e){if(this.__realSetAttr(t,e),this.isLeafer){this.emitEvent(new Co(Co.LEAFER_CHANGE,this,t,s,e));const i=Ko[t];i&&(this.emitEvent(new Xo(i,this)),this.emitEvent(new Xo(Xo.TRANSFORM,this)))}this.emitPropertyEvent(Co.CHANGE,t,s,e);const i=Lo[t];return i&&this.emitPropertyEvent(i,t,s,e),!0}return!1}return this.__realSetAttr(t,e),!0},emitPropertyEvent(t,e,i,s){const r=new Co(t,this,e,i,s);this.isLeafer||this.hasEvent(t)&&this.emitEvent(r),this.leafer.emitEvent(r)},__realSetAttr(t,e){const i=this.__;i[t]=e,this.__proxyData&&this.setProxyAttr(t,e),i.normalStyle&&(this.lockNormalStyle||o(i.normalStyle[t])||(i.normalStyle[t]=e))},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:da,multiplyParent:ca,translateInner:ua,defaultWorld:_a}=V,{toPoint:pa,tempPoint:ga}=yt,fa={__updateWorldMatrix(){const{parent:t,__layout:e,__world:i,__scrollWorld:s,__:r}=this;ca(this.__local||e,t?t.__scrollWorld||t.__world:_a,i,!!e.affectScaleOrRotation,r),s&&ua(Object.assign(s,i),r.scrollX,r.scrollY)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,i=this.__;t.affectScaleOrRotation&&(t.scaleChanged&&(t.resized||(t.resized="scale"))||t.rotationChanged)&&(da(e,i,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=void 0),e.e=i.x+i.offsetX,e.f=i.y+i.offsetY,(i.around||i.origin)&&(pa(i.around||i.origin,t.boxBounds,ga),ua(e,-ga.x,-ga.y,!i.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:ya,updateAllMatrix:ma}=Jn,{updateBounds:va}=uo,{toOuterOf:wa,copyAndSpread:xa,copy:ba}=Wt,{toBounds:Ea}=Br,Pa={__updateWorldBounds(){const t=this.__layout;wa(t.renderBounds,this.__world,this.__world),t.resized&&("inner"===t.resized&&this.__onUpdateSize(),this.__hasLocalEvent&&Do.emitLocal(this),t.resized=void 0),this.__hasWorldEvent&&Do.emitWorld(this)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized="inner"),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=void 0,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=void 0,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=void 0,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized="inner"),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),t.resized||(t.resized="local"),t.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),wa(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){wa(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){wa(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(t,e){const i=this.__layout.boxBounds,s=this.__;s.__usePathBox?Ea(s.path,i):(i.x=0,i.y=0,i.width=s.width,i.height=s.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),ma(this),va(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(ma(this),va(this,this))):ya(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(t){const e=this.__layout;xa(e.strokeBounds,e.boxBounds,e.strokeBoxSpread)},__updateRenderBounds(t){const e=this.__layout,{renderSpread:i}=e;d(i)&&i<=0?ba(e.renderBounds,e.strokeBounds):xa(e.renderBounds,e.boxBounds,i)}},Ba={__render(t,e){if(e.shape)return this.__renderShape(t,e);if(this.__worldOpacity){const i=this.__;if(i.bright&&!e.topRendering)return e.topList.add(this);if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=e.dimOpacity&&!i.dimskip?i.opacity*e.dimOpacity:i.opacity,this.__.__single){if("path"===i.eraser)return this.__renderEraser(t,e);const s=t.getSameCanvas(!0,!0);this.__draw(s,e,t),Jn.copyCanvasByWorld(this,t,s,this.__nowWorld,i.__blendMode,!0),s.recycle(this.__nowWorld)}else this.__draw(t,e);Vt.showBounds&&Vt.drawBounds(this,t,e)}},__renderShape(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawShape(t,e))},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),t.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:ka}=ao,Sa={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){if(this.__nowWorld=this.__getNowWorld(e),this.__worldOpacity){const i=this.__;if(i.__useDim)if(i.dim)e.dimOpacity=!0===i.dim?.2:i.dim;else{if(i.bright&&!e.topRendering)return e.topList.add(this);i.dimskip&&e.dimOpacity&&(e.dimOpacity=0)}if(i.__single&&!this.isBranchLeaf){if("path"===i.eraser)return this.__renderEraser(t,e);const s=t.getSameCanvas(!1,!0);this.__renderBranch(s,e);const r=this.__nowWorld;t.opacity=e.dimOpacity?i.opacity*e.dimOpacity:i.opacity,t.copyWorldByReset(s,r,r,i.__blendMode,!0),s.recycle(r)}else this.__renderBranch(t,e)}},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:i}=this;for(let s=0,r=i.length;s<r;s++)ka(i[s],e)||i[s].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:i}=this;for(let s=0,r=i.length;s<r;s++)ka(i[s],e)||i[s].__clip(t,e)}}},Ta={},{LEAF:Ra,create:Ca}=i,{stintSet:La}=g,{toInnerPoint:Oa,toOuterPoint:Da,multiplyParent:Ia}=V,{toOuterOf:Aa}=Wt,{copy:Ma,move:Wa}=st,{moveLocal:Fa,zoomOfLocal:Ua,rotateOfLocal:za,skewOfLocal:Na,moveWorld:Ya,zoomOfWorld:Xa,rotateOfWorld:Ha,skewOfWorld:ja,transform:Va,transformWorld:Ga,setTransform:Ka,getFlipTransform:qa,getLocalOrigin:Za,getRelativeWorld:$a,drop:Qa}=Jn;t.Leaf=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return y}get __LayoutProcessor(){return ko}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=Ca(Ra),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(To.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),0!==t&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.on(To.ADD,t,"once")}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.on(To.MOUNTED,t,"once")}nextRender(t,e,i){this.leafer?this.leafer.nextRender(t,e,i):this.waitLeafer(()=>this.leafer.nextRender(t,e,i))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(To.MOUNTED)):this.__emitLifeEvent(To.UNMOUNTED),this.isBranch){const{children:e}=this;for(let i=0,s=e.length;i<s;i++)e[i].__bindLeafer(t)}}set(t,e){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){o(t)?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=o(e)?null:void 0,this[t]=e}forceRender(t,e){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(t,e){}__updateContentBounds(){}__updateStrokeBounds(t){}__updateRenderBounds(t){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some(t=>t.__.eraser)}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=this.children.some(t=>t.__.mask&&t.__.visible&&t.__.opacity)}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld,i=this.__world;return Ia(i,t.matrix,e,void 0,i),Aa(this.__layout.renderBounds,e,e),La(e,"half",i.half),La(e,"ignorePixelSnap",i.ignorePixelSnap),e}return this.__world}getClampRenderScale(){let{scaleX:t}=this.__nowWorld||this.__world;return t<0&&(t=-t),t>1?t:1}getRenderScaleData(t,e){let{scaleX:i,scaleY:s}=jr.patternLocked?this.__world:this.__nowWorld;return t&&(i<0&&(i=-i),s<0&&(s=-s)),(!0===e||"zoom-in"===e&&i>1&&s>1)&&(i=s=1),Ta.scaleX=i,Ta.scaleY=s,Ta}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,i){return this.__layout.getLayoutBounds(t,e,i)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,i){const s=e?$a(this,e):this.worldTransform,r=i?t:{};return Aa(t,s,r),r}worldToLocal(t,e,i,s){this.parent?this.parent.worldToInner(t,e,i,s):e&&Ma(e,t)}localToWorld(t,e,i,s){this.parent?this.parent.innerToWorld(t,e,i,s):e&&Ma(e,t)}worldToInner(t,e,i,s){s&&(s.innerToWorld(t,e,i),t=e||t),Oa(this.scrollWorldTransform,t,e,i)}innerToWorld(t,e,i,s){Da(this.scrollWorldTransform,t,e,i),s&&s.worldToInner(e||t,null,i)}getBoxPoint(t,e,i,s){return this.getBoxPointByInner(this.getInnerPoint(t,e,i,s),null,null,!0)}getBoxPointByInner(t,e,i,s){const r=s?t:Object.assign({},t),{x:n,y:o}=this.boxBounds;return Wa(r,-n,-o),r}getInnerPoint(t,e,i,s){const r=s?t:{};return this.worldToInner(t,r,i,e),r}getInnerPointByBox(t,e,i,s){const r=s?t:Object.assign({},t),{x:n,y:o}=this.boxBounds;return Wa(r,n,o),r}getInnerPointByLocal(t,e,i,s){return this.getInnerPoint(t,this.parent,i,s)}getLocalPoint(t,e,i,s){const r=s?t:{};return this.worldToLocal(t,r,i,e),r}getLocalPointByInner(t,e,i,s){return this.getWorldPoint(t,this.parent,i,s)}getPagePoint(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,i,s)}getWorldPoint(t,e,i,s){const r=s?t:{};return this.innerToWorld(t,r,i,e),r}getWorldPointByBox(t,e,i,s){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,s),e,i,!0)}getWorldPointByLocal(t,e,i,s){const r=s?t:{};return this.localToWorld(t,r,i,e),r}getWorldPointByPage(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,i,s)}setTransform(t,e,i){Ka(this,t,e,i)}transform(t,e,i){Va(this,t,e,i)}move(t,e,i){Fa(this,t,e,i)}moveInner(t,e,i){Ya(this,t,e,!0,i)}scaleOf(t,e,i,s,r){Ua(this,Za(this,t),e,i,s,r)}rotateOf(t,e,i){za(this,Za(this,t),e,i)}skewOf(t,e,i,s,r){Na(this,Za(this,t),e,i,s,r)}transformWorld(t,e,i){Ga(this,t,e,i)}moveWorld(t,e,i){Ya(this,t,e,!1,i)}scaleOfWorld(t,e,i,s,r){Xa(this,t,e,i,s,r)}rotateOfWorld(t,e){Ha(this,t,e)}skewOfWorld(t,e,i,s,r){ja(this,t,e,i,s,r)}flip(t,e){Va(this,qa(this,t),!1,e)}scaleResize(t,e=t,i){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}hit(t,e){return!0}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e,i){}__clip(t,e){}__renderShape(t,e){}__drawShape(t,e){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return Jt.need("path")}getMotionPoint(t){return Jt.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,e){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,i){Qa(this,t,e,i)}on(t,e,i){}off(t,e,i){}on_(t,e,i,s){}off_(t){}once(t,e,i,s){}emit(t,e,i){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,i){i?this.addAttr(t,e,i):On(this.prototype,t,e)}static addAttr(t,e,i,s){i||(i=cn),i(e,s)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new To(t,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(To.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}},t.Leaf=he([Un(la),Un(fa),Un(Pa),Un(aa),Un(Ba)],t.Leaf);const{setListWithFn:Ja}=Wt,{sort:th}=uo,{localBoxBounds:eh,localStrokeBounds:ih,localRenderBounds:sh,maskLocalBoxBounds:rh,maskLocalStrokeBounds:nh,maskLocalRenderBounds:oh}=ao,ah=new Vt("Branch");t.Branch=class extends t.Leaf{__updateStrokeSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(t,e){Ja(e||this.__layout.boxBounds,this.children,this.__hasMask?rh:eh)}__updateStrokeBounds(t){Ja(t||this.__layout.strokeBounds,this.children,this.__hasMask?nh:ih)}__updateRenderBounds(t){Ja(t||this.__layout.renderBounds,this.children,this.__hasMask?oh:sh)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let i=0,s=e.length;i<s;i++)e[i].__tempNumber=i,e[i].__.zIndex&&(t=!0);e.sort(th),this.__layout.affectChildrenSort=t}}add(t,e){if(t===this||t.destroyed)return ah.warn("add self or destroyed");const i=o(e);if(!t.__){if(u(t))return t.forEach(t=>{this.add(t,e),i||e++});t=ie.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,i?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const s=t.__layout;s.boxChanged||s.boxChange(),s.matrixChanged||s.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(To.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(To.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,e){t?t.__?t.animationOut?t.__runAnimation("out",()=>this.__remove(t,e)):this.__remove(t,e):this.find(t).forEach(t=>this.remove(t,e)):o(t)&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach(e=>{this.__realRemoveChild(e),t&&e.destroy()}))}clear(){this.removeAll(!0)}__remove(t,e){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(To.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(To.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const i=new To(t,e,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}},t.Branch=he([Un(Sa)],t.Branch);class hh{get length(){return this.list.length}constructor(t){this.reset(),t&&(u(t)?this.addList(t):this.add(t))}has(t){return t&&!o(this.keys[t.innerId])}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return o(e)?-1:e}add(t){const{list:e,keys:i}=this;o(i[t.innerId])&&(e.push(t),i[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:i}=this;if(o(i[t.innerId])){const{list:s}=this;for(let t=e,r=s.length;t<r;t++)i[s[t].innerId]++;0===e?s.unshift(t):(e>s.length&&(e=s.length),s.splice(e,0,t)),i[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let i;for(let s=0,r=e.length;s<r;s++)o(i)?e[s].innerId===t.innerId&&(i=s,delete this.keys[t.innerId]):this.keys[e[s].innerId]=s-1;o(i)||e.splice(i,1)}sort(t){const{list:e}=this;t?e.sort((t,e)=>e.__level-t.__level):e.sort((t,e)=>t.__level-e.__level)}forEach(t){this.list.forEach(t)}clone(){const t=new hh;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let i=0,s=t.length;i<s;i++)e[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class lh{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(u(t)?this.addList(t):this.add(t))}has(t){return!o(this.keys[t.innerId])}without(t){return o(this.keys[t.innerId])}sort(t){const{levels:e}=this;t?e.sort((t,e)=>e-t):e.sort((t,e)=>t-e)}addList(t){t.forEach(t=>{this.add(t)})}add(t){const{keys:e,levelMap:i}=this;e[t.innerId]||(e[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach(i=>{e=this.levelMap[i];for(let i=0,s=e.length;i<s;i++)t(e[i])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const dh=Vt.get("LeaferCanvas");class ch extends Ee{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const s=i.children[t];s?(this.setAbsolute(s),i.insertBefore(e,s)):i.appendChild(s)}}init(){const{config:t}=this,i=t.view||t.canvas;i?this.__createViewFrom(i):this.__createView();const{style:s}=this.view;if(s.display||(s.display="block"),this.parentView=this.view.parentElement,this.parentView){const t=this.parentView.style;t.webkitUserSelect=t.userSelect="none"}e.syncDomFont&&!this.parentView&&(s.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e=h(t)?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:i}=e;i.position="absolute",i.top=i.bottom=i.left=i.right="0px",document.body.appendChild(e),t=e}this.__createView();const i=this.view;t.hasChildNodes()&&(this.setAbsolute(i),t.style.position||(t.style.position="relative")),t.appendChild(i)}else dh.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:s}=this.view;if(this.unreal){const{config:t,autoWidthStr:e,autoHeightStr:i}=this;t.width?(o(e)&&(this.autoWidthStr=s.width||""),s.width=t.width+"px"):o(e)||(s.width=e),t.height?(o(i)&&(this.autoHeightStr=s.height||""),s.height=t.height+"px"):o(i)||(s.height=i)}else s.width=t+"px",s.height=e+"px",this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i)}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(t,e){if(this.resizeListener=e,t){if(this.autoBounds=t,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)});const t=this.parentView;t?(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect())):(this.checkAutoBounds(this.view),dh.warn("no parent"))}catch(t){this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),e.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const t=e.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==t){const{width:e,height:i}=this;this.emitResize({width:e,height:i,pixelRatio:t})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(t){const i=this.view,{x:s,y:r,width:n,height:o}=this.autoBounds.getBoundsFrom(t),a={width:n,height:o,pixelRatio:this.config.pixelRatio?this.pixelRatio:e.devicePixelRatio};if(!this.isSameSize(a)){const{style:t}=i;t.marginLeft=s+"px",t.marginTop=r+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(t){const e={};g.copyAttrs(e,this,be),this.resize(t),this.resizeListener&&!o(this.width)&&this.resizeListener(new Uo(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),this.stopListenPixelRatio(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}Mr(CanvasRenderingContext2D.prototype),Mr(Path2D.prototype);const{mineType:uh,fileType:_h}=Wr;function ph(t,i){e.origin={createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i},canvasToDataURL:(t,e,i)=>{const s=uh(e),r=t.toDataURL(s,i);return"image/bmp"===s?r.replace("image/png;","image/bmp;"):r},canvasToBolb:(t,e,i)=>new Promise(s=>t.toBlob(s,uh(e),i)),canvasSaveAs:(t,i,s)=>{const r=t.toDataURL(uh(_h(i)),s);return e.origin.download(r,i)},download:(t,e)=>new Promise(i=>{let s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),i()}),loadImage:t=>new Promise((i,s)=>{const r=new e.origin.Image,{crossOrigin:n}=e.image;n&&(r.setAttribute("crossOrigin",n),r.crossOrigin=n),r.onload=()=>{i(r)},r.onerror=t=>{s(t)},r.src=e.image.getRealURL(t)}),Image:Image,PointerEvent:PointerEvent,DragEvent:DragEvent},e.event={stopDefault(t){t.preventDefault()},stopNow(t){t.stopImmediatePropagation()},stop(t){t.stopPropagation()}},e.canvas=te.canvas(),e.conicGradientSupport=!!e.canvas.context.createConicGradient}Object.assign(te,{canvas:(t,e)=>new ch(t,e),image:t=>new $r(t)}),e.name="web",e.isMobile="ontouchstart"in window,e.requestRender=function(t){window.requestAnimationFrame(t)},Qr(e,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:gh}=navigator;gh.indexOf("Firefox")>-1?(e.conicGradientRotate90=!0,e.intWheelDeltaY=!0,e.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&(e.fullImageShadow=!0),gh.indexOf("Windows")>-1?(e.os="Windows",e.intWheelDeltaY=!0):gh.indexOf("Mac")>-1?e.os="Mac":gh.indexOf("Linux")>-1&&(e.os="Linux");class fh{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new hh;return this.__updatedList.list.forEach(e=>{e.leafer&&t.add(e)}),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new hh,this.target=t,e&&(this.config=g.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(Yo.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===To.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new zo(zo.DATA,{updatedList:this.updatedList})),this.__updatedList=new hh,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[Co.CHANGE,this.__onAttrChange,this],[[To.ADD,To.REMOVE],this.__onChildEvent,this],[zo.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:yh,updateBounds:mh,updateChange:vh}=Jn,{pushAllChildBranch:wh,pushAllParent:xh}=uo;const{worldBounds:bh}=ao;class Eh{constructor(t){this.updatedBounds=new Nt,this.beforeBounds=new Nt,this.afterBounds=new Nt,u(t)&&(t=new hh(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,bh)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,bh),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:Ph,updateAllChange:Bh}=Jn,kh=Vt.get("Layouter");class Sh{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new lh,this.target=t,e&&(this.config=g.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:t}=this;this.times=0;try{t.emit(No.START),this.layoutOnce(),t.emitEvent(new No(No.END,this.layoutedBlocks,this.times))}catch(t){kh.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?kh.warn("layouting"):this.times>3?kh.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(zo.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=Zt.start("PartLayout"),{target:i,__updatedList:s}=this,{BEFORE:r,LAYOUT:n,AFTER:o}=No,a=this.getBlocks(s);a.forEach(t=>t.setBefore()),i.emitEvent(new No(r,a,this.times)),this.extraBlock=null,s.sort(),function(t,e){let i;t.list.forEach(t=>{i=t.__layout,e.without(t)&&!i.proxyZoom&&(i.matrixChanged?(yh(t,!0),e.add(t),t.isBranch&&wh(t,e),xh(t,e)):i.boundsChanged&&(e.add(t),t.isBranch&&(t.__tempNumber=0),xh(t,e)))})}(s,this.__levelList),function(t){let e,i,s;t.sort(!0),t.levels.forEach(r=>{e=t.levelMap[r];for(let t=0,r=e.length;t<r;t++){if(i=e[t],i.isBranch&&i.__tempNumber){s=i.children;for(let t=0,e=s.length;t<e;t++)s[t].isBranch||mh(s[t])}mh(i)}})}(this.__levelList),function(t){t.list.forEach(vh)}(s),this.extraBlock&&a.push(this.extraBlock),a.forEach(t=>t.setAfter()),i.emitEvent(new No(n,a,this.times)),i.emitEvent(new No(o,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,Zt.end(e)}fullLayout(){const t=Zt.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:s,AFTER:r}=No,n=this.getBlocks(new hh(e));e.emitEvent(new No(i,n,this.times)),Sh.fullLayout(e),n.forEach(t=>{t.setAfter()}),e.emitEvent(new No(s,n,this.times)),e.emitEvent(new No(r,n,this.times)),this.addBlocks(n),Zt.end(t)}static fullLayout(t){Ph(t,!0),t.isBranch?uo.updateBounds(t):Jn.updateBounds(t),Bh(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new Eh([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new Eh(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[No.REQUEST,this.layout,this],[No.AGAIN,this.layoutAgain,this],[zo.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const Th=Vt.get("Renderer");class Rh{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:120},this.frames=[],this.target=t,this.canvas=e,i&&(this.config=g.default(i,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(t=!0){this.changed||(this.changed=t),this.__requestRender()}requestLayout(){this.target.emit(No.REQUEST)}checkRender(){if(this.running){const{target:t}=this;t.isApp&&(t.emit(Yo.CHILD_START,t),t.children.forEach(t=>{t.renderer.FPS=this.FPS,t.renderer.checkRender()}),t.emit(Yo.CHILD_END,t)),this.changed&&this.canvas.view&&this.render(),this.target.emit(Yo.NEXT)}}render(t){if(!this.running||!this.canvas.view)return this.update();const{target:e}=this;this.times=0,this.totalBounds=new Nt,Th.log(e.innerName,"---\x3e");try{this.emitRender(Yo.START),this.renderOnce(t),this.emitRender(Yo.END,this.totalBounds),jr.clearRecycled()}catch(t){this.rendering=!1,Th.error(t)}Th.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return Th.warn("rendering");if(this.times>3)return Th.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Nt,this.renderOptions={},t)this.emitRender(Yo.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(Yo.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(Yo.RENDER,this.renderBounds,this.renderOptions),this.emitRender(Yo.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;e&&(this.mergeBlocks(),e.forEach(e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=Zt.start("PartRender"),{canvas:i}=this,s=t.getIntersect(i.bounds),r=new Nt(s);i.save(),s.spread(Rh.clipSpread).ceil(),i.clearWorld(s),i.clipWorld(s),this.__render(s,r),i.restore(),Zt.end(e)}fullRender(){const t=Zt.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds),e.restore(),Zt.end(t)}__render(t,i){const{canvas:s}=this,r=t.includes(this.target.__world),n=r?{includes:r}:{bounds:t,includes:r};this.needFill&&s.fillWorld(t,this.config.fill),Vt.showRepaint&&Vt.drawRepaint(s,t),e.render(this.target,s,n),this.renderBounds=i=i||t,this.renderOptions=n,this.totalBounds.isEmpty()?this.totalBounds=i:this.totalBounds.add(i),s.updateRender(i)}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new Nt;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=this.target;if(this.requestTime||!t)return;if(t.parentApp)return t.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const i=()=>{const t=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:s}=this.config;if(s&&t>s)return e.requestRender(i);const{frames:r}=this;r.length>30&&r.shift(),r.push(t),this.FPS=Math.round(r.reduce((t,e)=>t+e,0)/r.length),this.requestTime=0,this.checkRender()};e.requestRender(i)}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new Nt(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new Nt(0,0,1,1)),this.update()}}__onLayoutEnd(t){t.data&&t.data.map(t=>{let e;t.updatedList&&t.updatedList.list.some(t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||Th.tip(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e)),this.addBlock(e?this.canvas.bounds:t.updatedBounds)})}emitRender(t,e,i){this.target.emitEvent(new Yo(t,this.times,e,i))}__listenEvents(){this.__eventIds=[this.target.on_([[Yo.REQUEST,this.update,this],[No.END,this.__onLayoutEnd,this],[Yo.AGAIN,this.renderAgain,this],[Uo.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}Rh.clipSpread=10;const{hitRadiusPoint:Ch}=Wt;class Lh{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const s=i.through||!1,r=i.ignoreHittable||!1,n=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new hh(i.findList),i.findList||this.hitBranch(n.isBranchLeaf?{children:[n]}:n);const{list:o}=this.findList,a=this.getBestMatchLeaf(o,i.bottomList,r,!!i.findList),h=r?this.getPath(a):this.getHitablePath(a);return this.clear(),s?{path:h,target:a,throughPath:o.length?this.getThroughPath(o):h}:{path:h,target:a}}hitPoint(t,e,i){return!!this.getByPoint(t,e,i).target}getBestMatchLeaf(t,e,i,s){const r=this.findList=new hh;if(t.length){let e;const{x:s,y:n}=this.point,o={x:s,y:n,radiusX:0,radiusY:0};for(let s=0,n=t.length;s<n;s++)if(e=t[s],(i||Jn.worldHittable(e))&&(this.hitChild(e,o),r.length)){if(e.isBranchLeaf&&t.some(t=>t!==e&&Jn.hasParent(t,e))){r.reset();break}return r.list[0]}}if(e)for(let t=0,i=e.length;t<i;t++)if(this.hitChild(e[t].target,this.point,e[t].proxy),r.length)return r.list[0];return s?null:i?t[0]:t.find(t=>Jn.worldHittable(t))}getPath(t){const e=new hh,i=[],{target:s}=this;for(;t&&(t.syncEventer&&i.push(t.syncEventer),e.add(t),(t=t.parent)!==s););return i.length&&i.forEach(t=>{for(;t&&(t.__.hittable&&e.add(t),(t=t.parent)!==s););}),s&&e.add(s),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,s=new hh;for(let t=e.list.length-1;t>-1&&(i=e.list[t],i.__.hittable)&&(s.addAt(i,0),i.__.hitChildren&&(!i.isLeafer||"draw"!==i.mode));t--);return s}getThroughPath(t){const e=new hh,i=[];for(let e=t.length-1;e>-1;e--)i.push(this.getPath(t[e]));let s,r,n;for(let t=0,o=i.length;t<o;t++){s=i[t],r=i[t+1];for(let t=0,i=s.length;t<i&&(n=s.list[t],!r||!r.has(n));t++)e.add(n)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,s;const{point:r}=this;for(let n=t.length-1;n>-1;n--)i=t[n],!i.__.visible||e&&!i.__.mask||(s=!!i.__.hitRadius||Ch(i.__world,r),i.isBranch?(s||i.__ignoreHitWorld)&&(i.topChildren&&this.eachFind(i.topChildren,!1),this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,r)):s&&this.hitChild(i,r))}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:s}=t;if(s&&s.__hasMask&&!t.__.mask){let i,r=[];const{children:n}=s;for(let s=0,o=n.length;s<o;s++)if(i=n[s],i.__.mask&&r.push(i),i===t){if(r&&!r.every(t=>t.__hitWorld(e)))return;break}}this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class Oh{constructor(t,e){this.config={},e&&(this.config=g.default(e,this.config)),this.picker=new Lh(this.target=t,this),this.finder=te.finder&&te.finder()}getByPoint(t,i,s){const{target:r,picker:n}=this;return e.backgrounder&&r&&r.updateLayout(),n.getByPoint(t,i,s)}hitPoint(t,e,i){return this.picker.hitPoint(t,e,i)}getBy(t,e,i,s){return this.finder?this.finder.getBy(t,e,i,s):Jt.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}function Dh(t){return en(t,t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Ih(t){return en(t,t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function Ah(){return(t,e)=>{const i="_"+e;Qr(t,e,{set(t){this.isLeafer&&(this[i]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}Object.assign(te,{watcher:(t,e)=>new fh(t,e),layouter:(t,e)=>new Sh(t,e),renderer:(t,e,i)=>new Rh(t,e,i),selector:(t,e)=>new Oh(t,e)}),e.layout=Sh.fullLayout,e.render=function(t,e,i){const s=Object.assign(Object.assign({},i),{topRendering:!0});i.topList=new hh,t.__render(e,i),i.topList.length&&i.topList.forEach(t=>t.__render(e,s))};const Mh={},Wh={hasTransparent:function(t){if(!t||7===t.length||4===t.length)return!1;if("transparent"===t)return!0;const e=t[0];if("#"===e)switch(t.length){case 5:return"f"!==t[4]&&"F"!==t[4];case 9:return"f"!==t[7]&&"F"!==t[7]||"f"!==t[8]&&"F"!==t[8]}else if(("r"===e||"h"===e)&&"a"===t[3]){const e=t.lastIndexOf(",");if(e>-1)return parseFloat(t.slice(e+1))<1}return!1}},Fh={number:(t,e)=>_(t)?"percent"===t.type?t.value*e:t.value:t},Uh={},zh={},Nh={},Yh={},Xh={},Hh={apply(){Jt.need("filter")}},jh={},Vh={setStyleName:()=>Jt.need("state"),set:()=>Jt.need("state")},Gh={list:{},register(t,e){Gh.list[t]=e},get:t=>Gh.list[t]},{parse:Kh,objectToCanvasData:qh}=Vi,{stintSet:Zh}=g,{hasTransparent:$h}=Wh,Qh={},Jh=Vt.get("UIData");class tl extends y{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const t=this;return t.__hasMultiStrokeStyle?Math.max(t.__hasMultiStrokeStyle,t.strokeWidth):t.strokeWidth}get __hasMultiPaint(){const t=this;return t.fill&&this.__useStroke||t.__isFills&&t.fill.length>1||t.__isStrokes&&t.stroke.length>1||t.__useEffect}get __clipAfterFill(){const t=this;return t.cornerRadius||t.innerShadow||t.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,Jh.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,Jh.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),h(t)||!t?(Zh(this,"__isTransparentFill",$h(t)),this.__isFills&&this.__removePaint("fill",!0),this._fill=t):_(t)&&this.__setPaint("fill",t)}setStroke(t){h(t)||!t?(Zh(this,"__isTransparentStroke",$h(t)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=t):_(t)&&this.__setPaint("stroke",t)}setPath(t){const e=h(t);e||t&&_(t[0])?(this.__setInput("path",t),this._path=e?Kh(t):qh(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){el(this,"shadow",t)}setInnerShadow(t){el(this,"innerShadow",t)}setFilter(t){el(this,"filter",t)}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&zh.compute("fill",this.__leaf),e&&zh.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth(t){let{strokeWidth:e,strokeWidthFixed:i}=this;if(t&&(t.strokeWidth&&(e=t.strokeWidth),o(t.strokeWidthFixed)||(i=t.strokeWidthFixed)),i){const t=this.__leaf.getClampRenderScale();return t>1?e/t:e}return e}__setPaint(t,e){this.__setInput(t,e);const i=this.__leaf.__layout;i.boxChanged||i.boxChange(),u(e)&&!e.length?this.__removePaint(t):"fill"===t?(this.__isFills=!0,this._fill||(this._fill=Qh)):(this.__isStrokes=!0,this._stroke||(this._stroke=Qh))}__removePaint(t,e){e&&this.__removeInput(t),Nh.recycleImage(t,this),"fill"===t?(Zh(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(Zh(this,"__isAlphaPixelStroke",void 0),Zh(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}}function el(t,e,i){t.__setInput(e,i),u(i)?(i.some(t=>!1===t.visible)&&(i=i.filter(t=>!1!==t.visible)),i.length||(i=void 0)):i=i&&!1!==i.visible?[i]:void 0,t["_"+e]=i}class il extends tl{}class sl extends il{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const t=this;return"show"!==t.overflow&&t.__leaf.children.length&&(t.__leaf.isOverflow||super.__clipAfterFill)}}class rl extends il{__getInputData(t,e){const i=super.__getInputData(t,e);return be.forEach(t=>delete i[t]),i}}class nl extends sl{}class ol extends tl{get __usePathBox(){return this.points||this.__pathInputed}}class al extends tl{get __boxStroke(){return!this.__pathInputed}}class hl extends tl{get __boxStroke(){return!this.__pathInputed}}class ll extends ol{}class dl extends tl{}class cl extends tl{get __pathInputed(){return 2}}class ul extends il{}const _l={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class pl extends tl{get __useNaturalRatio(){return!1}setFontWeight(t){h(t)?(this.__setInput("fontWeight",t),t=_l[t]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t}setBoxStyle(t){let e=this.__leaf,i=e.__box;if(t){const{boxStyle:s}=this;if(i)for(let t in s)i[t]=void 0;else i=e.__box=ie.get("Rect",0);const r=e.__layout,n=i.__layout;s||(i.parent=e,i.__world=e.__world,n.boxBounds=r.boxBounds),i.set(t),n.strokeChanged&&r.strokeChange()}else i&&(e.__box=i.parent=null,i.destroy());this._boxStyle=t}}class gl extends al{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return t.url&&delete t.fill,t}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url&&delete i.fill,i}}class fl extends al{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url=this.__leaf.canvas.toDataURL("image/png"),i}}const{max:yl,add:ml}=E,vl={__updateStrokeSpread(){let t=0,e=0;const i=this.__,{strokeAlign:s,__maxStrokeWidth:r}=i,n=this.__box;if((i.stroke||"all"===i.hitStroke)&&r&&"inside"!==s&&(e=t="center"===s?r/2:r,!i.__boxStroke)){const e=i.__isLinePath?0:10*t,s="none"===i.strokeCap?0:r;t+=Math.max(e,s)}return i.__useArrow&&(t+=5*r),n&&(t=yl(t,n.__layout.strokeSpread=n.__updateStrokeSpread()),e=Math.max(e,n.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:i,blur:s,backgroundBlur:r,filter:n,renderSpread:o}=this.__,{strokeSpread:a}=this.__layout,h=this.__box;e&&(t=Xh.getShadowRenderSpread(this,e)),s&&(t=yl(t,s)),n&&(t=ml(t,Hh.getSpread(n))),o&&(t=ml(t,o)),a&&(t=ml(t,a));let l=t;return i&&(l=yl(l,Xh.getInnerShadowSpread(this,i))),r&&(l=yl(l,r)),this.__layout.renderShapeSpread=l,h?yl(h.__updateRenderSpread(),t):t}},{stintSet:wl}=g,xl={__updateChange(){const t=this.__;if(t.__useStroke){const e=t.__useStroke=!(!t.stroke||!t.strokeWidth);wl(this.__world,"half",e&&"center"===t.strokeAlign&&t.strokeWidth%2),wl(t,"__fillAfterStroke",e&&"outside"===t.strokeAlign&&t.fill&&!t.__isTransparentFill)}if(t.__useEffect){const{shadow:e,fill:i,stroke:s}=t,r=t.innerShadow||t.blur||t.backgroundBlur||t.filter;wl(t,"__isFastShadow",e&&!r&&e.length<2&&!e[0].spread&&!Xh.isTransformShadow(e[0])&&i&&!t.__isTransparentFill&&!(u(i)&&i.length>1)&&(this.useFastShadow||!s||s&&"inside"===t.strokeAlign)),t.__useEffect=!(!e&&!r)}t.__checkSingle(),wl(t,"__complex",t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect)},__drawFast(t,e){bl(this,t,e)},__draw(t,e,i){const s=this.__;if(s.__complex){s.__needComputePaint&&s.__computePaint();const{fill:r,stroke:n,__drawAfterFill:o,__fillAfterStroke:a,__isFastShadow:h}=s;if(this.__drawRenderPath(t),s.__useEffect&&!h){const h=zh.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:l,innerShadow:d,filter:c}=s;l&&Xh.shadow(this,t,h),a&&(s.__isStrokes?zh.strokes(n,this,t):zh.stroke(n,this,t)),r&&(s.__isFills?zh.fills(r,this,t):zh.fill(r,this,t)),o&&this.__drawAfterFill(t,e),d&&Xh.innerShadow(this,t,h),n&&!a&&(s.__isStrokes?zh.strokes(n,this,t):zh.stroke(n,this,t)),c&&Hh.apply(c,this,this.__nowWorld,t,i,h),h.worldCanvas&&h.worldCanvas.recycle(),h.canvas.recycle()}else{if(a&&(s.__isStrokes?zh.strokes(n,this,t):zh.stroke(n,this,t)),h){const e=s.shadow[0],{scaleX:i,scaleY:r}=this.getRenderScaleData(!0,e.scaleFixed);t.save(),t.setWorldShadow(e.x*i,e.y*r,e.blur*i,Wh.string(e.color))}r&&(s.__isFills?zh.fills(r,this,t):zh.fill(r,this,t)),h&&t.restore(),o&&this.__drawAfterFill(t,e),n&&!a&&(s.__isStrokes?zh.strokes(n,this,t):zh.stroke(n,this,t))}}else s.__pathInputed?bl(this,t,e):this.__drawFast(t,e)},__drawShape(t,e){this.__drawRenderPath(t);const i=this.__,{fill:s,stroke:r}=i;s&&!e.ignoreFill&&(i.__isAlphaPixelFill?zh.fills(s,this,t):zh.fill("#000000",this,t)),i.__isCanvas&&this.__drawAfterFill(t,e),r&&!e.ignoreStroke&&(i.__isAlphaPixelStroke?zh.strokes(r,this,t):zh.stroke("#000000",this,t))},__drawAfterFill(t,e){this.__.__clipAfterFill?(t.save(),t.clipUI(this),this.__drawContent(t,e),t.restore()):this.__drawContent(t,e)}};function bl(t,e,i){const{fill:s,stroke:r,__drawAfterFill:n,__fillAfterStroke:o}=t.__;t.__drawRenderPath(e),o&&zh.stroke(r,t,e),s&&zh.fill(s,t,e),n&&t.__drawAfterFill(e,i),r&&!o&&zh.stroke(r,t,e)}const El={__drawFast(t,e){let{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;const{fill:o,stroke:a,__drawAfterFill:h}=this.__;if(o&&(t.fillStyle=o,t.fillRect(i,s,r,n)),h&&this.__drawAfterFill(t,e),a){const{strokeAlign:o,__strokeWidth:h}=this.__;if(!h)return;t.setStroke(a,h,this.__);const l=h/2;switch(o){case"center":t.strokeRect(0,0,r,n);break;case"inside":r-=h,n-=h,r<0||n<0?(t.save(),this.__clip(t,e),t.strokeRect(i+l,s+l,r,n),t.restore()):t.strokeRect(i+l,s+l,r,n);break;case"outside":t.strokeRect(i-l,s-l,r+h,n+h)}}}};var Pl,Bl;t.UI=Pl=class extends t.Leaf{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){L.assignScale(this,t)}get scale(){return this.__.scale}get isAutoWidth(){const t=this.__;return t.__autoWidth||t.autoWidth}get isAutoHeight(){const t=this.__;return t.__autoHeight||t.autoHeight}get pen(){const{path:t}=this.__;return Ir.set(this.path=t||[]),t||this.__drawPathByBox(Ir),Ir}reset(t){}set(t,e){t&&Object.assign(this,t)}get(t){return h(t)?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){return Jt.need("find")}findTag(t){return this.find({tag:t})}findOne(t,e){return Jt.need("find")}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let i=e?this.__.__pathForRender:this.__.path;return i||(Ir.set(i=[]),this.__drawPathByBox(Ir)),t?Vi.toCanvasData(i,!0):i}getPathString(t,e,i){return Vi.stringify(this.getPath(t,e),i)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||jh.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){const t=this.__;t.path?(t.__pathForRender=t.cornerRadius?Or.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&Uh.addArrows(this)):t.__pathForRender&&(t.__pathForRender=void 0)}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?Gs.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:i,width:s,height:r}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:n}=this.__;t.roundRect(e,i,s,r,d(n)?[n]:n)}else t.rect(e,i,s,r)}drawImagePlaceholder(t,e){zh.fill(this.__.placeholderColor,this,t)}animate(t,e,i,s){return this.set(t),Jt.need("animate")}killAnimate(t,e){}export(t,e){return Jt.need("export")}syncExport(t,e){return Jt.need("export")}clone(t){const e=g.clone(this.toJSON());return t&&Object.assign(e,t),Pl.one(e)}static one(t,e,i,s,r){return ie.get(t.tag||this.prototype.__tag,t,e,i,s,r)}static registerUI(){zn()(this)}static registerData(t){Ln(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}},he([Ln(tl)],t.UI.prototype,"__",void 0),he([Ah()],t.UI.prototype,"zoomLayer",void 0),he([nn("")],t.UI.prototype,"id",void 0),he([nn("")],t.UI.prototype,"name",void 0),he([nn("")],t.UI.prototype,"className",void 0),he([wn("pass-through")],t.UI.prototype,"blendMode",void 0),he([bn(1)],t.UI.prototype,"opacity",void 0),he([En(!0)],t.UI.prototype,"visible",void 0),he([wn(!1)],t.UI.prototype,"locked",void 0),he([xn(!1)],t.UI.prototype,"dim",void 0),he([xn(!1)],t.UI.prototype,"dimskip",void 0),he([kn(0)],t.UI.prototype,"zIndex",void 0),he([Sn(!1)],t.UI.prototype,"mask",void 0),he([Tn(!1)],t.UI.prototype,"eraser",void 0),he([on(0,!0)],t.UI.prototype,"x",void 0),he([on(0,!0)],t.UI.prototype,"y",void 0),he([cn(100,!0)],t.UI.prototype,"width",void 0),he([cn(100,!0)],t.UI.prototype,"height",void 0),he([ln(1,!0)],t.UI.prototype,"scaleX",void 0),he([ln(1,!0)],t.UI.prototype,"scaleY",void 0),he([dn(0,!0)],t.UI.prototype,"rotation",void 0),he([dn(0,!0)],t.UI.prototype,"skewX",void 0),he([dn(0,!0)],t.UI.prototype,"skewY",void 0),he([on(0,!0)],t.UI.prototype,"offsetX",void 0),he([on(0,!0)],t.UI.prototype,"offsetY",void 0),he([an(0,!0)],t.UI.prototype,"scrollX",void 0),he([an(0,!0)],t.UI.prototype,"scrollY",void 0),he([hn()],t.UI.prototype,"origin",void 0),he([hn()],t.UI.prototype,"around",void 0),he([nn(!1)],t.UI.prototype,"lazy",void 0),he([un(1)],t.UI.prototype,"pixelRatio",void 0),he([vn(0)],t.UI.prototype,"renderSpread",void 0),he([pn()],t.UI.prototype,"path",void 0),he([gn()],t.UI.prototype,"windingRule",void 0),he([gn(!0)],t.UI.prototype,"closed",void 0),he([cn(0)],t.UI.prototype,"padding",void 0),he([cn(!1)],t.UI.prototype,"lockRatio",void 0),he([cn()],t.UI.prototype,"widthRange",void 0),he([cn()],t.UI.prototype,"heightRange",void 0),he([nn(!1)],t.UI.prototype,"draggable",void 0),he([nn()],t.UI.prototype,"dragBounds",void 0),he([nn("auto")],t.UI.prototype,"dragBoundsType",void 0),he([nn(!1)],t.UI.prototype,"editable",void 0),he([Rn(!0)],t.UI.prototype,"hittable",void 0),he([Rn("path")],t.UI.prototype,"hitFill",void 0),he([mn("path")],t.UI.prototype,"hitStroke",void 0),he([Rn(!1)],t.UI.prototype,"hitBox",void 0),he([Rn(!0)],t.UI.prototype,"hitChildren",void 0),he([Rn(!0)],t.UI.prototype,"hitSelf",void 0),he([Rn()],t.UI.prototype,"hitRadius",void 0),he([Cn("")],t.UI.prototype,"cursor",void 0),he([wn()],t.UI.prototype,"fill",void 0),he([mn(void 0,!0)],t.UI.prototype,"stroke",void 0),he([mn("inside")],t.UI.prototype,"strokeAlign",void 0),he([mn(1,!0)],t.UI.prototype,"strokeWidth",void 0),he([mn(!1)],t.UI.prototype,"strokeWidthFixed",void 0),he([mn("none")],t.UI.prototype,"strokeCap",void 0),he([mn("miter")],t.UI.prototype,"strokeJoin",void 0),he([mn()],t.UI.prototype,"dashPattern",void 0),he([mn(0)],t.UI.prototype,"dashOffset",void 0),he([mn(10)],t.UI.prototype,"miterLimit",void 0),he([gn(0)],t.UI.prototype,"cornerRadius",void 0),he([gn()],t.UI.prototype,"cornerSmoothing",void 0),he([Dh()],t.UI.prototype,"shadow",void 0),he([Dh()],t.UI.prototype,"innerShadow",void 0),he([Dh()],t.UI.prototype,"blur",void 0),he([Dh()],t.UI.prototype,"backgroundBlur",void 0),he([Dh()],t.UI.prototype,"grayscale",void 0),he([Dh()],t.UI.prototype,"filter",void 0),he([wn()],t.UI.prototype,"placeholderColor",void 0),he([nn(100)],t.UI.prototype,"placeholderDelay",void 0),he([nn({})],t.UI.prototype,"data",void 0),he([Mn(t.Leaf.prototype.reset)],t.UI.prototype,"reset",null),t.UI=Pl=he([Un(vl),Un(xl),Wn()],t.UI),t.Group=class extends t.UI{get __tag(){return"Group"}get isBranch(){return!0}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t)if(t.children){const{children:i}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),i.forEach(t=>this.add(t)),t.children=i}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return this.childlessJSON||(e.children=this.children.map(e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}},he([Ln(il)],t.Group.prototype,"__",void 0),he([cn(0)],t.Group.prototype,"width",void 0),he([cn(0)],t.Group.prototype,"height",void 0),t.Group=he([Un(t.Branch),zn()],t.Group);const kl=Vt.get("Leafer");t.Leafer=Bl=class extends t.Group{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Xr.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||{x:0,y:0,width:0,height:0}}constructor(t,e){super(e),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),Bl.list.add(this)}init(t,e){if(this.canvas)return;let i;const{config:s}=this;this.__setLeafer(this),e&&(this.parentApp=e,this.__bindApp(e),i=e.running),t&&(this.parent=e,this.initType(t.type),this.parent=void 0,g.assign(s,t));const r=this.canvas=te.canvas(s);this.__controllers.push(this.renderer=te.renderer(this,r,s),this.watcher=te.watcher(this,s),this.layouter=te.layouter(this,s)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),this.view=r.view,e||(this.selector=te.selector(this),this.interaction=te.interaction(this,r,this.selector,s),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=te.hitCanvasManager()),this.canvasManager=new ae,i=s.start),this.hittable=s.hittable,this.fill=s.fill,this.canvasManager.add(r),this.__listenEvents(),i&&(this.__startTimer=setTimeout(this.start.bind(this))),fo.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t,e){this.waitInit(()=>{super.set(t,e)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(Xo.RESTART):this.emitLeafer(Xo.START),this.__controllers.forEach(t=>t.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(t=>t.stop()),this.running=!1,this.emitLeafer(Xo.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=g.copyAttrs({},t,be);Object.keys(e).forEach(t=>this[t]=e[t])}forceRender(t,e){const{renderer:i}=this;i&&(i.addBlock(t?new Nt(t):this.canvas.bounds),this.viewReady&&(e?i.render():i.update()))}requestRender(t=!1){this.renderer&&this.renderer.update(t)}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const i=g.copyAttrs({},this.canvas,be);e.resize(t),this.updateLazyBounds(),this.__onResize(new Uo(t,i))}__onResize(t){this.emitEvent(t),g.copyAttrs(this.__,t,be),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(){const{config:t,parentApp:e}=this;e||(t.width&&t.height||(this.autoLayout=new Xt(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(be.includes(t)?this.__changeCanvasSize(t,e):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t?(this.canvas.zIndex=e,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):"mode"===t&&this.emit(Xo.UPDATE_MODE,{mode:e})),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&be.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const{config:i,canvas:s}=this,r=g.copyAttrs({},s,be);r[t]=i[t]=e,i.width&&i.height?s.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(r)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(Xo.BEFORE_READY),this.emitLeafer(Xo.READY),this.emitLeafer(Xo.AFTER_READY),fo.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(Xo.VIEW_READY),fo.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:t,width:e,height:i}=this.config;if(t){let{width:s,height:r,pixelRatio:n}=this;const o="box"===t?this.worldBoxBounds:this.__world;e||(s=Math.max(1,o.x+o.width)),i||(r=Math.max(1,o.y+o.height)),this.__doResize({width:s,height:r,pixelRatio:n})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){fo.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted(t=!0){this.nextRender(()=>{this.imageReady&&(t&&this.emitLeafer(Xo.VIEW_COMPLETED),fo.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,i){e&&(t=t.bind(e));const s=this.__nextRenderWait;if(i){for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}}else s.push(t);this.requestRender()}zoom(t,e,i,s){return Jt.need("view")}getValidMove(t,e,i){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}getClientPointByWorld(t){const{x:e,y:i}=this.clientBounds;return{x:e+t.x,y:i+t.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}emitLeafer(t){this.emitEvent(new Xo(t,this))}__listenEvents(){const t=Zt.start("FirstCreate "+this.innerName);this.once([[Xo.START,()=>Zt.end(t)],[No.START,this.updateLazyBounds,this],[Yo.START,this.__onCreated,this],[Yo.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[zo.DATA,this.__onWatchData,this],[No.END,this.__onLayoutEnd,this],[Yo.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy(t){const e=()=>{if(!this.destroyed){Bl.list.remove(this);try{this.stop(),this.emitLeafer(Xo.END),this.__removeListenEvents(),this.__controllers.forEach(t=>!(this.parent&&t===this.interaction)&&t.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{jr.clearRecycled()},100)}catch(t){kl.error(t)}}};t?e():setTimeout(e)}},t.Leafer.list=new hh,he([Ln(rl)],t.Leafer.prototype,"__",void 0),he([cn()],t.Leafer.prototype,"pixelRatio",void 0),he([nn("normal")],t.Leafer.prototype,"mode",void 0),t.Leafer=Bl=he([zn()],t.Leafer),t.Rect=class extends t.UI{get __tag(){return"Rect"}},he([Ln(al)],t.Rect.prototype,"__",void 0),t.Rect=he([Un(El),Wn(),zn()],t.Rect);const{add:Sl,includes:Tl,scroll:Rl}=Wt,Cl=t.Rect.prototype,Ll=t.Group.prototype;t.Box=class extends t.Group{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){if(this.children.length&&!this.pathInputed){const t=this.__;if(t.__autoSide){t.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:e}=this.__layout;t.__autoSize||(t.__autoWidth?(e.width+=e.x,e.x=0,e.height=t.height,e.y=0):(e.height+=e.y,e.y=0,e.width=t.width,e.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t,e;if(this.children.length){const i=this.__,s=this.__layout,{renderBounds:r,boxBounds:n}=s,{overflow:o}=i,a=s.childrenRenderBounds||(s.childrenRenderBounds={x:0,y:0,width:0,height:0});super.__updateRenderBounds(a),(e=o.includes("scroll"))&&(Sl(a,n),Rl(a,i)),this.__updateRectRenderBounds(),t=!Tl(n,a),t&&"show"===o&&Sl(r,a)}else this.__updateRectRenderBounds();g.stintSet(this,"isOverflow",t),this.__checkScroll(e)}__updateRectRenderBounds(){}__checkScroll(t){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e)),this.hasScroller&&this.scroller.__render(t,e)}__drawContent(t,e){this.__renderGroup(t,e),(this.__.__useStroke||this.__.__useEffect)&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}},he([Ln(sl)],t.Box.prototype,"__",void 0),he([cn(100)],t.Box.prototype,"width",void 0),he([cn(100)],t.Box.prototype,"height",void 0),he([nn(!1)],t.Box.prototype,"resizeChildren",void 0),he([vn("show")],t.Box.prototype,"overflow",void 0),he([Mn(Cl.__updateStrokeSpread)],t.Box.prototype,"__updateStrokeSpread",null),he([Mn(Cl.__updateRenderSpread)],t.Box.prototype,"__updateRectRenderSpread",null),he([Mn(Cl.__updateBoxBounds)],t.Box.prototype,"__updateRectBoxBounds",null),he([Mn(Cl.__updateStrokeBounds)],t.Box.prototype,"__updateStrokeBounds",null),he([Mn(Cl.__updateRenderBounds)],t.Box.prototype,"__updateRectRenderBounds",null),he([Mn(Cl.__updateChange)],t.Box.prototype,"__updateRectChange",null),he([Mn(Cl.__render)],t.Box.prototype,"__renderRect",null),he([Mn(Ll.__render)],t.Box.prototype,"__renderGroup",null),t.Box=he([Wn(),zn()],t.Box),t.Frame=class extends t.Box{get __tag(){return"Frame"}get isFrame(){return!0}},he([Ln(nl)],t.Frame.prototype,"__",void 0),he([wn("#FFFFFF")],t.Frame.prototype,"fill",void 0),he([vn("hide")],t.Frame.prototype,"overflow",void 0),t.Frame=he([zn()],t.Frame);const{moveTo:Ol,closePath:Dl,ellipse:Il}=gs;t.Ellipse=class extends t.UI{get __tag(){return"Ellipse"}__updatePath(){const{width:t,height:i,innerRadius:s,startAngle:r,endAngle:n}=this.__,o=t/2,a=i/2,h=this.__.path=[];s?(r||n?(s<1&&Il(h,o,a,o*s,a*s,0,r,n,!1),Il(h,o,a,o,a,0,n,r,!0),s<1&&Dl(h)):(s<1&&(Il(h,o,a,o*s,a*s),Ol(h,t,a)),Il(h,o,a,o,a,0,360,0,!0)),e.ellipseToCurve&&(this.__.path=this.getPath(!0))):r||n?(Ol(h,o,a),Il(h,o,a,o,a,0,r,n,!1),Dl(h)):Il(h,o,a,o,a)}},he([Ln(hl)],t.Ellipse.prototype,"__",void 0),he([gn(0)],t.Ellipse.prototype,"innerRadius",void 0),he([gn(0)],t.Ellipse.prototype,"startAngle",void 0),he([gn(0)],t.Ellipse.prototype,"endAngle",void 0),t.Ellipse=he([zn()],t.Ellipse);const{sin:Al,cos:Ml,PI:Wl}=Math,{moveTo:Fl,lineTo:Ul,closePath:zl,drawPoints:Nl}=gs;t.Polygon=class extends t.UI{get __tag(){return"Polygon"}__updatePath(){const t=this.__,e=t.path=[];if(t.points)Nl(e,t.points,t.curve,!0);else{const{width:i,height:s,sides:r}=t,n=i/2,o=s/2;Fl(e,n,0);for(let t=1;t<r;t++)Ul(e,n+n*Al(2*t*Wl/r),o-o*Ml(2*t*Wl/r));zl(e)}}},he([Ln(ll)],t.Polygon.prototype,"__",void 0),he([gn(3)],t.Polygon.prototype,"sides",void 0),he([gn()],t.Polygon.prototype,"points",void 0),he([gn(0)],t.Polygon.prototype,"curve",void 0),t.Polygon=he([Wn(),zn()],t.Polygon);const{sin:Yl,cos:Xl,PI:Hl}=Math,{moveTo:jl,lineTo:Vl,closePath:Gl}=gs;t.Star=class extends t.UI{get __tag(){return"Star"}__updatePath(){const{width:t,height:e,corners:i,innerRadius:s}=this.__,r=t/2,n=e/2,o=this.__.path=[];jl(o,r,0);for(let t=1;t<2*i;t++)Vl(o,r+(t%2==0?r:r*s)*Yl(t*Hl/i),n-(t%2==0?n:n*s)*Xl(t*Hl/i));Gl(o)}},he([Ln(dl)],t.Star.prototype,"__",void 0),he([gn(5)],t.Star.prototype,"corners",void 0),he([gn(.382)],t.Star.prototype,"innerRadius",void 0),t.Star=he([zn()],t.Star);const{moveTo:Kl,lineTo:ql,drawPoints:Zl}=gs,{rotate:$l,getAngle:Ql,getDistance:Jl,defaultPoint:td}=st;t.Line=class extends t.UI{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,i={x:0,y:0};return t&&(i.x=t),e&&$l(i,e),i}set toPoint(t){this.width=Jl(td,t),this.rotation=Ql(td,t),this.height&&(this.height=0)}__updatePath(){const t=this.__,e=t.path=[];t.points?Zl(e,t.points,t.curve,t.closed):(Kl(e,0,0),ql(e,this.width,0))}},he([Ln(ol)],t.Line.prototype,"__",void 0),he([fn("center")],t.Line.prototype,"strokeAlign",void 0),he([cn(0)],t.Line.prototype,"height",void 0),he([gn()],t.Line.prototype,"points",void 0),he([gn(0)],t.Line.prototype,"curve",void 0),he([gn(!1)],t.Line.prototype,"closed",void 0),t.Line=he([zn()],t.Line),t.Image=class extends t.Rect{get __tag(){return"Image"}get ready(){const{image:t}=this;return t&&t.ready}get image(){const{fill:t}=this.__;return u(t)&&t[0].image}},he([Ln(gl)],t.Image.prototype,"__",void 0),he([cn("")],t.Image.prototype,"url",void 0),t.Image=he([zn()],t.Image);const ed=t.Image;t.Canvas=class extends t.Rect{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor(t){super(t),this.canvas=te.canvas(this.__),t&&t.url&&this.drawImage(t.url)}drawImage(t){new $r({url:t}).load(t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Oo(Oo.LOADED,{image:t}))})}draw(t,e,i,s){const r=new dt(t.worldTransform).invert(),n=new dt;e&&n.translate(e.x,e.y),i&&(d(i)?n.scale(i):n.scale(i.x,i.y)),s&&n.rotate(s),r.multiplyParent(n),t.__render(this.canvas,{matrix:r.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:i,height:s}=this.__,{view:r}=this.canvas;t.drawImage(r,0,0,r.width,r.height,0,0,i,s)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e,safeResize:i}=this.__;t.resize(this.__,i),t.smooth!==e&&(t.smooth=e)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}},he([Ln(fl)],t.Canvas.prototype,"__",void 0),he([Ih(100)],t.Canvas.prototype,"width",void 0),he([Ih(100)],t.Canvas.prototype,"height",void 0),he([Ih(1)],t.Canvas.prototype,"pixelRatio",void 0),he([Ih(!0)],t.Canvas.prototype,"smooth",void 0),he([nn(!1)],t.Canvas.prototype,"safeResize",void 0),he([Ih()],t.Canvas.prototype,"contextSettings",void 0),t.Canvas=he([zn()],t.Canvas);const{copyAndSpread:id,includes:sd,spread:rd,setList:nd}=Wt;t.Text=class extends t.UI{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const t=this.__,{lineHeight:e,letterSpacing:i,fontFamily:s,fontSize:r,fontWeight:n,italic:o,textCase:a,textOverflow:h,padding:l}=t;t.__lineHeight=Fh.number(e,r),t.__letterSpacing=Fh.number(i,r),t.__padding=l?L.fourNumber(l):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*r)/2,t.__font=`${o?"italic ":""}${"small-caps"===a?"small-caps ":""}${"normal"!==n?n+" ":""}${r||12}px ${s||"caption"}`,t.__clipText="show"!==h&&!t.__autoSize,t.__textDrawData=Mh.getDrawData((t.__isPlacehold=t.placeholder&&""===t.text)?t.placeholder:t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{fontSize:i,italic:s,padding:r,__autoWidth:n,__autoHeight:o}=t;this.__updateTextDrawData();const{bounds:a}=t.__textDrawData,h=e.boxBounds;if(e.contentBounds=a,t.__lineHeight<i&&rd(a,i/2),n||o){if(h.x=n?a.x:0,h.y=o?a.y:0,h.width=n?a.width:t.width,h.height=o?a.height:t.height,r){const[e,i,s,r]=t.__padding;n&&(h.x-=r,h.width+=i+r),o&&(h.y-=e,h.height+=s+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();s&&(h.width+=.16*i),g.stintSet(this,"isOverflow",!sd(h,a)),this.isOverflow?(nd(t.__textBoxBounds={},[h,a]),e.renderChanged=!0):t.__textBoxBounds=h}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.isOverflow?1:0),t}__updateRenderBounds(){const{renderBounds:t,renderSpread:e}=this.__layout;id(t,this.__.__textBoxBounds,e),this.__box&&(this.__box.__layout.renderBounds=t)}__updateChange(){super.__updateChange();const t=this.__box;t&&(t.__onUpdateSize(),t.__updateChange())}__drawRenderPath(t){t.font=this.__.__font}__draw(t,e,i){const s=this.__box;s&&(s.__nowWorld=this.__nowWorld,s.__draw(t,e,i)),this.textEditing&&!e.exporting||super.__draw(t,e,i)}__drawShape(t,e){e.shape&&this.__box&&this.__box.__drawShape(t,e),super.__drawShape(t,e)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}},he([Ln(pl)],t.Text.prototype,"__",void 0),he([cn(0)],t.Text.prototype,"width",void 0),he([cn(0)],t.Text.prototype,"height",void 0),he([wn()],t.Text.prototype,"boxStyle",void 0),he([nn(!1)],t.Text.prototype,"resizeFontSize",void 0),he([wn("#000000")],t.Text.prototype,"fill",void 0),he([fn("outside")],t.Text.prototype,"strokeAlign",void 0),he([Rn("all")],t.Text.prototype,"hitFill",void 0),he([cn("")],t.Text.prototype,"text",void 0),he([cn("")],t.Text.prototype,"placeholder",void 0),he([cn("caption")],t.Text.prototype,"fontFamily",void 0),he([cn(12)],t.Text.prototype,"fontSize",void 0),he([cn("normal")],t.Text.prototype,"fontWeight",void 0),he([cn(!1)],t.Text.prototype,"italic",void 0),he([cn("none")],t.Text.prototype,"textCase",void 0),he([cn("none")],t.Text.prototype,"textDecoration",void 0),he([cn(0)],t.Text.prototype,"letterSpacing",void 0),he([cn({type:"percent",value:1.5})],t.Text.prototype,"lineHeight",void 0),he([cn(0)],t.Text.prototype,"paraIndent",void 0),he([cn(0)],t.Text.prototype,"paraSpacing",void 0),he([cn("x")],t.Text.prototype,"writingMode",void 0),he([cn("left")],t.Text.prototype,"textAlign",void 0),he([cn("top")],t.Text.prototype,"verticalAlign",void 0),he([cn(!0)],t.Text.prototype,"autoSizeAlign",void 0),he([cn("normal")],t.Text.prototype,"textWrap",void 0),he([cn("show")],t.Text.prototype,"textOverflow",void 0),he([wn(!1)],t.Text.prototype,"textEditing",void 0),t.Text=he([zn()],t.Text),t.Path=class extends t.UI{get __tag(){return"Path"}},he([Ln(cl)],t.Path.prototype,"__",void 0),he([fn("center")],t.Path.prototype,"strokeAlign",void 0),t.Path=he([zn()],t.Path),t.Pen=class extends t.Group{get __tag(){return"Pen"}setStyle(e){const i=this.pathElement=new t.Path(e);return this.pathStyle=e,this.__path=i.path||(i.path=[]),this.add(i),this}beginPath(){return this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,i,s,r,n){return this}quadraticCurveTo(t,e,i,s){return this}closePath(){return this}rect(t,e,i,s){return this}roundRect(t,e,i,s,r){return this}ellipse(t,e,i,s,r,n,o,a){return this}arc(t,e,i,s,r,n){return this}arcTo(t,e,i,s,r){return this}drawEllipse(t,e,i,s,r,n,o,a){return this}drawArc(t,e,i,s,r,n){return this}drawPoints(t,e,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}},he([Ln(ul)],t.Pen.prototype,"__",void 0),he([(t,e)=>{Qr(t,e,{get(){return this.__path}})}],t.Pen.prototype,"path",void 0),t.Pen=he([Un(Os,["set","path","paint"]),zn()],t.Pen),t.App=class extends t.Leafer{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:e,tree:i,sky:s,editor:r}=t;e&&(this.ground=this.addLeafer(e)),(i||r)&&(this.tree=this.addLeafer(i||{type:t.type||"design"})),(s||r)&&(this.sky=this.addLeafer(s)),r&&te.editor(r,this)}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:i}=this.config;e||i===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach(t=>t.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach(t=>t.start())}stop(){this.forEach(t=>t.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach(t=>t.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach(t=>t.lockLayout())}forceRender(t,e){this.forEach(i=>i.forceRender(t,e))}addLeafer(e){const i=new t.Leafer(e);return this.add(i),i}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add(t,e),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),o(e)||(t.canvas.childIndex=e),this.__listenChildEvents(t)}forEach(t){this.children.forEach(t)}__onCreated(){this.created=this.children.every(t=>t.created)}__onReady(){this.children.every(t=>t.ready)&&super.__onReady()}__onViewReady(){this.children.every(t=>t.viewReady)&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){t.context&&this.forEach(i=>e.matrix?i.__render(t,e):t.copyWorld(i.canvas,e.bounds))}__onResize(t){this.forEach(e=>e.resize(t)),super.__onResize(t)}updateLayout(){this.forEach(t=>t.updateLayout())}__getChildConfig(t){const e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&g.assign(e,t),this.autoLayout&&g.copyAttrs(e,this,be),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once([[No.END,this.__onReady,this],[Yo.START,this.__onCreated,this],[Yo.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push(t.on_(Yo.END,this.__onChildRenderEnd,this))}},t.App=he([zn()],t.App);const od={},ad={isHoldSpaceKey:()=>ad.isHold("Space"),isHold:t=>od[t],isHoldKeys:(t,e)=>e?t(e):void 0,setDownCode(t){od[t]||(od[t]=!0)},setUpCode(t){od[t]=!1}},hd={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class ld extends So{get spaceKey(){return ad.isHoldSpaceKey()}get left(){return hd.left(this)}get right(){return hd.right(this)}get middle(){return hd.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}isHoldKeys(t){return ad.isHoldKeys(t,this)}getBoxPoint(t){return(t||this.current).getBoxPoint(this)}getInnerPoint(t){return(t||this.current).getInnerPoint(this)}getLocalPoint(t){return(t||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,e){ne.changeName(t,e)}}const{min:dd,max:cd,abs:ud}=Math,{float:_d,sign:pd}=L,{minX:gd,maxX:fd,minY:yd,maxY:md}=Wt,vd=new Nt,wd=new Nt,xd={limitMove(t,e){const{dragBounds:i,dragBoundsType:s}=t;i&&bd.getValidMove(t.__localBoxBounds,bd.getDragBounds(t),s,e,!0),bd.axisMove(t,e)},limitScaleOf(t,e,i,s){const{dragBounds:r,dragBoundsType:n}=t;r&&bd.getValidScaleOf(t.__localBoxBounds,bd.getDragBounds(t),n,t.getLocalPointByInner(t.getInnerPointByBox(e)),i,s,!0)},axisMove(t,e){const{draggable:i}=t;"x"===i&&(e.y=0),"y"===i&&(e.x=0)},getDragBounds(t){const{dragBounds:e}=t;return"parent"===e?t.parent.boxBounds:e},isInnerMode:(t,e,i,s)=>"inner"===i||"auto"===i&&t[s]>e[s],getValidMove(t,e,i,s,r){const n=t.x+s.x,o=t.y+s.y,a=n+t.width,h=o+t.height,l=e.x+e.width,d=e.y+e.height;return r||(s=Object.assign({},s)),bd.isInnerMode(t,e,i,"width")?n>e.x?s.x+=e.x-n:a<l&&(s.x+=l-a):n<e.x?s.x+=e.x-n:a>l&&(s.x+=l-a),bd.isInnerMode(t,e,i,"height")?o>e.y?s.y+=e.y-o:h<d&&(s.y+=d-h):o<e.y?s.y+=e.y-o:h>d&&(s.y+=d-h),s.x=_d(s.x),s.y=_d(s.y),s},getValidScaleOf(t,e,i,s,r,n,o){o||(r=Object.assign({},r)),wd.set(e),vd.set(t).scaleOf(s,r.x,r.y);const a=(s.x-t.x)/t.width,h=1-a,d=(s.y-t.y)/t.height,c=1-d;let u,_,p,g,f=1,y=1;return bd.isInnerMode(t,e,i,"width")?(r.x<0&&vd.scaleOf(s,f=1/r.x,1),p=_d(vd.minX-wd.minX),g=_d(wd.maxX-vd.maxX),u=a&&p>0?1+p/(a*vd.width):1,_=h&&g>0?1+g/(h*vd.width):1,f*=cd(u,_)):(r.x<0&&((_d(gd(t)-gd(e))<=0||_d(fd(e)-fd(t))<=0)&&vd.scaleOf(s,f=1/r.x,1),vd.unsign()),p=_d(wd.minX-vd.minX),g=_d(vd.maxX-wd.maxX),u=a&&p>0?1-p/(a*vd.width):1,_=h&&g>0?1-g/(h*vd.width):1,f*=dd(u,_)),bd.isInnerMode(t,e,i,"height")?(r.y<0&&vd.scaleOf(s,1,y=1/r.y),p=_d(vd.minY-wd.minY),g=_d(wd.maxY-vd.maxY),u=d&&p>0?1+p/(d*vd.height):1,_=c&&g>0?1+g/(c*vd.height):1,y*=cd(u,_),n&&(u=cd(ud(f),ud(y)),f=pd(f)*u,y=pd(y)*u)):(r.y<0&&((_d(yd(t)-yd(e))<=0||_d(md(e)-md(t))<=0)&&vd.scaleOf(s,1,y=1/r.y),vd.unsign()),p=_d(wd.minY-vd.minY),g=_d(vd.maxY-wd.maxY),u=d&&p>0?1-p/(d*vd.height):1,_=c&&g>0?1-g/(c*vd.height):1,y*=dd(u,_)),r.x*=l(f)?f:1,r.y*=l(y)?y:1,r}},bd=xd;t.PointerEvent=class extends ld{},t.PointerEvent.POINTER="pointer",t.PointerEvent.BEFORE_DOWN="pointer.before_down",t.PointerEvent.BEFORE_MOVE="pointer.before_move",t.PointerEvent.BEFORE_UP="pointer.before_up",t.PointerEvent.DOWN="pointer.down",t.PointerEvent.MOVE="pointer.move",t.PointerEvent.UP="pointer.up",t.PointerEvent.OVER="pointer.over",t.PointerEvent.OUT="pointer.out",t.PointerEvent.ENTER="pointer.enter",t.PointerEvent.LEAVE="pointer.leave",t.PointerEvent.TAP="tap",t.PointerEvent.DOUBLE_TAP="double_tap",t.PointerEvent.CLICK="click",t.PointerEvent.DOUBLE_CLICK="double_click",t.PointerEvent.LONG_PRESS="long_press",t.PointerEvent.LONG_TAP="long_tap",t.PointerEvent.MENU="pointer.menu",t.PointerEvent.MENU_TAP="pointer.menu_tap",t.PointerEvent=he([Nn()],t.PointerEvent);const Ed=t.PointerEvent,Pd={};t.DragEvent=class extends t.PointerEvent{static setList(t){this.list=t instanceof hh?t:new hh(t)}static setData(t){this.data=t}static getValidMove(t,e,i,s=!0){const r=t.getLocalPoint(i,null,!0);return st.move(r,e.x-t.x,e.y-t.y),s&&this.limitMove(t,r),xd.axisMove(t,r),r}static limitMove(t,e){xd.limitMove(t,e)}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(Pd,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(Pd,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(Pd,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPagePoint(),i={};return Wt.set(i,e.x-t.x,e.y-t.y,t.x,t.y),Wt.unsign(i),i}assignMove(t){Pd.x=t?this.totalX:this.moveX,Pd.y=t?this.totalY:this.moveY}},t.DragEvent.BEFORE_DRAG="drag.before_drag",t.DragEvent.START="drag.start",t.DragEvent.DRAG="drag",t.DragEvent.END="drag.end",t.DragEvent.OVER="drag.over",t.DragEvent.OUT="drag.out",t.DragEvent.ENTER="drag.enter",t.DragEvent.LEAVE="drag.leave",t.DragEvent=he([Nn()],t.DragEvent);const Bd=t.DragEvent;t.DropEvent=class extends t.PointerEvent{static setList(e){t.DragEvent.setList(e)}static setData(e){t.DragEvent.setData(e)}},t.DropEvent.DROP="drop",t.DropEvent=he([Nn()],t.DropEvent),t.MoveEvent=class extends t.DragEvent{},t.MoveEvent.BEFORE_MOVE="move.before_move",t.MoveEvent.START="move.start",t.MoveEvent.MOVE="move",t.MoveEvent.END="move.end",t.MoveEvent=he([Nn()],t.MoveEvent),t.RotateEvent=class extends t.PointerEvent{},t.RotateEvent.BEFORE_ROTATE="rotate.before_rotate",t.RotateEvent.START="rotate.start",t.RotateEvent.ROTATE="rotate",t.RotateEvent.END="rotate.end",t.RotateEvent=he([Nn()],t.RotateEvent),t.SwipeEvent=class extends t.DragEvent{},t.SwipeEvent.SWIPE="swipe",t.SwipeEvent.LEFT="swipe.left",t.SwipeEvent.RIGHT="swipe.right",t.SwipeEvent.UP="swipe.up",t.SwipeEvent.DOWN="swipe.down",t.SwipeEvent=he([Nn()],t.SwipeEvent),t.ZoomEvent=class extends t.PointerEvent{},t.ZoomEvent.BEFORE_ZOOM="zoom.before_zoom",t.ZoomEvent.START="zoom.start",t.ZoomEvent.ZOOM="zoom",t.ZoomEvent.END="zoom.end",t.ZoomEvent=he([Nn()],t.ZoomEvent),t.KeyEvent=class extends ld{},t.KeyEvent.BEFORE_DOWN="key.before_down",t.KeyEvent.BEFORE_UP="key.before_up",t.KeyEvent.DOWN="key.down",t.KeyEvent.HOLD="key.hold",t.KeyEvent.UP="key.up",t.KeyEvent=he([Nn()],t.KeyEvent);const kd={getDragEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-e.x,moveY:i.y-e.y,totalX:i.x-t.x,totalY:i.y-t.y}),getDropEventData:(t,e,i)=>Object.assign(Object.assign({},t),{list:e,data:i}),getSwipeDirection:e=>e<-45&&e>-135?t.SwipeEvent.UP:e>45&&e<135?t.SwipeEvent.DOWN:e<=45&&e>=-45?t.SwipeEvent.RIGHT:t.SwipeEvent.LEFT,getSwipeEventData:(t,e,i)=>Object.assign(Object.assign({},i),{moveX:e.moveX,moveY:e.moveY,totalX:i.x-t.x,totalY:i.y-t.y,type:Sd.getSwipeDirection(st.getAngle(t,i))}),getBase(t){const e=1===t.button?4:t.button;return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,buttons:o(t.buttons)?1:0===t.buttons?e:t.buttons,origin:t}},pathHasEventType(t,e){const{list:i}=t;for(let t=0,s=i.length;t<s;t++)if(i[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const i=new hh,{list:s}=t;for(let t=0,r=s.length;t<r;t++)s[t].hasEvent(e)&&i.add(s[t]);return i},pathCanDrag:e=>e&&e.list.some(e=>Jn.draggable(e)||!e.isLeafer&&e.hasEvent(t.DragEvent.DRAG)),pathHasOutside:t=>t&&t.list.some(t=>t.isOutside)},Sd=kd,Td=new hh,{getDragEventData:Rd,getDropEventData:Cd,getSwipeEventData:Ld}=kd;class Od{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=Rd(t,t,t),this.canAnimate=this.canDragOut=!0}getList(e,i){const{proxy:s}=this.interaction.selector,r=s&&s.list.length,n=t.DragEvent.list||this.draggableList||Td;return this.dragging&&(r?e?Td:new hh(i?[...s.list,...s.dragHoverExclude]:s.list):n)}checkDrag(e,i){const{interaction:s}=this;if(this.moving&&e.buttons<1)return this.canAnimate=!1,void s.pointerCancel();!this.moving&&i&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(t.MoveEvent.START,this.dragData)),this.moving||this.dragStart(e,i),this.drag(e)}dragStart(e,i){this.dragging||(this.dragging=i&&hd.left(e),this.dragging&&(this.interaction.emit(t.DragEvent.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(t=>this.dragStartPoints[t.innerId]={x:t.x,y:t.y})}getDraggableList(t){let e;for(let i=0,s=t.length;i<s;i++)if(e=t.list[i],Jn.draggable(e)){this.draggableList=new hh(e);break}}drag(e){const{interaction:i,dragData:s,downData:r}=this,{path:n,throughPath:o}=r;this.dragData=Rd(r,s,e),o&&(this.dragData.throughPath=o),this.dragData.path=n,this.moving?(this.dragData.moveType="drag",i.emit(t.MoveEvent.BEFORE_MOVE,this.dragData),i.emit(t.MoveEvent.MOVE,this.dragData)):this.dragging&&(this.dragReal(),i.emit(t.DragEvent.BEFORE_DRAG,this.dragData),i.emit(t.DragEvent.DRAG,this.dragData))}dragReal(e){const{interaction:i}=this,{running:s}=i,r=this.realDraggableList;if(r.length&&s){const{totalX:s,totalY:n}=this.dragData,{dragLimitAnimate:o}=i.p,a=!o||!!e;r.forEach(i=>{if(i.draggable){const r=h(i.draggable),l=t.DragEvent.getValidMove(i,this.dragStartPoints[i.innerId],{x:s,y:n},a||r);o&&!r&&e?Jn.animateMove(i,l,d(o)?o:.3):i.move(l)}})}}dragOverOrOut(e){const{interaction:i}=this,{dragOverPath:s}=this,{path:r}=e;this.dragOverPath=r,s?r.indexAt(0)!==s.indexAt(0)&&(i.emit(t.DragEvent.OUT,e,s),i.emit(t.DragEvent.OVER,e,r)):i.emit(t.DragEvent.OVER,e,r)}dragEnterOrLeave(e){const{interaction:i}=this,{dragEnterPath:s}=this,{path:r}=e;i.emit(t.DragEvent.LEAVE,e,s,r),i.emit(t.DragEvent.ENTER,e,r,s),this.dragEnterPath=r}dragEnd(t,e){(this.dragging||this.moving)&&(this.checkDragEndAnimate(t,e)||this.dragEndReal(t))}dragEndReal(e){const{interaction:i,downData:s,dragData:r}=this;e||(e=r);const{path:n,throughPath:o}=s,a=Rd(s,e,e);if(o&&(a.throughPath=o),a.path=n,this.moving&&(this.moving=!1,a.moveType="drag",i.emit(t.MoveEvent.END,a)),this.dragging){const n=this.getList();this.dragging=!1,i.p.dragLimitAnimate&&this.dragReal(!0),i.emit(t.DragEvent.END,a),this.swipe(e,s,r,a),this.drop(e,n,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe(t,e,i,s){const{interaction:r}=this;if(st.getDistance(e,t)>r.config.pointer.swipeDistance){const t=Ld(e,i,s);this.interaction.emit(t.type,t)}}drop(e,i,s){const r=Cd(e,i,t.DragEvent.data);r.path=s,this.interaction.emit(t.DropEvent.DROP,r),this.interaction.emit(t.DragEvent.LEAVE,e,s)}dragReset(){t.DragEvent.list=t.DragEvent.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragEndAnimate(t,e){return!1}animate(t,e){}checkDragOut(t){}autoMoveOnDragOut(t){}autoMoveCancel(){}destroy(){this.dragReset()}}const Dd=Vt.get("emit");const Id=["move","zoom","rotate","key"];function Ad(t,e,i,s,r){if(Id.some(t=>e.startsWith(t))&&t.__.hitChildren&&!Wd(t,r)){let n;for(let o=0,a=t.children.length;o<a;o++)n=t.children[o],!i.path.has(n)&&n.__.hittable&&Md(n,e,i,s,r)}}function Md(t,e,i,s,r){if(t.destroyed)return!1;if(t.__.hitSelf&&!Wd(t,r)&&(Vh.updateEventStyle&&!s&&Vh.updateEventStyle(t,e),t.hasEvent(e,s))){i.phase=s?1:t===i.target?2:3;const r=ne.get(e,i);if(t.emitEvent(r,s),r.isStop)return!0}return!1}function Wd(t,e){return e&&e.has(t)}const Fd={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:Ud,pathCanDrag:zd,pathHasOutside:Nd}=kd;class Yd{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return!0===this.m.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&hd.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&hd.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&ad.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,e,i,s){this.config=g.clone(Fd),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=i,this.defaultPath=new hh(t),this.createTransformer(),this.dragger=new Od(this),s&&(this.config=g.default(s,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(e,i){e||(e=this.hoverData),e&&(hd.defaultLeft(e),this.updateDownData(e),this.checkPath(e,i),this.downTime=Date.now(),this.emit(t.PointerEvent.BEFORE_DOWN,e),this.emit(t.PointerEvent.DOWN,e),hd.left(e)&&(this.tapWait(),this.longPressWait(e)),this.waitRightTap=hd.right(e),this.dragger.setDragData(e),this.isHoldRightKey||this.updateCursor(e))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&hd.defaultLeft(t);(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(e){if(this.emit(t.PointerEvent.BEFORE_MOVE,e,this.defaultPath),this.downData){const t=st.getDistance(this.downData,e)>this.p.dragDistance;t&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(e,t)}this.dragger.moving||(this.updateHoverData(e),this.checkPath(e),this.emit(t.PointerEvent.MOVE,e),this.pointerHover(e),this.dragging&&(this.dragger.dragOverOrOut(e),this.dragger.dragEnterOrLeave(e))),this.updateCursor(this.downData||e)}pointerUp(e){const{downData:i}=this;if(e||(e=i),!i)return;hd.defaultLeft(e),e.multiTouch=i.multiTouch,this.findPath(e);const s=Object.assign(Object.assign({},e),{path:e.path.clone()});e.path.addList(i.path.list),this.checkPath(e),this.downData=null,this.emit(t.PointerEvent.BEFORE_UP,e),this.emit(t.PointerEvent.UP,e),this.touchLeave(e),e.isCancel||(this.tap(e),this.menuTap(e)),this.dragger.dragEnd(e),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}menu(e){this.findPath(e),this.emit(t.PointerEvent.MENU,e),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(e)}menuTap(e){this.waitRightTap&&this.waitMenuTap&&(this.emit(t.PointerEvent.MENU_TAP,e),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move(t){}zoom(t){}rotate(t){}transformEnd(){}wheel(t){}multiTouch(t,e){}keyDown(e){if(!this.config.keyEvent)return;this.emit(t.KeyEvent.BEFORE_DOWN,e,this.defaultPath);const{code:i}=e;this.downKeyMap[i]||(this.downKeyMap[i]=!0,ad.setDownCode(i),this.emit(t.KeyEvent.HOLD,e,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(t.KeyEvent.DOWN,e,this.defaultPath)}keyUp(e){if(!this.config.keyEvent)return;this.emit(t.KeyEvent.BEFORE_UP,e,this.defaultPath);const{code:i}=e;this.downKeyMap[i]=!1,ad.setUpCode(i),this.emit(t.KeyEvent.UP,e,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerHover(t){!this.canHover||this.dragging&&!this.p.dragHover||(t.path||(t.path=new hh),this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(e){const{path:i}=e,{overPath:s}=this;this.overPath=i,s?i.indexAt(0)!==s.indexAt(0)&&(this.emit(t.PointerEvent.OUT,e,s),this.emit(t.PointerEvent.OVER,e,i)):this.emit(t.PointerEvent.OVER,e,i)}pointerEnterOrLeave(e){let{path:i}=e;this.downData&&!this.moveMode&&(i=i.clone(),this.downData.path.forEach(t=>i.add(t)));const{enterPath:s}=this;this.enterPath=i,this.emit(t.PointerEvent.LEAVE,e,s,i),this.emit(t.PointerEvent.ENTER,e,i,s)}touchLeave(e){"touch"===e.pointerType&&this.enterPath&&(this.emit(t.PointerEvent.LEAVE,e),this.dragger.dragging&&this.emit(t.DropEvent.LEAVE,e))}tap(e){const{pointer:i}=this.config,s=this.longTap(e);if(!i.tapMore&&s)return;if(!this.waitTap)return;i.tapMore&&this.emitTap(e);const r=Date.now()-this.downTime,n=[t.PointerEvent.DOUBLE_TAP,t.PointerEvent.DOUBLE_CLICK].some(t=>Ud(e.path,t));r<i.tapTime+50&&n?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(e)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{i.tapMore||(this.tapWaitCancel(),this.emitTap(e))},i.tapTime))):i.tapMore||(this.tapWaitCancel(),this.emitTap(e))}findPath(t,i){const{hitRadius:s,through:r}=this.p,{bottomList:n,target:o}=this;e.backgrounder||t.origin||o&&o.updateLayout();const a=this.selector.getByPoint(t,s,Object.assign({bottomList:n,name:t.type},i||{through:r}));return a.throughPath&&(t.throughPath=a.throughPath),t.path=a.path,a.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!(!e||!e.isApp)&&(e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer)}checkPath(t,e){(e||this.moveMode&&!Nd(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||"auto"===this.m.drag&&!zd(t.path))&&!Nd(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,e,i){const{downData:s}=this;!t&&s&&(t=s),t&&(this.findPath(t,e),i&&s&&t.path.addList(s.path.list),this.downData=t)}updateHoverData(e){e||(e=this.hoverData),e&&(this.findPath(e,{exclude:this.dragger.getList(!1,!0),name:t.PointerEvent.MOVE}),this.hoverData=e)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,i;const{path:s}=t;for(let t=0,r=s.length;t<r&&(e=s.list[t],i=e.syncEventer&&e.syncEventer.cursor||e.cursor,!i);t++);this.setCursor(i)}setCursor(t){this.cursor=t}getLocal(t,e){const i=this.canvas.getClientBounds(e),s={x:t.clientX-i.x,y:t.clientY-i.y},{bounds:r}=this.canvas;return s.x*=r.width/i.width,s.y*=r.height/i.height,this.p.snap&&st.round(s),s}emitTap(e){this.emit(t.PointerEvent.TAP,e),this.emit(t.PointerEvent.CLICK,e)}emitDoubleTap(e){this.emit(t.PointerEvent.DOUBLE_TAP,e),this.emit(t.PointerEvent.DOUBLE_CLICK,e)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait(e){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(t.PointerEvent.LONG_PRESS,e)},this.p.longPressTime)}longTap(e){let i;return this.longPressed&&(this.emit(t.PointerEvent.LONG_TAP,e),(Ud(e.path,t.PointerEvent.LONG_TAP)||Ud(e.path,t.PointerEvent.LONG_PRESS))&&(i=!0)),this.longPressWaitCancel(),i}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:t}=this.m;this.shrinkCanvasBounds=new Nt(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(d(t)?t:2))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Uo.RESIZE,this.__onResize,this)],t.once(Xo.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,i,s){this.running&&function(t,e,i,s){if(!i&&!e.path)return;let r;e.type=t,i?e=Object.assign(Object.assign({},e),{path:i}):i=e.path,e.target=i.indexAt(0);try{for(let n=i.length-1;n>-1;n--){if(r=i.list[n],Md(r,t,e,!0,s))return;r.isApp&&Ad(r,t,e,!0,s)}for(let n=0,o=i.length;n<o;n++)if(r=i.list[n],r.isApp&&Ad(r,t,e,!1,s),Md(r,t,e,!1,s))return}catch(t){Dd.error(t)}}(t,e,i,s)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class Xd{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}Xd.custom={};class Hd extends ae{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new hh,this.pixelList=new hh}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),te.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),te.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}e.getSelector=function(t){return t.leafer?t.leafer.selector:e.selector||(e.selector=te.selector())};const{toInnerRadiusPointOf:jd,copy:Vd,setRadius:Gd}=st,{hitRadiusPoint:Kd,hitPoint:qd}=Wt,Zd={},$d={},Qd=t.Leaf.prototype;Qd.hit=function(t,i=0){this.updateLayout(),Vd($d,t),Gd($d,i);const s=this.__world;return!!(i?Kd(s,$d):qd(s,$d))&&(this.isBranch?e.getSelector(this).hitPoint(Object.assign({},$d),i,{target:this}):this.__hitWorld($d))},Qd.__hitWorld=function(t){const e=this.__;if(!e.hitSelf)return!1;const i=this.__world,s=this.__layout,r=i.width<10&&i.height<10;if(e.hitRadius&&(Vd(Zd,t),Gd(t=Zd,e.hitRadius)),jd(t,i,Zd),e.hitBox||r){if(Wt.hitRadiusPoint(s.boxBounds,Zd))return!0;if(r)return!1}return!s.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),s.boundsChanged||(s.hitCanvasChanged=!1)),this.__hit(Zd)},Qd.__hitFill=function(t){const e=this.__hitCanvas;return e&&e.hitFill(t,this.__.windingRule)},Qd.__hitStroke=function(t,e){const i=this.__hitCanvas;return i&&i.hitStroke(t,e)},Qd.__hitPixel=function(t){const e=this.__hitCanvas;return e&&e.hitPixel(t,this.__layout.renderBounds,e.hitScale)},Qd.__drawHitPath=function(t){t&&this.__drawRenderPath(t)};const Jd=new dt,tc=t.UI.prototype;tc.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:t}=this.leafer||this.parent&&this.parent.leafer||{};if(!t)return;const i=this.__,s=(i.__isAlphaPixelFill||i.__isCanvas)&&"pixel"===i.hitFill,r=i.__isAlphaPixelStroke&&"pixel"===i.hitStroke,n=s||r;this.__hitCanvas||(this.__hitCanvas=n?t.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):t.getPathType(this));const o=this.__hitCanvas;if(n){const{renderBounds:t}=this.__layout,n=e.image.hitCanvasSize,a=o.hitScale=Yt.set(0,0,n,n).getFitMatrix(t).a,{x:h,y:l,width:d,height:c}=Yt.set(t).scale(a);o.resize({width:d,height:c,pixelRatio:1}),o.clear(),jr.patternLocked=!0,this.__renderShape(o,{matrix:Jd.setWith(this.__world).scaleWith(1/a).invertWith().translate(-h,-l),ignoreFill:!s,ignoreStroke:!r}),jr.patternLocked=!1,o.resetTransform(),i.__isHitPixel=!0}else i.__isHitPixel&&(i.__isHitPixel=!1);this.__drawHitPath(o),o.setStrokeOptions(i)},tc.__hit=function(t){if(this.__box&&this.__box.__hit(t))return!0;const e=this.__;if(e.__isHitPixel&&this.__hitPixel(t))return!0;const{hitFill:i}=e,s=(e.fill||e.__isCanvas)&&("path"===i||"pixel"===i&&!(e.__isAlphaPixelFill||e.__isCanvas))||"all"===i;if(s&&this.__hitFill(t))return!0;const{hitStroke:r,__maxStrokeWidth:n}=e,o=e.stroke&&("path"===r||"pixel"===r&&!e.__isAlphaPixelStroke)||"all"===r;if(!s&&!o)return!1;const a=2*t.radiusX;let h=a;if(o)switch(e.strokeAlign){case"inside":if(h+=2*n,!s&&this.__hitFill(t)&&this.__hitStroke(t,h))return!0;h=a;break;case"center":h+=n;break;case"outside":if(h+=2*n,!s){if(!this.__hitFill(t)&&this.__hitStroke(t,h))return!0;h=a}}return!!h&&this.__hitStroke(t,h)};const ec=t.UI.prototype,ic=t.Rect.prototype,sc=t.Box.prototype;ic.__updateHitCanvas=sc.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&"pixel"===this.hitFill||"all"===this.hitStroke?ec.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},ic.__hitFill=sc.__hitFill=function(t){return this.__hitCanvas?ec.__hitFill.call(this,t):Wt.hitRadiusPoint(this.__layout.boxBounds,t)},t.Text.prototype.__drawHitPath=function(t){const{__lineHeight:e,fontSize:i,__baseLine:s,__letterSpacing:r,__textDrawData:n}=this.__;t.beginPath(),r<0?this.__drawPathByBox(t):n.rows.forEach(r=>t.rect(r.x,r.y-s,r.width,e<i?i:e))},t.Group.prototype.pick=function(t,i){return i||(i=n),this.updateLayout(),e.getSelector(this).getByPoint(t,i.hitRadius||0,Object.assign(Object.assign({},i),{target:this}))};const rc=Ee.prototype;rc.hitFill=function(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)},rc.hitStroke=function(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)},rc.hitPixel=function(t,e,i=1){let{x:s,y:r,radiusX:n,radiusY:o}=t;e&&(s-=e.x,r-=e.y),Yt.set(s-n,r-o,2*n,2*o).scale(i).ceil();const{data:a}=this.context.getImageData(Yt.x,Yt.y,Yt.width||1,Yt.height||1);for(let t=0,e=a.length;t<e;t+=4)if(a[t+3]>0)return!0;return a[3]>0};const nc={convert(t,e){const i=kd.getBase(t),{x:s,y:r}=e,n=Object.assign(Object.assign({},i),{x:s,y:r,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===n.pointerType&&(n.tangentialPressure=t.tangentialPressure,n.tiltX=t.tiltX,n.tiltY=t.tiltY,n.twist=t.twist),n},convertMouse(t,e){const i=kd.getBase(t),{x:s,y:r}=e;return Object.assign(Object.assign({},i),{x:s,y:r,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const i=nc.getTouch(t),s=kd.getBase(t),{x:r,y:n}=e;return Object.assign(Object.assign({},s),{x:r,y:n,width:1,height:1,pointerType:"touch",multiTouch:t.touches.length>1,pressure:i.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},oc={convert(t){const e=kd.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{pathCanDrag:ac}=kd;class hc extends Yd{get notPointer(){const{p:t}=this;return"pointer"!==t.type||t.touch||this.useMultiTouch}get notTouch(){const{p:t}=this;return"mouse"===t.type||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let i in e)e[i]=e[i].bind(this),t.addEventListener(i,e[i]);for(let t in i)i[t]=i[t].bind(this),window.addEventListener(t,i[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(oc.convert(t))}onKeyUp(t){this.keyUp(oc.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(nc.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(nc.convert(t,this.getLocal(t))))}onPointerMove(t,e){if(this.notPointer||this.preventWindowPointer(t))return;this.usePointer||(this.usePointer=!0);const i=nc.convert(t,this.getLocal(t,!0));e?this.pointerHover(i):this.pointerMove(i)}onPointerLeave(t){this.onPointerMove(t,!0)}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.notPointer||this.preventWindowPointer(t)||this.pointerUp(nc.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.notMouse||this.pointerDown(nc.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.notMouse||this.preventWindowPointer(t)||this.pointerMove(nc.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.notMouse||this.preventWindowPointer(t)||this.pointerUp(nc.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(t){const e=nc.getTouch(t),i=this.getLocal(e,!0),{preventDefault:s}=this.config.touch;(!0===s||"auto"===s&&ac(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(nc.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.notTouch||this.preventWindowPointer(t))return;const e=nc.getTouch(t);this.pointerMove(nc.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const e=nc.getTouch(t);this.pointerUp(nc.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(kd.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const s=[];return t.forEach(t=>{i=e.find(e=>e.identifier===t.identifier),i&&s.push({from:this.getLocal(t),to:this.getLocal(i)})}),s}getLocalTouchs(t){return t.map(t=>this.getLocal(t))}onWheel(t){this.preventDefaultWheel(t),this.wheel(Object.assign(Object.assign(Object.assign({},kd.getBase(t)),this.getLocal(t)),{deltaX:t.deltaX,deltaY:t.deltaY}))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=kd.getBase(t);Object.assign(e,this.getLocal(t));const i=t.scale/this.lastGestureScale,s=(t.rotation-this.lastGestureRotation)/Math.PI*180*(L.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},e),{scale:i*i})),this.rotate(Object.assign(Object.assign({},e),{rotation:s})),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),_(e[e.length-1])&&e.push("default"),this.canvas.view.style.cursor=e.map(t=>_(t)?`url(${t.url}) ${t.x||0} ${t.y||0}`:t).join(",")}eachCursor(t,e,i=0){if(i++,u(t))t.forEach(t=>this.eachCursor(t,e,i));else{const s=h(t)&&Xd.get(t);s&&i<2?this.eachCursor(s,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function lc(t,e){const i=t.__,{rows:s,decorationY:r}=i.__textDrawData;let n;i.__isPlacehold&&i.placeholderColor&&(e.fillStyle=i.placeholderColor);for(let t=0,i=s.length;t<i;t++)n=s[t],n.text?e.fillText(n.text,n.x,n.y):n.data&&n.data.forEach(t=>{e.fillText(t.char,t.x,n.y)});if(r){const{decorationColor:t,decorationHeight:n}=i.__textDrawData;t&&(e.fillStyle=t),s.forEach(t=>r.forEach(i=>e.fillRect(t.x,t.y+i,t.width,n)))}}function dc(t,e){t.__.__font?lc(t,e):t.__.windingRule?e.fill(t.__.windingRule):e.fill()}function cc(t,e,i){switch(e.__.strokeAlign){case"center":uc(t,1,e,i);break;case"inside":_c(t,"inside",e,i);break;case"outside":e.__.__fillAfterStroke?uc(t,2,e,i):_c(t,"outside",e,i)}}function uc(t,e,i,s){const r=i.__;_(t)?gc(t,e,!0,i,s):(s.setStroke(t,r.__strokeWidth*e,r),pc(i,s))}function _c(t,e,i,s){const r=s.getSameCanvas(!0,!0);r.font=i.__.__font,uc(t,2,i,r),r.blendMode="outside"===e?"destination-out":"destination-in",lc(i,r),r.blendMode="normal",Jn.copyCanvasByWorld(i,s,r),r.recycle(i.__nowWorld)}function pc(t,e){let i,s=t.__.__textDrawData;const{rows:r,decorationY:n}=s;for(let t=0,s=r.length;t<s;t++)i=r[t],i.text?e.strokeText(i.text,i.x,i.y):i.data&&i.data.forEach(t=>{e.strokeText(t.char,t.x,i.y)});if(n){const{decorationHeight:t}=s;r.forEach(i=>n.forEach(s=>e.strokeRect(i.x,i.y+s,i.width,t)))}}function gc(t,e,i,s,r){let n;const o=s.__,{__hasMultiStrokeStyle:a}=o;a||r.setStroke(void 0,o.__strokeWidth*e,o);for(let h=0,l=t.length;h<l;h++)if(n=t[h],(!n.image||!Nh.checkImage(s,r,n,!1))&&n.style){if(a){const{strokeStyle:t}=n;t?r.setStroke(n.style,o.__getRealStrokeWidth(t)*e,o,t):r.setStroke(n.style,o.__strokeWidth*e,o)}else r.strokeStyle=n.style;n.blendMode?(r.saveBlendMode(n.blendMode),i?pc(s,r):r.stroke(),r.restoreBlendMode()):i?pc(s,r):r.stroke()}}function fc(t,e,i){const s=e.__;if(s.__strokeWidth)if(s.__font)cc(t,e,i);else switch(s.strokeAlign){case"center":yc(t,1,e,i);break;case"inside":!function(t,e,i){i.save(),i.clipUI(e),yc(t,2,e,i),i.restore()}(t,e,i);break;case"outside":!function(t,e,i){const s=e.__;if(s.__fillAfterStroke)yc(t,2,e,i);else{const{renderBounds:r}=e.__layout,n=i.getSameCanvas(!0,!0);e.__drawRenderPath(n),yc(t,2,e,n),n.clipUI(s),n.clearWorld(r),Jn.copyCanvasByWorld(e,i,n),n.recycle(e.__nowWorld)}}(t,e,i)}}function yc(t,e,i,s){const r=i.__;_(t)?gc(t,e,!1,i,s):(s.setStroke(t,r.__strokeWidth*e,r),s.stroke()),r.__useArrow&&zh.strokeArrow(t,i,s)}const{getSpread:mc,copyAndSpread:vc,toOuterOf:wc,getOuterOf:xc,getByMove:bc,move:Ec,getIntersectData:Pc}=Wt,Bc={};let kc;const{stintSet:Sc}=g,{hasTransparent:Tc}=Wh;function Rc(t,e,i){if(!_(e)||!1===e.visible||0===e.opacity)return;let s;const{boxBounds:r}=i.__layout;switch(e.type){case"image":s=Nh.image(i,t,e,r,!kc||!kc[e.url]);break;case"linear":s=Yh.linearGradient(e,r);break;case"radial":s=Yh.radialGradient(e,r);break;case"angular":s=Yh.conicGradient(e,r);break;case"solid":const{type:n,color:a,opacity:h}=e;s={type:n,style:Wh.string(a,h)};break;default:o(e.r)||(s={type:"solid",style:Wh.string(e)})}if(s){if(h(s.style)&&Tc(s.style)&&(s.isTransparent=!0),e.style){if(0===e.style.strokeWidth)return;s.strokeStyle=e.style}e.editing&&(s.editing=e.editing),e.blendMode&&(s.blendMode=e.blendMode)}return s}const Cc={compute:function(t,e){const i=e.__,s=[];let r,n,o,a=i.__input[t];u(a)||(a=[a]),kc=Nh.recycleImage(t,i);for(let i,r=0,n=a.length;r<n;r++)(i=Rc(t,a[r],e))&&(s.push(i),i.strokeStyle&&(o||(o=1),i.strokeStyle.strokeWidth&&(o=Math.max(o,i.strokeStyle.strokeWidth))));i["_"+t]=s.length?s:void 0,s.length&&s.every(t=>t.isTransparent)&&(s.some(t=>t.image)&&(r=!0),n=!0),"fill"===t?(Sc(i,"__isAlphaPixelFill",r),Sc(i,"__isTransparentFill",n)):(Sc(i,"__isAlphaPixelStroke",r),Sc(i,"__isTransparentStroke",n),Sc(i,"__hasMultiStrokeStyle",o))},fill:function(t,e,i){i.fillStyle=t,dc(e,i)},fills:function(t,e,i){let s;for(let r=0,n=t.length;r<n;r++){if(s=t[r],s.image){if(Nh.checkImage(e,i,s,!e.__.__font))continue;if(!s.style){!r&&s.image.isPlacehold&&e.drawImagePlaceholder(i,s.image);continue}}if(i.fillStyle=s.style,s.transform||s.scaleFixed){if(i.save(),s.transform&&i.transform(s.transform),s.scaleFixed){const{scaleX:t,scaleY:r}=e.getRenderScaleData(!0);(!0===s.scaleFixed||"zoom-in"===s.scaleFixed&&t>1&&r>1)&&i.scale(1/t,1/r)}s.blendMode&&(i.blendMode=s.blendMode),dc(e,i),i.restore()}else s.blendMode?(i.saveBlendMode(s.blendMode),dc(e,i),i.restoreBlendMode()):dc(e,i)}},fillPathOrText:dc,fillText:lc,stroke:fc,strokes:function(t,e,i){fc(t,e,i)},strokeText:cc,drawTextStroke:pc,shape:function(t,i,s){const r=i.getSameCanvas(),n=i.bounds,o=t.__nowWorld,a=t.__layout,h=t.__nowWorldShapeBounds||(t.__nowWorldShapeBounds={});let l,d,c,u,_,p;wc(a.strokeSpread?(vc(Bc,a.boxBounds,a.strokeSpread),Bc):a.boxBounds,o,h);let{scaleX:g,scaleY:f}=t.getRenderScaleData(!0);if(n.includes(h))p=r,l=_=h,d=o;else{let r;if(e.fullImageShadow)r=h;else{const t=a.renderShapeSpread?mc(n,E.swapAndScale(a.renderShapeSpread,g,f)):n;r=Pc(t,h)}u=n.getFitMatrix(r);let{a:y,d:m}=u;u.a<1&&(p=i.getSameCanvas(),t.__renderShape(p,s),g*=y,f*=m),_=xc(h,u),l=bc(_,-u.e,-u.f),d=xc(o,u),Ec(d,-u.e,-u.f);const v=s.matrix;v?(c=new dt(u),c.multiply(v),y*=v.scaleX,m*=v.scaleY):c=u,c.withScale(y,m),s=Object.assign(Object.assign({},s),{matrix:c})}return t.__renderShape(r,s),{canvas:r,matrix:c,fitMatrix:u,bounds:l,renderBounds:d,worldCanvas:p,shapeBounds:_,scaleX:g,scaleY:f}}};let Lc={},Oc={a:1,b:0,c:0,d:1,e:0,f:0};const{get:Dc,set:Ic,rotateOfOuter:Ac,translate:Mc,scaleOfOuter:Wc,multiplyParent:Fc,scale:Uc,rotate:zc,skew:Nc}=V;function Yc(t,e,i,s){const r=Dc();Mc(r,e.x,e.y),i&&Uc(r,i,s),t.transform=r}function Xc(t,e,i,s,r,n,o){const a=Dc();Mc(a,e.x+i,e.y+s),Uc(a,r,n),o&&Ac(a,{x:e.x+e.width/2,y:e.y+e.height/2},o),t.transform=a}function Hc(t,e,i,s,r,n,o,a,h,l){const d=Dc();Vc(d,e,i,s,r,n,o,a),h&&(o||a?(Ic(Oc),Wc(Oc,e,h,l),Fc(d,Oc)):Wc(d,e,h,l)),t.transform=d}function jc(t,e,i,s,r,n,o,a,h,l,d,c){const u=Dc();if(c)Vc(u,e,r,n,o,a,h,l);else{if(h)if("center"===d)Ac(u,{x:i/2,y:s/2},h);else switch(zc(u,h),h){case 90:Mc(u,s,0);break;case 180:Mc(u,i,s);break;case 270:Mc(u,0,i)}Lc.x=e.x+r,Lc.y=e.y+n,Mc(u,Lc.x,Lc.y),o&&Wc(u,Lc,o,a)}t.transform=u}function Vc(t,e,i,s,r,n,o,a){o&&zc(t,o),a&&Nc(t,a.x,a.y),r&&Uc(t,r,n),Mc(t,e.x+i,e.y+s)}const{get:Gc,translate:Kc}=V,qc=new Nt,Zc={},$c={};function Qc(t,e,i,s){const{changeful:r,sync:n,scaleFixed:o}=i;r&&(t.changeful=r),n&&(t.sync=n),o&&(t.scaleFixed=o),t.data=Jc(i,s,e)}function Jc(t,e,i){t.padding&&(e=qc.set(e).shrink(t.padding)),"strench"===t.mode&&(t.mode="stretch");let{width:s,height:r}=i;const{opacity:n,mode:o,align:a,offset:l,scale:d,size:c,rotation:u,skew:p,clipSize:g,repeat:f,gap:y,filters:m}=t,v=e.width===s&&e.height===r,w={mode:o},x="center"!==a&&(u||0)%180==90;let b,E;switch(Wt.set($c,0,0,x?r:s,x?s:r),o&&"cover"!==o&&"fit"!==o?((d||c)&&(L.getScaleData(d,c,i,Zc),b=Zc.scaleX,E=Zc.scaleY),(a||y||f)&&(b&&Wt.scale($c,b,E,!0),a&&wt.toPoint(a,$c,e,$c,!0,!0))):v&&!u||(b=E=Wt.getFitScale(e,$c,"fit"!==o),Wt.put(e,i,a,b,!1,$c),Wt.scale($c,b,E,!0)),l&&st.move($c,l),o){case"stretch":v||(b=e.width/s,E=e.height/r,Yc(w,e,b,E));break;case"normal":case"clip":if($c.x||$c.y||b||g||u||p){let t,i;g&&(t=e.width/g.width,i=e.height/g.height),Hc(w,e,$c.x,$c.y,b,E,u,p,t,i),t&&(b=b?b*t:t,E=E?E*i:i)}break;case"repeat":(!v||b||u||p)&&jc(w,e,s,r,$c.x,$c.y,b,E,u,p,a,t.freeTransform),f||(w.repeat="repeat");const i=_(f);(y||i)&&(w.gap=function(t,e,i,s,r){let n,o;_(t)?(n=t.x,o=t.y):n=o=t;return{x:tu(n,i,r.width,e&&e.x),y:tu(o,s,r.height,e&&e.y)}}(y,i&&f,$c.width,$c.height,e));break;default:b&&Xc(w,e,$c.x,$c.y,b,E,u)}return w.transform||(e.x||e.y)&&Kc(w.transform=Gc(),e.x,e.y),w.width=s,w.height=r,b&&(w.scaleX=b,w.scaleY=E),n&&(w.opacity=n),m&&(w.filters=m),f&&(w.repeat=h(f)?"x"===f?"repeat-x":"repeat-y":"repeat"),w}function tu(t,e,i,s){const r=h(t)||s?(s?i-s*e:i%e)/((s||Math.floor(i/e))-1):t;return"auto"===t&&r<0?0:r}let eu,iu=new Nt;const{isSame:su}=Wt;function ru(t,e,i,s,r,n){if("fill"===e&&!t.__.__naturalWidth){const e=t.__;if(e.__naturalWidth=s.width/e.pixelRatio,e.__naturalHeight=s.height/e.pixelRatio,e.__autoSide)return t.forceUpdate("width"),t.__proxyData&&(t.setProxyAttr("width",e.width),t.setProxyAttr("height",e.height)),!1}return r.data||Qc(r,s,i,n),!0}function nu(t,e){hu(t,Oo.LOAD,e)}function ou(t,e){hu(t,Oo.LOADED,e)}function au(t,e,i){e.error=i,t.forceUpdate("surface"),hu(t,Oo.ERROR,e)}function hu(t,e,i){t.hasEvent(e)&&t.emitEvent(new Oo(e,i))}function lu(t,e){const{leafer:i}=t;i&&i.viewReady&&(i.renderer.ignore=e)}const{get:du,scale:cu,copy:uu}=V,{floor:_u,ceil:pu,max:gu,abs:fu}=Math;function yu(t,i,s){let{scaleX:r,scaleY:n}=t.getRenderScaleData(!0,i.scaleFixed);const o=r+"-"+n+"-"+s;if(i.patternId===o||t.destroyed)return!1;{const{image:a,data:h}=i;let l,d,{width:c,height:u,scaleX:_,scaleY:p,transform:g,repeat:f,gap:y}=h;r*=s,n*=s,_&&(_=fu(_),p=fu(p),d=du(),uu(d,g),cu(d,1/_,1/p),r*=_,n*=p),c*=r,u*=n;const m=c*u;if(!f&&m>e.image.maxCacheSize)return!1;let v=e.image.maxPatternSize;if(a.isSVG){const t=c/a.width;t>1&&(l=t/pu(t))}else{const t=a.width*a.height;v>t&&(v=t)}m>v&&(l=Math.sqrt(m/v)),l&&(r/=l,n/=l,c/=l,u/=l),_&&(r/=_,n/=p);const w=y&&y.x*r,x=y&&y.y*n;if(g||1!==r||1!==n){const t=c+(w||0),e=u+(x||0);r/=t/gu(_u(t),1),n/=e/gu(_u(e),1),d||(d=du(),g&&uu(d,g)),cu(d,1/r,1/n)}const b=a.getCanvas(c,u,h.opacity,h.filters,w,x,t.leafer&&t.leafer.config.smooth),E=a.getPattern(b,f||e.origin.noRepeat||"no-repeat",d,i);return i.style=E,i.patternId=o,!0}}const mu={image:function(t,e,i,s,r){let n,o;const a=jr.get(i);return eu&&i===eu.paint&&su(s,eu.boxBounds)?n=eu.leafPaint:(n={type:i.type,image:a},a.hasAlphaPixel&&(n.isTransparent=!0),eu=a.use>1?{leafPaint:n,paint:i,boxBounds:iu.set(s)}:null),(r||a.loading)&&(o={image:a,attrName:e,attrValue:i}),a.ready?(ru(t,e,i,a,n,s),r&&(nu(t,o),ou(t,o))):a.error?r&&au(t,o,a.error):(r&&(lu(t,!0),nu(t,o)),n.loadId=a.load(()=>{lu(t,!1),t.destroyed||(ru(t,e,i,a,n,s)&&(a.hasAlphaPixel&&(t.__layout.hitCanvasChanged=!0),t.forceUpdate("surface")),ou(t,o)),n.loadId=void 0},e=>{lu(t,!1),au(t,o,e),n.loadId=void 0}),t.placeholderColor&&(t.placeholderDelay?setTimeout(()=>{a.ready||(a.isPlacehold=!0,t.forceUpdate("surface"))},t.placeholderDelay):a.isPlacehold=!0)),n},checkImage:function(t,i,s,r){const{scaleX:n,scaleY:o}=t.getRenderScaleData(!0,s.scaleFixed),{pixelRatio:a}=i,{data:h}=s;if(!h||s.patternId===n+"-"+o+"-"+a&&!jh.running)return!1;if(r)if(h.repeat)r=!1;else if(!(s.changeful||"miniapp"===e.name&&Uo.isResizing(t)||jh.running)){let{width:t,height:i}=h;t*=n*a,i*=o*a,h.scaleX&&(t*=h.scaleX,i*=h.scaleY),r=t*i>e.image.maxCacheSize}return r?(t.__.__isFastShadow&&(i.fillStyle=s.style||"#000",i.fill()),function(t,e,i,s){e.save(),e.clipUI(t),i.blendMode&&(e.blendMode=i.blendMode);s.opacity&&(e.opacity*=s.opacity);s.transform&&e.transform(s.transform);e.drawImage(i.image.getFull(s.filters),0,0,s.width,s.height),e.restore()}(t,i,s,h),!0):(!s.style||s.sync||jh.running?yu(t,s,a):s.patternTask||(s.patternTask=jr.patternTasker.add(()=>le(this,void 0,void 0,function*(){s.patternTask=null,i.bounds.hit(t.__nowWorld)&&yu(t,s,a),t.forceUpdate("surface")}),300)),!1)},createPattern:yu,recycleImage:function(t,e){const i=e["_"+t];if(u(i)){let s,r,n,o,a;for(let h=0,l=i.length;h<l;h++)s=i[h],r=s.image,a=r&&r.url,a&&(n||(n={}),n[a]=!0,jr.recycle(r),r.loading&&(o||(o=e.__input&&e.__input[t]||[],u(o)||(o=[o])),r.unload(i[h].loadId,!o.some(t=>t.url===a))));return n}return null},createData:Qc,getPatternData:Jc,stretchMode:Yc,fillOrFitMode:Xc,clipMode:Hc,repeatMode:jc},{toPoint:vu}=yt,{hasTransparent:wu}=Wh,xu={},bu={};function Eu(t,e,i,s){if(i){let r,n,o,a;for(let t=0,l=i.length;t<l;t++)r=i[t],h(r)?(o=t/(l-1),n=Wh.string(r,s)):(o=r.offset,n=Wh.string(r.color,s)),e.addColorStop(o,n),!a&&wu(n)&&(a=!0);a&&(t.isTransparent=!0)}}const{getAngle:Pu,getDistance:Bu}=st,{get:ku,rotateOfOuter:Su,scaleOfOuter:Tu}=V,{toPoint:Ru}=yt,Cu={},Lu={};function Ou(t,e,i,s,r){let n;const{width:o,height:a}=t;if(o!==a||s){const t=Pu(e,i);n=ku(),r?(Tu(n,e,o/a*(s||1),1),Su(n,e,t+90)):(Tu(n,e,1,o/a*(s||1)),Su(n,e,t))}return n}const{getDistance:Du}=st,{toPoint:Iu}=yt,Au={},Mu={};const Wu={linearGradient:function(t,i){let{from:s,to:r,type:n,opacity:o}=t;vu(s||"top",i,xu),vu(r||"bottom",i,bu);const a=e.canvas.createLinearGradient(xu.x,xu.y,bu.x,bu.y),h={type:n,style:a};return Eu(h,a,t.stops,o),h},radialGradient:function(t,i){let{from:s,to:r,type:n,opacity:o,stretch:a}=t;Ru(s||"center",i,Cu),Ru(r||"bottom",i,Lu);const h=e.canvas.createRadialGradient(Cu.x,Cu.y,0,Cu.x,Cu.y,Bu(Cu,Lu)),l={type:n,style:h};Eu(l,h,t.stops,o);const d=Ou(i,Cu,Lu,a,!0);return d&&(l.transform=d),l},conicGradient:function(t,i){let{from:s,to:r,type:n,opacity:o,stretch:a}=t;Iu(s||"center",i,Au),Iu(r||"bottom",i,Mu);const h=e.conicGradientSupport?e.canvas.createConicGradient(0,Au.x,Au.y):e.canvas.createRadialGradient(Au.x,Au.y,0,Au.x,Au.y,Du(Au,Mu)),l={type:n,style:h};Eu(l,h,t.stops,o);const d=Ou(i,Au,Mu,a||1,e.conicGradientRotate90);return d&&(l.transform=d),l},getTransform:Ou},{copy:Fu,move:Uu,toOffsetOutBounds:zu}=Wt,{max:Nu,abs:Yu}=Math,Xu={},Hu=new dt,ju={};function Vu(t,e){let i,s,r,n,o=0,a=0,h=0,l=0;return e.forEach(t=>{i=t.x||0,s=t.y||0,n=1.5*(t.blur||0),r=Yu(t.spread||0),o=Nu(o,r+n-s),a=Nu(a,r+n+i),h=Nu(h,r+n+s),l=Nu(l,r+n-i)}),o===a&&a===h&&h===l?o:[o,a,h,l]}function Gu(t,i,s){const{shapeBounds:r}=s;let n,o;e.fullImageShadow?(Fu(Xu,t.bounds),Uu(Xu,i.x-r.x,i.y-r.y),n=t.bounds,o=Xu):(n=r,o=i),t.copyWorld(s.canvas,n,o)}const{toOffsetOutBounds:Ku}=Wt,qu={};const Zu=Vu;const $u={shadow:function(t,e,i){let s,r;const{__nowWorld:n}=t,{shadow:o}=t.__,{worldCanvas:a,bounds:h,renderBounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=o.length-1;zu(h,ju,l),o.forEach((o,g)=>{let f=1;if(o.scaleFixed){const t=Math.abs(n.scaleX);t>1&&(f=1/t)}_.setWorldShadow(ju.offsetX+(o.x||0)*c*f,ju.offsetY+(o.y||0)*u*f,(o.blur||0)*c*f,Wh.string(o.color)),r=Xh.getShadowTransform(t,_,i,o,ju,f),r&&_.setTransform(r),Gu(_,ju,i),r&&_.resetTransform(),s=l,o.box&&(_.restore(),_.save(),a&&(_.copyWorld(_,l,n,"copy"),s=n),a?_.copyWorld(a,n,n,"destination-out"):_.copyWorld(i.canvas,d,h,"destination-out")),Jn.copyCanvasByWorld(t,e,_,s,o.blendMode),p&&g<p&&_.clearWorld(s)}),_.recycle(s)},innerShadow:function(t,e,i){let s,r;const{__nowWorld:n}=t,{innerShadow:o}=t.__,{worldCanvas:a,bounds:h,renderBounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=o.length-1;Ku(h,qu,l),o.forEach((o,g)=>{let f=1;if(o.scaleFixed){const t=Math.abs(n.scaleX);t>1&&(f=1/t)}_.save(),_.setWorldShadow(qu.offsetX+(o.x||0)*c*f,qu.offsetY+(o.y||0)*u*f,(o.blur||0)*c*f),r=Xh.getShadowTransform(t,_,i,o,qu,f,!0),r&&_.setTransform(r),Gu(_,qu,i),_.restore(),a?(_.copyWorld(_,l,n,"copy"),_.copyWorld(a,n,n,"source-out"),s=n):(_.copyWorld(i.canvas,d,h,"source-out"),s=l),_.fillWorld(s,Wh.string(o.color),"source-in"),Jn.copyCanvasByWorld(t,e,_,s,o.blendMode),p&&g<p&&_.clearWorld(s)}),_.recycle(s)},blur:function(t,e,i){const{blur:s}=t.__;i.setWorldBlur(s*t.__nowWorld.a),i.copyWorldToInner(e,t.__nowWorld,t.__layout.renderBounds),i.filter="none"},backgroundBlur:function(t,e,i){},getShadowRenderSpread:Vu,getShadowTransform:function(t,e,i,s,r,n,o){if(s.spread){const i=2*s.spread*n*(o?-1:1),{width:a,height:h}=t.__layout.strokeBounds;return Hu.set().scaleOfOuter({x:(r.x+r.width/2)*e.pixelRatio,y:(r.y+r.height/2)*e.pixelRatio},1+i/a,1+i/h),Hu}},isTransformShadow(t){},getInnerShadowSpread:Zu},{excludeRenderBounds:Qu}=ao;let Ju;function t_(t,e,i,s,r,n,o,a){switch(e){case"grayscale":Ju||(Ju=!0,r.useGrayscaleAlpha(t.__nowWorld));case"alpha":!function(t,e,i,s,r,n){const o=t.__nowWorld;i.resetTransform(),i.opacity=1,i.useMask(s,o),n&&s.recycle(o);i_(t,e,i,1,r,n)}(t,i,s,r,o,a);break;case"opacity-path":i_(t,i,s,n,o,a);break;case"path":a&&i.restore()}}function e_(t){return t.getSameCanvas(!1,!0)}function i_(t,e,i,s,r,n){const o=t.__nowWorld;e.resetTransform(),e.opacity=s,e.copyWorld(i,o,void 0,r),n?i.recycle(o):i.clearWorld(o)}t.Group.prototype.__renderMask=function(t,e){let i,s,r,n,o,a;const{children:h}=this;for(let l=0,d=h.length;l<d;l++){if(i=h[l],a=i.__.mask,a){o&&(t_(this,o,t,r,s,n,void 0,!0),s=r=null),"clipping"!==a&&"clipping-path"!==a||Qu(i,e)||i.__render(t,e),n=i.__.opacity,Ju=!1,"path"===a||"clipping-path"===a?(n<1?(o="opacity-path",r||(r=e_(t))):(o="path",t.save()),i.__clip(r||t,e)):(o="grayscale"===a?"grayscale":"alpha",s||(s=e_(t)),r||(r=e_(t)),i.__render(s,e));continue}const d=1===n&&i.__.__blendMode;d&&t_(this,o,t,r,s,n,void 0,!1),Qu(i,e)||i.__render(r||t,e),d&&t_(this,o,t,r,s,n,d,!1)}t_(this,o,t,r,s,n,void 0,!0)};const s_=">)]}%!?,.:;'\"",r_=s_+"_#~&*+\\=|",n_=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`).join("|"));function o_(t){const e={};return t.split("").forEach(t=>e[t]=!0),e}const a_=o_("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),h_=o_("{[(<'\""),l_=o_(s_),d_=o_(r_),c_=o_("- ");var u_;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}(u_||(u_={}));const{Letter:__,Single:p_,Before:g_,After:f_,Symbol:y_,Break:m_}=u_;function v_(t){return a_[t]?__:c_[t]?m_:h_[t]?g_:l_[t]?f_:d_[t]?y_:n_.test(t)?p_:__}const w_={trimRight(t){const{words:e}=t;let i,s=0,r=e.length;for(let n=r-1;n>-1&&(i=e[n].data[0]," "===i.char);n--)s++,t.width-=i.width;s&&e.splice(r-s,s)}};function x_(t,e,i){switch(e){case"title":return i?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:b_}=w_,{Letter:E_,Single:P_,Before:B_,After:k_,Symbol:S_,Break:T_}=u_;let R_,C_,L_,O_,D_,I_,A_,M_,W_,F_,U_,z_,N_,Y_,X_,H_,j_,V_=[];function G_(t,e){W_&&!M_&&(M_=W_),R_.data.push({char:t,width:e}),L_+=e}function K_(){O_+=L_,R_.width=L_,C_.words.push(R_),R_={data:[]},L_=0}function q_(){Y_&&(X_.paraNumber++,C_.paraStart=!0,Y_=!1),W_&&(C_.startCharSize=M_,C_.endCharSize=W_,M_=0),C_.width=O_,H_.width?b_(C_):j_&&Z_(),V_.push(C_),C_={words:[]},O_=0}function Z_(){O_>(X_.maxWidth||0)&&(X_.maxWidth=O_)}const{top:$_,right:Q_,bottom:J_,left:tp}=t.Direction4;function ep(t,e,i){const{bounds:s,rows:r}=t;s[e]+=i;for(let t=0;t<r.length;t++)r[t][e]+=i}const ip={getDrawData:function(t,i){h(t)||(t=String(t));let s=0,r=0,n=i.__getInput("width")||0,o=i.__getInput("height")||0;const{textDecoration:a,__font:l,__padding:d}=i;d&&(n?(s=d[tp],n-=d[Q_]+d[tp]):i.autoSizeAlign||(s=d[tp]),o?(r=d[$_],o-=d[$_]+d[J_]):i.autoSizeAlign||(r=d[$_]));const c={bounds:{x:s,y:r,width:n,height:o},rows:[],paraNumber:0,font:e.canvas.font=l};return function(t,i,s){X_=t,V_=t.rows,H_=t.bounds,j_=!H_.width&&!s.autoSizeAlign;const{__letterSpacing:r,paraIndent:n,textCase:o}=s,{canvas:a}=e,{width:h,height:l}=H_;if(h||l||r||"none"!==o){const t="none"!==s.textWrap,e="break"===s.textWrap;Y_=!0,U_=null,M_=A_=W_=L_=O_=0,R_={data:[]},C_={words:[]},r&&(i=[...i]);for(let s=0,l=i.length;s<l;s++)I_=i[s],"\n"===I_?(L_&&K_(),C_.paraEnd=!0,q_(),Y_=!0):(F_=v_(I_),F_===E_&&"none"!==o&&(I_=x_(I_,o,!L_)),A_=a.measureText(I_).width,r&&(r<0&&(W_=A_),A_+=r),z_=F_===P_&&(U_===P_||U_===E_)||U_===P_&&F_!==k_,N_=!(F_!==B_&&F_!==P_||U_!==S_&&U_!==k_),D_=Y_&&n?h-n:h,t&&h&&O_+L_+A_>D_&&(e?(L_&&K_(),O_&&q_()):(N_||(N_=F_===E_&&U_==k_),z_||N_||F_===T_||F_===B_||F_===P_||L_+A_>D_?(L_&&K_(),O_&&q_()):O_&&q_()))," "===I_&&!0!==Y_&&O_+L_===0||(F_===T_?(" "===I_&&L_&&K_(),G_(I_,A_),K_()):z_||N_?(L_&&K_(),G_(I_,A_)):G_(I_,A_)),U_=F_);L_&&K_(),O_&&q_(),V_.length>0&&(V_[V_.length-1].paraEnd=!0)}else i.split("\n").forEach(t=>{X_.paraNumber++,O_=a.measureText(t).width,V_.push({x:n||0,text:t,width:O_,paraStart:!0}),j_&&Z_()})}(c,t,i),d&&function(t,e,i,s,r){if(!s&&i.autoSizeAlign)switch(i.textAlign){case"left":ep(e,"x",t[tp]);break;case"right":ep(e,"x",-t[Q_])}if(!r&&i.autoSizeAlign)switch(i.verticalAlign){case"top":ep(e,"y",t[$_]);break;case"bottom":ep(e,"y",-t[J_])}}(d,c,i,n,o),function(t,e){const{rows:i,bounds:s}=t,r=i.length,{__lineHeight:n,__baseLine:o,__letterSpacing:a,__clipText:h,textAlign:l,verticalAlign:d,paraSpacing:c,autoSizeAlign:u}=e;let{x:_,y:p,width:g,height:f}=s,y=n*r+(c?c*(t.paraNumber-1):0),m=o;if(h&&y>f)y=Math.max(f,n),r>1&&(t.overflow=r);else if(f||u)switch(d){case"middle":p+=(f-y)/2;break;case"bottom":p+=f-y}m+=p;let v,w,x,b=g||u?g:t.maxWidth;for(let o=0,d=r;o<d;o++){if(v=i[o],v.x=_,v.width<g||v.width>g&&!h)switch(l){case"center":v.x+=(b-v.width)/2;break;case"right":v.x+=b-v.width}v.paraStart&&c&&o>0&&(m+=c),v.y=m,m+=n,t.overflow>o&&m>y&&(v.isOverflow=!0,t.overflow=o+1),w=v.x,x=v.width,a<0&&(v.width<0?(x=-v.width+e.fontSize+a,w-=x,x+=e.fontSize):x-=a),w<s.x&&(s.x=w),x>s.width&&(s.width=x),h&&g&&g<x&&(v.isOverflow=!0,t.overflow||(t.overflow=i.length))}s.y=p,s.height=y}(c,i),function(t,e,i){const{rows:s}=t,{textAlign:r,paraIndent:n,letterSpacing:o}=e;let a,h,l,d,c,u;s.forEach(t=>{t.words&&(l=n&&t.paraStart?n:0,u=t.words.length,h=i&&("justify"===r||"both"===r)&&u>1?(i-t.width-l)/(u-1):0,d=o||t.isOverflow?0:h>.01?1:2,t.isOverflow&&!o&&(t.textMode=!0),2===d?(t.x+=l,function(t){t.text="",t.words.forEach(e=>{e.data.forEach(e=>{t.text+=e.char})})}(t)):(t.x+=l,a=t.x,t.data=[],t.words.forEach((e,i)=>{1===d?(c={char:"",x:a},a=function(t,e,i){return t.forEach(t=>{i.char+=t.char,e+=t.width}),e}(e.data,a,c),(t.isOverflow||" "!==c.char)&&t.data.push(c)):a=function(t,e,i,s){return t.forEach(t=>{(s||" "!==t.char)&&(t.x=e,i.push(t)),e+=t.width}),e}(e.data,a,t.data,t.isOverflow),!h||t.paraEnd&&"both"!==r||i===u-1||(a+=h,t.width+=h)})),t.words=null)})}(c,i,n),c.overflow&&function(t,i,s,r){if(!r)return;const{rows:n,overflow:o}=t;let{textOverflow:a}=i;if(n.splice(o),a&&"show"!==a){let t,h;"hide"===a?a="":"ellipsis"===a&&(a="...");const l=a?e.canvas.measureText(a).width:0,d=s+r-l;("none"===i.textWrap?n:[n[o-1]]).forEach(e=>{if(e.isOverflow&&e.data){let i=e.data.length-1;for(let s=i;s>-1&&(t=e.data[s],h=t.x+t.width,!(s===i&&h<d));s--){if(h<d&&" "!==t.char||!s){e.data.splice(s+1),e.width-=t.width;break}e.width-=t.width}e.width+=l,e.data.push({char:a,x:h}),e.textMode&&function(t){t.text="",t.data.forEach(e=>{t.text+=e.char}),t.data=null}(e)}})}}(c,i,s,n),"none"!==a&&function(t,e){let i,s=0;const{fontSize:r,textDecoration:n}=e;switch(t.decorationHeight=r/11,_(n)?(i=n.type,n.color&&(t.decorationColor=Wh.string(n.color)),n.offset&&(s=Math.min(.3*r,Math.max(n.offset,.15*-r)))):i=n,i){case"under":t.decorationY=[.15*r+s];break;case"delete":t.decorationY=[.35*-r];break;case"under-delete":t.decorationY=[.15*r+s,.35*-r]}}(c,i),c}};const sp={string:function(t,e){if(!t)return"#000";const i=d(e)&&e<1;if(h(t)){if(!i||!Wh.object)return t;t=Wh.object(t)}let s=o(t.a)?1:t.a;i&&(s*=e);const r=t.r+","+t.g+","+t.b;return 1===s?"rgb("+r+")":"rgba("+r+","+s+")"}};return Object.assign(Mh,ip),Object.assign(Wh,sp),Object.assign(zh,Cc),Object.assign(Nh,mu),Object.assign(Yh,Wu),Object.assign(Xh,$u),Object.assign(te,{interaction:(t,e,i,s)=>new hc(t,e,i,s),hitCanvas:(t,e)=>new ch(t,e),hitCanvasManager:()=>new Hd}),ph(),t.AlignHelper=wt,t.AroundHelper=yt,t.AutoBounds=Xt,t.BezierHelper=Je,t.Bounds=Nt,t.BoundsEvent=Do,t.BoundsHelper=Wt,t.BoxData=sl,t.BranchHelper=uo,t.BranchRender=Sa,t.CanvasData=fl,t.CanvasManager=ae,t.ChildEvent=To,t.ColorConvert=Wh,t.Creator=te,t.Cursor=Xd,t.DataHelper=g,t.Debug=Vt,t.DragBoundsHelper=xd,t.Dragger=Od,t.Effect=Xh,t.EllipseData=hl,t.EllipseHelper=hi,t.Event=So,t.EventCreator=ne,t.Eventer=Zo,t.Export=jh,t.FileHelper=Wr,t.Filter=Hh,t.FourNumberHelper=E,t.FrameData=nl,t.GroupData=il,t.HitCanvasManager=Hd,t.ImageData=gl,t.ImageEvent=Oo,t.ImageManager=jr,t.IncrementId=i,t.Interaction=hc,t.InteractionBase=Yd,t.InteractionHelper=kd,t.Keyboard=ad,t.LayoutEvent=No,t.Layouter=Sh,t.LeafBounds=Pa,t.LeafBoundsHelper=ao,t.LeafData=y,t.LeafDataProxy=la,t.LeafEventer=aa,t.LeafHelper=Jn,t.LeafLayout=ko,t.LeafLevelList=lh,t.LeafList=hh,t.LeafMatrix=fa,t.LeafRender=Ba,t.LeaferCanvas=ch,t.LeaferCanvasBase=Ee,t.LeaferData=rl,t.LeaferEvent=Xo,t.LeaferImage=$r,t.LineData=ol,t.MathHelper=L,t.Matrix=dt,t.MatrixHelper=V,t.MyDragEvent=Bd,t.MyImage=ed,t.MyPointerEvent=Ed,t.NeedConvertToCanvasCommandMap=Te,t.OneRadian=D,t.PI2=I,t.PI_2=A,t.Paint=zh,t.PaintGradient=Yh,t.PaintImage=Nh,t.PathArrow=Uh,t.PathBounds=Br,t.PathCommandDataHelper=gs,t.PathCommandMap=ke,t.PathConvert=Vi,t.PathCorner=Or,t.PathCreator=Os,t.PathData=cl,t.PathDrawer=Gs,t.PathHelper=Pe,t.PathNumberCommandLengthMap=Oe,t.PathNumberCommandMap=Le,t.PenData=ul,t.Picker=Lh,t.Platform=e,t.Plugin=Jt,t.Point=ht,t.PointHelper=st,t.PointerButton=hd,t.PolygonData=ll,t.PropertyEvent=Co,t.RectData=al,t.RectHelper=De,t.RectRender=El,t.RenderEvent=Yo,t.Renderer=Rh,t.ResizeEvent=Uo,t.Resource=Xr,t.Run=Zt,t.Selector=Oh,t.StarData=dl,t.State=Vh,t.StringNumberMap=Ht,t.TaskItem=zr,t.TaskProcessor=Nr,t.TextConvert=Mh,t.TextData=pl,t.Transition=Gh,t.TwoPointBoundsHelper=ut,t.UIBounds=vl,t.UICreator=ie,t.UIData=tl,t.UIEvent=ld,t.UIRender=xl,t.UnitConvert=Fh,t.WaitHelper=fo,t.WatchEvent=zo,t.Watcher=fh,t.affectRenderBoundsType=vn,t.affectStrokeBoundsType=fn,t.attr=sn,t.autoLayoutType=hn,t.boundsType=cn,t.canvasPatch=Mr,t.canvasSizeAttrs=be,t.createAttr=function(t){return(e,i)=>{Qr(e,i,tn(i,t))}},t.createDescriptor=tn,t.cursorType=Cn,t.dataProcessor=Ln,t.dataType=nn,t.decorateLeafAttr=en,t.defineDataProcessor=On,t.defineKey=Qr,t.defineLeafAttr=rn,t.dimType=xn,t.doBoundsType=_n,t.doStrokeType=yn,t.effectType=Dh,t.emptyData=n,t.eraserType=Tn,t.extraPropertyEventMap=Lo,t.getBoundsData=W,t.getDescriptor=Jr,t.getMatrixData=F,t.getPointData=M,t.hitType=Rn,t.isArray=u,t.isData=function(t){return _(t)&&!u(t)},t.isEmptyData=p,t.isFinite=l,t.isNull=a,t.isNumber=d,t.isObject=_,t.isString=h,t.isUndefined=o,t.layoutProcessor=function(t){return(e,i)=>{Qr(e,"__LayoutProcessor",{get:()=>t})}},t.leaferTransformAttrMap=Ko,t.maskType=Sn,t.naturalBoundsType=un,t.opacityType=bn,t.path=Dr,t.pathInputType=pn,t.pathType=gn,t.pen=Ir,t.positionType=on,t.registerUI=zn,t.registerUIEvent=Nn,t.resizeType=Ih,t.rewrite=Mn,t.rewriteAble=Wn,t.rotationType=dn,t.scaleType=ln,t.scrollType=an,t.sortType=kn,t.strokeType=mn,t.surfaceType=wn,t.tempBounds=Yt,t.tempMatrix=ct,t.tempPoint=lt,t.tryToNumber=function(t){return"string"==typeof t&&c.test(t)?+t:t},t.useCanvas=ph,t.useModule=Un,t.version="1.9.12",t.visibleType=En,t.zoomLayerType=Ah,t}({});function Leafer(t){return new LeaferUI.Leafer(t)}Object.setPrototypeOf(Leafer,LeaferUI),Leafer.prototype=LeaferUI.Leafer.prototype;
//# sourceMappingURL=web.min.js.map
