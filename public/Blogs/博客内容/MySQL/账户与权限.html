<article class="专题简介">
  <h1 class="简介标题">
    <span>账户<span class="次要">与</span>权限</span
    ><span class="原创">原创</span>
  </h1>
  <div class="简介信息">
    <section class="简介信息文本">
      <p class="作者">
        <span class="作者前缀 前缀">作者：</span>
        <span class="作者姓名">苏扬</span>
      </p>
      <p class="日期">
        <span class="日期前缀 前缀">日期：</span>
        <span class="日期文本"><span class="日期文本-数字 日期文本-年">2024</span>年<span class="日期文本-数字 日期文本-月">3</span>月<span class="日期文本-数字 日期文本-日">17</span>日</span>
      </p>
    </section>
    <section class="简介信息图像">
      <img src="/Images/Contributors/苏扬.jpg" alt="苏扬" />
    </section>
  </div>
  <ul class="联系方式列表">
    <li class="联系方式项">
      <a class="联系方式链接" href="mailto:suyangzuo@gmail.com" target="_blank">
        <i class="fa-solid fa-envelope"></i>
      </a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://github.com/suyangzuo"
        target="_blank"
        ><i class="fa-brands fa-github"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://www.deviantart.com/suyangzuo"
        target="_blank"
        ><i class="fa-brands fa-deviantart"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a class="联系方式链接" href="https://dev.to/suyangzuo" target="_blank"
        ><i class="fa-brands fa-dev"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://www.freecodecamp.org/suyangzuo"
        target="_blank"
        ><i class="fa-brands fa-free-code-camp"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://codepen.io/suyangzuo"
        target="_blank"
        ><i class="fa-brands fa-codepen"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://dribbble.com/suyangzuo"
        target="_blank"
        ><i class="fa-brands fa-dribbble"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://www.artstation.com/user-7893655"
        target="_blank"
        ><i class="fa-brands fa-artstation"></i
      ></a>
    </li>
    <li class="联系方式项">
      <a
        class="联系方式链接"
        href="https://codesandbox.io/u/suyangzuo"
        target="_blank"
      >
        <img src="/Images/Page-Logos/CodeSandbox.png" alt="CodeSandbox"
      /></a>
    </li>
  </ul>
</article>
<div class="专题正文区">
  <article class="正文分区">
    <h2 class="分区标题 分区2级标题">账户管理</h2>

    <h3 class="分区标题 分区3级标题">身份验证</h3>
    <p class="分区普通文本">
      在安装<span class="行内专业名词">MySQL</span
      >时，有一步是选择身份验证方式：
    </p>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/下载与安装/MySQL-安装-07-验证方法.png"
        alt="MySQL 验证方法"
      />
    </figure>
    <p class="分区普通文本">
      <span class="行内专业名词">MySQL</span
      >包含多个用于身份验证的插件，其中用得最多的两个是：
    </p>
    <ul class="分区列表">
      <li class="分区列表项">
        <span class="代码">caching_sha2_password</span>，<span
          class="行内专业名词"
          >MySQL 8.x</span
        >的默认验证方式，安全性更高。
      </li>
      <li class="分区列表项">
        <span class="代码">mysql_native_password</span>，兼容<span
          class="行内专业名词"
          >MySQL 5.x</span
        >。从<span class="行内专业名词">MySQL 8.0.34</span>开始，<span
          class="行内代码"
          >mysql_native_password</span
        >身份验证插件已被弃用，并可能在未来版本中删除。
      </li>
    </ul>
    <p class="分区普通文本">
      新建账户时，可以指定身份验证方式；已有的账户，可以修改身份验证方式。
    </p>

    <h3 class="分区标题 分区3级标题">查询账户信息</h3>
    <p class="分区普通文本">
      账户信息都存储于<span class="行内代码">mysql</span>数据库的<span
        class="行内代码"
        >user</span
      >数据表中，该表拥有 51 个字段。我们只需要查询<span class="行内专业名词"
        >用户<span class="附加说明">user</span></span
      >、<span class="行内专业名词">主机<span class="附加说明">host</span></span
      >、<span class="行内专业名词"
        >身份验证插件<span class="附加说明">plugin</span>即可</span
      >。
    </p>
    <pre>
      <code class="lang-sql">
        select user,host,plugin from mysql.user;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/用户信息查询结果.png"
        alt="用户信息查询结果"
      />
    </figure>
    <p class="分区普通文本">
      目前有 5 个账户，身份验证方式都是<span class="行内代码"
        >caching_sha2_password</span
      >。
    </p>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        完整的账户名称包含 2 个部分：<span class="行内专业名词">用户名</span
        >和<span class="行内专业名词">主机名</span>，其语法是：<span
          class="代码"
          >'用户名'<span style="color: #5c8">@</span>'主机名'</span
        >。该语法遵循以下规则：
      </p>
      <ul class="分区列表">
        <li class="分区列表项">
          <span class="行内专业名词">主机名</span
          >可以省略；如果省略，则表示<span class="行内专业名词">%</span
          ><span class="附加说明">所有主机</span>。例如：<span class="代码"
            >'runner'</span
          ><i
            style="margin: 0 5px; color: gold; font-size: 0.8em"
            class="fa-solid fa-equals"
          ></i
          ><span class="代码"
            >'runner'<span style="color: #5c8">@</span>'%'</span
          >。
        </li>
        <li class="分区列表项">
          如果<span class="行内专业名词">用户名</span>和<span
            class="行内专业名词"
            >主机名</span
          >是合法的，可以不加引号。以下情况必须加引号：
          <ul class="分区列表">
            <li class="分区列表项">
              <span class="行内专业名词">用户名</span>包含特殊字符，如<span
                class="代码"
                >空格</span
              >、<span class="代码">-</span>
            </li>
            <li class="分区列表项">
              <span class="行内专业名词">主机名</span>包含特殊字符，如<span
                class="代码"
                >.</span
              >、<span class="代码">%</span>
            </li>
          </ul>
          例如：<span class="代码"
            >'su-yang'<span style="color: #5c8">@</span>'x.com'</span
          >，<span class="行内专业名词">用户名</span>和<span
            class="行内专业名词"
            >主机名</span
          >都必须加引号。
        </li>
      </ul>
    </section>

    <h3 class="分区标题 分区3级标题">创建账户</h3>
    <p class="分区普通文本">
      可以使用<span class="代码">create user</span
      >语句来创建账户，完整的语法参数非常多，我们只需要最常用的：
    </p>
    <pre>
      <code class="lang-sql">
        # create user '用户名'@'主机名' identified with 验证方式 by '密码';
        create user runner@localhost identified with caching_sha2_password by 'letmepass';
      </code>
    </pre>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        <span class="行内代码">runner</span>和<span class="行内代码"
          >localhost</span
        >都是合法名称，也没有特殊字符，因此可以不加引号。
      </p>
    </section>
    <p class="分区普通文本">成功运行命令后，再次查询账户信息：</p>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/创建账户后-查询账户信息.png"
        alt="创建账户后查询账户信息"
      />
    </figure>
    <p class="分区普通文本">
      成功地创建了账户：<span class="代码"
        >runner<span style="color: #aaa">@</span>localhost</span
      >。
    </p>
    <p class="分区普通文本">
      假设我们省略<span class="行内专业名词">主机名</span>和<span
        class="行内专业名词"
        >验证方式</span
      >，看看会有什么结果：
    </p>
    <pre>
      <code class="lang-sql">
        # create user '用户名' identified by '密码';
        create user tester identified by 'letmepass';
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/创建账户-省略主机名和验证方式-查询账户信息.png"
        alt="创建账户：省略主机名和验证方式 查询账户信息"
      />
    </figure>
    <p class="分区普通文本">
      省略<span class="行内专业名词">主机名</span>，则<span class="行内专业名词"
        >主机名</span
      >自动设置为<span class="代码">%</span
      ><span class="附加说明">所有主机</span>。省略<span class="行内专业名词"
        >验证方式</span
      >，则默认为<span class="行内代码">caching_sha2_password</span>。
    </p>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        事实上，创建账户语句连<span class="代码">identified by '密码'</span
        >也可以省略，这样的账户不需要密码就可以登录<span class="行内专业名词"
          >MySQL</span
        >。但是，这与数据库的安全性需求是完全背道而驰的。信息时代，数据库的重要性无以复加，因此实际工作中<span
          class="强调"
          >绝对不要创建无密码账户</span
        >！
      </p>
    </section>

    <h3 class="分区标题 分区3级标题">删除账户</h3>
    <p class="分区普通文本">
      使用<span class="代码">drop user</span>语句删除账户：
    </p>
    <pre>
      <code class="lang-sql">
        # drop user 账户;
        drop user tester@localhost;
      </code>
    </pre>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        <span class="代码">drop user</span
        >不会自动关闭任何已打开的会话，而是会等待会话结束。一旦会话结束，语句便会执行，执行后将无法再用该账户登录。
      </p>
    </section>

    <h3 class="分区标题 分区3级标题">修改账户验证方式和密码</h3>
    <p class="分区普通文本">
      使用<span class="代码">alter user</span>修改账户验证方式：
    </p>
    <pre>
      <code class="lang-sql">
        # alter user 账户 identified with 验证方式 by '密码';
        alter user tester@localhost identified with mysql_native_password by 'MyPassword';

        # 用 user() 函数可以方便地获取当前登录的账户
        alter user user() identified with mysql_native_password by 'MyPassword';
      </code>
    </pre>
  </article>

  <article class="正文分区">
    <h2 class="分区标题 分区2级标题">权限管理</h2>

    <h3 class="分区标题 分区3级标题">查看所有权限</h3>
    <p class="分区普通文本">
      运行<span class="代码">show privileges</span
      >命令可以查看一共有多少种权限：
    </p>
    <pre>
      <code class="lang-sql">
        show privileges;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/显示所有可用权限.png"
        alt="显示所有可用权限"
      />
    </figure>
    <p class="分区普通文本">
      一共有 69 种权限，权限名称显示在<span class="行内代码">Privilege</span
      >列。创建账户时，需要根据账户用途，来分配具体的可用权限。
    </p>

    <h3 class="分区标题 分区3级标题">查看账户权限</h3>
    <p class="分区普通文本">
      运行<span class="代码">show grants</span>命令可以查看账户的权限，<span
        class="行内代码"
        >grants</span
      >是<span class="行内专业名词">授予</span>的意思：
    </p>
    <pre>
      <code class="lang-sql">
        # show grants for 账户;
        show grants for suyang@localhost;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/显示用户权限.png"
        alt="显示用户权限"
      />
    </figure>
    <p class="分区普通文本">
      <span class="行内代码"
        >suyang<span style="color: #aaa">@</span>localhost</span
      >账户被授予了两种权限：
    </p>
    <ul class="分区列表">
      <li class="分区列表项">
        <span class="代码">Usage</span>：登录权限，<span class="代码">*.*</span
        >表示<span class="行内专业名词">该权限可用于所有数据库的所有数据表</span
        >。拥有此权限只能让该账户登录到数据库，无法执行其它任何操作。<span
          class="行内代码"
          >Usage</span
        >是基础权限，创建账户时会自动分配该权限。
      </li>
      <li class="分区列表项">
        <span class="代码">All Privileges</span>：一切权限。该账户可以对<span
          class="行内代码"
          >test</span
        >数据库的所有数据表执行全部操作。
      </li>
    </ul>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        由于权限中没有<span class="代码">Grant Option</span>，因此<span
          class="行内代码"
          >suyang<span style="color: #aaa">@</span>localhost</span
        >无法向其它用户分配权限。
      </p>
    </section>
    <p class="分区普通文本">
      一般来说，<span class="行内代码">root</span
      >账户拥有最高权限；其它新建的账户都要手动分配权限，用来指定这个账户可以做什么，不可以做什么。
    </p>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        为其它账户分配权限也是一种权限，这个权限的名称是<span class="代码"
          >Grant Option</span
        >：
      </p>
      <figure class="截图容器">
        <img
          src="/Images/Blogs/MySQL/账户与权限/Grant权限.png"
          alt="Grant Option 权限"
        />
      </figure>
      <p class="分区普通文本">
        <span class="行内代码">root</span
        >账户自动具有此权限。其它账户则需要手动授予此权限。
      </p>
    </section>

    <h3 class="分区标题 分区3级标题">授予账户权限</h3>
    <p class="分区普通文本">
      使用<span class="行内代码">grant</span>语句来授予权限：
    </p>
    <pre>
      <code class="lang-sql">
        # grant 权限 on 数据库.数据表 to 账户 [with grant option];
        
        # 授予 tester@locahost 账户 alter、select 权限，用于 test 数据库的 students 数据表
        # 并且可以向其它账户授予权限
        grant alter, select on test.students to tester@localhost with grant option;
        
        # 授予 tester@locahost 账户一切权限，用于所有数据库的所有数据表，但无法向其它用户授予权限
        grant all on *.* to tester@locahost;

        # 在不改变 tester@locahost 账户现有权限的情况下，授予其 Grant Option 权限
        grant usage on *.* to tester@locahost with grant option;
      </code>
    </pre>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        要将权限授予其它账户，必须拥有<span class="代码">Grant Option</span
        >权限，此权限不包含在<span class="代码">All</span>权限内。
      </p>
      <p class="分区普通文本">当前账户仅能将自己拥有的权限授予其它账户。</p>
    </section>

    <h3 class="分区标题 分区3级标题">收回账户权限</h3>
    <p class="分区普通文本">
      使用<span class="行内代码">revoke</span>语句来收回权限：
    </p>
    <pre>
      <code class="lang-sql">
        # revoke 权限 on 数据库.数据表 from 账户;

        # 收回 tester@locahost 账户在 test 数据库的 students 数据表的 alter 权限
        # 同时收回 grant option 权限
        revoke alter, grant option on test.students from tester@localhost;

        # 收回 tester@locahost 账户的一切权限
        revoke all privileges, grant option from tester@localhost;
      </code>
    </pre>
  </article>

  <article class="正文分区">
    <h2 class="分区标题 分区2级标题">角色管理</h2>

    <h3 class="分区标题 分区3级标题">角色是什么</h3>
    <p class="分区普通文本">
      角色是<span class="行内专业名词">权限的集合</span
      >，有了角色，管理权限更加方便。试想一下，你需要向大量账户分配以下权限：
    </p>
    <ul class="分区列表">
      <li class="分区列表项"><span class="行内代码">select</span></li>
      <li class="分区列表项"><span class="行内代码">insert</span></li>
      <li class="分区列表项"><span class="行内代码">alter</span></li>
      <li class="分区列表项"><span class="行内代码">drop</span></li>
      <li class="分区列表项"><span class="行内代码">delete</span></li>
    </ul>
    <p class="分区普通文本">
      正常情况下，每次都要写：<br /><span class="代码"
        >grant select, insert, alter, drop, delete …………</span
      >，<br />非常繁琐，且容易错漏。<span class="行内专业名词">角色</span
      >的思维模式：将这些权限打包，起个名字<span class="附加说明">角色</span
      >，授权语句变为：<br /><span class="代码">grant 角色 …………</span
      >，<br />语句清晰、简洁、易管理。如果想要从所有授予该角色的账户中收回某个权限，不需要操作账户，只需要从角色中删除该权限即可，一次操作，全体账户生效。
    </p>

    <h3 class="分区标题 分区3级标题">创建角色</h3>
    <p class="分区普通文本">
      使用<span class="代码">create role</span>语句创建角色：
    </p>
    <pre>
      <code class="lang-sql">
        # create role 角色;
        create role role_hacker;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/查询账户与角色.png"
        alt="查询账户与角色"
      />
    </figure>
    <section class="提醒">
      <h3 class="提醒标题">提醒</h3>
      <p class="分区普通文本">
        角色名也分为<span class="行内专业名词">用户部分</span>和<span
          class="行内专业名词"
          >主机部分</span
        >，比如：<span class="代码"
          >'role_hacker'<span style="color: #5c8">@</span>'localhost'</span
        >；如果忽略主机部分，则角色名默认为<span class="代码"
          >'role_hacker'<span style="color: #5c8">@</span>'%'</span
        >。但是，这里的<span class="代码">%</span>和账户不同；账户的<span
          class="代码"
          >%</span
        >代表任意主机，而角色的<span class="代码">%</span>只是一个字符串而已。
      </p>
      <p class="分区普通文本">
        账户和角色都保存在<span class="代码">mysql.user</span
        >数据表中。为了更好地区分究竟是账户还是角色，为角色起名时最好加入固定的前缀，比如<span
          class="行内代码"
          >role_</span
        >。
      </p>
    </section>

    <h3 class="分区标题 分区3级标题">授予角色权限</h3>
    <p class="分区普通文本">
      授予角色权限和授予账户权限的语法类似，只不过角色名称不需要指定主机名：
    </p>
    <pre>
      <code class="lang-sql">
        # grant 权限 on 数据库.数据表 to 角色;
        grant select, insert, update, delete on test.* to role_hacker;
      </code>
    </pre>

    <h3 class="分区标题 分区3级标题">查看角色权限</h3>
    <pre>
      <code class="lang-sql">
        # show grants for 角色;
        show grants for role_hacker;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/查看角色权限.png"
        alt="查看角色权限"
      />
    </figure>

    <h3 class="分区标题 分区3级标题">向账户授予角色</h3>
    <pre>
      <code class="lang-sql">
        # grant 角色 to 账号;
        grant role_hacker to tester@localhost;
      </code>
    </pre>
    <p class="分区普通文本">
      实质就是将<span class="行内代码">role_hacker</span
      >这个角色拥有的权限全部授予<span class="行内代码"
        >tester<span style="color: #aaa">@</span>localhost</span
      >账号。因为用角色代替了多个权限，因此语法简洁了许多。
    </p>

    <h3 class="分区标题 分区3级标题">查看账户授予的角色</h3>
    <pre>
      <code class="lang-sql">
        # show grants for 账号;
        show grants for tester@localhost;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/查看授予账户的角色.png"
        alt="查看授予账户的角色"
      />
    </figure>
    <p class="分区普通文本">
      第 2 行显示了授予<span class="代码"
        >'tester'<span style="color: #5c8">@</span>'localhost'</span
      >账户的角色有<span class="代码"
        >'role_hacker'<span style="color: #5c8">@</span>'%'</span
      >。但是，这只能查看角色，无法查看角色拥有的具体权限，要查看具体权限，应使用语句：
    </p>
    <pre>
      <code class="lang-sql">
        # show grants for 账号 using 角色;
        show grants for tester@localhost using role_hacker;
      </code>
    </pre>
    <figure class="截图容器">
      <img
        src="/Images/Blogs/MySQL/账户与权限/查看授予账户的角色的具体权限.png"
        alt="查看授予账户的角色的具体权限"
      />
    </figure>
    <p class="分区普通文本">第 2 行显示了角色拥有的具体权限。</p>

    <h3 class="分区标题 分区3级标题">
      收回角色权限<span class="次要">或</span>收回角色
    </h3>
    <ul class="分区列表">
      <li class="分区列表项">
        收回角色权限
        <p class="分区普通文本">收回角色权限，和收回账户权限语法类似：</p>
        <pre>
          <code class="lang-sql">
            # revoke 权限 on 数据库.数据表 from 角色；
            revoke delete on test.* from role_hacker;
          </code>
        </pre>
        <figure class="截图容器">
          <img
            src="/Images/Blogs/MySQL/账户与权限/收回角色delete权限.png"
            alt="收回角色delete权限"
          />
        </figure>
        <p class="分区普通文本">
          观察第 2 行，<span class="行内代码">delete</span
          >权限已被收回，任何分配了<span class="行内代码">role_hacker</span
          >角色的账户也同时失去此权限。
        </p>
      </li>
      <li class="分区列表项">
        收回角色
        <p class="分区普通文本">
          从账户收回角色，相当于从账户收回该角色拥有的所有权限，因此依然使用<span
            class="行内代码"
            >revoke</span
          >语句：
        </p>
        <pre>
          <code class="lang-sql">
            # revoke 角色 from 账户;
            revoke role_hacker from tester@localhost;
          </code>
        </pre>
        <figure class="截图容器">
          <img
            src="/Images/Blogs/MySQL/账户与权限/收回角色.png"
            alt="收回角色"
          />
        </figure>
        <p class="分区普通文本">
          <span class="代码"
            >'tester'<span style="color: #5c8">@</span>'localhost'</span
          >账户中与<span class="行内代码">role_hacker</span
          >角色相关的所有权限已被收回。
        </p>
      </li>
    </ul>

    <h3 class="分区标题 分区3级标题">删除角色</h3>
    <p class="分区普通文本">
      删除角色和删除账户的语法类似，使用<span class="代码">drop role</span
      >语句：
    </p>
    <pre>
      <code class="lang-sql">
        # drop role 角色;
        drop role role_hacker;
      </code>
    </pre>
    <p class="分区普通文本">
      删除角色，会同时从所有分配了该角色的账户中收回该角色。
    </p>
  </article>
</div>
