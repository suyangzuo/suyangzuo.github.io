var LeaferUI=function(t){"use strict";var e,i;t.PathNodeHandleType=void 0,(e=t.PathNodeHandleType||(t.PathNodeHandleType={}))[e.none=1]="none",e[e.free=2]="free",e[e.mirrorAngle=3]="mirrorAngle",e[e.mirror=4]="mirror",t.Answer=void 0,(i=t.Answer||(t.Answer={}))[i.No=0]="No",i[i.Yes=1]="Yes",i[i.NoAndSkip=2]="NoAndSkip",i[i.YesAndSkip=3]="YesAndSkip";const s={};function r(t){return void 0===t}function n(t){return null==t}function o(t){return"string"==typeof t}const{isFinite:a}=Number;function h(t){return"number"==typeof t}const l=/^-?\d+(?:\.\d+)?$/;const{isArray:d}=Array;function c(t){return t&&"object"==typeof t}function u(t){return"{}"===JSON.stringify(t)}const _={default:(t,e)=>(p(e,t),p(t,e),t),assign(t,e,i){let s;Object.keys(e).forEach(r=>{var n,o;if(s=e[r],(null==s?void 0:s.constructor)===Object&&(null===(n=t[r])||void 0===n?void 0:n.constructor)===Object)return p(t[r],e[r],i&&i[r]);i&&r in i?(null===(o=i[r])||void 0===o?void 0:o.constructor)===Object&&p(t[r]={},e[r],i[r]):t[r]=e[r]})},copyAttrs:(t,e,i)=>(i.forEach(i=>{r(e[i])||(t[i]=e[i])}),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let i=0,s=t.length;i<s;i++)e[t[i]]=!0;return e},stintSet(t,e,i){i||(i=void 0),t[e]!==i&&(t[e]=i)}},{assign:p}=_;class g{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&6===t.length&&1===t[0]}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(!r(e))return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let i;for(let s in this)"_"!==s[0]&&(i=e?e[s]:void 0,t[s]=r(i)?this[s]:i);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(!r(e))return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&!r(this.__input[t])&&(this.__input[t]=void 0)}__getInputData(t,e){const i={};if(t)if(d(t))for(let e of t)i[e]=this.__getInput(e);else for(let e in t)i[e]=this.__getInput(e);else{let t,e,{__input:s}=this;i.tag=this.__leaf.tag;for(let n in this)if("_"!==n[0]&&(t=this["_"+n],!r(t))){if("path"===n&&!this.__pathInputed)continue;e=s?s[n]:void 0,i[n]=r(e)?t:e}}if(e&&e.matrix){const{a:t,b:e,c:s,d:r,e:n,f:o}=this.__leaf.__localMatrix;i.matrix={a:t,b:e,c:s,d:r,e:n,f:o}}return i}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&(e.isBranch||t.__hasMultiPaint)||e.__hasEraser||t.eraser||t.filter?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}const f={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=y;return e[t]?e[t]++:(e[t]=1,0)}},y=f;let m,v,w;const{max:x}=Math,b=[0,0,0,0],E={zero:[...b],tempFour:b,set:(t,e,i,s,r)=>(void 0===i&&(i=s=r=e),t[0]=e,t[1]=i,t[2]=s,t[3]=r,t),setTemp:(t,e,i,s)=>P(b,t,e,i,s),toTempAB(t,e,i){w=i?h(t)?e:t:[],h(t)?(m=S(t),v=e):h(e)?(m=t,v=S(e)):(m=t,v=e),4!==m.length&&(m=B(m)),4!==v.length&&(v=B(v))},get(t,e){let i;if(!h(t))switch(t.length){case 4:i=r(e)?t:[...t];break;case 2:i=[t[0],t[1],t[0],t[1]];break;case 3:i=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(i||(i=[t,t,t,t]),!r(e))for(let t=0;t<4;t++)i[t]>e&&(i[t]=e);return i},max:(t,e,i)=>h(t)&&h(e)?x(t,e):(T(t,e,i),P(w,x(m[0],v[0]),x(m[1],v[1]),x(m[2],v[2]),x(m[3],v[3]))),add:(t,e,i)=>h(t)&&h(e)?t+e:(T(t,e,i),P(w,m[0]+v[0],m[1]+v[1],m[2]+v[2],m[3]+v[3])),swapAndScale(t,e,i,s){if(h(t))return e===i?t*e:[t*i,t*e];const r=s?t:[],[n,o,a,l]=4===t.length?t:B(t);return P(r,a*i,l*e,n*i,o*e)}},{set:P,get:B,setTemp:S,toTempAB:T}=E,{round:k,pow:R,max:C,floor:L,PI:O}=Math,D={within:(t,e,i)=>(c(e)&&(i=e.max,e=e.min),!r(e)&&t<e&&(t=e),!r(i)&&t>i&&(t=i),t),fourNumber:E.get,formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),D.float(t)),getGapRotation(t,e,i=0){let s=t+i;if(e>1){const t=Math.abs(s%e);(t<1||t>e-1)&&(s=Math.round(s/e)*e)}return s-i},float(t,e){const i=r(e)?1e12:R(10,e);return-0===(t=k(t*i)/i)?0:t},sign:t=>t<0?-1:1,getScaleData(t,e,i,s){if(s||(s={}),e){const t=(h(e)?e:e.width||0)/i.width,r=(h(e)?e:e.height||0)/i.height;s.scaleX=t||r||1,s.scaleY=r||t||1}else t&&D.assignScale(s,t);return s},assignScale(t,e){h(e)?t.scaleX=t.scaleY=e:(t.scaleX=e.x,t.scaleY=e.y)},getFloorScale:(t,e=1)=>C(L(t),e)/t,randInt:I,randColor:t=>`rgba(${I(255)},${I(255)},${I(255)},${t||1})`};function I(t){return Math.round(Math.random()*t)}const A=O/180,M=2*O,W=O/2;function F(){return{x:0,y:0}}function U(){return{x:0,y:0,width:0,height:0}}function z(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:N,cos:Y,acos:X,sqrt:H}=Math,{float:j}=D,V={};function G(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const K={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:G(),tempMatrix:{},set(t,e=1,i=0,s=0,r=1,n=0,o=0){t.a=e,t.b=i,t.c=s,t.d=r,t.e=n,t.f=o},get:z,getWorld:G,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,i){t.e+=e,t.f+=i},translateInner(t,e,i,s){t.e+=t.a*e+t.c*i,t.f+=t.b*e+t.d*i,s&&(t.e-=e,t.f-=i)},scale(t,e,i=e){t.a*=e,t.b*=e,t.c*=i,t.d*=i},pixelScale(t,e,i){i||(i=t),i.a=t.a*e,i.b=t.b*e,i.c=t.c*e,i.d=t.d*e,i.e=t.e*e,i.f=t.f*e},scaleOfOuter(t,e,i,s){q.toInnerPoint(t,e,V),q.scaleOfInner(t,V,i,s)},scaleOfInner(t,e,i,s=i){q.translateInner(t,e.x,e.y),q.scale(t,i,s),q.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:i,b:s,c:r,d:n}=t,o=Y(e*=A),a=N(e);t.a=i*o-s*a,t.b=i*a+s*o,t.c=r*o-n*a,t.d=r*a+n*o},rotateOfOuter(t,e,i){q.toInnerPoint(t,e,V),q.rotateOfInner(t,V,i)},rotateOfInner(t,e,i){q.translateInner(t,e.x,e.y),q.rotate(t,i),q.translateInner(t,-e.x,-e.y)},skew(t,e,i){const{a:s,b:r,c:n,d:o}=t;i&&(i*=A,t.a=s+n*i,t.b=r+o*i),e&&(e*=A,t.c=n+s*e,t.d=o+r*e)},skewOfOuter(t,e,i,s){q.toInnerPoint(t,e,V),q.skewOfInner(t,V,i,s)},skewOfInner(t,e,i,s=0){q.translateInner(t,e.x,e.y),q.skew(t,i,s),q.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:i,b:s,c:r,d:n,e:o,f:a}=t;t.a=e.a*i+e.b*r,t.b=e.a*s+e.b*n,t.c=e.c*i+e.d*r,t.d=e.c*s+e.d*n,t.e=e.e*i+e.f*r+o,t.f=e.e*s+e.f*n+a},multiplyParent(t,e,i,s,n){const{e:o,f:a}=t;if(i||(i=t),r(s)&&(s=1!==t.a||t.b||t.c||1!==t.d),s){const{a:s,b:r,c:o,d:a}=t;i.a=s*e.a+r*e.c,i.b=s*e.b+r*e.d,i.c=o*e.a+a*e.c,i.d=o*e.b+a*e.d,n&&(i.scaleX=e.scaleX*n.scaleX,i.scaleY=e.scaleY*n.scaleY)}else i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,n&&(i.scaleX=e.scaleX,i.scaleY=e.scaleY);i.e=o*e.a+a*e.c+e.e,i.f=o*e.b+a*e.d+e.f},divide(t,e){q.multiply(t,q.tempInvert(e))},divideParent(t,e){q.multiplyParent(t,q.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=q;return q.copy(e,t),q.invert(e),e},invert(t){const{a:e,b:i,c:s,d:r,e:n,f:o}=t;if(i||s){const a=1/(e*r-i*s);t.a=r*a,t.b=-i*a,t.c=-s*a,t.d=e*a,t.e=-(n*r-o*s)*a,t.f=-(o*e-n*i)*a}else if(1===e&&1===r)t.e=-n,t.f=-o;else{const i=1/(e*r);t.a=r*i,t.d=e*i,t.e=-n*r*i,t.f=-o*e*i}},toOuterPoint(t,e,i,s){const{x:r,y:n}=e;i||(i=e),i.x=r*t.a+n*t.c,i.y=r*t.b+n*t.d,s||(i.x+=t.e,i.y+=t.f)},toInnerPoint(t,e,i,s){const{a:r,b:n,c:o,d:a}=t,h=1/(r*a-n*o),{x:l,y:d}=e;if(i||(i=e),i.x=(l*a-d*o)*h,i.y=(d*r-l*n)*h,!s){const{e:e,f:s}=t;i.x-=(e*a-s*o)*h,i.y-=(s*r-e*n)*h}},setLayout(t,e,i,s,n){const{x:o,y:a,scaleX:h,scaleY:l}=e;if(r(n)&&(n=e.rotation||e.skewX||e.skewY),n){const{rotation:i,skewX:s,skewY:r}=e,n=i*A,o=Y(n),a=N(n);if(s||r){const e=s*A,i=r*A;t.a=(o+i*-a)*h,t.b=(a+i*o)*h,t.c=(e*o-a)*l,t.d=(o+e*a)*l}else t.a=o*h,t.b=a*h,t.c=-a*l,t.d=o*l}else t.a=h,t.b=0,t.c=0,t.d=l;t.e=o,t.f=a,(i=i||s)&&q.translateInner(t,-i.x,-i.y,!s)},getLayout(t,e,i,s){const{a:r,b:n,c:o,d:a,e:h,f:l}=t;let d,c,u,_,p,g=h,f=l;if(n||o){const t=r*a-n*o;if(o&&!s){d=H(r*r+n*n),c=t/d;const e=r/d;u=n>0?X(e):-X(e)}else{c=H(o*o+a*a),d=t/c;const e=o/c;u=W-(a>0?X(-e):-X(e))}const e=j(Y(u)),i=N(u);d=j(d),c=j(c),_=e?j((o/c+i)/e/A,9):0,p=e?j((n/d-i)/e/A,9):0,u=j(u/A)}else d=r,c=a,u=_=p=0;return(e=i||e)&&(g+=e.x*r+e.y*o,f+=e.x*n+e.y*a,i||(g-=e.x,f-=e.y)),{x:g,y:f,scaleX:d,scaleY:c,rotation:u,skewX:_,skewY:p}},withScale(t,e,i=e){const s=t;if(!e||!i){const{a:s,b:r,c:n,d:o}=t;r||n?i=(s*o-r*n)/(e=H(s*s+r*r)):(e=s,i=o)}return s.scaleX=e,s.scaleY=i,s},reset(t){q.set(t)}},q=K,{float:Z}=D,{toInnerPoint:$,toOuterPoint:Q}=K,{sin:J,cos:tt,abs:et,sqrt:it,atan2:st,min:rt,round:nt}=Math,ot={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,i=0){t.x=e,t.y=i},setRadius(t,e,i){t.radiusX=e,t.radiusY=r(i)?e:i},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,i){t.x=e,t.y=i},round(t,e){t.x=e?nt(t.x-.5)+.5:nt(t.x),t.y=e?nt(t.y-.5)+.5:nt(t.y)},move(t,e,i){c(e)?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=i)},scale(t,e,i=e){t.x&&(t.x*=e),t.y&&(t.y*=i)},scaleOf(t,e,i,s=i){t.x+=(t.x-e.x)*(i-1),t.y+=(t.y-e.y)*(s-1)},rotate(t,e,i){i||(i=at.defaultPoint);const s=tt(e*=A),r=J(e),n=t.x-i.x,o=t.y-i.y;t.x=i.x+n*s-o*r,t.y=i.y+n*r+o*s},tempToInnerOf(t,e){const{tempPoint:i}=at;return lt(i,t),$(e,i,i),i},tempToOuterOf(t,e){const{tempPoint:i}=at;return lt(i,t),Q(e,i,i),i},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:i}=at;return lt(i,t),at.toInnerRadiusPointOf(t,e,i),i},copyRadiusPoint:(t,e,i,s)=>(lt(t,e),dt(t,i,s),t),toInnerRadiusPointOf(t,e,i){i||(i=t),$(e,t,i),i.radiusX=Math.abs(t.radiusX/e.scaleX),i.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,i){$(e,t,i)},toOuterOf(t,e,i){Q(e,t,i)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>ht(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,i,s){const r=et(i-t),n=et(s-e);return it(r*r+n*n)},getMinDistanceFrom:(t,e,i,s,r,n)=>rt(ht(t,e,i,s),ht(i,s,r,n)),getAngle:(t,e)=>ct(t,e)/A,getRotation:(t,e,i,s)=>(s||(s=e),at.getRadianFrom(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)/A),getRadianFrom(t,e,i,s,n,o,a,h){r(a)&&(a=i,h=s);const l=t-i,d=e-s,c=n-a,u=o-h;return Math.atan2(l*u-d*c,l*c+d*u)},getAtan2:(t,e)=>st(e.y-t.y,e.x-t.x),getDistancePoint(t,e,i,s,r){const n=ct(t,e);return r&&(t=e),s||(e={}),e.x=t.x+tt(n)*i,e.y=t.y+J(n)*i,e},toNumberPoints(t){let e=t;return c(t[0])&&(e=[],t.forEach(t=>e.push(t.x,t.y))),e},isSame:(t,e)=>Z(t.x)===Z(e.x)&&Z(t.y)===Z(e.y),reset(t){at.reset(t)}},at=ot,{getDistanceFrom:ht,copy:lt,setRadius:dt,getAtan2:ct}=at;class ut{constructor(t,e){this.set(t,e)}set(t,e){return c(t)?ot.copy(this,t):ot.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new ut(this)}move(t,e){return ot.move(this,t,e),this}scale(t,e){return ot.scale(this,t,e),this}scaleOf(t,e,i){return ot.scaleOf(this,t,e,i),this}rotate(t,e){return ot.rotate(this,t,e),this}rotateOf(t,e){return ot.rotate(this,e,t),this}getRotation(t,e,i){return ot.getRotation(this,t,e,i)}toInnerOf(t,e){return ot.toInnerOf(this,t,e),this}toOuterOf(t,e){return ot.toOuterOf(this,t,e),this}getCenter(t){return new ut(ot.getCenter(this,t))}getDistance(t){return ot.getDistance(this,t)}getDistancePoint(t,e,i,s){return new ut(ot.getDistancePoint(this,t,e,i,s))}getAngle(t){return ot.getAngle(this,t)}getAtan2(t){return ot.getAtan2(this,t)}isSame(t){return ot.isSame(this,t)}reset(){return ot.reset(this),this}}const _t=new ut;class pt{constructor(t,e,i,s,r,n){this.set(t,e,i,s,r,n)}set(t,e,i,s,r,n){return c(t)?K.copy(this,t):K.set(this,t,e,i,s,r,n),this}setWith(t){return K.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:i,d:s,e:r,f:n}=this;return{a:t,b:e,c:i,d:s,e:r,f:n}}clone(){return new pt(this)}translate(t,e){return K.translate(this,t,e),this}translateInner(t,e){return K.translateInner(this,t,e),this}scale(t,e){return K.scale(this,t,e),this}scaleWith(t,e){return K.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}pixelScale(t){return K.pixelScale(this,t),this}scaleOfOuter(t,e,i){return K.scaleOfOuter(this,t,e,i),this}scaleOfInner(t,e,i){return K.scaleOfInner(this,t,e,i),this}rotate(t){return K.rotate(this,t),this}rotateOfOuter(t,e){return K.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return K.rotateOfInner(this,t,e),this}skew(t,e){return K.skew(this,t,e),this}skewOfOuter(t,e,i){return K.skewOfOuter(this,t,e,i),this}skewOfInner(t,e,i){return K.skewOfInner(this,t,e,i),this}multiply(t){return K.multiply(this,t),this}multiplyParent(t){return K.multiplyParent(this,t),this}divide(t){return K.divide(this,t),this}divideParent(t){return K.divideParent(this,t),this}invert(){return K.invert(this),this}invertWith(){return K.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,i){K.toOuterPoint(this,t,e,i)}toInnerPoint(t,e,i){K.toInnerPoint(this,t,e,i)}setLayout(t,e,i){return K.setLayout(this,t,e,i),this}getLayout(t,e,i){return K.getLayout(this,t,e,i)}withScale(t,e){return K.withScale(this,t,e)}reset(){K.reset(this)}}const gt=new pt,ft={tempPointBounds:{},setPoint(t,e,i){t.minX=t.maxX=e,t.minY=t.maxY=i},addPoint(t,e,i){t.minX=e<t.minX?e:t.minX,t.minY=i<t.minY?i:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=i>t.maxY?i:t.maxY},addBounds(t,e,i,s,r){yt(t,e,i),yt(t,e+s,i+r)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:yt}=ft;var mt,vt;t.Direction4=void 0,(mt=t.Direction4||(t.Direction4={}))[mt.top=0]="top",mt[mt.right=1]="right",mt[mt.bottom=2]="bottom",mt[mt.left=3]="left",t.Direction9=void 0,(vt=t.Direction9||(t.Direction9={}))[vt.topLeft=0]="topLeft",vt[vt.top=1]="top",vt[vt.topRight=2]="topRight",vt[vt.right=3]="right",vt[vt.bottomRight=4]="bottomRight",vt[vt.bottom=5]="bottom",vt[vt.bottomLeft=6]="bottomLeft",vt[vt.left=7]="left",vt[vt.center=8]="center",vt[vt["top-left"]=0]="top-left",vt[vt["top-right"]=2]="top-right",vt[vt["bottom-right"]=4]="bottom-right",vt[vt["bottom-left"]=6]="bottom-left";const wt=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];wt.forEach(t=>t.type="percent");const xt={directionData:wt,tempPoint:{},get:bt,toPoint(t,e,i,s,r,n){const o=bt(t);i.x=o.x,i.y=o.y,"percent"===o.type&&(i.x*=e.width,i.y*=e.height,r&&(n||(i.x-=r.x,i.y-=r.y),o.x&&(i.x-=1===o.x?r.width:.5===o.x?o.x*r.width:0),o.y&&(i.y-=1===o.y?r.height:.5===o.y?o.y*r.height:0))),s||(i.x+=e.x,i.y+=e.y)},getPoint:(t,e,i)=>(i||(i={}),xt.toPoint(t,e,i,!0),i)};function bt(e){return o(e)?wt[t.Direction9[e]]:e}const{toPoint:Et}=xt,Pt={toPoint(t,e,i,s,r,n){Et(t,i,s,r,e,n)}},{tempPointBounds:Bt,setPoint:St,addPoint:Tt,toBounds:kt}=ft,{toOuterPoint:Rt}=K,{float:Ct,fourNumber:Lt}=D,{floor:Ot,ceil:Dt}=Math;let It,At,Mt,Wt;const Ft={},Ut={},zt={},Nt={tempBounds:zt,set(t,e=0,i=0,s=0,r=0){t.x=e,t.y=i,t.width=s,t.height=r},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,i,s,r){const{x:n,y:o,width:a,height:h}=e;if(d(i)){const e=Lt(i);s?Yt.set(t,n+e[3],o+e[0],a-e[1]-e[3],h-e[2]-e[0]):Yt.set(t,n-e[3],o-e[0],a+e[1]+e[3],h+e[2]+e[0])}else s&&(i=-i),Yt.set(t,n-i,o-i,a+2*i,h+2*i);r&&("width"===r?(t.y=o,t.height=h):(t.x=n,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,i){t.x+=e,t.y+=i},scroll(t,e){t.x+=e.scrollX,t.y+=e.scrollY},getByMove:(t,e,i)=>(t=Object.assign({},t),Yt.move(t,e,i),t),toOffsetOutBounds(t,e,i){e?Ht(e,t):e=t,i||(i=t),e.offsetX=Yt.maxX(i),e.offsetY=Yt.maxY(i),Yt.move(e,-e.offsetX,-e.offsetY)},scale(t,e,i=e,s){s||ot.scale(t,e,i),t.width*=e,t.height*=i},scaleOf(t,e,i,s=i){ot.scaleOf(t,e,i,s),t.width*=i,t.height*=s},tempToOuterOf:(t,e)=>(Yt.copy(zt,t),Yt.toOuterOf(zt,e),zt),getOuterOf:(t,e)=>(t=Object.assign({},t),Yt.toOuterOf(t,e),t),toOuterOf(t,e,i){if(i||(i=t),0===e.b&&0===e.c){const{a:s,d:r,e:n,f:o}=e;s>0?(i.width=t.width*s,i.x=n+t.x*s):(i.width=t.width*-s,i.x=n+t.x*s-i.width),r>0?(i.height=t.height*r,i.y=o+t.y*r):(i.height=t.height*-r,i.y=o+t.y*r-i.height)}else Ft.x=t.x,Ft.y=t.y,Rt(e,Ft,Ut),St(Bt,Ut.x,Ut.y),Ft.x=t.x+t.width,Rt(e,Ft,Ut),Tt(Bt,Ut.x,Ut.y),Ft.y=t.y+t.height,Rt(e,Ft,Ut),Tt(Bt,Ut.x,Ut.y),Ft.x=t.x,Rt(e,Ft,Ut),Tt(Bt,Ut.x,Ut.y),kt(Bt,i)},toInnerOf(t,e,i){i||(i=t),Yt.move(i,-e.e,-e.f),Yt.scale(i,1/e.a,1/e.d)},getFitMatrix(t,e,i=1){const s=Math.min(i,Yt.getFitScale(t,e));return new pt(s,0,0,s,-e.x*s,-e.y*s)},getFitScale(t,e,i){const s=t.width/e.width,r=t.height/e.height;return i?Math.max(s,r):Math.min(s,r)},put(t,e,i="center",s=1,r=!0,n){n||(n=e),o(s)&&(s=Yt.getFitScale(t,e,"cover"===s)),zt.width=r?e.width*=s:e.width*s,zt.height=r?e.height*=s:e.height*s,Pt.toPoint(i,zt,t,n,!0,!0)},getSpread(t,e,i){const s={};return Yt.copyAndSpread(s,t,e,!1,i),s},spread(t,e,i){Yt.copyAndSpread(t,t,e,!1,i)},shrink(t,e,i){Yt.copyAndSpread(t,t,e,!0,i)},ceil(t){const{x:e,y:i}=t;t.x=Ot(t.x),t.y=Ot(t.y),t.width=e>t.x?Dt(t.width+e-t.x):Dt(t.width),t.height=i>t.y?Dt(t.height+i-t.y):Dt(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=Ct(t.x,e),t.y=Ct(t.y,e),t.width=Ct(t.width,e),t.height=Ct(t.height,e)},add(t,e,i){It=t.x+t.width,At=t.y+t.height,Mt=e.x,Wt=e.y,i||(Mt+=e.width,Wt+=e.height),It=It>Mt?It:Mt,At=At>Wt?At:Wt,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=It-t.x,t.height=At-t.y},addList(t,e){Yt.setListWithFn(t,e,void 0,!0)},setList(t,e,i=!1){Yt.setListWithFn(t,e,void 0,i)},addListWithFn(t,e,i){Yt.setListWithFn(t,e,i,!0)},setListWithFn(t,e,i,s=!1){let r,n=!0;for(let o=0,a=e.length;o<a;o++)r=i?i(e[o],o):e[o],r&&(r.width||r.height)&&(n?(n=!1,s||Ht(t,r)):Xt(t,r));n&&Yt.reset(t)},setPoints(t,e){e.forEach((t,e)=>0===e?St(Bt,t.x,t.y):Tt(Bt,t.x,t.y)),kt(Bt,t)},setPoint(t,e){Yt.set(t,e.x,e.y)},addPoint(t,e){Xt(t,e,!0)},getPoints(t){const{x:e,y:i,width:s,height:r}=t;return[{x:e,y:i},{x:e+s,y:i},{x:e+s,y:i+r},{x:e,y:i+r}]},hitRadiusPoint:(t,e,i)=>(i&&(e=ot.tempToInnerRadiusPointOf(e,i)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,i)=>(i&&(e=ot.tempToInnerOf(e,i)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,i)=>(i&&(e=Yt.tempToOuterOf(e,i)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,i)=>(i&&(e=Yt.tempToOuterOf(e,i)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,i){if(i&&(e=Yt.tempToOuterOf(e,i)),!Yt.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:s,y:r,width:n,height:o}=e;return It=s+n,At=r+o,Mt=t.x+t.width,Wt=t.y+t.height,s=s>t.x?s:t.x,r=r>t.y?r:t.y,It=It<Mt?It:Mt,At=At<Wt?At:Wt,n=It-s,o=At-r,{x:s,y:r,width:n,height:o}},intersect(t,e,i){Yt.copy(t,Yt.getIntersectData(t,e,i))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,hasSize:t=>t.width&&t.height,reset(t){Yt.set(t)}},Yt=Nt,{add:Xt,copy:Ht}=Yt;class jt{get minX(){return Nt.minX(this)}get minY(){return Nt.minY(this)}get maxX(){return Nt.maxX(this)}get maxY(){return Nt.maxY(this)}constructor(t,e,i,s){this.set(t,e,i,s)}set(t,e,i,s){return c(t)?Nt.copy(this,t):Nt.set(this,t,e,i,s),this}get(){const{x:t,y:e,width:i,height:s}=this;return{x:t,y:e,width:i,height:s}}clone(){return new jt(this)}move(t,e){return Nt.move(this,t,e),this}scale(t,e,i){return Nt.scale(this,t,e,i),this}scaleOf(t,e,i){return Nt.scaleOf(this,t,e,i),this}toOuterOf(t,e){return Nt.toOuterOf(this,t,e),this}toInnerOf(t,e){return Nt.toInnerOf(this,t,e),this}getFitMatrix(t,e){return Nt.getFitMatrix(this,t,e)}put(t,e,i){Nt.put(this,t,e,i)}spread(t,e){return Nt.spread(this,t,e),this}shrink(t,e){return Nt.shrink(this,t,e),this}ceil(){return Nt.ceil(this),this}unsign(){return Nt.unsign(this),this}float(t){return Nt.float(this,t),this}add(t){return Nt.add(this,t),this}addList(t){return Nt.setList(this,t,!0),this}setList(t){return Nt.setList(this,t),this}addListWithFn(t,e){return Nt.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return Nt.setListWithFn(this,t,e),this}setPoint(t){return Nt.setPoint(this,t),this}setPoints(t){return Nt.setPoints(this,t),this}addPoint(t){return Nt.addPoint(this,t),this}getPoints(){return Nt.getPoints(this)}hitPoint(t,e){return Nt.hitPoint(this,t,e)}hitRadiusPoint(t,e){return Nt.hitRadiusPoint(this,t,e)}hit(t,e){return Nt.hit(this,t,e)}includes(t,e){return Nt.includes(this,t,e)}intersect(t,e){return Nt.intersect(this,t,e),this}getIntersect(t,e){return new jt(Nt.getIntersectData(this,t,e))}isSame(t){return Nt.isSame(this,t)}isEmpty(){return Nt.isEmpty(this)}reset(){Nt.reset(this)}}const Vt=new jt;class Gt{constructor(t,e,i,s,r,n){c(t)?this.copy(t):this.set(t,e,i,s,r,n)}set(t=0,e=0,i=0,s=0,r=0,n=0){this.top=t,this.right=e,this.bottom=i,this.left=s,this.width=r,this.height=n}copy(t){const{top:e,right:i,bottom:s,left:r,width:n,height:o}=t;this.set(e,i,s,r,n,o)}getBoundsFrom(t){const{top:e,right:i,bottom:s,left:r,width:n,height:o}=this;return new jt(r,e,n||t.width-r-i,o||t.height-e-s)}}const Kt={number:(t,e)=>c(t)?"percent"===t.type?t.value*e:t.value:t},qt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{floor:Zt,max:$t}=Math,Qt={toURL(t,e){let i=encodeURIComponent(t);return"text"===e?i="data:text/plain;charset=utf-8,"+i:"svg"===e&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",isLarge:(t,e,i,s)=>t.width*t.height*(e?e*i:1)>(s||Jt.maxCacheSize),isSuperLarge:(t,e,i)=>Jt.isLarge(t,e,i,Jt.maxPatternSize),getRealURL(t){const{prefix:e,suffix:i}=Jt;return!i||t.startsWith("data:")||t.startsWith("blob:")||(t+=(t.includes("?")?"&":"?")+i),e&&"/"===t[0]&&(t=e+t),t},resize(t,e,i,s,r,n,o,a,h,l){const d=$t(Zt(e+(s||0)),1),c=$t(Zt(i+(r||0)),1);let u,_,p;l&&(p=Kt.number(l.offset,(u="x"===l.type)?e:i))&&(u||(_=!0));const g=Qt.origin.createCanvas(_?2*d:d,u?2*c:c),f=g.getContext("2d");if(a&&(f.globalAlpha=a),f.imageSmoothingEnabled=!1!==o,Jt.canUse(t)){if(n){const s=e/n.width,r=i/n.height;f.setTransform(s,0,0,r,-n.x*s,-n.y*r),f.drawImage(t,0,0,t.width,t.height)}else f.drawImage(t,0,0,e,i);p&&(f.drawImage(g,0,0,d,c,u?p-d:d,u?c:p-c,d,c),f.drawImage(g,0,0,d,c,u?p:d,u?c:p,d,c))}return g},canUse:t=>t&&t.width&&!t.__closed,setPatternTransform(t,e,i){try{e&&t.setTransform&&(t.setTransform(e),e=void 0)}catch(t){}i&&_.stintSet(i,"transform",e)}}},{image:Jt}=Qt,{randColor:te}=D;class ee{constructor(t){this.repeatMap={},this.name=t}static get(t){return new ee(t)}static set filter(t){this.filterList=ie(t)}static set exclude(t){this.excludeList=ie(t)}static drawRepaint(t,e){const i=te();t.fillWorld(e,i.replace("1)",".1)")),t.strokeWorld(e,i)}static drawBounds(t,e,i){const s="hit"===ee.showBounds,r=t.__nowWorld,n=te();s&&(e.setWorld(r),t.__drawHitPath(e),e.fillStyle=n.replace("1)",".2)"),e.fill()),e.resetTransform(),e.setStroke(n,2),s?e.stroke():e.strokeWorld(r,n)}log(...t){if(se.enable){if(se.filterList.length&&se.filterList.every(t=>t!==this.name))return;if(se.excludeList.length&&se.excludeList.some(t=>t===this.name))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){se.enable&&this.warn(...t)}warn(...t){se.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function ie(t){return t?o(t)&&(t=[t]):t=[],t}ee.filterList=[],ee.excludeList=[],ee.showWarn=!0;const se=ee,re=ee.get("RunTime"),ne={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const i=f.create(f.RUNTIME);return oe.currentId=oe.idMap[i]=e?performance.now():Date.now(),oe.currentName=oe.nameMap[i]=t,oe.nameToIdMap[t]=i,i},end(t,e){const i=oe.idMap[t],s=oe.nameMap[t],r=e?(performance.now()-i)/1e3:Date.now()-i;oe.idMap[t]=oe.nameMap[t]=oe.nameToIdMap[s]=void 0,re.log(s,r,"ms")},endOfName(t,e){const i=oe.nameToIdMap[t];r(i)||oe.end(i,e)}},oe=ne,ae=[],he={list:{},add(t,...e){this.list[t]=!0,ae.push(...e)},has(t,e){const i=this.list[t];return!i&&e&&this.need(t),i},need(t){console.error("please install and import plugin: "+(t.includes("-x")?"":"@leafer-in/")+t)}};setTimeout(()=>ae.forEach(t=>he.has(t,!0)));const le={editor:t=>he.need("editor")},de=ee.get("UICreator"),ce={list:{},register(t){const{__tag:e}=t.prototype;ue[e]&&de.repeat(e),ue[e]=t},get(t,e,i,s,n,o){ue[t]||de.error("not register "+t);const a=new ue[t](e);return r(i)||(a.x=i,s&&(a.y=s),n&&(a.width=n),o&&(a.height=o)),a}},{list:ue}=ce,_e=ee.get("EventCreator"),pe={nameList:{},register(t){let e;Object.keys(t).forEach(i=>{e=t[i],o(e)&&(ge[e]&&_e.repeat(e),ge[e]=t)})},changeName(t,e){const i=ge[t];if(i){const s=Object.keys(i).find(e=>i[e]===t);s&&(i[s]=e,ge[e]=i)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new ge[t](...e)},{nameList:ge}=pe;class fe{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let e;const{list:i}=this;for(let s=0,r=i.length;s<r;s++)if(e=i[s],e.recycled&&e.isSameSize(t))return e.recycled=!1,e.manager||(e.manager=this),e;const s=le.canvas(t);return this.add(s),s}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let i=0,s=this.list.length;i<s;i++)t=this.list[i],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach(t=>{t.destroy()}),this.list.length=0}destroy(){this.clear()}}function ye(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}function me(t,e,i,s){return new(i||(i=Promise))(function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}h((s=s.apply(t,e||[])).next())})}function ve(t){return(e,i)=>{t||(t=i);const s={get(){return this.context[t]},set(e){this.context[t]=e}};"strokeCap"===i&&(s.set=function(e){this.context[t]="none"===e?"butt":e}),Object.defineProperty(e,i,s)}}"function"==typeof SuppressedError&&SuppressedError;const we=[];function xe(){return(t,e)=>{we.push(e)}}const be=[];class Ee{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||be)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;we.forEach(e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(t,e,i,s,r,n){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,i,s,r,n){c(t)?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,i,s,r,n)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,i,s){}strokeRect(t,e,i,s){}clearRect(t,e,i,s){}drawImage(t,e,i,s,r,n,o,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/s*a;s+=e,e=0,n+=t,a-=t}if(i<0){const t=-i/r*h;r+=i,i=0,o+=t,h-=t}this.context.drawImage(t,e,i,s,r,n,o,a,h);break;case 5:this.context.drawImage(t,e,i,s,r);break;case 3:this.context.drawImage(t,e,i)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,i,s,r,n){}quadraticCurveTo(t,e,i,s){}closePath(){}arc(t,e,i,s,r,n){}arcTo(t,e,i,s,r){}ellipse(t,e,i,s,r,n,o,a){}rect(t,e,i,s){}roundRect(t,e,i,s,r){}createConicGradient(t,e,i){}createLinearGradient(t,e,i,s){}createPattern(t,e){}createRadialGradient(t,e,i,s,r,n){}fillText(t,e,i,s){}measureText(t){}strokeText(t,e,i,s){}destroy(){this.context=null}}ye([ve("imageSmoothingEnabled")],Ee.prototype,"smooth",void 0),ye([ve("imageSmoothingQuality")],Ee.prototype,"smoothLevel",void 0),ye([ve("globalAlpha")],Ee.prototype,"opacity",void 0),ye([ve()],Ee.prototype,"fillStyle",void 0),ye([ve()],Ee.prototype,"strokeStyle",void 0),ye([ve("lineWidth")],Ee.prototype,"strokeWidth",void 0),ye([ve("lineCap")],Ee.prototype,"strokeCap",void 0),ye([ve("lineJoin")],Ee.prototype,"strokeJoin",void 0),ye([ve("lineDashOffset")],Ee.prototype,"dashOffset",void 0),ye([ve()],Ee.prototype,"miterLimit",void 0),ye([ve()],Ee.prototype,"shadowBlur",void 0),ye([ve()],Ee.prototype,"shadowColor",void 0),ye([ve()],Ee.prototype,"shadowOffsetX",void 0),ye([ve()],Ee.prototype,"shadowOffsetY",void 0),ye([ve()],Ee.prototype,"filter",void 0),ye([ve()],Ee.prototype,"font",void 0),ye([ve()],Ee.prototype,"fontKerning",void 0),ye([ve()],Ee.prototype,"fontStretch",void 0),ye([ve()],Ee.prototype,"fontVariantCaps",void 0),ye([ve()],Ee.prototype,"textAlign",void 0),ye([ve()],Ee.prototype,"textBaseline",void 0),ye([ve()],Ee.prototype,"textRendering",void 0),ye([ve()],Ee.prototype,"wordSpacing",void 0),ye([ve()],Ee.prototype,"letterSpacing",void 0),ye([ve()],Ee.prototype,"direction",void 0),ye([xe()],Ee.prototype,"setTransform",null),ye([xe()],Ee.prototype,"resetTransform",null),ye([xe()],Ee.prototype,"getTransform",null),ye([xe()],Ee.prototype,"save",null),ye([xe()],Ee.prototype,"restore",null),ye([xe()],Ee.prototype,"translate",null),ye([xe()],Ee.prototype,"scale",null),ye([xe()],Ee.prototype,"rotate",null),ye([xe()],Ee.prototype,"fill",null),ye([xe()],Ee.prototype,"stroke",null),ye([xe()],Ee.prototype,"clip",null),ye([xe()],Ee.prototype,"fillRect",null),ye([xe()],Ee.prototype,"strokeRect",null),ye([xe()],Ee.prototype,"clearRect",null),ye([xe()],Ee.prototype,"beginPath",null),ye([xe()],Ee.prototype,"moveTo",null),ye([xe()],Ee.prototype,"lineTo",null),ye([xe()],Ee.prototype,"bezierCurveTo",null),ye([xe()],Ee.prototype,"quadraticCurveTo",null),ye([xe()],Ee.prototype,"closePath",null),ye([xe()],Ee.prototype,"arc",null),ye([xe()],Ee.prototype,"arcTo",null),ye([xe()],Ee.prototype,"ellipse",null),ye([xe()],Ee.prototype,"rect",null),ye([xe()],Ee.prototype,"roundRect",null),ye([xe()],Ee.prototype,"createConicGradient",null),ye([xe()],Ee.prototype,"createLinearGradient",null),ye([xe()],Ee.prototype,"createPattern",null),ye([xe()],Ee.prototype,"createRadialGradient",null),ye([xe()],Ee.prototype,"fillText",null),ye([xe()],Ee.prototype,"measureText",null),ye([xe()],Ee.prototype,"strokeText",null);const{copy:Pe,multiplyParent:Be,pixelScale:Se}=K,{round:Te}=Math,ke=new jt,Re=new jt,Ce={width:1,height:1,pixelRatio:1},Le=["width","height","pixelRatio"];class Oe extends Ee{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap(t){this.config.pixelSnap=t}get allowBackgroundColor(){return this.view&&this.parentView}constructor(t,e){super(),this.size={},this.worldTransform={},t||(t=Ce),this.manager=e,this.innerId=f.create(f.CNAVAS);const{width:i,height:s,pixelRatio:r}=t;this.autoLayout=!i||!s,this.size.pixelRatio=r||Qt.devicePixelRatio,this.config=t,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t,e=!0){if(this.isSameSize(t))return;let i;this.context&&!this.unreal&&e&&this.width&&(i=this.getSameCanvas(),i.copyWorld(this));const s=this.size;_.copyAttrs(s,t,Le),Le.forEach(t=>s[t]||(s[t]=1)),this.bounds=new jt(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&i&&(this.clearWorld(i.bounds),this.copyWorld(i),i.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:i,pixelSnap:s}=this,r=this.worldTransform;e&&Be(t,e,r),Se(t,i,r),s&&!t.ignorePixelSnap&&(t.half&&t.half*i%2?(r.e=Te(r.e-.5)+.5,r.f=Te(r.f-.5)+.5):(r.e=Te(r.e),r.f=Te(r.f))),this.setTransform(r.a,r.b,r.c,r.d,r.e,r.f)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,i,s){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i,s)}setStrokeOptions(t,e){let{strokeCap:i,strokeJoin:s,dashPattern:n,dashOffset:o,miterLimit:a}=t;e&&(e.strokeCap&&(i=e.strokeCap),e.strokeJoin&&(s=e.strokeJoin),r(e.dashPattern)||(n=e.dashPattern),r(e.dashOffset)||(o=e.dashOffset),e.miterLimit&&(a=e.miterLimit)),this.strokeCap=i,this.strokeJoin=s,this.dashPattern=n,this.dashOffset=o,this.miterLimit=a}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,i=1){return!0}setWorldShadow(t,e,i,s){const{pixelRatio:r}=this;this.shadowOffsetX=t*r,this.shadowOffsetY=e*r,this.shadowBlur=i*r,this.shadowColor=s||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,i,s,r){s&&(this.blendMode=s),e?(this.setTempPixelBounds(e,r),i?(this.setTempPixelBounds2(i,r),i=Re):i=ke,this.drawImage(t.view,ke.x,ke.y,ke.width,ke.height,i.x,i.y,i.width,i.height)):this.drawImage(t.view,0,0),s&&(this.blendMode="source-over")}copyWorldToInner(t,e,i,s,r){e.b||e.c?(this.save(),this.resetTransform(),this.copyWorld(t,e,Nt.tempToOuterOf(i,e),s,r),this.restore()):(s&&(this.blendMode=s),this.setTempPixelBounds(e,r),this.drawImage(t.view,ke.x,ke.y,ke.width,ke.height,i.x,i.y,i.width,i.height),s&&(this.blendMode="source-over"))}copyWorldByReset(t,e,i,s,r,n){this.resetTransform(),this.copyWorld(t,e,i,s,n),r||this.useWorldTransform()}useGrayscaleAlpha(t){let e,i;this.setTempPixelBounds(t,!0,!0);const{context:s}=this,r=s.getImageData(ke.x,ke.y,ke.width,ke.height),{data:n}=r;for(let t=0,s=n.length;t<s;t+=4)i=.299*n[t]+.587*n[t+1]+.114*n[t+2],(e=n[t+3])&&(n[t+3]=255===e?i:e*(i/255));s.putImageData(r,ke.x,ke.y)}useMask(t,e,i){this.copyWorld(t,e,i,"destination-in")}useEraser(t,e,i){this.copyWorld(t,e,i,"destination-out")}fillWorld(t,e,i,s){i&&(this.blendMode=i),this.fillStyle=e,this.setTempPixelBounds(t,s),this.fillRect(ke.x,ke.y,ke.width,ke.height),i&&(this.blendMode="source-over")}strokeWorld(t,e,i,s){i&&(this.blendMode=i),this.strokeStyle=e,this.setTempPixelBounds(t,s),this.strokeRect(ke.x,ke.y,ke.width,ke.height),i&&(this.blendMode="source-over")}clipWorld(t,e=!0){this.beginPath(),this.setTempPixelBounds(t,e),this.rect(ke.x,ke.y,ke.width,ke.height),this.clip()}clipUI(t){t.windingRule?this.clip(t.windingRule):this.clip()}clearWorld(t,e=!0){this.setTempPixelBounds(t,e),this.clearRect(ke.x,ke.y,ke.width,ke.height)}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}setTempPixelBounds(t,e,i){this.copyToPixelBounds(ke,t,e,i)}setTempPixelBounds2(t,e,i){this.copyToPixelBounds(Re,t,e,i)}copyToPixelBounds(t,e,i,s){t.set(e),s&&t.intersect(this.bounds),t.scale(this.pixelRatio),i&&t.ceil()}isSameSize(t){return this.width===t.width&&this.height===t.height&&(!t.pixelRatio||this.pixelRatio===t.pixelRatio)}getSameCanvas(t,e){const{size:i,pixelSnap:s}=this,r=this.manager?this.manager.get(i):le.canvas(Object.assign({},i));return r.save(),t&&(Pe(r.worldTransform,this.worldTransform),r.useWorldTransform()),e&&(r.smooth=this.smooth),r.pixelSnap!==s&&(r.pixelSnap=s),r}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const De={creator:{},parse(t,e){},convertToCanvasData(t,e){}},Ie={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Ae=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Ie),Me={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},We={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Fe=Object.assign(Object.assign({},We),Ie),Ue=Ae,ze={};for(let t in Ue)ze[Ue[t]]=t;const Ne={};for(let t in Ue)Ne[Ue[t]]=Me[t];const Ye={drawRoundRect(t,e,i,s,r,n){const o=D.fourNumber(n,Math.min(s/2,r/2)),a=e+s,h=i+r;o[0]?t.moveTo(e+o[0],i):t.moveTo(e,i),o[1]?t.arcTo(a,i,a,h,o[1]):t.lineTo(a,i),o[2]?t.arcTo(a,h,e,h,o[2]):t.lineTo(a,h),o[3]?t.arcTo(e,h,e,i,o[3]):t.lineTo(e,h),o[0]?t.arcTo(e,i,a,i,o[0]):t.lineTo(e,i)}},{sin:Xe,cos:He,hypot:je,atan2:Ve,ceil:Ge,abs:Ke,PI:qe,sqrt:Ze,pow:$e}=Math,{setPoint:Qe,addPoint:Je}=ft,{set:ti,toNumberPoints:ei}=ot,{M:ii,L:si,C:ri,Q:ni,Z:oi}=Ae,ai={},hi={points(t,e,i,s){let r=ei(e);if(t.push(ii,r[0],r[1]),i&&r.length>5){let e,n,o,a,h,l,d,c,u,_,p,g,f,y,m,v=r.length;const w=!0===i?.5:i;s&&(r=[r[v-2],r[v-1],...r,r[0],r[1],r[2],r[3]],v=r.length);for(let i=2;i<v-2;i+=2)e=r[i-2],n=r[i-1],o=r[i],a=r[i+1],h=r[i+2],l=r[i+3],p=o-e,g=a-n,f=Ze($e(p,2)+$e(g,2)),y=Ze($e(h-o,2)+$e(l-a,2)),(f||y)&&(m=f+y,f=w*f/m,y=w*y/m,h-=e,l-=n,d=o-f*h,c=a-f*l,2===i?s||t.push(ni,d,c,o,a):(p||g)&&t.push(ri,u,_,d,c,o,a),u=o+y*h,_=a+y*l);s||t.push(ni,u,_,r[v-2],r[v-1])}else for(let e=2,i=r.length;e<i;e+=2)t.push(si,r[e],r[e+1]);s&&t.push(oi)},rect(t,e,i,s,r){De.creator.path=t,De.creator.moveTo(e,i).lineTo(e+s,i).lineTo(e+s,i+r).lineTo(e,i+r).lineTo(e,i)},roundRect(t,e,i,s,r,n){De.creator.path=[],Ye.drawRoundRect(De.creator,e,i,s,r,n),t.push(...De.convertToCanvasData(De.creator.path,!0))},arcTo(t,e,i,s,r,n,o,a,h,l,d){const c=s-e,u=r-i,_=n-s,p=o-r;let g=Ve(u,c),f=Ve(p,_);const y=je(c,u),m=je(_,p);let v=f-g;if(v<0&&(v+=M),y<1e-12||m<1e-12||v<1e-12||Ke(v-qe)<1e-12)return t&&t.push(si,s,r),h&&(Qe(h,e,i),Je(h,s,r)),d&&ti(d,e,i),void(l&&ti(l,s,r));const w=c*p-_*u<0,x=w?-1:1,b=a/He(v/2),E=s+b*He(g+v/2+W*x),P=r+b*Xe(g+v/2+W*x);return g-=W*x,f-=W*x,ci(t,E,P,a,a,0,g/A,f/A,w,h,l,d)},arc:(t,e,i,s,r,n,o,a,h,l)=>ci(t,e,i,s,s,0,r,n,o,a,h,l),ellipse(t,e,i,s,r,n,o,a,h,l,d,c){const u=n*A,_=Xe(u),p=He(u);let g=o*A,f=a*A;g>qe&&(g-=M),f<0&&(f+=M);let y=f-g;y<0?y+=M:y>M&&(y-=M),h&&(y-=M);const m=Ge(Ke(y/W)),v=y/m,w=Xe(v/4),x=8/3*w*w/Xe(v/2);f=g+v;let b,E,P,B,S,T,k,R,C=He(g),L=Xe(g),O=P=p*s*C-_*r*L,D=B=_*s*C+p*r*L,I=e+P,F=i+B;t&&t.push(t.length?si:ii,I,F),l&&Qe(l,I,F),c&&ti(c,I,F);for(let n=0;n<m;n++)b=He(f),E=Xe(f),P=p*s*b-_*r*E,B=_*s*b+p*r*E,S=e+O-x*(p*s*L+_*r*C),T=i+D-x*(_*s*L-p*r*C),k=e+P+x*(p*s*E+_*r*b),R=i+B+x*(_*s*E-p*r*b),t&&t.push(ri,S,T,k,R,e+P,i+B),l&&di(e+O,i+D,S,T,k,R,e+P,i+B,l,!0),O=P,D=B,C=b,L=E,g=f,f+=v;d&&ti(d,e+P,i+B)},quadraticCurveTo(t,e,i,s,r,n,o){t.push(ri,(e+2*s)/3,(i+2*r)/3,(n+2*s)/3,(o+2*r)/3,n,o)},toTwoPointBoundsByQuadraticCurve(t,e,i,s,r,n,o,a){di(t,e,(t+2*i)/3,(e+2*s)/3,(r+2*i)/3,(n+2*s)/3,r,n,o,a)},toTwoPointBounds(t,e,i,s,r,n,o,a,h,l){const d=[];let c,u,_,p,g,f,y,m,v=t,w=i,x=r,b=o;for(let t=0;t<2;++t)if(1==t&&(v=e,w=s,x=n,b=a),c=-3*v+9*w-9*x+3*b,u=6*v-12*w+6*x,_=3*w-3*v,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;p=-_/u,0<p&&p<1&&d.push(p)}else y=u*u-4*_*c,m=Math.sqrt(y),y<0||(g=(-u+m)/(2*c),0<g&&g<1&&d.push(g),f=(-u-m)/(2*c),0<f&&f<1&&d.push(f));l?Je(h,t,e):Qe(h,t,e),Je(h,o,a);for(let l=0,c=d.length;l<c;l++)li(d[l],t,e,i,s,r,n,o,a,ai),Je(h,ai.x,ai.y)},getPointAndSet(t,e,i,s,r,n,o,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,_=3*d*t*t,p=t*t*t;l.x=c*e+u*s+_*n+p*a,l.y=c*i+u*r+_*o+p*h},getPoint(t,e,i,s,r,n,o,a,h){const l={};return li(t,e,i,s,r,n,o,a,h,l),l},getDerivative(t,e,i,s,r){const n=1-t;return 3*n*n*(i-e)+6*n*t*(s-i)+3*t*t*(r-s)}},{getPointAndSet:li,toTwoPointBounds:di,ellipse:ci}=hi,{sin:ui,cos:_i,sqrt:pi,atan2:gi}=Math,{ellipse:fi}=hi,yi={ellipticalArc(t,e,i,s,r,n,o,a,h,l,d){const c=(h-e)/2,u=(l-i)/2,_=n*A,p=ui(_),g=_i(_),f=-g*c-p*u,y=-g*u+p*c,m=s*s,v=r*r,w=y*y,x=f*f,b=m*v-m*w-v*x;let E=0;if(b<0){const t=pi(1-b/(m*v));s*=t,r*=t}else E=(o===a?-1:1)*pi(b/(m*w+v*x));const P=E*s*y/r,B=-E*r*f/s,S=gi((y-B)/r,(f-P)/s),T=gi((-y-B)/r,(-f-P)/s);let k=T-S;0===a&&k>0?k-=M:1===a&&k<0&&(k+=M);const R=e+c+g*P-p*B,C=i+u+p*P+g*B,L=k<0?1:0;d||Qt.ellipseToCurve?fi(t,R,C,s,r,n,S/A,T/A,L):s!==r||n?t.push(Ae.G,R,C,s,r,n,S/A,T/A,L):t.push(Ae.O,R,C,s,S/A,T/A,L)}},mi={toCommand:t=>[],toNode:t=>[]},{M:vi,m:wi,L:xi,l:bi,H:Ei,h:Pi,V:Bi,v:Si,C:Ti,c:ki,S:Ri,s:Ci,Q:Li,q:Oi,T:Di,t:Ii,A:Ai,a:Mi,Z:Wi,z:Fi,N:Ui,D:zi,X:Ni,G:Yi,F:Xi,O:Hi,P:ji,U:Vi}=Ae,{rect:Gi,roundRect:Ki,arcTo:qi,arc:Zi,ellipse:$i,quadraticCurveTo:Qi}=hi,{ellipticalArc:Ji}=yi,ts=ee.get("PathConvert"),es={},is={current:{dot:0},stringify(t,e){let i,s,r,n=0,o=t.length,a="";for(;n<o;){s=t[n],i=Ne[s],a+=s===r?" ":ze[s];for(let s=1;s<i;s++)a+=D.float(t[n+s],e),s===i-1||(a+=" ");r=s,n+=i}return a},parse(t,e){let i,s,r,n="";const o=[],a=e?Fe:We;for(let e=0,h=t.length;e<h;e++)s=t[e],qt[s]?("."===s&&(ss.dot&&(rs(o,n),n=""),ss.dot++),"0"===n&&"."!==s&&(rs(o,n),n=""),n+=s):Ae[s]?(n&&(rs(o,n),n=""),ss.name=Ae[s],ss.length=Me[s],ss.index=0,rs(o,ss.name),!i&&a[s]&&(i=!0)):"-"===s||"+"===s?"e"===r||"E"===r?n+=s:(n&&rs(o,n),n=s):n&&(rs(o,n),n=""),r=s;return n&&rs(o,n),i?is.toCanvasData(o,e):o},toCanvasData(t,e){let i,s,r,n,o,a=0,h=0,l=0,d=0,c=0,u=t.length;const _=[];for(;c<u;){switch(r=t[c],r){case wi:t[c+1]+=a,t[c+2]+=h;case vi:a=t[c+1],h=t[c+2],_.push(vi,a,h),c+=3;break;case Pi:t[c+1]+=a;case Ei:a=t[c+1],_.push(xi,a,h),c+=2;break;case Si:t[c+1]+=h;case Bi:h=t[c+1],_.push(xi,a,h),c+=2;break;case bi:t[c+1]+=a,t[c+2]+=h;case xi:a=t[c+1],h=t[c+2],_.push(xi,a,h),c+=3;break;case Ci:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=Ri;case Ri:o=n===Ti||n===Ri,l=o?2*a-i:t[c+1],d=o?2*h-s:t[c+2],i=t[c+1],s=t[c+2],a=t[c+3],h=t[c+4],_.push(Ti,l,d,i,s,a,h),c+=5;break;case ki:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,r=Ti;case Ti:i=t[c+3],s=t[c+4],a=t[c+5],h=t[c+6],_.push(Ti,t[c+1],t[c+2],i,s,a,h),c+=7;break;case Ii:t[c+1]+=a,t[c+2]+=h,r=Di;case Di:o=n===Li||n===Di,i=o?2*a-i:t[c+1],s=o?2*h-s:t[c+2],e?Qi(_,a,h,i,s,t[c+1],t[c+2]):_.push(Li,i,s,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case Oi:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,r=Li;case Li:i=t[c+1],s=t[c+2],e?Qi(_,a,h,i,s,t[c+3],t[c+4]):_.push(Li,i,s,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case Mi:t[c+6]+=a,t[c+7]+=h;case Ai:Ji(_,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case Fi:case Wi:_.push(Wi),c++;break;case Ui:a=t[c+1],h=t[c+2],e?Gi(_,a,h,t[c+3],t[c+4]):ns(_,t,c,5),c+=5;break;case zi:a=t[c+1],h=t[c+2],e?Ki(_,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):ns(_,t,c,9),c+=9;break;case Ni:a=t[c+1],h=t[c+2],e?Ki(_,a,h,t[c+3],t[c+4],t[c+5]):ns(_,t,c,6),c+=6;break;case Yi:$i(e?_:ns(_,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,es),a=es.x,h=es.y,c+=9;break;case Xi:e?$i(_,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):ns(_,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case Hi:Zi(e?_:ns(_,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,es),a=es.x,h=es.y,c+=7;break;case ji:e?Zi(_,t[c+1],t[c+2],t[c+3],0,360,!1):ns(_,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case Vi:qi(e?_:ns(_,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,es),a=es.x,h=es.y,c+=6;break;default:return ts.error(`command: ${r} [index:${c}]`,t),_}n=r}return _},objectToCanvasData(t){if(t[0].name.length>1)return mi.toCommand(t);{const e=[];return t.forEach(t=>{switch(t.name){case"M":e.push(vi,t.x,t.y);break;case"L":e.push(xi,t.x,t.y);break;case"C":e.push(Ti,t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"Q":e.push(Li,t.x1,t.y1,t.x,t.y);break;case"Z":e.push(Wi)}}),e}},copyData(t,e,i,s){for(let r=i,n=i+s;r<n;r++)t.push(e[r])},pushData(t,e){ss.index===ss.length&&(ss.index=1,t.push(ss.name)),t.push(Number(e)),ss.index++,ss.dot=0}},{current:ss,pushData:rs,copyData:ns}=is,{M:os,L:as,C:hs,Q:ls,Z:ds,N:cs,D:us,X:_s,G:ps,F:gs,O:fs,P:ys,U:ms}=Ae,{getMinDistanceFrom:vs,getRadianFrom:ws}=ot,{tan:xs,min:bs,abs:Es}=Math,Ps={},Bs={beginPath(t){t.length=0},moveTo(t,e,i){t.push(os,e,i)},lineTo(t,e,i){t.push(as,e,i)},bezierCurveTo(t,e,i,s,r,n,o){t.push(hs,e,i,s,r,n,o)},quadraticCurveTo(t,e,i,s,r){t.push(ls,e,i,s,r)},closePath(t){t.push(ds)},rect(t,e,i,s,r){t.push(cs,e,i,s,r)},roundRect(t,e,i,s,r,n){if(h(n))t.push(_s,e,i,s,r,n);else{const o=D.fourNumber(n);o?t.push(us,e,i,s,r,...o):t.push(cs,e,i,s,r)}},ellipse(t,e,i,s,r,o,a,h,l){if(s===r)return Ts(t,e,i,s,a,h,l);n(o)?t.push(gs,e,i,s,r):(n(a)&&(a=0),n(h)&&(h=360),t.push(ps,e,i,s,r,o,a,h,l?1:0))},arc(t,e,i,s,r,o,a){n(r)?t.push(ys,e,i,s):(n(r)&&(r=0),n(o)&&(o=360),t.push(fs,e,i,s,r,o,a?1:0))},arcTo(t,e,i,s,n,o,a,h){if(!r(a)){const t=vs(a,h,e,i,s,n);o=bs(o,bs(t/2,t/2*Es(xs(ws(a,h,e,i,s,n)/2))))}t.push(ms,e,i,s,n,o)},drawEllipse(t,e,i,s,r,o,a,h,l){hi.ellipse(null,e,i,s,r,n(o)?0:o,n(a)?0:a,n(h)?360:h,l,null,null,Ps),t.push(os,Ps.x,Ps.y),Ss(t,e,i,s,r,o,a,h,l)},drawArc(t,e,i,s,r,o,a){hi.arc(null,e,i,s,n(r)?0:r,n(o)?360:o,a,null,null,Ps),t.push(os,Ps.x,Ps.y),Ts(t,e,i,s,r,o,a)},drawPoints(t,e,i,s){hi.points(t,e,i,s)}},{ellipse:Ss,arc:Ts}=Bs,{moveTo:ks,lineTo:Rs,quadraticCurveTo:Cs,bezierCurveTo:Ls,closePath:Os,beginPath:Ds,rect:Is,roundRect:As,ellipse:Ms,arc:Ws,arcTo:Fs,drawEllipse:Us,drawArc:zs,drawPoints:Ns}=Bs;class Ys{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.set(t)}set(t){return this.__path=t?o(t)?De.parse(t):t:[],this}beginPath(){return Ds(this.__path),this.paint(),this}moveTo(t,e){return ks(this.__path,t,e),this.paint(),this}lineTo(t,e){return Rs(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,i,s,r,n){return Ls(this.__path,t,e,i,s,r,n),this.paint(),this}quadraticCurveTo(t,e,i,s){return Cs(this.__path,t,e,i,s),this.paint(),this}closePath(){return Os(this.__path),this.paint(),this}rect(t,e,i,s){return Is(this.__path,t,e,i,s),this.paint(),this}roundRect(t,e,i,s,r){return As(this.__path,t,e,i,s,r),this.paint(),this}ellipse(t,e,i,s,r,n,o,a){return Ms(this.__path,t,e,i,s,r,n,o,a),this.paint(),this}arc(t,e,i,s,r,n){return Ws(this.__path,t,e,i,s,r,n),this.paint(),this}arcTo(t,e,i,s,r){return Fs(this.__path,t,e,i,s,r),this.paint(),this}drawEllipse(t,e,i,s,r,n,o,a){return Us(this.__path,t,e,i,s,r,n,o,a),this.paint(),this}drawArc(t,e,i,s,r,n){return zs(this.__path,t,e,i,s,r,n),this.paint(),this}drawPoints(t,e,i){return Ns(this.__path,t,e,i),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Xs,L:Hs,C:js,Q:Vs,Z:Gs,N:Ks,D:qs,X:Zs,G:$s,F:Qs,O:Js,P:tr,U:er}=Ae,ir=ee.get("PathDrawer"),sr={drawPathByData(t,e){if(!e)return;let i,s=0,r=e.length;for(;s<r;)switch(i=e[s],i){case Xs:t.moveTo(e[s+1],e[s+2]),s+=3;break;case Hs:t.lineTo(e[s+1],e[s+2]),s+=3;break;case js:t.bezierCurveTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6]),s+=7;break;case Vs:t.quadraticCurveTo(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case Gs:t.closePath(),s+=1;break;case Ks:t.rect(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case qs:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],[e[s+5],e[s+6],e[s+7],e[s+8]]),s+=9;break;case Zs:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;case $s:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]*A,e[s+6]*A,e[s+7]*A,e[s+8]),s+=9;break;case Qs:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],0,0,M,!1),s+=5;break;case Js:t.arc(e[s+1],e[s+2],e[s+3],e[s+4]*A,e[s+5]*A,e[s+6]),s+=7;break;case tr:t.arc(e[s+1],e[s+2],e[s+3],0,M,!1),s+=4;break;case er:t.arcTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;default:return void ir.error(`command: ${i} [index:${s}]`,e)}}},{M:rr,L:nr,C:or,Q:ar,Z:hr,N:lr,D:dr,X:cr,G:ur,F:_r,O:pr,P:gr,U:fr}=Ae,{toTwoPointBounds:yr,toTwoPointBoundsByQuadraticCurve:mr,arcTo:vr,arc:wr,ellipse:xr}=hi,{addPointBounds:br,copy:Er,addPoint:Pr,setPoint:Br,addBounds:Sr,toBounds:Tr}=ft,kr=ee.get("PathBounds");let Rr,Cr,Lr;const Or={},Dr={},Ir={},Ar={toBounds(t,e){Ar.toTwoPointBounds(t,Dr),Tr(Dr,e)},toTwoPointBounds(t,e){if(!t||!t.length)return Br(e,0,0);let i,s,r,n,o,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(o=t[a],0===a&&(o===hr||o===or||o===ar?Br(e,h,l):Br(e,t[a+1],t[a+2])),o){case rr:case nr:h=t[a+1],l=t[a+2],Pr(e,h,l),a+=3;break;case or:r=t[a+5],n=t[a+6],yr(h,l,t[a+1],t[a+2],t[a+3],t[a+4],r,n,Or),br(e,Or),h=r,l=n,a+=7;break;case ar:i=t[a+1],s=t[a+2],r=t[a+3],n=t[a+4],mr(h,l,i,s,r,n,Or),br(e,Or),h=r,l=n,a+=5;break;case hr:a+=1;break;case lr:h=t[a+1],l=t[a+2],Sr(e,h,l,t[a+3],t[a+4]),a+=5;break;case dr:case cr:h=t[a+1],l=t[a+2],Sr(e,h,l,t[a+3],t[a+4]),a+=o===dr?9:6;break;case ur:xr(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],Or,Ir),0===a?Er(e,Or):br(e,Or),h=Ir.x,l=Ir.y,a+=9;break;case _r:h=t[a+1],l=t[a+2],Cr=t[a+3],Lr=t[a+4],Sr(e,h-Cr,l-Lr,2*Cr,2*Lr),h+=Cr,a+=5;break;case pr:wr(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],Or,Ir),0===a?Er(e,Or):br(e,Or),h=Ir.x,l=Ir.y,a+=7;break;case gr:h=t[a+1],l=t[a+2],Rr=t[a+3],Sr(e,h-Rr,l-Rr,2*Rr,2*Rr),h+=Rr,a+=4;break;case fr:vr(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],Or,Ir),0===a?Er(e,Or):br(e,Or),h=Ir.x,l=Ir.y,a+=6;break;default:return void kr.error(`command: ${o} [index:${a}]`,t)}}},{M:Mr,L:Wr,Z:Fr}=Ae,{getCenterX:Ur,getCenterY:zr}=ot,{arcTo:Nr}=Bs,Yr={smooth(t,e,i){let s,r,n,o=0,a=0,h=0,l=0,c=0,u=0,_=0,p=0,g=0;d(e)&&(e=e[0]||0);const f=t.length,y=[];for(;o<f;){switch(s=t[o],s){case Mr:l=p=t[o+1],c=g=t[o+2],o+=3,t[o]===Wr?(u=t[o+1],_=t[o+2],y.push(Mr,Ur(l,u),zr(c,_))):y.push(Mr,l,c);break;case Wr:switch(a=t[o+1],h=t[o+2],o+=3,t[o]){case Wr:Nr(y,a,h,t[o+1],t[o+2],e,p,g);break;case Fr:Nr(y,a,h,l,c,e,p,g);break;default:y.push(Wr,a,h)}p=a,g=h;break;case Fr:r!==Fr&&(Nr(y,l,c,u,_,e,p,g),y.push(Fr)),o+=1;break;default:n=Ne[s];for(let e=0;e<n;e++)y.push(t[o+e]);o+=n}r=s}return s!==Fr&&(y[1]=l,y[2]=c),y}};function Xr(t){return new Ys(t)}const Hr=Xr();De.creator=Xr(),De.parse=is.parse,De.convertToCanvasData=is.toCanvasData;const{drawRoundRect:jr}=Ye;function Vr(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,i,s,r){jr(this,t,e,i,s,r)})}(t)}const Gr={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=Kr.fileType(t);return["jpg","jpeg"].some(t=>t===e)},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},Kr=Gr;Kr.alphaPixelTypes.forEach(t=>Kr.upperCaseTypeMap[t]=t.toUpperCase());const qr=ee.get("TaskProcessor");class Zr{constructor(t){this.parallel=!0,this.time=1,this.id=f.create(f.TASK),this.task=t}run(){return me(this,void 0,void 0,function*(){try{if(this.isComplete||this.runing)return;if(this.runing=!0,this.canUse&&!this.canUse())return this.cancel();this.task&&(yield this.task())}catch(t){qr.error(t)}})}complete(){this.isComplete=!0,this.parent=this.task=this.canUse=null}cancel(){this.isCancel=!0,this.complete()}}class $r{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,i=0;for(let s=0;s<t;s++)s<=this.finishedIndex?(i+=this.list[s].time,s===this.finishedIndex&&(e=i)):e+=this.list[s].time;return this.isComplete?1:i/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&_.assign(this.config,t),this.empty()}add(t,e,i){let s,n,o,a;const l=new Zr(t);return l.parent=this,h(e)?a=e:e&&(n=e.parallel,s=e.start,o=e.time,a=e.delay,i||(i=e.canUse)),o&&(l.time=o),!1===n&&(l.parallel=!1),i&&(l.canUse=i),r(a)?this.push(l,s):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(l,s))},a)),this.isComplete=!1,l}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(t=>{t.isComplete||t.run()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then(()=>{this.onTask(t),this.index++,t.isCancel?this.runTask():this.nextTask()}).catch(t=>{this.onError(t)}):this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach(t=>this.runParallelTask(t))}runParallelTask(t){t.run().then(()=>{this.onTask(t),this.fillParallelTask()}).catch(t=>{this.onParallelError(t)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let t;const{config:e,list:i,index:s}=this;this.parallelList=[],this.parallelSuccessNumber=0;let r=s+e.parallel;if(r>i.length&&(r=i.length),e.parallel>1)for(let e=s;e<r&&(t=i[e],t.parallel);e++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const i=e.length,s=this.finishedIndex+i;if(e.length){if(!this.running)return;s<this.total&&(t=this.list[s],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach(t=>{t.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const Qr=ee.get("Resource"),Jr={tasker:new $r,map:{},get isComplete(){return tn.tasker.isComplete},set(t,e){tn.map[t]&&Qr.repeat(t),tn.map[t]=e},get:t=>tn.map[t],remove(t){const e=tn.map[t];e&&(e.destroy&&e.destroy(),delete tn.map[t])},loadImage(t,e){return new Promise((i,s)=>{const r=this.setImage(t,t,e);r.load(()=>i(r),t=>s(t))})},setImage(t,e,i){let s;return o(e)?s={url:e}:e.url||(s={url:t,view:e}),s&&(i&&(s.format=i),e=le.image(s)),tn.set(t,e),e},destroy(){tn.map={}}},tn=Jr,en={maxRecycled:10,recycledList:[],patternTasker:new $r({parallel:1}),get(t){let e=Jr.get(t.url);return e||Jr.set(t.url,e=le.image(t)),e.use++,e},recycle(t){t.use--,setTimeout(()=>{t.use||(Qt.image.isLarge(t)?t.url&&Jr.remove(t.url):(t.clearLevels(),sn.recycledList.push(t)))})},recyclePaint(t){sn.recycle(t.image)},clearRecycled(t){const e=sn.recycledList;(e.length>sn.maxRecycled||t)&&(e.forEach(e=>(!e.use||t)&&e.url&&Jr.remove(e.url)),e.length=0)},clearLevels(){},hasAlphaPixel:t=>Gr.alphaPixelTypes.some(e=>sn.isFormat(e,t)),isFormat(t,e){if(e.format)return e.format===t;const{url:i}=e;if(i.startsWith("data:")){if(i.startsWith("data:"+Gr.mineType(t)))return!0}else{if(i.includes("."+t)||i.includes("."+Gr.upperCaseTypeMap[t]))return!0;if("png"===t&&!i.includes("."))return!0}return!1},destroy(){this.clearRecycled(!0)}},sn=en,{IMAGE:rn,create:nn}=f;class on{get url(){return this.config.url}get crossOrigin(){const{crossOrigin:t}=this.config;return r(t)?Qt.image.crossOrigin:t}get completed(){return this.ready||!!this.error}constructor(t){if(this.use=0,this.waitComplete=[],this.innerId=nn(rn),this.config=t||(t={url:""}),t.view){const{view:e}=t;this.setView(e.config?e.view:e)}en.isFormat("svg",t)&&(this.isSVG=!0),en.hasAlphaPixel(t)&&(this.hasAlphaPixel=!0)}load(t,e,i){return this.loading||(this.loading=!0,Jr.tasker.add(()=>me(this,void 0,void 0,function*(){return yield Qt.origin.loadImage(this.getLoadUrl(i),this.crossOrigin,this).then(t=>{i&&this.setThumbView(t),this.setView(t)}).catch(t=>{this.error=t,this.onComplete(!1)})}))),this.waitComplete.push(t,e),this.waitComplete.length-2}unload(t,e){const i=this.waitComplete;if(e){const e=i[t+1];e&&e({type:"stop"})}i[t]=i[t+1]=void 0}setView(t){this.ready=!0,this.width||(this.width=t.width,this.height=t.height,this.view=t),this.onComplete(!0)}onComplete(t){let e;this.waitComplete.forEach((i,s)=>{e=s%2,i&&(t?e||i(this):e&&i(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(t){return this.view}getCanvas(t,e,i,s,r,n,o,a){if(t||(t=this.width),e||(e=this.height),this.cache){let{params:t,data:e}=this.cache;for(let i in t)if(t[i]!==arguments[i]){e=null;break}if(e)return e}const h=Qt.image.resize(this.view,t,e,r,n,void 0,o,i,s,a);return this.cache=this.use>1?{data:h,params:arguments}:null,h}getPattern(t,e,i,s){const r=Qt.canvas.createPattern(t,e);return Qt.image.setPatternTransform(r,i,s),r}getLoadUrl(t){return this.url}setThumbView(t){}getThumbSize(t){}getMinLevel(){}getLevelData(t,e,i){}clearLevels(t){}destroy(){this.clearLevels();const{view:t}=this;t&&t.close&&t.close(),this.config={url:""},this.cache=this.view=null,this.waitComplete.length=0}}function an(t,e,i,s){s||(i.configurable=i.enumerable=!0),Object.defineProperty(t,e,i)}function hn(t,e){return Object.getOwnPropertyDescriptor(t,e)}function ln(t,e){const i="_"+t;return{get(){const t=this[i];return null==t?e:t},set(t){this[i]=t}}}function dn(t,e){return(i,s)=>un(i,s,t,e&&e(s))}function cn(t){return t}function un(t,e,i,s){const r={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};an(t,e,Object.assign(r,s||{})),zn(t,e,i)}function _n(t){return dn(t)}function pn(t,e){return dn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function gn(t,e){return dn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function fn(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),xn(this))}}))}function yn(t,e){return dn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function mn(t,e){return dn(t,t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function vn(t,e){return dn(t,t=>({set(i){this.__setAttr(t,i,e)&&xn(this)}}))}function wn(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(xn(this),this.__.__removeNaturalSize())}}))}function xn(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}function bn(t){return dn(t,t=>({set(e){const i=this.__;2!==i.__pathInputed&&(i.__pathInputed=e?1:0),e||(i.__pathForRender=void 0),this.__setAttr(t,e),xn(this)}}))}const En=vn;function Pn(t,e){return dn(t,t=>({set(i){this.__setAttr(t,i)&&(Bn(this),e&&(this.__.__useStroke=!0))}}))}function Bn(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&xn(t)}const Sn=Pn;function Tn(t){return dn(t,t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}}))}function kn(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function Rn(t){return dn(t,t=>({set(e){if(this.__setAttr(t,e)){const t=this.__;_.stintSet(t,"__useDim",t.dim||t.bright||t.dimskip),this.__layout.surfaceChange()}}}))}function Cn(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&On(this)}}))}function Ln(t){return dn(t,t=>({set(e){const i=this.visible;if(!0===i&&0===e){if(this.animationOut)return this.__runAnimation("out",()=>Dn(this,t,e,i))}else 0===i&&!0===e&&this.animation&&this.__runAnimation("in");Dn(this,t,e,i),this.mask&&On(this)}}))}function On(t){const{parent:e}=t;if(e){const{__hasMask:t}=e;e.__updateMask(),t!==e.__hasMask&&e.forceUpdate()}}function Dn(t,e,i,s){t.__setAttr(e,i)&&(t.__layout.opacityChanged||t.__layout.opacityChange(),0!==s&&0!==i||xn(t))}function In(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function An(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(e)}))}}))}function Mn(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&this.waitParent(()=>{this.parent.__updateEraser(e)})}}))}function Wn(t){return dn(t,t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,"hit"===ee.showBounds&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function Fn(t){return dn(t,t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}}))}function Un(t){return(e,i)=>{an(e,"__DataProcessor",{get:()=>t})}}function zn(t,e,i){const s=t.__DataProcessor.prototype,n="_"+e,o=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),a=ln(e,i);if(r(i))a.get=function(){return this[n]};else if("function"==typeof i)a.get=function(){const t=this[n];return null==t?i(this.__leaf):t};else if(c(i)){const t=u(i);a.get=function(){const e=this[n];return null==e?this[n]=t?{}:_.clone(i):e}}const h=t.isBranchLeaf;"width"===e?a.get=function(){const t=this[n];if(null==t){const t=this,e=t.__naturalWidth,s=t.__leaf;return!i||s.pathInputed?s.boxBounds.width:e?t._height&&t.__useNaturalRatio?t._height*e/t.__naturalHeight:e:h&&s.children.length?s.boxBounds.width:i}return t}:"height"===e&&(a.get=function(){const t=this[n];if(null==t){const t=this,e=t.__naturalHeight,s=t.__leaf;return!i||s.pathInputed?s.boxBounds.height:e?t._width&&t.__useNaturalRatio?t._width*e/t.__naturalWidth:e:h&&s.children.length?s.boxBounds.height:i}return t});let l,d=s;for(;!l&&d;)l=hn(d,e),d=d.__proto__;l&&l.set&&(a.set=l.set),s[o]&&(a.set=s[o],delete s[o]),an(s,e,a)}const Nn=new ee("rewrite"),Yn=[],Xn=["destroy","constructor"];function Hn(t){return(e,i)=>{Yn.push({name:e.constructor.name+"."+i,run:()=>{e[i]=t}})}}function jn(){return t=>{Vn()}}function Vn(t){Yn.length&&(Yn.forEach(e=>{t&&Nn.error(e.name,"Class@rewriteAble()"),e.run()}),Yn.length=0)}function Gn(t,e){return i=>{var s;(t.prototype?(s=t.prototype,Object.getOwnPropertyNames(s)):Object.keys(t)).forEach(s=>{if(!(Xn.includes(s)||e&&e.includes(s)))if(t.prototype){hn(t.prototype,s).writable&&(i.prototype[s]=t.prototype[s])}else i.prototype[s]=t[s]})}}function Kn(){return t=>{ce.register(t)}}function qn(){return t=>{pe.register(t)}}setTimeout(()=>Vn(!0));const{copy:Zn,toInnerPoint:$n,toOuterPoint:Qn,scaleOfOuter:Jn,rotateOfOuter:to,skewOfOuter:eo,multiplyParent:io,divideParent:so,getLayout:ro}=K,no={},{round:oo}=Math,ao={updateAllMatrix(t,e,i){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(i=!0),co(t,e,i),t.isBranch){const{children:s}=t;for(let t=0,r=s.length;t<r;t++)lo(s[t],e,i)}},updateMatrix(t,e,i){const s=t.__layout;e?i&&(s.waitAutoLayout=!0,t.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&t.__updateLocalMatrix(),s.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)uo(e[t])}},updateChange(t){const e=t.__layout;e.stateStyleChanged&&t.updateState(),e.opacityChanged&&uo(t),t.__updateChange()},updateAllChange(t){if(po(t),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)_o(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},draggable:t=>(t.draggable||t.editable)&&t.hitSelf&&!t.locked,copyCanvasByWorld(t,e,i,s,r,n){s||(s=t.__nowWorld),t.__worldFlipped||Qt.fullImageShadow?e.copyWorldByReset(i,s,t.__nowWorld,r,n):e.copyWorldToInner(i,s,t.__layout.renderBounds,r)},moveWorld(t,e,i=0,s,r){const n=c(e)?Object.assign({},e):{x:e,y:i};s?Qn(t.localTransform,n,n,!0):t.parent&&$n(t.parent.scrollWorldTransform,n,n,!0),ho.moveLocal(t,n.x,n.y,r)},moveLocal(t,e,i=0,s){c(e)&&(i=e.y,e=e.x),e+=t.x,i+=t.y,t.leafer&&t.leafer.config.pointSnap&&(e=oo(e),i=oo(i)),s?t.animate({x:e,y:i},s):(t.x=e,t.y=i)},zoomOfWorld(t,e,i,s,r,n){ho.zoomOfLocal(t,go(t,e),i,s,r,n)},zoomOfLocal(t,e,i,s=i,r,n){const o=t.__localMatrix;if(h(s)||(s&&(n=s),s=i),Zn(no,o),Jn(no,e,i,s),ho.hasHighPosition(t))ho.setTransform(t,no,r,n);else{const e=t.x+no.e-o.e,a=t.y+no.f-o.f;n&&!r?t.animate({x:e,y:a,scaleX:t.scaleX*i,scaleY:t.scaleY*s},n):(t.x=e,t.y=a,t.scaleResize(i,s,!0!==r))}},rotateOfWorld(t,e,i,s){ho.rotateOfLocal(t,go(t,e),i,s)},rotateOfLocal(t,e,i,s){const r=t.__localMatrix;Zn(no,r),to(no,e,i),ho.hasHighPosition(t)?ho.setTransform(t,no,!1,s):t.set({x:t.x+no.e-r.e,y:t.y+no.f-r.f,rotation:D.formatRotation(t.rotation+i)},s)},skewOfWorld(t,e,i,s,r,n){ho.skewOfLocal(t,go(t,e),i,s,r,n)},skewOfLocal(t,e,i,s=0,r,n){Zn(no,t.__localMatrix),eo(no,e,i,s),ho.setTransform(t,no,r,n)},transformWorld(t,e,i,s){Zn(no,t.worldTransform),io(no,e),t.parent&&so(no,t.parent.scrollWorldTransform),ho.setTransform(t,no,i,s)},transform(t,e,i,s){Zn(no,t.localTransform),io(no,e),ho.setTransform(t,no,i,s)},setTransform(t,e,i,s){const r=t.__,n=r.origin&&ho.getInnerOrigin(t,r.origin),o=ro(e,n,r.around&&ho.getInnerOrigin(t,r.around));if(ho.hasOffset(t)&&(o.x-=r.offsetX,o.y-=r.offsetY),i){const e=o.scaleX/t.scaleX,i=o.scaleY/t.scaleY;if(delete o.scaleX,delete o.scaleY,n){Nt.scale(t.boxBounds,Math.abs(e),Math.abs(i));const s=ho.getInnerOrigin(t,r.origin);ot.move(o,n.x-s.x,n.y-s.y)}t.set(o),t.scaleResize(e,i,!1)}else t.set(o,s)},getFlipTransform(t,e){const i={a:1,b:0,c:0,d:1,e:0,f:0},s="x"===e?1:-1;return Jn(i,ho.getLocalOrigin(t,"center"),-1*s,1*s),i},getLocalOrigin:(t,e)=>ot.tempToOuterOf(ho.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const i={};return xt.toPoint(e,t.boxBounds,i),i},getRelativeWorld:(t,e,i)=>(Zn(no,t.worldTransform),so(no,e.scrollWorldTransform),i?no:Object.assign({},no)),drop(t,e,i,s){t.setTransform(ho.getRelativeWorld(t,e,!0),s),e.add(t,i)},hasHighPosition:t=>t.origin||t.around||ho.hasOffset(t),hasOffset:t=>t.offsetX||t.offsetY,hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}},animateMove(t,e,i=.3){if(e.x||e.y)if(Math.abs(e.x)<1&&Math.abs(e.y)<1)t.move(e);else{const s=e.x*i,r=e.y*i;e.x-=s,e.y-=r,t.move(s,r),Qt.requestRender(()=>ho.animateMove(t,e,i))}}},ho=ao,{updateAllMatrix:lo,updateMatrix:co,updateAllWorldOpacity:uo,updateAllChange:_o,updateChange:po}=ho;function go(t,e){return t.updateLayout(),t.parent?ot.tempToInnerOf(e,t.parent.scrollWorldTransform):e}const fo={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:(t,e)=>mo(t,e)&&t.__localBoxBounds,maskLocalStrokeBounds:(t,e)=>mo(t,e)&&t.__layout.localStrokeBounds,maskLocalRenderBounds:(t,e)=>mo(t,e)&&t.__layout.localRenderBounds,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))};let yo;function mo(t,e){return e||(yo=0),t.__.mask&&(yo=1),yo<0?null:(yo&&(yo=-1),!0)}const{updateBounds:vo}=ao,wo={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:i}=t;for(let s=0,r=i.length;s<r;s++)(t=i[s]).isBranch&&(t.__tempNumber=1,e.add(t),xo(t,e))}},pushAllParent(t,e){const{keys:i}=e;if(i)for(;t.parent&&r(i[t.parent.innerId]);)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let i=e.length;const{children:s}=t;for(let t=0,i=s.length;t<i;t++)s[t].isBranch&&e.push(s[t]);for(let t=i,s=e.length;t<s;t++)bo(e[t],e)},updateBounds(t,e){const i=[t];bo(t,i),Eo(i,e)},updateBoundsByBranchStack(t,e){let i,s;for(let r=t.length-1;r>-1;r--){i=t[r],s=i.children;for(let t=0,e=s.length;t<e;t++)vo(s[t]);e&&e===i||vo(i)}},move(t,e,i){let s;const{children:r}=t;for(let n=0,o=r.length;n<o;n++)s=(t=r[n]).__world,s.e+=e,s.f+=i,s.x+=e,s.y+=i,t.isBranch&&Po(t,e,i)},scale(t,e,i,s,r,n,o){let a;const{children:h}=t,l=s-1,d=r-1;for(let c=0,u=h.length;c<u;c++)a=(t=h[c]).__world,a.a*=s,a.d*=r,(a.b||a.c)&&(a.b*=s,a.c*=r),a.e===a.x&&a.f===a.y?(a.x=a.e+=(a.e-n)*l+e,a.y=a.f+=(a.f-o)*d+i):(a.e+=(a.e-n)*l+e,a.f+=(a.f-o)*d+i,a.x+=(a.x-n)*l+e,a.y+=(a.y-o)*d+i),a.width*=s,a.height*=r,a.scaleX*=s,a.scaleY*=r,t.isBranch&&Bo(t,e,i,s,r,n,o)}},{pushAllChildBranch:xo,pushAllBranchStack:bo,updateBoundsByBranchStack:Eo,move:Po,scale:Bo}=wo,So={run(t){if(t&&t.length){const e=t.length;for(let i=0;i<e;i++)t[i]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:To,updateBounds:ko}=ao,{toOuterOf:Ro,getPoints:Co,copy:Lo}=Nt,Oo="_localContentBounds",Do="_worldContentBounds",Io="_worldBoxBounds",Ao="_worldStrokeBounds";class Mo{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(t){this._renderBounds=t}get localContentBounds(){return Ro(this.contentBounds,this.leaf.__localMatrix,this[Oo]||(this[Oo]={})),this[Oo]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Ro(this.contentBounds,this.leaf.__world,this[Do]||(this[Do]={})),this[Do]}get worldBoxBounds(){return Ro(this.boxBounds,this.leaf.__world,this[Io]||(this[Io]={})),this[Io]}get worldStrokeBounds(){return Ro(this.strokeBounds,this.leaf.__world,this[Ao]||(this[Ao]={})),this[Ao]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),t.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leaf:t}=this,{leafer:e}=t;if(t.isApp)return ko(t);if(e)e.ready?e.watcher.changed&&e.layouter.layout():e.start();else{let e=t;for(;e.parent&&!e.parent.leafer;)e=e.parent;const i=e;if(i.__fullLayouting)return;i.__fullLayouting=!0,Qt.layout(i),delete i.__fullLayouting}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return K.defaultMatrix;case"page":t=e.zoomLayer;default:return To(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new jt(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",i){const{leaf:s}=this;let r,n,o,a=this.getInnerBounds(t);switch(e){case"world":r=s.getWorldPoint(a),n=s.__world;break;case"local":const{scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d}=s.__;o={scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d},r=s.getLocalPointByInner(a);break;case"inner":r=a,n=K.defaultMatrix;break;case"page":e=s.zoomLayer;default:r=s.getWorldPoint(a,e),n=To(s,e,!0)}if(o||(o=K.getLayout(n)),Lo(o,a),ot.copy(o,r),i){const{scaleX:t,scaleY:e}=o,i=Math.abs(t),s=Math.abs(e);1===i&&1===s||(o.scaleX/=i,o.scaleY/=s,o.width*=i,o.height*=s)}return o}getLayoutPoints(t,e="world"){const{leaf:i}=this,s=Co(this.getInnerBounds(t));let n;switch(e){case"world":n=null;break;case"local":n=i.parent;break;case"inner":break;case"page":e=i.zoomLayer;default:n=e}return r(n)||s.forEach(t=>i.innerToWorld(t,null,!1,n)),s}shrinkContent(){const{x:t,y:e,width:i,height:s}=this.boxBounds;this._contentBounds={x:t,y:e,width:i,height:s}}spreadStroke(){const{x:t,y:e,width:i,height:s}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:i,height:s},this._localStrokeBounds={x:t,y:e,width:i,height:s},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:i,height:s}=this.renderBounds;this._renderBounds={x:t,y:e,width:i,height:s},this._localRenderBounds={x:t,y:e,width:i,height:s}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class Wo{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&Qt.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&Qt.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&Qt.event.stop(this.origin)}}class Fo extends Wo{constructor(t,e,i){super(t,e),this.parent=i,this.child=e}}Fo.ADD="child.add",Fo.REMOVE="child.remove",Fo.CREATED="created",Fo.MOUNTED="mounted",Fo.UNMOUNTED="unmounted",Fo.DESTROY="destroy";const Uo="property.scroll";class zo extends Wo{constructor(t,e,i,s,r){super(t,e),this.attrName=i,this.oldValue=s,this.newValue=r}}zo.CHANGE="property.change",zo.LEAFER_CHANGE="property.leafer_change",zo.SCROLL=Uo;const No={scrollX:Uo,scrollY:Uo};class Yo extends Wo{constructor(t,e){super(t),Object.assign(this,e)}}Yo.LOAD="image.load",Yo.LOADED="image.loaded",Yo.ERROR="image.error";class Xo extends Wo{static checkHas(t,e,i){"on"===i?e===Go?t.__hasWorldEvent=!0:t.__hasLocalEvent=!0:(t.__hasLocalEvent=t.hasEvent(Ho)||t.hasEvent(jo)||t.hasEvent(Vo),t.__hasWorldEvent=t.hasEvent(Go))}static emitLocal(t){if(t.leaferIsReady){const{resized:e}=t.__layout;"local"!==e&&(t.emit(Ho,t),"inner"===e&&t.emit(jo,t)),t.emit(Vo,t)}}static emitWorld(t){t.leaferIsReady&&t.emit(Go,this)}}Xo.RESIZE="bounds.resize",Xo.INNER="bounds.inner",Xo.LOCAL="bounds.local",Xo.WORLD="bounds.world";const{RESIZE:Ho,INNER:jo,LOCAL:Vo,WORLD:Go}=Xo,Ko={};[Ho,jo,Vo,Go].forEach(t=>Ko[t]=1);class qo extends Wo{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){c(t)?(super(qo.RESIZE),Object.assign(this,t)):super(t),this.old=e}static isResizing(t){return this.resizingKeys&&!r(this.resizingKeys[t.innerId])}}qo.RESIZE="resize";class Zo extends Wo{constructor(t,e){super(t),this.data=e}}Zo.REQUEST="watch.request",Zo.DATA="watch.data";class $o extends Wo{constructor(t,e,i){super(t),e&&(this.data=e,this.times=i)}}$o.REQUEST="layout.request",$o.START="layout.start",$o.BEFORE="layout.before",$o.LAYOUT="layout",$o.AFTER="layout.after",$o.AGAIN="layout.again",$o.END="layout.end";class Qo extends Wo{constructor(t,e,i,s){super(t),e&&(this.times=e),i&&(this.renderBounds=i,this.renderOptions=s)}}Qo.REQUEST="render.request",Qo.CHILD_START="render.child_start",Qo.CHILD_END="render.child_end",Qo.START="render.start",Qo.BEFORE="render.before",Qo.RENDER="render",Qo.AFTER="render.after",Qo.AGAIN="render.again",Qo.END="render.end",Qo.NEXT="render.next";class Jo extends Wo{}Jo.START="leafer.start",Jo.BEFORE_READY="leafer.before_ready",Jo.READY="leafer.ready",Jo.AFTER_READY="leafer.after_ready",Jo.VIEW_READY="leafer.view_ready",Jo.VIEW_COMPLETED="leafer.view_completed",Jo.STOP="leafer.stop",Jo.RESTART="leafer.restart",Jo.END="leafer.end",Jo.UPDATE_MODE="leafer.update_mode",Jo.TRANSFORM="leafer.transform",Jo.MOVE="leafer.move",Jo.SCALE="leafer.scale",Jo.ROTATE="leafer.rotate",Jo.SKEW="leafer.skew";const{MOVE:ta,SCALE:ea,ROTATE:ia,SKEW:sa}=Jo,ra={x:ta,y:ta,scaleX:ea,scaleY:ea,rotation:ia,skewX:sa,skewY:sa},na={};class oa{set event(t){this.on(t)}on(t,e,i){if(!e){let e;if(d(t))t.forEach(t=>this.on(t[0],t[1],t[2]));else for(let i in t)d(e=t[i])?this.on(i,e[0],e[1]):this.on(i,e);return}let s,r,n;i&&("once"===i?r=!0:"boolean"==typeof i?s=i:(s=i.capture,r=i.once));const a=aa(this,s,!0),h=o(t)?t.split(" "):t,l=r?{listener:e,once:r}:{listener:e};h.forEach(t=>{t&&(n=a[t],n?-1===n.findIndex(t=>t.listener===e)&&n.push(l):a[t]=[l],Ko[t]&&Xo.checkHas(this,t,"on"))})}off(t,e,i){if(t){const s=o(t)?t.split(" "):t;if(e){let t,r,n;i&&(t="boolean"==typeof i?i:"once"!==i&&i.capture);const o=aa(this,t);s.forEach(t=>{t&&(r=o[t],r&&(n=r.findIndex(t=>t.listener===e),n>-1&&r.splice(n,1),r.length||delete o[t],Ko[t]&&Xo.checkHas(this,t,"off")))})}else{const{__bubbleMap:t,__captureMap:e}=this;s.forEach(i=>{t&&delete t[i],e&&delete e[i]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,e,i,s){return e?this.on(t,i?e=e.bind(i):e,s):d(t)&&t.forEach(t=>this.on(t[0],t[2]?t[1]=t[1].bind(t[2]):t[1],t[3])),{type:t,current:this,listener:e,options:s}}off_(t){if(!t)return;const e=d(t)?t:[t];e.forEach(t=>{t&&(t.listener?t.current.off(t.type,t.listener,t.options):d(t.type)&&t.type.forEach(e=>t.current.off(e[0],e[1],e[3])))}),e.length=0}once(t,e,i,s){if(!e)return d(t)&&t.forEach(t=>this.once(t[0],t[1],t[2],t[3]));c(i)?e=e.bind(i):s=i,this.on(t,e,{once:!0,capture:s})}emit(t,e,i){!e&&pe.has(t)&&(e=pe.get(t,{type:t,target:this,current:this}));const s=aa(this,i)[t];if(s){let r;for(let n=0,o=s.length;n<o&&!((r=s[n])&&(r.listener(e),r.once&&(this.off(t,r.listener,i),n--,o--),e&&e.isStopNow));n++);}this.syncEventer&&this.syncEventer.emitEvent(e,i)}emitEvent(t,e){t.current=this,this.emit(t.type,t,e)}hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:i,__captureMap:s}=this,n=i&&i[t],o=s&&s[t];return!!(r(e)?n||o:e?o:n)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function aa(t,e,i){if(e){const{__captureMap:e}=t;return e||(i?t.__captureMap={}:na)}{const{__bubbleMap:e}=t;return e||(i?t.__bubbleMap={}:na)}}const{on:ha,on_:la,off:da,off_:ca,once:ua,emit:_a,emitEvent:pa,hasEvent:ga,destroy:fa}=oa.prototype,ya={on:ha,on_:la,off:da,off_:ca,once:ua,emit:_a,emitEvent:pa,hasEvent:ga,destroyEventer:fa},ma=ee.get("setAttr"),va={__setAttr(t,e,i){if(this.leaferIsCreated){const s=this.__.__getInput(t);if(!i||a(e)||r(e)||(ma.warn(this.innerName,t,e),e=void 0),c(e)||s!==e){if(this.__realSetAttr(t,e),this.isLeafer){this.emitEvent(new zo(zo.LEAFER_CHANGE,this,t,s,e));const i=ra[t];i&&(this.emitEvent(new Jo(i,this)),this.emitEvent(new Jo(Jo.TRANSFORM,this)))}this.emitPropertyEvent(zo.CHANGE,t,s,e);const i=No[t];return i&&this.emitPropertyEvent(i,t,s,e),!0}return!1}return this.__realSetAttr(t,e),!0},emitPropertyEvent(t,e,i,s){const r=new zo(t,this,e,i,s);this.isLeafer||this.hasEvent(t)&&this.emitEvent(r),this.leafer.emitEvent(r)},__realSetAttr(t,e){const i=this.__;i[t]=e,this.__proxyData&&this.setProxyAttr(t,e),i.normalStyle&&(this.lockNormalStyle||r(i.normalStyle[t])||(i.normalStyle[t]=e))},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:wa,multiplyParent:xa,translateInner:ba,defaultWorld:Ea}=K,{toPoint:Pa,tempPoint:Ba}=xt,Sa={__updateWorldMatrix(){const{parent:t,__layout:e,__world:i,__scrollWorld:s,__:r}=this;xa(this.__local||e,t?t.__scrollWorld||t.__world:Ea,i,!!e.affectScaleOrRotation,r),s&&ba(Object.assign(s,i),r.scrollX,r.scrollY)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,i=this.__;t.affectScaleOrRotation&&(t.scaleChanged&&(t.resized||(t.resized="scale"))||t.rotationChanged)&&(wa(e,i,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=void 0),e.e=i.x+i.offsetX,e.f=i.y+i.offsetY,(i.around||i.origin)&&(Pa(i.around||i.origin,t.boxBounds,Ba),ba(e,-Ba.x,-Ba.y,!i.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:Ta,updateAllMatrix:ka}=ao,{updateBounds:Ra}=wo,{toOuterOf:Ca,copyAndSpread:La,copy:Oa}=Nt,{toBounds:Da}=Ar,Ia={__updateWorldBounds(){const{__layout:t,__world:e}=this;Ca(t.renderBounds,e,e),t.resized&&("inner"===t.resized&&this.__onUpdateSize(),this.__hasLocalEvent&&Xo.emitLocal(this),t.resized=void 0),this.__hasWorldEvent&&Xo.emitWorld(this)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized="inner"),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=void 0,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=void 0,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=void 0,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized="inner"),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),t.resized||(t.resized="local"),t.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),Ca(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){Ca(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){Ca(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(t,e){const i=this.__layout.boxBounds,s=this.__;s.__usePathBox?Da(s.path,i):(i.x=0,i.y=0,i.width=s.width,i.height=s.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),ka(this),Ra(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(ka(this),Ra(this,this))):Ta(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(t){const e=this.__layout;La(e.strokeBounds,e.boxBounds,e.strokeBoxSpread)},__updateRenderBounds(t){const e=this.__layout,{renderSpread:i}=e;h(i)&&i<=0?Oa(e.renderBounds,e.strokeBounds):La(e.renderBounds,e.boxBounds,i)}},Aa={__render(t,e){if(e.shape)return this.__renderShape(t,e);if((!e.cellList||e.cellList.has(this))&&this.__worldOpacity){const i=this.__;if(i.bright&&!e.topRendering)return e.topList.add(this);if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=e.dimOpacity&&!i.dimskip?i.opacity*e.dimOpacity:i.opacity,this.__.__single){if("path"===i.eraser)return this.__renderEraser(t,e);const s=t.getSameCanvas(!0,!0);this.__draw(s,e,t),ao.copyCanvasByWorld(this,t,s,this.__nowWorld,i.__blendMode,!0),s.recycle(this.__nowWorld)}else this.__draw(t,e);ee.showBounds&&ee.drawBounds(this,t,e)}},__renderShape(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawShape(t,e))},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),t.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Ma}=fo,{hasSize:Wa}=Nt,Fa={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){const i=this.__nowWorld=this.__getNowWorld(e);if(this.__worldOpacity&&Wa(i)){const s=this.__;if(s.__useDim)if(s.dim)e.dimOpacity=!0===s.dim?.2:s.dim;else{if(s.bright&&!e.topRendering)return e.topList.add(this);s.dimskip&&e.dimOpacity&&(e.dimOpacity=0)}if(s.__single&&!this.isBranchLeaf){if("path"===s.eraser)return this.__renderEraser(t,e);const r=t.getSameCanvas(!1,!0);this.__renderBranch(r,e),t.opacity=e.dimOpacity?s.opacity*e.dimOpacity:s.opacity,t.copyWorldByReset(r,i,i,s.__blendMode,!0),r.recycle(i)}else this.__renderBranch(t,e)}},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:i}=this;for(let s=0,r=i.length;s<r;s++)Ma(i[s],e)||i[s].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:i}=this;for(let s=0,r=i.length;s<r;s++)Ma(i[s],e)||i[s].__clip(t,e)}}},Ua={},{LEAF:za,create:Na}=f,{stintSet:Ya}=_,{toInnerPoint:Xa,toOuterPoint:Ha,multiplyParent:ja}=K,{toOuterOf:Va}=Nt,{copy:Ga,move:Ka}=ot,{moveLocal:qa,zoomOfLocal:Za,rotateOfLocal:$a,skewOfLocal:Qa,moveWorld:Ja,zoomOfWorld:th,rotateOfWorld:eh,skewOfWorld:ih,transform:sh,transformWorld:rh,setTransform:nh,getFlipTransform:oh,getLocalOrigin:ah,getRelativeWorld:hh,drop:lh}=ao;t.Leaf=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return g}get __LayoutProcessor(){return Mo}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=Na(za),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(Fo.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),0!==t&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.on(Fo.ADD,t,"once")}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.on(Fo.MOUNTED,t,"once")}nextRender(t,e,i){this.leafer?this.leafer.nextRender(t,e,i):this.waitLeafer(()=>this.leafer.nextRender(t,e,i))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(Fo.MOUNTED)):this.__emitLifeEvent(Fo.UNMOUNTED),this.isBranch){const{children:e}=this;for(let i=0,s=e.length;i<s;i++)e[i].__bindLeafer(t)}}set(t,e){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){r(t)?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=r(e)?null:void 0,this[t]=e}forceRender(t,e){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(t,e){}__updateContentBounds(){}__updateStrokeBounds(t){}__updateRenderBounds(t){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some(t=>t.__.eraser)}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=this.children.some(t=>t.__.mask&&t.__.visible&&t.__.opacity)}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld,i=this.__world;return ja(i,t.matrix,e,void 0,i),Va(this.__layout.renderBounds,e,e),Ya(e,"half",i.half),Ya(e,"ignorePixelSnap",i.ignorePixelSnap),e}return this.__world}getClampRenderScale(){let{scaleX:t}=this.__nowWorld||this.__world;return t<0&&(t=-t),t>1?t:1}getRenderScaleData(t,e){let{scaleX:i,scaleY:s}=en.patternLocked?this.__world:this.__nowWorld;return t&&(i<0&&(i=-i),s<0&&(s=-s)),(!0===e||"zoom-in"===e&&i>1&&s>1)&&(i=s=1),Ua.scaleX=i,Ua.scaleY=s,Ua}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,i){return this.__layout.getLayoutBounds(t,e,i)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,i){const s=e?hh(this,e):this.worldTransform,r=i?t:{};return Va(t,s,r),r}worldToLocal(t,e,i,s){this.parent?this.parent.worldToInner(t,e,i,s):e&&Ga(e,t)}localToWorld(t,e,i,s){this.parent?this.parent.innerToWorld(t,e,i,s):e&&Ga(e,t)}worldToInner(t,e,i,s){s&&(s.innerToWorld(t,e,i),t=e||t),Xa(this.scrollWorldTransform,t,e,i)}innerToWorld(t,e,i,s){Ha(this.scrollWorldTransform,t,e,i),s&&s.worldToInner(e||t,null,i)}getBoxPoint(t,e,i,s){return this.getBoxPointByInner(this.getInnerPoint(t,e,i,s),null,null,!0)}getBoxPointByInner(t,e,i,s){const r=s?t:Object.assign({},t),{x:n,y:o}=this.boxBounds;return Ka(r,-n,-o),r}getInnerPoint(t,e,i,s){const r=s?t:{};return this.worldToInner(t,r,i,e),r}getInnerPointByBox(t,e,i,s){const r=s?t:Object.assign({},t),{x:n,y:o}=this.boxBounds;return Ka(r,n,o),r}getInnerPointByLocal(t,e,i,s){return this.getInnerPoint(t,this.parent,i,s)}getLocalPoint(t,e,i,s){const r=s?t:{};return this.worldToLocal(t,r,i,e),r}getLocalPointByInner(t,e,i,s){return this.getWorldPoint(t,this.parent,i,s)}getPagePoint(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,i,s)}getWorldPoint(t,e,i,s){const r=s?t:{};return this.innerToWorld(t,r,i,e),r}getWorldPointByBox(t,e,i,s){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,s),e,i,!0)}getWorldPointByLocal(t,e,i,s){const r=s?t:{};return this.localToWorld(t,r,i,e),r}getWorldPointByPage(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,i,s)}setTransform(t,e,i){nh(this,t,e,i)}transform(t,e,i){sh(this,t,e,i)}move(t,e,i){qa(this,t,e,i)}moveInner(t,e,i){Ja(this,t,e,!0,i)}scaleOf(t,e,i,s,r){Za(this,ah(this,t),e,i,s,r)}rotateOf(t,e,i){$a(this,ah(this,t),e,i)}skewOf(t,e,i,s,r){Qa(this,ah(this,t),e,i,s,r)}transformWorld(t,e,i){rh(this,t,e,i)}moveWorld(t,e,i){Ja(this,t,e,!1,i)}scaleOfWorld(t,e,i,s,r){th(this,t,e,i,s,r)}rotateOfWorld(t,e){eh(this,t,e)}skewOfWorld(t,e,i,s,r){ih(this,t,e,i,s,r)}flip(t,e){sh(this,oh(this,t),!1,e)}scaleResize(t,e=t,i){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}hit(t,e){return!0}__hitWorld(t,e){return!0}__hit(t,e){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e,i){}__clip(t,e){}__renderShape(t,e){}__drawShape(t,e){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return he.need("path")}getMotionPoint(t){return he.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,e){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,i){lh(this,t,e,i)}on(t,e,i){}off(t,e,i){}on_(t,e,i,s){}off_(t){}once(t,e,i,s){}emit(t,e,i){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,i){i?this.addAttr(t,e,i):zn(this.prototype,t,e)}static addAttr(t,e,i,s){i||(i=vn),i(e,s)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new Fo(t,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(Fo.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}},t.Leaf=ye([Gn(va),Gn(Sa),Gn(Ia),Gn(ya),Gn(Aa)],t.Leaf);const{setListWithFn:dh}=Nt,{sort:ch}=wo,{localBoxBounds:uh,localStrokeBounds:_h,localRenderBounds:ph,maskLocalBoxBounds:gh,maskLocalStrokeBounds:fh,maskLocalRenderBounds:yh}=fo,mh=new ee("Branch");t.Branch=class extends t.Leaf{__updateStrokeSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(t,e){dh(e||this.__layout.boxBounds,this.children,this.__hasMask?gh:uh)}__updateStrokeBounds(t){dh(t||this.__layout.strokeBounds,this.children,this.__hasMask?fh:_h)}__updateRenderBounds(t){dh(t||this.__layout.renderBounds,this.children,this.__hasMask?yh:ph)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let i=0,s=e.length;i<s;i++)e[i].__tempNumber=i,e[i].__.zIndex&&(t=!0);e.sort(ch),this.__layout.affectChildrenSort=t}}add(t,e){if(t===this||t.destroyed)return mh.warn("add self or destroyed");const i=r(e);if(!t.__){if(d(t))return t.forEach(t=>{this.add(t,e),i||e++});t=ce.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,i?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const s=t.__layout;s.boxChanged||s.boxChange(),s.matrixChanged||s.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(Fo.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(Fo.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,e){t?t.__?t.animationOut?t.__runAnimation("out",()=>this.__remove(t,e)):this.__remove(t,e):this.find(t).forEach(t=>this.remove(t,e)):r(t)&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach(e=>{this.__realRemoveChild(e),t&&e.destroy()}))}clear(){this.removeAll(!0)}__remove(t,e){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(Fo.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(Fo.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const i=new Fo(t,e,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}},t.Branch=ye([Gn(Fa)],t.Branch);class vh{get length(){return this.list.length}constructor(t){this.reset(),t&&(d(t)?this.addList(t):this.add(t))}has(t){return t&&!r(this.keys[t.innerId])}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return r(e)?-1:e}add(t){const{list:e,keys:i}=this;r(i[t.innerId])&&(e.push(t),i[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:i}=this;if(r(i[t.innerId])){const{list:s}=this;for(let t=e,r=s.length;t<r;t++)i[s[t].innerId]++;0===e?s.unshift(t):(e>s.length&&(e=s.length),s.splice(e,0,t)),i[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let i;for(let s=0,n=e.length;s<n;s++)r(i)?e[s].innerId===t.innerId&&(i=s,delete this.keys[t.innerId]):this.keys[e[s].innerId]=s-1;r(i)||e.splice(i,1)}sort(t){const{list:e}=this;t?e.sort((t,e)=>e.__level-t.__level):e.sort((t,e)=>t.__level-e.__level)}forEach(t){this.list.forEach(t)}clone(){const t=new vh;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let i=0,s=t.length;i<s;i++)e[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class wh{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(d(t)?this.addList(t):this.add(t))}has(t){return!r(this.keys[t.innerId])}without(t){return r(this.keys[t.innerId])}sort(t){const{levels:e}=this;t?e.sort((t,e)=>e-t):e.sort((t,e)=>t-e)}addList(t){t.forEach(t=>{this.add(t)})}add(t){const{keys:e,levelMap:i}=this;e[t.innerId]||(e[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach(i=>{e=this.levelMap[i];for(let i=0,s=e.length;i<s;i++)t(e[i])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const xh=ee.get("LeaferCanvas");class bh extends Oe{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const s=i.children[t];s?(this.setAbsolute(s),i.insertBefore(e,s)):i.appendChild(s)}}init(){const{config:t}=this,e=t.view||t.canvas;e?this.__createViewFrom(e):this.__createView();const{style:i}=this.view;if(i.display||(i.display="block"),this.parentView=this.view.parentElement,this.parentView){const t=this.parentView.style;t.webkitUserSelect=t.userSelect="none",this.view.classList.add("leafer-canvas-view")}Qt.syncDomFont&&!this.parentView&&(i.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(t)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e=o(t)?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:i}=e;i.position="absolute",i.top=i.bottom=i.left=i.right="0px",document.body.appendChild(e),t=e}this.__createView();const i=this.view;t.hasChildNodes()&&(this.setAbsolute(i),t.style.position||(t.style.position="relative")),t.appendChild(i)}else xh.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:s}=this.view;s.width=t+"px",s.height=e+"px",this.unreal||(this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i))}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(t,e){if(this.resizeListener=e,t){if(this.autoBounds=t,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)});const t=this.parentView;t?(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect())):(this.checkAutoBounds(this.view),xh.warn("no parent"))}catch(t){this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),Qt.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const t=Qt.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==t){const{width:e,height:i}=this;this.emitResize({width:e,height:i,pixelRatio:t})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(t){const e=this.view,{x:i,y:s,width:r,height:n}=this.autoBounds.getBoundsFrom(t),o={width:r,height:n,pixelRatio:this.config.pixelRatio?this.pixelRatio:Qt.devicePixelRatio};if(!this.isSameSize(o)){const{style:t}=e;t.marginLeft=i+"px",t.marginTop=s+"px",this.emitResize(o)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(t){const e={};_.copyAttrs(e,this,Le),this.resize(t),this.resizeListener&&!r(this.width)&&this.resizeListener(new qo(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){let t=this.view;t&&t.remove(),t=this.view=document.createElement("div"),this.parentView.appendChild(this.view),t.classList.add("leafer-app-view"),this.unreal=!0}}destroy(){const{view:t}=this;t&&(this.stopAutoLayout(),this.stopListenPixelRatio(),t.parentElement&&t.remove(),super.destroy())}}Vr(CanvasRenderingContext2D.prototype),Vr(Path2D.prototype);const{mineType:Eh,fileType:Ph}=Gr;function Bh(t,e){Qt.origin={createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i},canvasToDataURL:(t,e,i)=>{const s=Eh(e),r=t.toDataURL(s,i);return"image/bmp"===s?r.replace("image/png;","image/bmp;"):r},canvasToBolb:(t,e,i)=>new Promise(s=>t.toBlob(s,Eh(e),i)),canvasSaveAs:(t,e,i)=>{const s=t.toDataURL(Eh(Ph(e)),i);return Qt.origin.download(s,e)},download:(t,e)=>new Promise(i=>{let s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),i()}),loadImage:t=>new Promise((e,i)=>{const s=new Qt.origin.Image,{crossOrigin:r}=Qt.image;r&&(s.setAttribute("crossOrigin",r),s.crossOrigin=r),s.onload=()=>{e(s)},s.onerror=t=>{i(t)},s.src=Qt.image.getRealURL(t)}),Image:Image,PointerEvent:PointerEvent,DragEvent:DragEvent},Qt.event={stopDefault(t){t.preventDefault()},stopNow(t){t.stopImmediatePropagation()},stop(t){t.stopPropagation()}},Qt.canvas=le.canvas(),Qt.conicGradientSupport=!!Qt.canvas.context.createConicGradient}Object.assign(le,{canvas:(t,e)=>new bh(t,e),image:t=>new on(t)}),Qt.name="web",Qt.isMobile="ontouchstart"in window,Qt.requestRender=function(t){window.requestAnimationFrame(t)},an(Qt,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:Sh}=navigator;Sh.indexOf("Firefox")>-1?(Qt.conicGradientRotate90=!0,Qt.intWheelDeltaY=!0,Qt.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&(Qt.fullImageShadow=!0),Sh.indexOf("Windows")>-1?(Qt.os="Windows",Qt.intWheelDeltaY=!0):Sh.indexOf("Mac")>-1?Qt.os="Mac":Sh.indexOf("Linux")>-1&&(Qt.os="Linux");class Th{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove&&this.config.usePartLayout){const t=new vh;return this.__updatedList.list.forEach(e=>{e.leafer&&t.add(e)}),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new vh,this.target=t,e&&(this.config=_.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(Qo.REQUEST)}__onAttrChange(t){this.config.usePartLayout&&this.__updatedList.add(t.target),this.update()}__onChildEvent(t){this.config.usePartLayout&&(t.type===Fo.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent))),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new Zo(Zo.DATA,{updatedList:this.updatedList})),this.__updatedList=new vh,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[zo.CHANGE,this.__onAttrChange,this],[[Fo.ADD,Fo.REMOVE],this.__onChildEvent,this],[Zo.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:kh,updateBounds:Rh,updateChange:Ch}=ao,{pushAllChildBranch:Lh,pushAllParent:Oh}=wo;const{worldBounds:Dh}=fo;class Ih{constructor(t){this.updatedBounds=new jt,this.beforeBounds=new jt,this.afterBounds=new jt,d(t)&&(t=new vh(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,Dh)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,Dh),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:Ah,updateAllChange:Mh}=ao,Wh=ee.get("Layouter");class Fh{constructor(t,e){this.totalTimes=0,this.config={usePartLayout:!0},this.__levelList=new wh,this.target=t,e&&(this.config=_.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:t}=this;this.times=0;try{t.emit($o.START),this.layoutOnce(),t.emitEvent(new $o($o.END,this.layoutedBlocks,this.times))}catch(t){Wh.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Wh.warn("layouting"):this.times>3?Wh.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Zo.REQUEST),this.totalTimes>1&&this.config.usePartLayout?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=ne.start("PartLayout"),{target:i,__updatedList:s}=this,{BEFORE:r,LAYOUT:n,AFTER:o}=$o,a=this.getBlocks(s);a.forEach(t=>t.setBefore()),i.emitEvent(new $o(r,a,this.times)),this.extraBlock=null,s.sort(),function(t,e){let i;t.list.forEach(t=>{i=t.__layout,e.without(t)&&!i.proxyZoom&&(i.matrixChanged?(kh(t,!0),e.add(t),t.isBranch&&Lh(t,e),Oh(t,e)):i.boundsChanged&&(e.add(t),t.isBranch&&(t.__tempNumber=0),Oh(t,e)))})}(s,this.__levelList),function(t){let e,i,s;t.sort(!0),t.levels.forEach(r=>{e=t.levelMap[r];for(let t=0,r=e.length;t<r;t++){if(i=e[t],i.isBranch&&i.__tempNumber){s=i.children;for(let t=0,e=s.length;t<e;t++)s[t].isBranch||Rh(s[t])}Rh(i)}})}(this.__levelList),function(t){t.list.forEach(Ch)}(s),this.extraBlock&&a.push(this.extraBlock),a.forEach(t=>t.setAfter()),i.emitEvent(new $o(n,a,this.times)),i.emitEvent(new $o(o,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,ne.end(e)}fullLayout(){const t=ne.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:s,AFTER:r}=$o,n=this.getBlocks(new vh(e));e.emitEvent(new $o(i,n,this.times)),Fh.fullLayout(e),n.forEach(t=>{t.setAfter()}),e.emitEvent(new $o(s,n,this.times)),e.emitEvent(new $o(r,n,this.times)),this.addBlocks(n),ne.end(t)}static fullLayout(t){Ah(t,!0),t.isBranch?wo.updateBounds(t):ao.updateBounds(t),Mh(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new Ih([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new Ih(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[$o.REQUEST,this.layout,this],[$o.AGAIN,this.layoutAgain,this],[Zo.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const Uh=ee.get("Renderer");class zh{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,ceilPartPixel:!0,maxFPS:120},this.frames=[],this.target=t,this.canvas=e,i&&(this.config=_.default(i,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(t=!0){this.changed||(this.changed=t),this.requestTime||this.__requestRender()}requestLayout(){this.target.emit($o.REQUEST)}checkRender(){if(this.running){const{target:t}=this;t.isApp&&(t.emit(Qo.CHILD_START,t),t.children.forEach(t=>{t.renderer.FPS=this.FPS,t.renderer.checkRender()}),t.emit(Qo.CHILD_END,t)),this.changed&&this.canvas.view&&this.render(),this.target.emit(Qo.NEXT)}}render(t){if(!this.running||!this.canvas.view)return this.update();const{target:e}=this;this.times=0,this.totalBounds=new jt,Uh.log(e.innerName,"---\x3e");try{this.emitRender(Qo.START),this.renderOnce(t),this.emitRender(Qo.END,this.totalBounds),en.clearRecycled()}catch(t){this.rendering=!1,Uh.error(t)}Uh.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return Uh.warn("rendering");if(this.times>3)return Uh.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new jt,this.renderOptions={},t)this.emitRender(Qo.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(Qo.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(Qo.RENDER,this.renderBounds,this.renderOptions),this.emitRender(Qo.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;e&&(this.mergeBlocks(),e.forEach(e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=ne.start("PartRender"),{canvas:i}=this,s=t.getIntersect(i.bounds),r=new jt(s);i.save(),s.spread(zh.clipSpread).ceil();const{ceilPartPixel:n}=this.config;i.clipWorld(s,n),i.clearWorld(s,n),this.__render(s,r),i.restore(),ne.end(e)}fullRender(){const t=ne.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds),e.restore(),ne.end(t)}__render(t,e){const{canvas:i,target:s}=this,r=t.includes(s.__world),n=r?{includes:r}:{bounds:t,includes:r};this.needFill&&i.fillWorld(t,this.config.fill),ee.showRepaint&&ee.drawRepaint(i,t),this.config.useCellRender&&(n.cellList=this.getCellList()),Qt.render(s,i,n),this.renderBounds=e=e||t,this.renderOptions=n,this.totalBounds.isEmpty()?this.totalBounds=e:this.totalBounds.add(e),i.updateRender(e)}getCellList(){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new jt;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const t=this.target;if(this.requestTime||!t)return;if(t.parentApp)return t.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const e=()=>{const t=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:i}=this.config;if(i&&t>i)return Qt.requestRender(e);const{frames:s}=this;s.length>30&&s.shift(),s.push(t),this.FPS=Math.round(s.reduce((t,e)=>t+e,0)/s.length),this.requestTime=0,this.checkRender()};Qt.requestRender(e)}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new jt(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new jt(0,0,1,1)),this.update()}}__onLayoutEnd(t){t.data&&t.data.map(t=>{let e;t.updatedList&&t.updatedList.list.some(t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||Uh.tip(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e)),this.addBlock(e?this.canvas.bounds:t.updatedBounds)})}emitRender(t,e,i){this.target.emitEvent(new Qo(t,this.times,e,i))}__listenEvents(){this.__eventIds=[this.target.on_([[Qo.REQUEST,this.update,this],[$o.END,this.__onLayoutEnd,this],[Qo.AGAIN,this.renderAgain,this],[qo.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}zh.clipSpread=10;const Nh={},{copyRadiusPoint:Yh}=ot,{hitRadiusPoint:Xh}=Nt;class Hh{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const s=i.through||!1,r=i.ignoreHittable||!1,n=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new vh(i.findList),i.findList||this.hitBranch(n.isBranchLeaf?{children:[n]}:n);const{list:o}=this.findList,a=this.getBestMatchLeaf(o,i.bottomList,r,!!i.findList),h=r?this.getPath(a):this.getHitablePath(a);return this.clear(),s?{path:h,target:a,throughPath:o.length?this.getThroughPath(o):h}:{path:h,target:a}}hitPoint(t,e,i){return!!this.getByPoint(t,e,i).target}getBestMatchLeaf(t,e,i,s){const r=this.findList=new vh;if(t.length){let e;const{x:s,y:n}=this.point,o={x:s,y:n,radiusX:0,radiusY:0};for(let s=0,n=t.length;s<n;s++)if(e=t[s],(i||ao.worldHittable(e))&&(this.hitChild(e,o),r.length)){if(e.isBranchLeaf&&t.some(t=>t!==e&&ao.hasParent(t,e))){r.reset();break}return r.list[0]}}if(e)for(let t=0,i=e.length;t<i;t++)if(this.hitChild(e[t].target,this.point,e[t].proxy),r.length)return r.list[0];return s?null:i?t[0]:t.find(t=>ao.worldHittable(t))}getPath(t){const e=new vh,i=[],{target:s}=this;for(;t&&(t.syncEventer&&i.push(t.syncEventer),e.add(t),(t=t.parent)!==s););return i.length&&i.forEach(t=>{for(;t&&(t.__.hittable&&e.add(t),(t=t.parent)!==s););}),s&&e.add(s),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,s=new vh;for(let t=e.list.length-1;t>-1&&(i=e.list[t],i.__.hittable)&&(s.addAt(i,0),i.__.hitChildren&&(!i.isLeafer||"draw"!==i.mode));t--);return s}getThroughPath(t){const e=new vh,i=[];for(let e=t.length-1;e>-1;e--)i.push(this.getPath(t[e]));let s,r,n;for(let t=0,o=i.length;t<o;t++){s=i[t],r=i[t+1];for(let t=0,i=s.length;t<i&&(n=s.list[t],!r||!r.has(n));t++)e.add(n)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,s,r;const{point:n}=this;for(let o=t.length-1;o>-1;o--)if(i=t[o],r=i.__,r.visible&&(!e||r.mask))if(s=Xh(i.__world,r.hitRadius?Yh(Nh,n,r.hitRadius):n),i.isBranch){if(s||i.__ignoreHitWorld){if(i.isBranchLeaf&&r.__clipAfterFill&&!i.__hitWorld(n,!0))continue;i.topChildren&&this.eachFind(i.topChildren,!1),this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,n)}}else s&&this.hitChild(i,n)}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:s}=t;if(s&&s.__hasMask&&!t.__.mask){let i,r=[];const{children:n}=s;for(let s=0,o=n.length;s<o;s++)if(i=n[s],i.__.mask&&r.push(i),i===t){if(r&&!r.every(t=>t.__hitWorld(e)))return;break}}this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class jh{constructor(t,e){this.config={},e&&(this.config=_.default(e,this.config)),this.picker=new Hh(this.target=t,this),this.finder=le.finder&&le.finder()}getByPoint(t,e,i){const{target:s,picker:r}=this;return Qt.backgrounder&&s&&s.updateLayout(),r.getByPoint(t,e,i)}hitPoint(t,e,i){return this.picker.hitPoint(t,e,i)}getBy(t,e,i,s){return this.finder?this.finder.getBy(t,e,i,s):he.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}function Vh(t){return dn(t,t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Gh(t){return dn(t,t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function Kh(){return(t,e)=>{const i="_"+e;an(t,e,{set(t){this.isLeafer&&(this[i]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}Object.assign(le,{watcher:(t,e)=>new Th(t,e),layouter:(t,e)=>new Fh(t,e),renderer:(t,e,i)=>new zh(t,e,i),selector:(t,e)=>new jh(t,e)}),Qt.layout=Fh.fullLayout,Qt.render=function(t,e,i){const s=Object.assign(Object.assign({},i),{topRendering:!0});i.topList=new vh,t.__render(e,i),i.topList.length&&i.topList.forEach(t=>t.__render(e,s))};const qh={},Zh={hasTransparent:function(t){if(!t||7===t.length||4===t.length)return!1;if("transparent"===t)return!0;const e=t[0];if("#"===e)switch(t.length){case 5:return"f"!==t[4]&&"F"!==t[4];case 9:return"f"!==t[7]&&"F"!==t[7]||"f"!==t[8]&&"F"!==t[8]}else if(("r"===e||"h"===e)&&"a"===t[3]){const e=t.lastIndexOf(",");if(e>-1)return parseFloat(t.slice(e+1))<1}return!1}},$h=Kt,Qh={},Jh={},tl={},el={},il={},sl={apply(){he.need("filter")}},rl={},nl={setStyleName:()=>he.need("state"),set:()=>he.need("state")},ol={list:{},register(t,e){ol.list[t]=e},get:t=>ol.list[t]},{parse:al,objectToCanvasData:hl}=is,{stintSet:ll}=_,{hasTransparent:dl}=Zh,cl={originPaint:{}},ul=ee.get("UIData");class _l extends g{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const t=this;return t.__hasMultiStrokeStyle?Math.max(t.__hasMultiStrokeStyle,t.strokeWidth):t.strokeWidth}get __hasMultiPaint(){const t=this;return t.fill&&this.__useStroke||t.__isFills&&t.fill.length>1||t.__isStrokes&&t.stroke.length>1||t.__useEffect}get __clipAfterFill(){const t=this;return t.cornerRadius||t.innerShadow||t.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,ul.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,ul.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),o(t)||!t?(ll(this,"__isTransparentFill",dl(t)),this.__isFills&&this.__removePaint("fill",!0),this._fill=t):c(t)&&this.__setPaint("fill",t)}setStroke(t){o(t)||!t?(ll(this,"__isTransparentStroke",dl(t)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=t):c(t)&&this.__setPaint("stroke",t)}setPath(t){const e=o(t);e||t&&c(t[0])?(this.__setInput("path",t),this._path=e?al(t):hl(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){pl(this,"shadow",t)}setInnerShadow(t){pl(this,"innerShadow",t)}setFilter(t){pl(this,"filter",t)}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&Jh.compute("fill",this.__leaf),e&&Jh.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth(t){let{strokeWidth:e,strokeWidthFixed:i}=this;if(t&&(t.strokeWidth&&(e=t.strokeWidth),r(t.strokeWidthFixed)||(i=t.strokeWidthFixed)),i){const t=this.__leaf.getClampRenderScale();return t>1?e/t:e}return e}__setPaint(t,e){this.__setInput(t,e);const i=this.__leaf.__layout;i.boxChanged||i.boxChange(),d(e)&&!e.length?this.__removePaint(t):"fill"===t?(this.__isFills=!0,this._fill||(this._fill=cl)):(this.__isStrokes=!0,this._stroke||(this._stroke=cl))}__removePaint(t,e){e&&this.__removeInput(t),tl.recycleImage(t,this),"fill"===t?(ll(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(ll(this,"__isAlphaPixelStroke",void 0),ll(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}}function pl(t,e,i){t.__setInput(e,i),d(i)?(i.some(t=>!1===t.visible)&&(i=i.filter(t=>!1!==t.visible)),i.length||(i=void 0)):i=i&&!1!==i.visible?[i]:void 0,t["_"+e]=i}class gl extends _l{}class fl extends gl{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const t=this;return"show"!==t.overflow&&t.__leaf.children.length&&(t.__leaf.isOverflow||super.__clipAfterFill)}}class yl extends gl{__getInputData(t,e){const i=super.__getInputData(t,e);return Le.forEach(t=>delete i[t]),i}}class ml extends fl{}class vl extends _l{get __usePathBox(){return this.points||this.__pathInputed}}class wl extends _l{get __boxStroke(){return!this.__pathInputed}}class xl extends _l{get __boxStroke(){return!this.__pathInputed}}class bl extends vl{}class El extends _l{}class Pl extends _l{get __pathInputed(){return 2}}class Bl extends gl{}const Sl={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class Tl extends _l{get __useNaturalRatio(){return!1}setFontWeight(t){o(t)?(this.__setInput("fontWeight",t),t=Sl[t]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t}setBoxStyle(t){let e=this.__leaf,i=e.__box;if(t){const{boxStyle:s}=this;if(i)for(let t in s)i[t]=void 0;else i=e.__box=ce.get("Rect",0);const r=e.__layout,n=i.__layout;s||(i.parent=e,i.__world=e.__world,n.boxBounds=r.boxBounds),i.set(t),n.strokeChanged&&r.strokeChange()}else i&&(e.__box=i.parent=null,i.destroy());this._boxStyle=t}__getInputData(t,e){const i=super.__getInputData(t,e);return i.textEditing&&delete i.textEditing,i}}class kl extends wl{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return t.url&&delete t.fill,t}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url&&delete i.fill,i}}class Rl extends wl{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url=this.__leaf.canvas.toDataURL("image/png"),i}}const{max:Cl,add:Ll}=E,Ol={__updateStrokeSpread(){let t=0,e=0;const i=this.__,{strokeAlign:s,__maxStrokeWidth:r}=i,n=this.__box;if((i.stroke||"all"===i.hitStroke)&&r&&"inside"!==s&&(e=t="center"===s?r/2:r,!i.__boxStroke)){const e=i.__isLinePath?0:10*t,s="none"===i.strokeCap?0:r;t+=Math.max(e,s)}return i.__useArrow&&(t+=5*r),n&&(t=Cl(t,n.__layout.strokeSpread=n.__updateStrokeSpread()),e=Math.max(e,n.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:i,blur:s,backgroundBlur:r,filter:n,renderSpread:o}=this.__,{strokeSpread:a}=this.__layout,h=this.__box;e&&(t=il.getShadowRenderSpread(this,e)),s&&(t=Cl(t,s)),n&&(t=Ll(t,sl.getSpread(n))),o&&(t=Ll(t,o)),a&&(t=Ll(t,a));let l=t;return i&&(l=Cl(l,il.getInnerShadowSpread(this,i))),r&&(l=Cl(l,r)),this.__layout.renderShapeSpread=l,h?Cl(h.__updateRenderSpread(),t):t}},{stintSet:Dl}=_,Il={__updateChange(){const t=this.__;if(t.__useStroke){const e=t.__useStroke=!(!t.stroke||!t.strokeWidth);Dl(this.__world,"half",e&&"center"===t.strokeAlign&&t.strokeWidth%2),Dl(t,"__fillAfterStroke",e&&"outside"===t.strokeAlign&&t.fill&&!t.__isTransparentFill)}if(t.__useEffect){const{shadow:e,fill:i,stroke:s}=t,r=t.innerShadow||t.blur||t.backgroundBlur||t.filter;Dl(t,"__isFastShadow",e&&!r&&e.length<2&&!e[0].spread&&!il.isTransformShadow(e[0])&&i&&!t.__isTransparentFill&&!(d(i)&&i.length>1)&&(this.useFastShadow||!s||s&&"inside"===t.strokeAlign)),t.__useEffect=!(!e&&!r)}t.__checkSingle(),Dl(t,"__complex",t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect)},__drawFast(t,e){Al(this,t,e)},__draw(t,e,i){const s=this.__;if(s.__complex){s.__needComputePaint&&s.__computePaint();const{fill:r,stroke:n,__drawAfterFill:o,__fillAfterStroke:a,__isFastShadow:h}=s;if(this.__drawRenderPath(t),s.__useEffect&&!h){const h=Jh.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:l,innerShadow:d,filter:c}=s;l&&il.shadow(this,t,h),a&&(s.__isStrokes?Jh.strokes(n,this,t,e):Jh.stroke(n,this,t,e)),r&&(s.__isFills?Jh.fills(r,this,t,e):Jh.fill(r,this,t,e)),o&&this.__drawAfterFill(t,e),d&&il.innerShadow(this,t,h),n&&!a&&(s.__isStrokes?Jh.strokes(n,this,t,e):Jh.stroke(n,this,t,e)),c&&sl.apply(c,this,this.__nowWorld,t,i,h),h.worldCanvas&&h.worldCanvas.recycle(),h.canvas.recycle()}else{if(a&&(s.__isStrokes?Jh.strokes(n,this,t,e):Jh.stroke(n,this,t,e)),h){const e=s.shadow[0],{scaleX:i,scaleY:r}=this.getRenderScaleData(!0,e.scaleFixed);t.save(),t.setWorldShadow(e.x*i,e.y*r,e.blur*i,Zh.string(e.color))}r&&(s.__isFills?Jh.fills(r,this,t,e):Jh.fill(r,this,t,e)),h&&t.restore(),o&&this.__drawAfterFill(t,e),n&&!a&&(s.__isStrokes?Jh.strokes(n,this,t,e):Jh.stroke(n,this,t,e))}}else s.__pathForRender?Al(this,t,e):this.__drawFast(t,e)},__drawShape(t,e){this.__drawRenderPath(t);const i=this.__,{fill:s,stroke:r}=i;s&&!e.ignoreFill&&(i.__isAlphaPixelFill?Jh.fills(s,this,t,e):Jh.fill("#000000",this,t,e)),i.__isCanvas&&this.__drawAfterFill(t,e),r&&!e.ignoreStroke&&(i.__isAlphaPixelStroke?Jh.strokes(r,this,t,e):Jh.stroke("#000000",this,t,e))},__drawAfterFill(t,e){this.__.__clipAfterFill?(t.save(),t.clipUI(this),this.__drawContent(t,e),t.restore()):this.__drawContent(t,e)}};function Al(t,e,i){const{fill:s,stroke:r,__drawAfterFill:n,__fillAfterStroke:o}=t.__;t.__drawRenderPath(e),o&&Jh.stroke(r,t,e,i),s&&Jh.fill(s,t,e,i),n&&t.__drawAfterFill(e,i),r&&!o&&Jh.stroke(r,t,e,i)}const Ml={__drawFast(t,e){let{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;const{fill:o,stroke:a,__drawAfterFill:h}=this.__;if(o&&(t.fillStyle=o,t.fillRect(i,s,r,n)),h&&this.__drawAfterFill(t,e),a){const{strokeAlign:o,__strokeWidth:h}=this.__;if(!h)return;t.setStroke(a,h,this.__);const l=h/2;switch(o){case"center":t.strokeRect(0,0,r,n);break;case"inside":r-=h,n-=h,r<0||n<0?(t.save(),this.__clip(t,e),t.strokeRect(i+l,s+l,r,n),t.restore()):t.strokeRect(i+l,s+l,r,n);break;case"outside":t.strokeRect(i-l,s-l,r+h,n+h)}}}};var Wl,Fl;t.UI=Wl=class extends t.Leaf{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){D.assignScale(this,t)}get scale(){return this.__.scale}get isAutoWidth(){const t=this.__;return t.__autoWidth||t.autoWidth}get isAutoHeight(){const t=this.__;return t.__autoHeight||t.autoHeight}get pen(){const{path:t}=this.__;return Hr.set(this.path=t||[]),t||this.__drawPathByBox(Hr),Hr}reset(t){}set(t,e){t&&Object.assign(this,t)}get(t){return o(t)?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){return he.need("find")}findTag(t){return this.find({tag:t})}findOne(t,e){return he.need("find")}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let i=e?this.__.__pathForRender:this.__.path;return i||(Hr.set(i=[]),this.__drawPathByBox(Hr,!e)),t?is.toCanvasData(i,!0):i}getPathString(t,e,i){return is.stringify(this.getPath(t,e),i)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||rl.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){const t=this.__;t.path?(t.__pathForRender=t.cornerRadius?Yr.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&Qh.addArrows(this)):t.__pathForRender&&(t.__pathForRender=void 0)}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path,!0)}__drawPathByData(t,e,i){e?sr.drawPathByData(t,e):this.__drawPathByBox(t,i)}__drawPathByBox(t,e){const{x:i,y:s,width:r,height:n}=this.__layout.boxBounds;if(this.__.cornerRadius&&!e){const{cornerRadius:e}=this.__;t.roundRect(i,s,r,n,h(e)?[e]:e)}else t.rect(i,s,r,n);t.closePath()}drawImagePlaceholder(t,e,i){Jh.fill(this.__.placeholderColor,this,e,i)}animate(t,e,i,s){return this.set(t),he.need("animate")}killAnimate(t,e){}export(t,e){return he.need("export")}syncExport(t,e){return he.need("export")}clone(t){const e=_.clone(this.toJSON());return t&&Object.assign(e,t),Wl.one(e)}static one(t,e,i,s,r){return ce.get(t.tag||this.prototype.__tag,t,e,i,s,r)}static registerUI(){Kn()(this)}static registerData(t){Un(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}},ye([Un(_l)],t.UI.prototype,"__",void 0),ye([Kh()],t.UI.prototype,"zoomLayer",void 0),ye([_n("")],t.UI.prototype,"id",void 0),ye([_n("")],t.UI.prototype,"name",void 0),ye([_n("")],t.UI.prototype,"className",void 0),ye([kn("pass-through")],t.UI.prototype,"blendMode",void 0),ye([Cn(1)],t.UI.prototype,"opacity",void 0),ye([Ln(!0)],t.UI.prototype,"visible",void 0),ye([kn(!1)],t.UI.prototype,"locked",void 0),ye([Rn(!1)],t.UI.prototype,"dim",void 0),ye([Rn(!1)],t.UI.prototype,"dimskip",void 0),ye([In(0)],t.UI.prototype,"zIndex",void 0),ye([An(!1)],t.UI.prototype,"mask",void 0),ye([Mn(!1)],t.UI.prototype,"eraser",void 0),ye([pn(0,!0)],t.UI.prototype,"x",void 0),ye([pn(0,!0)],t.UI.prototype,"y",void 0),ye([vn(100,!0)],t.UI.prototype,"width",void 0),ye([vn(100,!0)],t.UI.prototype,"height",void 0),ye([yn(1,!0)],t.UI.prototype,"scaleX",void 0),ye([yn(1,!0)],t.UI.prototype,"scaleY",void 0),ye([mn(0,!0)],t.UI.prototype,"rotation",void 0),ye([mn(0,!0)],t.UI.prototype,"skewX",void 0),ye([mn(0,!0)],t.UI.prototype,"skewY",void 0),ye([pn(0,!0)],t.UI.prototype,"offsetX",void 0),ye([pn(0,!0)],t.UI.prototype,"offsetY",void 0),ye([gn(0,!0)],t.UI.prototype,"scrollX",void 0),ye([gn(0,!0)],t.UI.prototype,"scrollY",void 0),ye([fn()],t.UI.prototype,"origin",void 0),ye([fn()],t.UI.prototype,"around",void 0),ye([_n(!1)],t.UI.prototype,"lazy",void 0),ye([wn(1)],t.UI.prototype,"pixelRatio",void 0),ye([Tn(0)],t.UI.prototype,"renderSpread",void 0),ye([bn()],t.UI.prototype,"path",void 0),ye([En()],t.UI.prototype,"windingRule",void 0),ye([En(!0)],t.UI.prototype,"closed",void 0),ye([vn(0)],t.UI.prototype,"padding",void 0),ye([vn(!1)],t.UI.prototype,"lockRatio",void 0),ye([vn()],t.UI.prototype,"widthRange",void 0),ye([vn()],t.UI.prototype,"heightRange",void 0),ye([_n(!1)],t.UI.prototype,"draggable",void 0),ye([_n()],t.UI.prototype,"dragBounds",void 0),ye([_n("auto")],t.UI.prototype,"dragBoundsType",void 0),ye([_n(!1)],t.UI.prototype,"editable",void 0),ye([Wn(!0)],t.UI.prototype,"hittable",void 0),ye([Wn("path")],t.UI.prototype,"hitFill",void 0),ye([Sn("path")],t.UI.prototype,"hitStroke",void 0),ye([Wn(!1)],t.UI.prototype,"hitBox",void 0),ye([Wn(!0)],t.UI.prototype,"hitChildren",void 0),ye([Wn(!0)],t.UI.prototype,"hitSelf",void 0),ye([Wn()],t.UI.prototype,"hitRadius",void 0),ye([Fn("")],t.UI.prototype,"cursor",void 0),ye([kn()],t.UI.prototype,"fill",void 0),ye([Sn(void 0,!0)],t.UI.prototype,"stroke",void 0),ye([Sn("inside")],t.UI.prototype,"strokeAlign",void 0),ye([Sn(1,!0)],t.UI.prototype,"strokeWidth",void 0),ye([Sn(!1)],t.UI.prototype,"strokeWidthFixed",void 0),ye([Sn("none")],t.UI.prototype,"strokeCap",void 0),ye([Sn("miter")],t.UI.prototype,"strokeJoin",void 0),ye([Sn()],t.UI.prototype,"dashPattern",void 0),ye([Sn(0)],t.UI.prototype,"dashOffset",void 0),ye([Sn(10)],t.UI.prototype,"miterLimit",void 0),ye([En(0)],t.UI.prototype,"cornerRadius",void 0),ye([En()],t.UI.prototype,"cornerSmoothing",void 0),ye([Vh()],t.UI.prototype,"shadow",void 0),ye([Vh()],t.UI.prototype,"innerShadow",void 0),ye([Vh()],t.UI.prototype,"blur",void 0),ye([Vh()],t.UI.prototype,"backgroundBlur",void 0),ye([Vh()],t.UI.prototype,"grayscale",void 0),ye([Vh()],t.UI.prototype,"filter",void 0),ye([kn()],t.UI.prototype,"placeholderColor",void 0),ye([_n(100)],t.UI.prototype,"placeholderDelay",void 0),ye([_n({})],t.UI.prototype,"data",void 0),ye([Hn(t.Leaf.prototype.reset)],t.UI.prototype,"reset",null),t.UI=Wl=ye([Gn(Ol),Gn(Il),jn()],t.UI),t.Group=class extends t.UI{get __tag(){return"Group"}get isBranch(){return!0}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t)if(t.children){const{children:i}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),i.forEach(t=>this.add(t)),t.children=i}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return this.childlessJSON||(e.children=this.children.map(e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}},ye([Un(gl)],t.Group.prototype,"__",void 0),ye([vn(0)],t.Group.prototype,"width",void 0),ye([vn(0)],t.Group.prototype,"height",void 0),t.Group=ye([Gn(t.Branch),Kn()],t.Group);const Ul=ee.get("Leafer");t.Leafer=Fl=class extends t.Group{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Jr.isComplete}get layoutLocked(){return!this.layouter.running}get view(){return this.canvas&&this.canvas.view}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||{x:0,y:0,width:0,height:0}}constructor(t,e){super(e),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),Fl.list.add(this)}init(t,e){if(this.canvas)return;let i;const{config:s}=this;this.__setLeafer(this),e&&(this.parentApp=e,this.__bindApp(e),i=e.running),t&&(this.parent=e,this.initType(t.type),this.parent=void 0,_.assign(s,t));const r=this.canvas=le.canvas(s);this.__controllers.push(this.renderer=le.renderer(this,r,s),this.watcher=le.watcher(this,s),this.layouter=le.layouter(this,s)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),e||(this.selector=le.selector(this),this.interaction=le.interaction(this,r,this.selector,s),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=le.hitCanvasManager()),this.canvasManager=new fe,i=s.start),this.hittable=s.hittable,this.fill=s.fill,this.canvasManager.add(r),this.__listenEvents(),i&&(this.__startTimer=setTimeout(this.start.bind(this))),So.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t,e){this.waitInit(()=>{super.set(t,e)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(Jo.RESTART):this.emitLeafer(Jo.START),this.__controllers.forEach(t=>t.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(t=>t.stop()),this.running=!1,this.emitLeafer(Jo.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=_.copyAttrs({},t,Le);Object.keys(e).forEach(t=>this[t]=e[t])}forceRender(t,e){const{renderer:i}=this;i&&(i.addBlock(t?new jt(t):this.canvas.bounds),this.viewReady&&(e?i.render():i.update()))}requestRender(t=!1){this.renderer&&this.renderer.update(t)}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const i=_.copyAttrs({},this.canvas,Le);e.resize(t),this.updateLazyBounds(),this.__onResize(new qo(t,i))}__onResize(t){this.emitEvent(t),_.copyAttrs(this.__,t,Le),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(){const{config:t,parentApp:e}=this;e||(t.width&&t.height||(this.autoLayout=new Gt(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(Le.includes(t)?this.__changeCanvasSize(t,e):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t?(this.canvas.zIndex=e,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):"mode"===t&&this.emit(Jo.UPDATE_MODE,{mode:e})),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&Le.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const{config:i,canvas:s}=this,r=_.copyAttrs({},s,Le);r[t]=i[t]=e,i.width&&i.height?s.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(r)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(Jo.BEFORE_READY),this.emitLeafer(Jo.READY),this.emitLeafer(Jo.AFTER_READY),So.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(Jo.VIEW_READY),So.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:t,width:e,height:i}=this.config;if(t){let{width:s,height:r,pixelRatio:n}=this;const o="box"===t?this.worldBoxBounds:this.__world;e||(s=Math.max(1,o.x+o.width)),i||(r=Math.max(1,o.y+o.height)),this.__doResize({width:s,height:r,pixelRatio:n})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){So.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted(t=!0){this.nextRender(()=>{this.imageReady&&(t&&this.emitLeafer(Jo.VIEW_COMPLETED),So.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,i){e&&(t=t.bind(e));const s=this.__nextRenderWait;if(i){for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}}else s.push(t);this.requestRender()}zoom(t,e,i,s){return he.need("view")}getValidMove(t,e,i){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}getClientPointByWorld(t){const{x:e,y:i}=this.clientBounds;return{x:e+t.x,y:i+t.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}emitLeafer(t){this.emitEvent(new Jo(t,this))}__listenEvents(){const t=ne.start("FirstCreate "+this.innerName);this.once([[Jo.START,()=>ne.end(t)],[$o.START,this.updateLazyBounds,this],[Qo.START,this.__onCreated,this],[Qo.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[Zo.DATA,this.__onWatchData,this],[$o.END,this.__onLayoutEnd,this],[Qo.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy(t){const e=()=>{if(!this.destroyed){Fl.list.remove(this);try{this.stop(),this.emitLeafer(Jo.END),this.__removeListenEvents(),this.__controllers.forEach(t=>!(this.parent&&t===this.interaction)&&t.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{en.clearRecycled()},100)}catch(t){Ul.error(t)}}};t?e():setTimeout(e)}},t.Leafer.list=new vh,ye([Un(yl)],t.Leafer.prototype,"__",void 0),ye([vn()],t.Leafer.prototype,"pixelRatio",void 0),ye([_n("normal")],t.Leafer.prototype,"mode",void 0),t.Leafer=Fl=ye([Kn()],t.Leafer),t.Rect=class extends t.UI{get __tag(){return"Rect"}},ye([Un(wl)],t.Rect.prototype,"__",void 0),t.Rect=ye([Gn(Ml),jn(),Kn()],t.Rect);const{add:zl,includes:Nl,scroll:Yl}=Nt,Xl=t.Rect.prototype,Hl=t.Group.prototype;t.Box=class extends t.Group{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){if(this.children.length&&!this.pathInputed){const t=this.__;if(t.__autoSide){t.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:e}=this.__layout;t.__autoSize||(t.__autoWidth?(e.width+=e.x,e.x=0,e.height=t.height,e.y=0):(e.height+=e.y,e.y=0,e.width=t.width,e.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t,e;if(this.children.length){const i=this.__,s=this.__layout,{renderBounds:r,boxBounds:n}=s,{overflow:o}=i,a=s.childrenRenderBounds||(s.childrenRenderBounds={x:0,y:0,width:0,height:0});super.__updateRenderBounds(a),(e=o&&o.includes("scroll"))&&(zl(a,n),Yl(a,i)),this.__updateRectRenderBounds(),t=!Nl(n,a),t&&"show"===o&&zl(r,a)}else this.__updateRectRenderBounds();_.stintSet(this,"isOverflow",t),this.__checkScroll(e)}__updateRectRenderBounds(){}__checkScroll(t){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e)),this.hasScroller&&this.scroller.__render(t,e)}__drawContent(t,e){this.__renderGroup(t,e),(this.__.__useStroke||this.__.__useEffect)&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}},ye([Un(fl)],t.Box.prototype,"__",void 0),ye([vn(100)],t.Box.prototype,"width",void 0),ye([vn(100)],t.Box.prototype,"height",void 0),ye([_n(!1)],t.Box.prototype,"resizeChildren",void 0),ye([Tn("show")],t.Box.prototype,"overflow",void 0),ye([Hn(Xl.__updateStrokeSpread)],t.Box.prototype,"__updateStrokeSpread",null),ye([Hn(Xl.__updateRenderSpread)],t.Box.prototype,"__updateRectRenderSpread",null),ye([Hn(Xl.__updateBoxBounds)],t.Box.prototype,"__updateRectBoxBounds",null),ye([Hn(Xl.__updateStrokeBounds)],t.Box.prototype,"__updateStrokeBounds",null),ye([Hn(Xl.__updateRenderBounds)],t.Box.prototype,"__updateRectRenderBounds",null),ye([Hn(Xl.__updateChange)],t.Box.prototype,"__updateRectChange",null),ye([Hn(Xl.__render)],t.Box.prototype,"__renderRect",null),ye([Hn(Hl.__render)],t.Box.prototype,"__renderGroup",null),t.Box=ye([jn(),Kn()],t.Box),t.Frame=class extends t.Box{get __tag(){return"Frame"}get isFrame(){return!0}},ye([Un(ml)],t.Frame.prototype,"__",void 0),ye([kn("#FFFFFF")],t.Frame.prototype,"fill",void 0),ye([Tn("hide")],t.Frame.prototype,"overflow",void 0),t.Frame=ye([Kn()],t.Frame);const{moveTo:jl,closePath:Vl,ellipse:Gl}=Bs;t.Ellipse=class extends t.UI{get __tag(){return"Ellipse"}__updatePath(){const{width:t,height:e,innerRadius:i,startAngle:s,endAngle:r}=this.__,n=t/2,o=e/2,a=this.__.path=[];let h;i?s||r?(i<1?Gl(a,n,o,n*i,o*i,0,s,r,!1):h=!0,Gl(a,n,o,n,o,0,r,s,!0)):(i<1&&(Gl(a,n,o,n*i,o*i),jl(a,t,o)),Gl(a,n,o,n,o,0,360,0,!0)):s||r?(jl(a,n,o),Gl(a,n,o,n,o,0,s,r,!1)):Gl(a,n,o,n,o),h||Vl(a),Qt.ellipseToCurve&&(this.__.path=this.getPath(!0))}},ye([Un(xl)],t.Ellipse.prototype,"__",void 0),ye([En(0)],t.Ellipse.prototype,"innerRadius",void 0),ye([En(0)],t.Ellipse.prototype,"startAngle",void 0),ye([En(0)],t.Ellipse.prototype,"endAngle",void 0),t.Ellipse=ye([Kn()],t.Ellipse);const{sin:Kl,cos:ql,PI:Zl}=Math,{moveTo:$l,lineTo:Ql,closePath:Jl,drawPoints:td}=Bs;t.Polygon=class extends t.UI{get __tag(){return"Polygon"}__updatePath(){const t=this.__,e=t.path=[];if(t.points)td(e,t.points,t.curve,!0);else{const{width:i,height:s,sides:r}=t,n=i/2,o=s/2;$l(e,n,0);for(let t=1;t<r;t++)Ql(e,n+n*Kl(2*t*Zl/r),o-o*ql(2*t*Zl/r));Jl(e)}}},ye([Un(bl)],t.Polygon.prototype,"__",void 0),ye([En(3)],t.Polygon.prototype,"sides",void 0),ye([En()],t.Polygon.prototype,"points",void 0),ye([En(0)],t.Polygon.prototype,"curve",void 0),t.Polygon=ye([jn(),Kn()],t.Polygon);const{sin:ed,cos:id,PI:sd}=Math,{moveTo:rd,lineTo:nd,closePath:od}=Bs;t.Star=class extends t.UI{get __tag(){return"Star"}__updatePath(){const{width:t,height:e,corners:i,innerRadius:s}=this.__,r=t/2,n=e/2,o=this.__.path=[];rd(o,r,0);for(let t=1;t<2*i;t++)nd(o,r+(t%2==0?r:r*s)*ed(t*sd/i),n-(t%2==0?n:n*s)*id(t*sd/i));od(o)}},ye([Un(El)],t.Star.prototype,"__",void 0),ye([En(5)],t.Star.prototype,"corners",void 0),ye([En(.382)],t.Star.prototype,"innerRadius",void 0),t.Star=ye([Kn()],t.Star);const{moveTo:ad,lineTo:hd,drawPoints:ld}=Bs,{rotate:dd,getAngle:cd,getDistance:ud,defaultPoint:_d}=ot;t.Line=class extends t.UI{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,i={x:0,y:0};return t&&(i.x=t),e&&dd(i,e),i}set toPoint(t){this.width=ud(_d,t),this.rotation=cd(_d,t),this.height&&(this.height=0)}__updatePath(){const t=this.__,e=t.path=[];t.points?ld(e,t.points,t.curve,t.closed):(ad(e,0,0),hd(e,this.width,0))}},ye([Un(vl)],t.Line.prototype,"__",void 0),ye([Pn("center")],t.Line.prototype,"strokeAlign",void 0),ye([vn(0)],t.Line.prototype,"height",void 0),ye([En()],t.Line.prototype,"points",void 0),ye([En(0)],t.Line.prototype,"curve",void 0),ye([En(!1)],t.Line.prototype,"closed",void 0),t.Line=ye([Kn()],t.Line),t.Image=class extends t.Rect{get __tag(){return"Image"}get ready(){const{image:t}=this;return t&&t.ready}get image(){const{fill:t}=this.__;return d(t)&&t[0].image}},ye([Un(kl)],t.Image.prototype,"__",void 0),ye([vn("")],t.Image.prototype,"url",void 0),t.Image=ye([Kn()],t.Image);const pd=t.Image;t.Canvas=class extends t.Rect{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor(t){super(t),this.canvas=le.canvas(this.__),t&&t.url&&this.drawImage(t.url)}drawImage(t){new on({url:t}).load(t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Yo(Yo.LOADED,{image:t}))})}draw(t,e,i,s){const r=new pt(t.worldTransform).invert(),n=new pt;e&&n.translate(e.x,e.y),i&&(h(i)?n.scale(i):n.scale(i.x,i.y)),s&&n.rotate(s),r.multiplyParent(n),t.__render(this.canvas,{matrix:r.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:i,height:s}=this.__,{view:r}=this.canvas;t.drawImage(r,0,0,r.width,r.height,0,0,i,s)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e,safeResize:i}=this.__;t.resize(this.__,i),t.smooth!==e&&(t.smooth=e)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}},ye([Un(Rl)],t.Canvas.prototype,"__",void 0),ye([Gh(100)],t.Canvas.prototype,"width",void 0),ye([Gh(100)],t.Canvas.prototype,"height",void 0),ye([Gh(1)],t.Canvas.prototype,"pixelRatio",void 0),ye([Gh(!0)],t.Canvas.prototype,"smooth",void 0),ye([_n(!1)],t.Canvas.prototype,"safeResize",void 0),ye([Gh()],t.Canvas.prototype,"contextSettings",void 0),t.Canvas=ye([Kn()],t.Canvas);const{copyAndSpread:gd,includes:fd,spread:yd,setList:md}=Nt,{stintSet:vd}=_;t.Text=class extends t.UI{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const t=this.__,{lineHeight:e,letterSpacing:i,fontFamily:s,fontSize:r,fontWeight:n,italic:o,textCase:a,textOverflow:h,padding:l,width:d,height:c}=t;t.__lineHeight=$h.number(e,r),t.__letterSpacing=$h.number(i,r),t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*r)/2,t.__font=`${o?"italic ":""}${"small-caps"===a?"small-caps ":""}${"normal"!==n?n+" ":""}${r||12}px ${s||"caption"}`,vd(t,"__padding",l&&D.fourNumber(l)),vd(t,"__clipText","show"!==h&&!t.__autoSize),vd(t,"__isCharMode",d||c||t.__letterSpacing||"none"!==a),t.__textDrawData=qh.getDrawData((t.__isPlacehold=t.placeholder&&""===t.text)?t.placeholder:t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{fontSize:i,italic:s,padding:r,__autoWidth:n,__autoHeight:o}=t;this.__updateTextDrawData();const{bounds:a}=t.__textDrawData,h=e.boxBounds;if(e.contentBounds=a,t.__lineHeight<i&&yd(a,i/2),n||o){if(h.x=n?a.x:0,h.y=o?a.y:0,h.width=n?a.width:t.width,h.height=o?a.height:t.height,r){const[e,i,s,r]=t.__padding;n&&(h.x-=r,h.width+=i+r),o&&(h.y-=e,h.height+=s+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();s&&(h.width+=.16*i),_.stintSet(this,"isOverflow",!fd(h,a)),this.isOverflow?(md(t.__textBoxBounds={},[h,a]),e.renderChanged=!0):t.__textBoxBounds=h}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.isOverflow?1:0),t}__updateRenderBounds(){const{renderBounds:t,renderSpread:e}=this.__layout;gd(t,this.__.__textBoxBounds,e),this.__box&&(this.__box.__layout.renderBounds=t)}__updateChange(){super.__updateChange();const t=this.__box;t&&(t.__onUpdateSize(),t.__updateChange())}__drawRenderPath(t){t.font=this.__.__font}__draw(t,e,i){const s=this.__box;s&&(s.__nowWorld=this.__nowWorld,s.__draw(t,e,i)),this.textEditing&&!e.exporting||super.__draw(t,e,i)}__drawShape(t,e){e.shape&&this.__box&&this.__box.__drawShape(t,e),super.__drawShape(t,e)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}},ye([Un(Tl)],t.Text.prototype,"__",void 0),ye([vn(0)],t.Text.prototype,"width",void 0),ye([vn(0)],t.Text.prototype,"height",void 0),ye([kn()],t.Text.prototype,"boxStyle",void 0),ye([_n(!1)],t.Text.prototype,"resizeFontSize",void 0),ye([kn("#000000")],t.Text.prototype,"fill",void 0),ye([Pn("outside")],t.Text.prototype,"strokeAlign",void 0),ye([Wn("all")],t.Text.prototype,"hitFill",void 0),ye([vn("")],t.Text.prototype,"text",void 0),ye([vn("")],t.Text.prototype,"placeholder",void 0),ye([vn("caption")],t.Text.prototype,"fontFamily",void 0),ye([vn(12)],t.Text.prototype,"fontSize",void 0),ye([vn("normal")],t.Text.prototype,"fontWeight",void 0),ye([vn(!1)],t.Text.prototype,"italic",void 0),ye([vn("none")],t.Text.prototype,"textCase",void 0),ye([vn("none")],t.Text.prototype,"textDecoration",void 0),ye([vn(0)],t.Text.prototype,"letterSpacing",void 0),ye([vn({type:"percent",value:1.5})],t.Text.prototype,"lineHeight",void 0),ye([vn(0)],t.Text.prototype,"paraIndent",void 0),ye([vn(0)],t.Text.prototype,"paraSpacing",void 0),ye([vn("x")],t.Text.prototype,"writingMode",void 0),ye([vn("left")],t.Text.prototype,"textAlign",void 0),ye([vn("top")],t.Text.prototype,"verticalAlign",void 0),ye([vn(!0)],t.Text.prototype,"autoSizeAlign",void 0),ye([vn("normal")],t.Text.prototype,"textWrap",void 0),ye([vn("show")],t.Text.prototype,"textOverflow",void 0),ye([kn(!1)],t.Text.prototype,"textEditing",void 0),t.Text=ye([Kn()],t.Text),t.Path=class extends t.UI{get __tag(){return"Path"}},ye([Un(Pl)],t.Path.prototype,"__",void 0),ye([Pn("center")],t.Path.prototype,"strokeAlign",void 0),t.Path=ye([Kn()],t.Path),t.Pen=class extends t.Group{get __tag(){return"Pen"}setStyle(e){const i=this.pathElement=new t.Path(e);return this.pathStyle=e,this.__path=i.path||(i.path=[]),this.add(i),this}beginPath(){return this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,i,s,r,n){return this}quadraticCurveTo(t,e,i,s){return this}closePath(){return this}rect(t,e,i,s){return this}roundRect(t,e,i,s,r){return this}ellipse(t,e,i,s,r,n,o,a){return this}arc(t,e,i,s,r,n){return this}arcTo(t,e,i,s,r){return this}drawEllipse(t,e,i,s,r,n,o,a){return this}drawArc(t,e,i,s,r,n){return this}drawPoints(t,e,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}},ye([Un(Bl)],t.Pen.prototype,"__",void 0),ye([(t,e)=>{an(t,e,{get(){return this.__path}})}],t.Pen.prototype,"path",void 0),t.Pen=ye([Gn(Ys,["set","path","paint"]),Kn()],t.Pen),t.App=class extends t.Leafer{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,e){if(super.init(t,e),t){const{ground:e,tree:i,sky:s,editor:r}=t;e&&(this.ground=this.addLeafer(e)),(i||r)&&(this.tree=this.addLeafer(i||{type:t.type||"design"})),(s||r)&&(this.sky=this.addLeafer(s)),r&&le.editor(r,this)}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:i}=this.config;e||i===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach(t=>t.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach(t=>t.start())}stop(){this.forEach(t=>t.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach(t=>t.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach(t=>t.lockLayout())}forceRender(t,e){this.forEach(i=>i.forceRender(t,e))}addLeafer(e){const i=new t.Leafer(e);return this.add(i),i}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add(t,e),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),r(e)||(t.canvas.childIndex=e),this.__listenChildEvents(t)}forEach(t){this.children.forEach(t)}__onCreated(){this.created=this.children.every(t=>t.created)}__onReady(){this.children.every(t=>t.ready)&&super.__onReady()}__onViewReady(){this.children.every(t=>t.viewReady)&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){t.context&&this.forEach(i=>e.matrix?i.__render(t,e):t.copyWorld(i.canvas,e.bounds))}__onResize(t){this.forEach(e=>e.resize(t)),super.__onResize(t)}updateLayout(){this.forEach(t=>t.updateLayout())}__getChildConfig(t){const e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&_.assign(e,t),this.autoLayout&&_.copyAttrs(e,this,Le),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once([[$o.END,this.__onReady,this],[Qo.START,this.__onCreated,this],[Qo.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push(t.on_(Qo.END,this.__onChildRenderEnd,this))}},t.App=ye([Kn()],t.App);const wd={},xd={isHoldSpaceKey:()=>xd.isHold("Space"),isHold:t=>wd[t],isHoldKeys:(t,e)=>e?t(e):void 0,setDownCode(t){wd[t]||(wd[t]=!0)},setUpCode(t){wd[t]=!1}},bd={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class Ed extends Wo{get spaceKey(){return xd.isHoldSpaceKey()}get left(){return bd.left(this)}get right(){return bd.right(this)}get middle(){return bd.middle(this)}constructor(t){super(t.type),this.bubbles=!0,Object.assign(this,t)}isHoldKeys(t){return xd.isHoldKeys(t,this)}getBoxPoint(t){return(t||this.current).getBoxPoint(this)}getInnerPoint(t){return(t||this.current).getInnerPoint(this)}getLocalPoint(t){return(t||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(t){return this.getInnerPoint(t)}getLocal(t){return this.getLocalPoint(t)}getPage(){return this.getPagePoint()}static changeName(t,e){pe.changeName(t,e)}}const{min:Pd,max:Bd,abs:Sd}=Math,{float:Td,sign:kd}=D,{minX:Rd,maxX:Cd,minY:Ld,maxY:Od}=Nt,Dd=new jt,Id=new jt,Ad={limitMove(t,e){const{dragBounds:i,dragBoundsType:s}=t;i&&Md.getValidMove(t.__localBoxBounds,Md.getDragBounds(t),s,e,!0),Md.axisMove(t,e)},limitScaleOf(t,e,i,s){const{dragBounds:r,dragBoundsType:n}=t;r&&Md.getValidScaleOf(t.__localBoxBounds,Md.getDragBounds(t),n,t.getLocalPointByInner(t.getInnerPointByBox(e)),i,s,!0)},axisMove(t,e){const{draggable:i}=t;"x"===i&&(e.y=0),"y"===i&&(e.x=0)},getDragBounds(t){const{dragBounds:e}=t;return"parent"===e?t.parent.boxBounds:e},isInnerMode:(t,e,i,s)=>"inner"===i||"auto"===i&&t[s]>e[s],getValidMove(t,e,i,s,r){const n=t.x+s.x,o=t.y+s.y,a=n+t.width,h=o+t.height,l=e.x+e.width,d=e.y+e.height;return r||(s=Object.assign({},s)),Md.isInnerMode(t,e,i,"width")?n>e.x?s.x+=e.x-n:a<l&&(s.x+=l-a):n<e.x?s.x+=e.x-n:a>l&&(s.x+=l-a),Md.isInnerMode(t,e,i,"height")?o>e.y?s.y+=e.y-o:h<d&&(s.y+=d-h):o<e.y?s.y+=e.y-o:h>d&&(s.y+=d-h),s.x=Td(s.x),s.y=Td(s.y),s},getValidScaleOf(t,e,i,s,r,n,o){o||(r=Object.assign({},r)),Id.set(e),Dd.set(t).scaleOf(s,r.x,r.y);const h=(s.x-t.x)/t.width,l=1-h,d=(s.y-t.y)/t.height,c=1-d;let u,_,p,g,f=1,y=1;return Md.isInnerMode(t,e,i,"width")?(r.x<0&&Dd.scaleOf(s,f=1/r.x,1),p=Td(Dd.minX-Id.minX),g=Td(Id.maxX-Dd.maxX),u=h&&p>0?1+p/(h*Dd.width):1,_=l&&g>0?1+g/(l*Dd.width):1,f*=Bd(u,_)):(r.x<0&&((Td(Rd(t)-Rd(e))<=0||Td(Cd(e)-Cd(t))<=0)&&Dd.scaleOf(s,f=1/r.x,1),Dd.unsign()),p=Td(Id.minX-Dd.minX),g=Td(Dd.maxX-Id.maxX),u=h&&p>0?1-p/(h*Dd.width):1,_=l&&g>0?1-g/(l*Dd.width):1,f*=Pd(u,_)),Md.isInnerMode(t,e,i,"height")?(r.y<0&&Dd.scaleOf(s,1,y=1/r.y),p=Td(Dd.minY-Id.minY),g=Td(Id.maxY-Dd.maxY),u=d&&p>0?1+p/(d*Dd.height):1,_=c&&g>0?1+g/(c*Dd.height):1,y*=Bd(u,_),n&&(u=Bd(Sd(f),Sd(y)),f=kd(f)*u,y=kd(y)*u)):(r.y<0&&((Td(Ld(t)-Ld(e))<=0||Td(Od(e)-Od(t))<=0)&&Dd.scaleOf(s,1,y=1/r.y),Dd.unsign()),p=Td(Id.minY-Dd.minY),g=Td(Dd.maxY-Id.maxY),u=d&&p>0?1-p/(d*Dd.height):1,_=c&&g>0?1-g/(c*Dd.height):1,y*=Pd(u,_)),r.x*=a(f)?f:1,r.y*=a(y)?y:1,r}},Md=Ad;t.PointerEvent=class extends Ed{},t.PointerEvent.POINTER="pointer",t.PointerEvent.BEFORE_DOWN="pointer.before_down",t.PointerEvent.BEFORE_MOVE="pointer.before_move",t.PointerEvent.BEFORE_UP="pointer.before_up",t.PointerEvent.DOWN="pointer.down",t.PointerEvent.MOVE="pointer.move",t.PointerEvent.UP="pointer.up",t.PointerEvent.OVER="pointer.over",t.PointerEvent.OUT="pointer.out",t.PointerEvent.ENTER="pointer.enter",t.PointerEvent.LEAVE="pointer.leave",t.PointerEvent.TAP="tap",t.PointerEvent.DOUBLE_TAP="double_tap",t.PointerEvent.CLICK="click",t.PointerEvent.DOUBLE_CLICK="double_click",t.PointerEvent.LONG_PRESS="long_press",t.PointerEvent.LONG_TAP="long_tap",t.PointerEvent.MENU="pointer.menu",t.PointerEvent.MENU_TAP="pointer.menu_tap",t.PointerEvent=ye([qn()],t.PointerEvent);const Wd=t.PointerEvent,Fd={};t.DragEvent=class extends t.PointerEvent{static setList(t){this.list=t instanceof vh?t:new vh(t)}static setData(t){this.data=t}static getValidMove(t,e,i,s=!0){const r=t.getLocalPoint(i,null,!0);return ot.move(r,e.x-t.x,e.y-t.y),s&&this.limitMove(t,r),Ad.axisMove(t,r),r}static limitMove(t,e){Ad.limitMove(t,e)}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(Fd,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(Fd,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(Fd,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPagePoint(),i={};return Nt.set(i,e.x-t.x,e.y-t.y,t.x,t.y),Nt.unsign(i),i}assignMove(t){Fd.x=t?this.totalX:this.moveX,Fd.y=t?this.totalY:this.moveY}},t.DragEvent.BEFORE_DRAG="drag.before_drag",t.DragEvent.START="drag.start",t.DragEvent.DRAG="drag",t.DragEvent.END="drag.end",t.DragEvent.OVER="drag.over",t.DragEvent.OUT="drag.out",t.DragEvent.ENTER="drag.enter",t.DragEvent.LEAVE="drag.leave",t.DragEvent=ye([qn()],t.DragEvent);const Ud=t.DragEvent;t.DropEvent=class extends t.PointerEvent{static setList(e){t.DragEvent.setList(e)}static setData(e){t.DragEvent.setData(e)}},t.DropEvent.DROP="drop",t.DropEvent=ye([qn()],t.DropEvent),t.MoveEvent=class extends t.DragEvent{},t.MoveEvent.BEFORE_MOVE="move.before_move",t.MoveEvent.START="move.start",t.MoveEvent.MOVE="move",t.MoveEvent.DRAG_ANIMATE="move.drag_animate",t.MoveEvent.END="move.end",t.MoveEvent.PULL_DOWN="move.pull_down",t.MoveEvent.REACH_BOTTOM="move.reach_bottom",t.MoveEvent=ye([qn()],t.MoveEvent),t.TouchEvent=class extends Ed{},t.TouchEvent=ye([qn()],t.TouchEvent);const zd=t.TouchEvent;t.RotateEvent=class extends t.PointerEvent{},t.RotateEvent.BEFORE_ROTATE="rotate.before_rotate",t.RotateEvent.START="rotate.start",t.RotateEvent.ROTATE="rotate",t.RotateEvent.END="rotate.end",t.RotateEvent=ye([qn()],t.RotateEvent),t.SwipeEvent=class extends t.DragEvent{},t.SwipeEvent.SWIPE="swipe",t.SwipeEvent.LEFT="swipe.left",t.SwipeEvent.RIGHT="swipe.right",t.SwipeEvent.UP="swipe.up",t.SwipeEvent.DOWN="swipe.down",t.SwipeEvent=ye([qn()],t.SwipeEvent),t.ZoomEvent=class extends t.PointerEvent{},t.ZoomEvent.BEFORE_ZOOM="zoom.before_zoom",t.ZoomEvent.START="zoom.start",t.ZoomEvent.ZOOM="zoom",t.ZoomEvent.END="zoom.end",t.ZoomEvent=ye([qn()],t.ZoomEvent),t.KeyEvent=class extends Ed{},t.KeyEvent.BEFORE_DOWN="key.before_down",t.KeyEvent.BEFORE_UP="key.before_up",t.KeyEvent.DOWN="key.down",t.KeyEvent.HOLD="key.hold",t.KeyEvent.UP="key.up",t.KeyEvent=ye([qn()],t.KeyEvent);const Nd={getDragEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-e.x,moveY:i.y-e.y,totalX:i.x-t.x,totalY:i.y-t.y}),getDropEventData:(t,e,i)=>Object.assign(Object.assign({},t),{list:e,data:i}),getSwipeDirection:e=>e<-45&&e>-135?t.SwipeEvent.UP:e>45&&e<135?t.SwipeEvent.DOWN:e<=45&&e>=-45?t.SwipeEvent.RIGHT:t.SwipeEvent.LEFT,getSwipeEventData:(t,e,i)=>Object.assign(Object.assign({},i),{moveX:e.moveX,moveY:e.moveY,totalX:i.x-t.x,totalY:i.y-t.y,type:Yd.getSwipeDirection(ot.getAngle(t,i))}),getBase(t){const e=1===t.button?4:t.button;return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,time:Date.now(),buttons:r(t.buttons)?1:0===t.buttons?e:t.buttons,origin:t}},pathHasEventType(t,e){const{list:i}=t;for(let t=0,s=i.length;t<s;t++)if(i[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const i=new vh,{list:s}=t;for(let t=0,r=s.length;t<r;t++)s[t].hasEvent(e)&&i.add(s[t]);return i},pathCanDrag:e=>e&&e.list.some(e=>ao.draggable(e)||!e.isLeafer&&e.hasEvent(t.DragEvent.DRAG)),pathHasOutside:t=>t&&t.list.some(t=>t.isOutside)},Yd=Nd,Xd=new vh,{getDragEventData:Hd,getDropEventData:jd,getSwipeEventData:Vd}=Nd;class Gd{constructor(t){this.dragDataList=[],this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=Hd(t,t,t),this.canAnimate=this.canDragOut=!0}getList(e,i){const{proxy:s}=this.interaction.selector,r=s&&s.list.length,n=t.DragEvent.list||this.draggableList||Xd;return this.dragging&&(r?e?Xd:new vh(i?[...s.list,...s.dragHoverExclude]:s.list):n)}checkDrag(e,i){const{interaction:s}=this;if(this.moving&&e.buttons<1)return this.canAnimate=!1,void s.pointerCancel();!this.moving&&i&&(this.moving=s.canMove(this.downData)||s.isHoldRightKey||s.isMobileDragEmpty)&&(this.dragData.moveType="drag",s.emit(t.MoveEvent.START,this.dragData)),this.moving||this.dragStart(e,i),this.drag(e)}dragStart(e,i){this.dragging||(this.dragging=i&&bd.left(e),this.dragging&&(this.interaction.emit(t.DragEvent.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach(t=>this.dragStartPoints[t.innerId]={x:t.x,y:t.y})}getDraggableList(t){let e;for(let i=0,s=t.length;i<s;i++)if(e=t.list[i],ao.draggable(e)){this.draggableList=new vh(e);break}}drag(e){const{interaction:i,dragData:s,downData:r}=this,{path:n,throughPath:o}=r;this.dragData=Hd(r,s,e),o&&(this.dragData.throughPath=o),this.dragData.path=n,this.dragDataList.push(this.dragData),this.moving?(e.moving=!0,this.dragData.moveType="drag",i.emit(t.MoveEvent.BEFORE_MOVE,this.dragData),i.emit(t.MoveEvent.MOVE,this.dragData)):this.dragging&&(e.dragging=!0,this.dragReal(),i.emit(t.DragEvent.BEFORE_DRAG,this.dragData),i.emit(t.DragEvent.DRAG,this.dragData))}dragReal(e){const{interaction:i}=this,{running:s}=i,r=this.realDraggableList;if(r.length&&s){const{totalX:s,totalY:n}=this.dragData,{dragLimitAnimate:a}=i.p,l=!a||!!e;r.forEach(i=>{if(i.draggable){const r=o(i.draggable),d=t.DragEvent.getValidMove(i,this.dragStartPoints[i.innerId],{x:s,y:n},l||r);a&&!r&&e?ao.animateMove(i,d,h(a)?a:.3):i.move(d)}})}}dragOverOrOut(e){const{interaction:i}=this,{dragOverPath:s}=this,{path:r}=e;this.dragOverPath=r,s?r.indexAt(0)!==s.indexAt(0)&&(i.emit(t.DragEvent.OUT,e,s),i.emit(t.DragEvent.OVER,e,r)):i.emit(t.DragEvent.OVER,e,r)}dragEnterOrLeave(e){const{interaction:i}=this,{dragEnterPath:s}=this,{path:r}=e;i.emit(t.DragEvent.LEAVE,e,s,r),i.emit(t.DragEvent.ENTER,e,r,s),this.dragEnterPath=r}dragEnd(t){(this.dragging||this.moving)&&(this.checkDragEndAnimate(t)||this.dragEndReal(t))}dragEndReal(e){const{interaction:i,downData:s,dragData:r}=this;e||(e=r);const{path:n,throughPath:o}=s,a=Hd(s,e,e);if(o&&(a.throughPath=o),a.path=n,this.moving&&(this.moving=!1,a.moveType="drag",i.emit(t.MoveEvent.END,a)),this.dragging){const n=this.getList();this.dragging=!1,i.p.dragLimitAnimate&&this.dragReal(!0),i.emit(t.DragEvent.END,a),this.swipe(e,s,r,a),this.drop(e,n,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe(t,e,i,s){const{interaction:r}=this;if(ot.getDistance(e,t)>r.config.pointer.swipeDistance){const t=Vd(e,i,s);this.interaction.emit(t.type,t)}}drop(e,i,s){const r=jd(e,i,t.DragEvent.data);r.path=s,this.interaction.emit(t.DropEvent.DROP,r),this.interaction.emit(t.DragEvent.LEAVE,e,s)}dragReset(){t.DragEvent.list=t.DragEvent.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null,this.dragDataList=[]}checkDragEndAnimate(t,e){return!1}animate(t,e){}stopAnimate(){}checkDragOut(t){}autoMoveOnDragOut(t){}autoMoveCancel(){}destroy(){this.dragReset()}}const Kd=ee.get("emit");const qd=["move","zoom","rotate","key"];function Zd(t,e,i,s,r){if(qd.some(t=>e.startsWith(t))&&t.__.hitChildren&&!Qd(t,r)){let n;for(let o=0,a=t.children.length;o<a;o++)n=t.children[o],!i.path.has(n)&&n.__.hittable&&$d(n,e,i,s,r)}}function $d(t,e,i,s,r){if(t.destroyed)return!1;if(t.__.hitSelf&&!Qd(t,r)&&(nl.updateEventStyle&&!s&&nl.updateEventStyle(t,e),t.hasEvent(e,s))){i.phase=s?1:t===i.target?2:3;const r=pe.get(e,i);if(t.emitEvent(r,s),r.isStop)return!0}return!1}function Qd(t,e){return e&&e.has(t)}const Jd={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:tc,pathCanDrag:ec,pathHasOutside:ic}=Nd;class sc{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return!0===this.m.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&bd.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&bd.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&xd.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(t,e,i,s){this.config=_.clone(Jd),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=i,this.defaultPath=new vh(t),this.createTransformer(),this.dragger=new Gd(this),s&&(this.config=_.default(s,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(e,i){e||(e=this.hoverData),e&&(bd.defaultLeft(e),this.updateDownData(e),this.checkPath(e,i),this.downTime=Date.now(),this.emit(t.PointerEvent.BEFORE_DOWN,e),this.emit(t.PointerEvent.DOWN,e),bd.left(e)&&(this.tapWait(),this.longPressWait(e)),this.waitRightTap=bd.right(e),this.dragger.setDragData(e),this.isHoldRightKey||this.updateCursor(e))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&bd.defaultLeft(t);(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(e){if(this.emit(t.PointerEvent.BEFORE_MOVE,e,this.defaultPath),this.downData){const t=ot.getDistance(this.downData,e)>this.p.dragDistance;t&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(e,t)}this.dragger.moving||(this.updateHoverData(e),this.checkPath(e),this.emit(t.PointerEvent.MOVE,e),this.pointerHover(e),this.dragging&&(this.dragger.dragOverOrOut(e),this.dragger.dragEnterOrLeave(e))),this.updateCursor(this.downData||e)}pointerUp(e){const{downData:i}=this;if(e||(e=i),!i)return;bd.defaultLeft(e),e.multiTouch=i.multiTouch,this.findPath(e);const s=Object.assign(Object.assign({},e),{path:e.path.clone()});e.path.addList(i.path.list),this.checkPath(e),this.downData=null,this.emit(t.PointerEvent.BEFORE_UP,e),this.emit(t.PointerEvent.UP,e),this.touchLeave(e),e.isCancel||(this.tap(e),this.menuTap(e)),this.dragger.dragEnd(e),this.updateCursor(s)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}menu(e){this.findPath(e),this.emit(t.PointerEvent.MENU,e),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(e)}menuTap(e){this.waitRightTap&&this.waitMenuTap&&(this.emit(t.PointerEvent.MENU_TAP,e),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move(t){}zoom(t){}rotate(t){}transformEnd(){}wheel(t){}multiTouch(t,e){}keyDown(e){if(!this.config.keyEvent)return;this.emit(t.KeyEvent.BEFORE_DOWN,e,this.defaultPath);const{code:i}=e;this.downKeyMap[i]||(this.downKeyMap[i]=!0,xd.setDownCode(i),this.emit(t.KeyEvent.HOLD,e,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(t.KeyEvent.DOWN,e,this.defaultPath)}keyUp(e){if(!this.config.keyEvent)return;this.emit(t.KeyEvent.BEFORE_UP,e,this.defaultPath);const{code:i}=e;this.downKeyMap[i]=!1,xd.setUpCode(i),this.emit(t.KeyEvent.UP,e,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerHover(t){!this.canHover||this.dragging&&!this.p.dragHover||(t.path||(t.path=new vh),this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(e){const{path:i}=e,{overPath:s}=this;this.overPath=i,s?i.indexAt(0)!==s.indexAt(0)&&(this.emit(t.PointerEvent.OUT,e,s),this.emit(t.PointerEvent.OVER,e,i)):this.emit(t.PointerEvent.OVER,e,i)}pointerEnterOrLeave(e){let{path:i}=e;this.downData&&!this.moveMode&&(i=i.clone(),this.downData.path.forEach(t=>i.add(t)));const{enterPath:s}=this;this.enterPath=i,this.emit(t.PointerEvent.LEAVE,e,s,i),this.emit(t.PointerEvent.ENTER,e,i,s)}touchLeave(e){"touch"===e.pointerType&&this.enterPath&&(this.emit(t.PointerEvent.LEAVE,e),this.dragger.dragging&&this.emit(t.DropEvent.LEAVE,e))}tap(e){const{pointer:i}=this.config,s=this.longTap(e);if(!i.tapMore&&s)return;if(!this.waitTap)return;i.tapMore&&this.emitTap(e);const r=Date.now()-this.downTime,n=[t.PointerEvent.DOUBLE_TAP,t.PointerEvent.DOUBLE_CLICK].some(t=>tc(e.path,t));r<i.tapTime+50&&n?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(e)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{i.tapMore||(this.tapWaitCancel(),this.emitTap(e))},i.tapTime))):i.tapMore||(this.tapWaitCancel(),this.emitTap(e))}findPath(t,e){const{hitRadius:i,through:s}=this.p,{bottomList:r,target:n}=this;Qt.backgrounder||t.origin||n&&n.updateLayout();const o=this.selector.getByPoint(t,i,Object.assign({bottomList:r,name:t.type},e||{through:s}));return o.throughPath&&(t.throughPath=o.throughPath),t.path=o.path,o.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!(!e||!e.isApp)&&(e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer)}checkPath(t,e){(e||this.moveMode&&!ic(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||"auto"===this.m.drag&&!ec(t.path))&&!ic(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}stopDragAnimate(){this.dragger.stopAnimate()}updateDownData(t,e,i){const{downData:s}=this;!t&&s&&(t=s),t&&(this.findPath(t,e),i&&s&&t.path.addList(s.path.list),this.downData=t)}updateHoverData(e){e||(e=this.hoverData),e&&(this.findPath(e,{exclude:this.dragger.getList(!1,!0),name:t.PointerEvent.MOVE}),this.hoverData=e)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,i;const{path:s}=t;for(let t=0,r=s.length;t<r&&(e=s.list[t],i=e.syncEventer&&e.syncEventer.cursor||e.cursor,!i);t++);this.setCursor(i)}setCursor(t){this.cursor=t}getLocal(t,e){const i=this.canvas.getClientBounds(e),s={x:t.clientX-i.x,y:t.clientY-i.y},{bounds:r}=this.canvas;return s.x*=r.width/i.width,s.y*=r.height/i.height,this.p.snap&&ot.round(s),s}emitTap(e){this.emit(t.PointerEvent.TAP,e),this.emit(t.PointerEvent.CLICK,e)}emitDoubleTap(e){this.emit(t.PointerEvent.DOUBLE_TAP,e),this.emit(t.PointerEvent.DOUBLE_CLICK,e)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait(e){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(t.PointerEvent.LONG_PRESS,e)},this.p.longPressTime)}longTap(e){let i;return this.longPressed&&(this.emit(t.PointerEvent.LONG_TAP,e),(tc(e.path,t.PointerEvent.LONG_TAP)||tc(e.path,t.PointerEvent.LONG_PRESS))&&(i=!0)),this.longPressWaitCancel(),i}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:t}=this.m;this.shrinkCanvasBounds=new jt(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(h(t)?t:2))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(qo.RESIZE,this.__onResize,this)],t.once(Jo.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,i,s){this.running&&function(t,e,i,s){if(!i&&!e.path)return;let r;e.type=t,i?e=Object.assign(Object.assign({},e),{path:i}):i=e.path,e.target=i.indexAt(0);try{for(let n=i.length-1;n>-1;n--){if(r=i.list[n],$d(r,t,e,!0,s))return;r.isApp&&Zd(r,t,e,!0,s)}for(let n=0,o=i.length;n<o;n++)if(r=i.list[n],r.isApp&&Zd(r,t,e,!1,s),$d(r,t,e,!1,s))return}catch(t){Kd.error(t)}}(t,e,i,s)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class rc{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}rc.custom={};class nc extends fe{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new vh,this.pixelList=new vh}getPixelType(t,e){return this.__autoClear(),this.pixelList.add(t),le.hitCanvas(e)}getPathType(t){return this.__autoClear(),this.pathList.add(t),le.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach(t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)}),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}Qt.getSelector=function(t){return t.leafer?t.leafer.selector:Qt.selector||(Qt.selector=le.selector())};const{toInnerRadiusPointOf:oc,copyRadiusPoint:ac}=ot,{hitRadiusPoint:hc,hitPoint:lc}=Nt,dc={},cc={},uc=t.Leaf.prototype;uc.hit=function(t,e=0){this.updateLayout(),ac(cc,t,e);const i=this.__world;return!!(e?hc(i,cc):lc(i,cc))&&(this.isBranch?Qt.getSelector(this).hitPoint(Object.assign({},cc),e,{target:this}):this.__hitWorld(cc))},uc.__hitWorld=function(t,e){const i=this.__;if(!i.hitSelf)return!1;const s=this.__world,r=this.__layout,n=s.width<10&&s.height<10;if(i.hitRadius&&(ac(dc,t,i.hitRadius),t=dc),oc(t,s,dc),i.hitBox||n){if(Nt.hitRadiusPoint(r.boxBounds,dc))return!0;if(n)return!1}return!r.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),r.boundsChanged||(r.hitCanvasChanged=!1)),this.__hit(dc,e)},uc.__hitFill=function(t){const e=this.__hitCanvas;return e&&e.hitFill(t,this.__.windingRule)},uc.__hitStroke=function(t,e){const i=this.__hitCanvas;return i&&i.hitStroke(t,e)},uc.__hitPixel=function(t){const e=this.__hitCanvas;return e&&e.hitPixel(t,this.__layout.renderBounds,e.hitScale)},uc.__drawHitPath=function(t){t&&this.__drawRenderPath(t)};const _c=new pt,pc=t.UI.prototype;pc.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:t}=this.leafer||this.parent&&this.parent.leafer||{};if(!t)return;const e=this.__,i=(e.__isAlphaPixelFill||e.__isCanvas)&&"pixel"===e.hitFill,s=e.__isAlphaPixelStroke&&"pixel"===e.hitStroke,r=i||s;this.__hitCanvas||(this.__hitCanvas=r?t.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):t.getPathType(this));const n=this.__hitCanvas;if(r){const{renderBounds:t}=this.__layout,r=Qt.image.hitCanvasSize,o=n.hitScale=Vt.set(0,0,r,r).getFitMatrix(t).a,{x:a,y:h,width:l,height:d}=Vt.set(t).scale(o);n.resize({width:l,height:d,pixelRatio:1}),n.clear(),en.patternLocked=!0,this.__renderShape(n,{matrix:_c.setWith(this.__world).scaleWith(1/o).invertWith().translate(-a,-h),snapshot:!0,ignoreFill:!i,ignoreStroke:!s}),en.patternLocked=!1,n.resetTransform(),e.__isHitPixel=!0}else e.__isHitPixel&&(e.__isHitPixel=!1);this.__drawHitPath(n),n.setStrokeOptions(e)},pc.__hit=function(t,e){if(this.__box&&this.__box.__hit(t))return!0;const i=this.__;if(i.__isHitPixel&&this.__hitPixel(t))return!0;const{hitFill:s}=i,r=(i.fill||i.__isCanvas)&&("path"===s||"pixel"===s&&!(i.__isAlphaPixelFill||i.__isCanvas))||"all"===s||e;if(r&&this.__hitFill(t))return!0;const{hitStroke:n,__maxStrokeWidth:o}=i,a=i.stroke&&("path"===n||"pixel"===n&&!i.__isAlphaPixelStroke)||"all"===n;if(!r&&!a)return!1;const h=2*t.radiusX;let l=h;if(a)switch(i.strokeAlign){case"inside":if(l+=2*o,!r&&this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h;break;case"center":l+=o;break;case"outside":if(l+=2*o,!r){if(!this.__hitFill(t)&&this.__hitStroke(t,l))return!0;l=h}}return!!l&&this.__hitStroke(t,l)};const gc=t.UI.prototype,fc=t.Rect.prototype,yc=t.Box.prototype;fc.__updateHitCanvas=yc.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&"pixel"===this.hitFill||"all"===this.hitStroke?gc.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},fc.__hitFill=yc.__hitFill=function(t){return this.__hitCanvas?gc.__hitFill.call(this,t):Nt.hitRadiusPoint(this.__layout.boxBounds,t)},t.Text.prototype.__drawHitPath=function(t){const{__lineHeight:e,fontSize:i,__baseLine:s,__letterSpacing:r,__textDrawData:n}=this.__;t.beginPath(),r<0?this.__drawPathByBox(t):n.rows.forEach(r=>t.rect(r.x,r.y-s,r.width,e<i?i:e))},t.Group.prototype.pick=function(t,e){return e||(e=s),this.updateLayout(),Qt.getSelector(this).getByPoint(t,e.hitRadius||0,Object.assign(Object.assign({},e),{target:this}))};const mc=Oe.prototype;mc.hitFill=function(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)},mc.hitStroke=function(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)},mc.hitPixel=function(t,e,i=1){let{x:s,y:r,radiusX:n,radiusY:o}=t;e&&(s-=e.x,r-=e.y),Vt.set(s-n,r-o,2*n,2*o).scale(i).ceil();const{data:a}=this.context.getImageData(Vt.x,Vt.y,Vt.width||1,Vt.height||1);for(let t=0,e=a.length;t<e;t+=4)if(a[t+3]>0)return!0;return a[3]>0};const vc={convert(t,e){const i=Nd.getBase(t),{x:s,y:r}=e,n=Object.assign(Object.assign({},i),{x:s,y:r,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===n.pointerType&&(n.tangentialPressure=t.tangentialPressure,n.tiltX=t.tiltX,n.tiltY=t.tiltY,n.twist=t.twist),n},convertMouse(t,e){const i=Nd.getBase(t),{x:s,y:r}=e;return Object.assign(Object.assign({},i),{x:s,y:r,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const i=vc.getTouch(t),s=Nd.getBase(t),{x:r,y:n}=e;return Object.assign(Object.assign({},s),{x:r,y:n,width:1,height:1,pointerType:"touch",multiTouch:t.touches.length>1,pressure:i.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},wc={convert(t){const e=Nd.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{pathCanDrag:xc}=Nd;class bc extends sc{get notPointer(){const{p:t}=this;return"pointer"!==t.type||t.touch||this.useMultiTouch}get notTouch(){const{p:t}=this;return"mouse"===t.type||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let i in e)e[i]=e[i].bind(this),t.addEventListener(i,e[i]);for(let t in i)i[t]=i[t].bind(this),window.addEventListener(t,i[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(wc.convert(t))}onKeyUp(t){this.keyUp(wc.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(vc.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(vc.convert(t,this.getLocal(t))))}onPointerMove(t,e){if(this.notPointer||this.preventWindowPointer(t))return;this.usePointer||(this.usePointer=!0);const i=vc.convert(t,this.getLocal(t,!0));e?this.pointerHover(i):this.pointerMove(i)}onPointerLeave(t){this.onPointerMove(t,!0)}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.notPointer||this.preventWindowPointer(t)||this.pointerUp(vc.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.notMouse||this.pointerDown(vc.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.notMouse||this.preventWindowPointer(t)||this.pointerMove(vc.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.notMouse||this.preventWindowPointer(t)||this.pointerUp(vc.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(t){const e=vc.getTouch(t),i=this.getLocal(e,!0),{preventDefault:s}=this.config.touch;(!0===s||"auto"===s&&xc(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(vc.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.notTouch||this.preventWindowPointer(t))return;const e=vc.getTouch(t);this.pointerMove(vc.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const e=vc.getTouch(t);this.pointerUp(vc.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(Nd.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const s=[];return t.forEach(t=>{i=e.find(e=>e.identifier===t.identifier),i&&s.push({from:this.getLocal(t),to:this.getLocal(i)})}),s}getLocalTouchs(t){return t.map(t=>this.getLocal(t))}onWheel(t){this.preventDefaultWheel(t),this.wheel(Object.assign(Object.assign(Object.assign({},Nd.getBase(t)),this.getLocal(t)),{deltaX:t.deltaX,deltaY:t.deltaY}))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=Nd.getBase(t);Object.assign(e,this.getLocal(t));const i=t.scale/this.lastGestureScale,s=(t.rotation-this.lastGestureRotation)/Math.PI*180*(D.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},e),{scale:i*i})),this.rotate(Object.assign(Object.assign({},e),{rotation:s})),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),c(e[e.length-1])&&e.push("default"),this.canvas.view.style.cursor=e.map(t=>c(t)?`url(${t.url}) ${t.x||0} ${t.y||0}`:t).join(",")}eachCursor(t,e,i=0){if(i++,d(t))t.forEach(t=>this.eachCursor(t,e,i));else{const s=o(t)&&rc.get(t);s&&i<2?this.eachCursor(s,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Ec(t,e,i){t.__.__font?Jh.fillText(t,e,i):t.__.windingRule?e.fill(t.__.windingRule):e.fill()}function Pc(t,e,i,s,r){const n=i.__;c(t)?Jh.drawStrokesStyle(t,e,!1,i,s,r):(s.setStroke(t,n.__strokeWidth*e,n),s.stroke()),n.__useArrow&&Jh.strokeArrow(t,i,s,r)}function Bc(t,e,i,s,r){const n=i.__;c(t)?Jh.drawStrokesStyle(t,e,!0,i,s,r):(s.setStroke(t,n.__strokeWidth*e,n),Jh.drawTextStroke(i,s,r))}function Sc(t,e,i,s,r){const n=s.getSameCanvas(!0,!0);n.font=i.__.__font,Bc(t,2,i,n,r),n.blendMode="outside"===e?"destination-out":"destination-in",Jh.fillText(i,n,r),n.blendMode="normal",ao.copyCanvasByWorld(i,s,n),n.recycle(i.__nowWorld)}const{getSpread:Tc,copyAndSpread:kc,toOuterOf:Rc,getOuterOf:Cc,getByMove:Lc,move:Oc,getIntersectData:Dc}=Nt,Ic={};let Ac;const{stintSet:Mc}=_,{hasTransparent:Wc}=Zh;function Fc(t,e,i){if(!c(e)||!1===e.visible||0===e.opacity)return;let s;const{boxBounds:n}=i.__layout;switch(e.type){case"image":if(!e.url)return;s=tl.image(i,t,e,n,!Ac||!Ac[e.url]);break;case"linear":s=el.linearGradient(e,n);break;case"radial":s=el.radialGradient(e,n);break;case"angular":s=el.conicGradient(e,n);break;case"solid":const{type:o,color:a,opacity:h}=e;s={type:o,style:Zh.string(a,h)};break;default:r(e.r)||(s={type:"solid",style:Zh.string(e)})}if(s&&(s.originPaint=e,o(s.style)&&Wc(s.style)&&(s.isTransparent=!0),e.style)){if(0===e.style.strokeWidth)return;s.strokeStyle=e.style}return s}const Uc={compute:function(t,e){const i=e.__,s=[];let r,n,o,a=i.__input[t];d(a)||(a=[a]),Ac=tl.recycleImage(t,i);for(let i,r=0,n=a.length;r<n;r++)(i=Fc(t,a[r],e))&&(s.push(i),i.strokeStyle&&(o||(o=1),i.strokeStyle.strokeWidth&&(o=Math.max(o,i.strokeStyle.strokeWidth))));i["_"+t]=s.length?s:void 0,s.length?(s.every(t=>t.isTransparent)&&(s.some(t=>t.image)&&(r=!0),n=!0),"fill"===t?(Mc(i,"__isAlphaPixelFill",r),Mc(i,"__isTransparentFill",n)):(Mc(i,"__isAlphaPixelStroke",r),Mc(i,"__isTransparentStroke",n),Mc(i,"__hasMultiStrokeStyle",o))):i.__removePaint(t,!1)},fill:function(t,e,i,s){i.fillStyle=t,Ec(e,i,s)},fills:function(t,e,i,s){let r,n,o;for(let a=0,h=t.length;a<h;a++){if(r=t[a],n=r.originPaint,r.image){if(o?o++:o=1,tl.checkImage(r,!e.__.__font,e,i,s))continue;if(!r.style){1===o&&r.image.isPlacehold&&e.drawImagePlaceholder(r,i,s);continue}}if(i.fillStyle=r.style,r.transform||n.scaleFixed){if(i.save(),r.transform&&i.transform(r.transform),n.scaleFixed){const{scaleX:t,scaleY:s}=e.getRenderScaleData(!0);(!0===n.scaleFixed||"zoom-in"===n.scaleFixed&&t>1&&s>1)&&i.scale(1/t,1/s)}n.blendMode&&(i.blendMode=n.blendMode),Ec(e,i,s),i.restore()}else n.blendMode?(i.saveBlendMode(n.blendMode),Ec(e,i,s),i.restoreBlendMode()):Ec(e,i,s)}},fillPathOrText:Ec,fillText:function(t,e,i){const s=t.__,{rows:r,decorationY:n}=s.__textDrawData;let o;s.__isPlacehold&&s.placeholderColor&&(e.fillStyle=s.placeholderColor);for(let t=0,i=r.length;t<i;t++)o=r[t],o.text?e.fillText(o.text,o.x,o.y):o.data&&o.data.forEach(t=>{e.fillText(t.char,t.x,o.y)});if(n){const{decorationColor:t,decorationHeight:i}=s.__textDrawData;t&&(e.fillStyle=t),r.forEach(t=>n.forEach(s=>e.fillRect(t.x,t.y+s,t.width,i)))}},stroke:function(t,e,i,s){const r=e.__;if(r.__strokeWidth)if(r.__font)Jh.strokeText(t,e,i,s);else switch(r.strokeAlign){case"center":Pc(t,1,e,i,s);break;case"inside":!function(t,e,i,s){i.save(),i.clipUI(e),Pc(t,2,e,i,s),i.restore()}(t,e,i,s);break;case"outside":!function(t,e,i,s){const r=e.__;if(r.__fillAfterStroke)Pc(t,2,e,i,s);else{const{renderBounds:n}=e.__layout,o=i.getSameCanvas(!0,!0);e.__drawRenderPath(o),Pc(t,2,e,o,s),o.clipUI(r),o.clearWorld(n),ao.copyCanvasByWorld(e,i,o),o.recycle(e.__nowWorld)}}(t,e,i,s)}},strokes:function(t,e,i,s){Jh.stroke(t,e,i,s)},strokeText:function(t,e,i,s){switch(e.__.strokeAlign){case"center":Bc(t,1,e,i,s);break;case"inside":Sc(t,"inside",e,i,s);break;case"outside":e.__.__fillAfterStroke?Bc(t,2,e,i,s):Sc(t,"outside",e,i,s)}},drawTextStroke:function(t,e,i){let s,r=t.__.__textDrawData;const{rows:n,decorationY:o}=r;for(let t=0,i=n.length;t<i;t++)s=n[t],s.text?e.strokeText(s.text,s.x,s.y):s.data&&s.data.forEach(t=>{e.strokeText(t.char,t.x,s.y)});if(o){const{decorationHeight:t}=r;n.forEach(i=>o.forEach(s=>e.strokeRect(i.x,i.y+s,i.width,t)))}},drawStrokesStyle:function(t,e,i,s,r,n){let o;const a=s.__,{__hasMultiStrokeStyle:h}=a;h||r.setStroke(void 0,a.__strokeWidth*e,a);for(let l=0,d=t.length;l<d;l++)if(o=t[l],(!o.image||!tl.checkImage(o,!1,s,r,n))&&o.style){if(h){const{strokeStyle:t}=o;t?r.setStroke(o.style,a.__getRealStrokeWidth(t)*e,a,t):r.setStroke(o.style,a.__strokeWidth*e,a)}else r.strokeStyle=o.style;o.originPaint.blendMode?(r.saveBlendMode(o.originPaint.blendMode),i?Jh.drawTextStroke(s,r,n):r.stroke(),r.restoreBlendMode()):i?Jh.drawTextStroke(s,r,n):r.stroke()}},shape:function(t,e,i){const s=e.getSameCanvas(),r=e.bounds,n=t.__nowWorld,o=t.__layout,a=t.__nowWorldShapeBounds||(t.__nowWorldShapeBounds={});let h,l,d,c,u,_;Rc(o.strokeSpread?(kc(Ic,o.boxBounds,o.strokeSpread),Ic):o.boxBounds,n,a);let{scaleX:p,scaleY:g}=t.getRenderScaleData(!0);if(r.includes(a))_=s,h=u=a,l=n;else{let s;if(Qt.fullImageShadow)s=a;else{const t=o.renderShapeSpread?Tc(r,E.swapAndScale(o.renderShapeSpread,p,g)):r;s=Dc(t,a)}c=r.getFitMatrix(s);let{a:f,d:y}=c;c.a<1&&(_=e.getSameCanvas(),t.__renderShape(_,i),p*=f,g*=y),u=Cc(a,c),h=Lc(u,-c.e,-c.f),l=Cc(n,c),Oc(l,-c.e,-c.f);const m=i.matrix;m?(d=new pt(c),d.multiply(m),f*=m.scaleX,y*=m.scaleY):d=c,d.withScale(f,y),i=Object.assign(Object.assign({},i),{matrix:d})}return t.__renderShape(s,i),{canvas:s,matrix:d,fitMatrix:c,bounds:h,renderBounds:l,worldCanvas:_,shapeBounds:u,scaleX:p,scaleY:g}}};let zc,Nc=new jt;const{isSame:Yc}=Nt;function Xc(t,e,i,s,r,n){if("fill"===e&&!t.__.__naturalWidth){const e=t.__;if(e.__naturalWidth=s.width/e.pixelRatio,e.__naturalHeight=s.height/e.pixelRatio,e.__autoSide)return t.forceUpdate("width"),t.__proxyData&&(t.setProxyAttr("width",e.width),t.setProxyAttr("height",e.height)),!1}return r.data||tl.createData(r,s,i,n),!0}function Hc(t,e){Gc(t,Yo.LOAD,e)}function jc(t,e){Gc(t,Yo.LOADED,e)}function Vc(t,e,i){e.error=i,t.forceUpdate("surface"),Gc(t,Yo.ERROR,e)}function Gc(t,e,i){t.hasEvent(e)&&t.emitEvent(new Yo(e,i))}function Kc(t,e){const{leafer:i}=t;i&&i.viewReady&&(i.renderer.ignore=e)}const{get:qc,translate:Zc}=K,$c=new jt,Qc={},Jc={};function tu(t,e,i,s){const r=o(t)||s?(s?i-s*e:i%e)/((s||Math.floor(i/e))-1):t;return"auto"===t&&r<0?0:r}let eu={},iu={a:1,b:0,c:0,d:1,e:0,f:0};const{get:su,set:ru,rotateOfOuter:nu,translate:ou,scaleOfOuter:au,multiplyParent:hu,scale:lu,rotate:du,skew:cu}=K;function uu(t,e,i,s,r,n,o,a){o&&du(t,o),a&&cu(t,a.x,a.y),r&&lu(t,r,n),ou(t,e.x+i,e.y+s)}const{get:_u,scale:pu,copy:gu}=K,{getFloorScale:fu}=D,{abs:yu}=Math;const mu={image:function(t,e,i,s,r){let n,o;const a=en.get(i);return zc&&i===zc.paint&&Yc(s,zc.boxBounds)?n=zc.leafPaint:(n={type:i.type,image:a},a.hasAlphaPixel&&(n.isTransparent=!0),zc=a.use>1?{leafPaint:n,paint:i,boxBounds:Nc.set(s)}:null),(r||a.loading)&&(o={image:a,attrName:e,attrValue:i}),a.ready?(Xc(t,e,i,a,n,s),r&&(Hc(t,o),jc(t,o))):a.error?r&&Vc(t,o,a.error):(r&&(Kc(t,!0),Hc(t,o)),n.loadId=a.load(()=>{Kc(t,!1),t.destroyed||(Xc(t,e,i,a,n,s)&&(a.hasAlphaPixel&&(t.__layout.hitCanvasChanged=!0),t.forceUpdate("surface")),jc(t,o)),n.loadId=void 0},e=>{Kc(t,!1),Vc(t,o,e),n.loadId=void 0},i.lod&&a.getThumbSize(i.lod)),t.placeholderColor&&(t.placeholderDelay?setTimeout(()=>{a.ready||(a.isPlacehold=!0,t.forceUpdate("surface"))},t.placeholderDelay):a.isPlacehold=!0)),n},checkImage:function(t,e,i,s,r){const{scaleX:n,scaleY:o}=tl.getImageRenderScaleData(t,i,s,r),{image:a,data:h,originPaint:l}=t,{exporting:d,snapshot:c}=r;return!(!h||t.patternId===n+"-"+o&&!d||c)&&(e&&(h.repeat?e=!1:l.changeful||"miniapp"===Qt.name&&qo.isResizing(i)||d||(e=Qt.image.isLarge(a,n,o)||a.width*n>8096||a.height*o>8096)),e?(i.__.__isFastShadow&&(s.fillStyle=t.style||"#000",s.fill()),tl.drawImage(t,n,o,i,s,r),!0):(!t.style||l.sync||d?tl.createPattern(t,i,s,r):tl.createPatternTask(t,i,s,r),!1))},drawImage:function(t,e,i,s,r,n){const{data:o,image:a}=t,{blendMode:h}=t.originPaint,{opacity:l,transform:d}=o,c=a.getFull(o.filters),u=s.__;let _,{width:p,height:g}=a;(_=d&&!d.onlyScale||u.path||u.cornerRadius)||l||h?(r.save(),_&&r.clipUI(s),h&&(r.blendMode=h),l&&(r.opacity*=l),d&&r.transform(d),r.drawImage(c,0,0,p,g),r.restore()):(o.scaleX&&(p*=o.scaleX,g*=o.scaleY),r.drawImage(c,0,0,p,g))},getImageRenderScaleData:function(t,e,i,s){const r=e.getRenderScaleData(!0,t.originPaint.scaleFixed),{data:n}=t;if(i){const{pixelRatio:t}=i;r.scaleX*=t,r.scaleY*=t}return n&&n.scaleX&&(r.scaleX*=Math.abs(n.scaleX),r.scaleY*=Math.abs(n.scaleY)),r},recycleImage:function(t,e){const i=e["_"+t];if(d(i)){let s,r,n,o,a;for(let h=0,l=i.length;h<l;h++)s=i[h],r=s.image,a=r&&r.url,a&&(n||(n={}),n[a]=!0,en.recyclePaint(s),r.loading&&(o||(o=e.__input&&e.__input[t]||[],d(o)||(o=[o])),r.unload(i[h].loadId,!o.some(t=>t.url===a))));return n}return null},createPatternTask:function(t,e,i,s){t.patternTask||(t.patternTask=en.patternTasker.add(()=>me(this,void 0,void 0,function*(){tl.createPattern(t,e,i,s),e.forceUpdate("surface")}),0,()=>(t.patternTask=null,i.bounds.hit(e.__nowWorld))))},createPattern:function(t,e,i,s){let{scaleX:r,scaleY:n}=tl.getImageRenderScaleData(t,e,i,s),o=r+"-"+n;if(t.patternId!==o&&!e.destroyed&&(!Qt.image.isLarge(t.image,r,n)||t.data.repeat)){const{image:i,data:s}=t,{transform:a,gap:h}=s,l=tl.getPatternFixScale(t,r,n);let d,c,u,{width:_,height:p}=i;l&&(r*=l,n*=l),_*=r,p*=n,h&&(c=h.x*r/yu(s.scaleX||1),u=h.y*n/yu(s.scaleY||1)),(a||1!==r||1!==n)&&(r*=fu(_+(c||0)),n*=fu(p+(u||0)),d=_u(),a&&gu(d,a),pu(d,1/r,1/n));const g=i.getCanvas(_,p,s.opacity,s.filters,c,u,e.leafer&&e.leafer.config.smooth,s.interlace),f=i.getPattern(g,s.repeat||Qt.origin.noRepeat||"no-repeat",d,t);t.style=f,t.patternId=o}},getPatternFixScale:function(t,e,i){const{image:s}=t;let r,n=Qt.image.maxPatternSize,o=s.width*s.height;return s.isSVG?e>1&&(r=Math.ceil(e)/e):n>o&&(n=o),(o*=e*i)>n&&(r=Math.sqrt(n/o)),r},createData:function(t,e,i,s){t.data=tl.getPatternData(i,s,e)},getPatternData:function(t,e,i){t.padding&&(e=$c.set(e).shrink(t.padding)),"strench"===t.mode&&(t.mode="stretch");const{width:s,height:r}=i,{opacity:n,mode:a,align:l,offset:d,scale:u,size:_,rotation:p,skew:g,clipSize:f,repeat:y,gap:m,filters:v,interlace:w}=t,x=e.width===s&&e.height===r,b={mode:a},E="center"!==l&&(p||0)%180==90;let P,B;switch(Nt.set(Jc,0,0,E?r:s,E?s:r),a&&"cover"!==a&&"fit"!==a?((u||_)&&(D.getScaleData(u,_,i,Qc),P=Qc.scaleX,B=Qc.scaleY),(l||m||y)&&(P&&Nt.scale(Jc,P,B,!0),l&&Pt.toPoint(l,Jc,e,Jc,!0,!0))):x&&!p||(P=B=Nt.getFitScale(e,Jc,"fit"!==a),Nt.put(e,i,l,P,!1,Jc),Nt.scale(Jc,P,B,!0)),d&&ot.move(Jc,d),a){case"stretch":x?P&&(P=B=void 0):(P=e.width/s,B=e.height/r,tl.stretchMode(b,e,P,B));break;case"normal":case"clip":if(Jc.x||Jc.y||P||f||p||g){let t,i;f&&(t=e.width/f.width,i=e.height/f.height),tl.clipMode(b,e,Jc.x,Jc.y,P,B,p,g,t,i),t&&(P=P?P*t:t,B=B?B*i:i)}break;case"repeat":(!x||P||p||g)&&tl.repeatMode(b,e,s,r,Jc.x,Jc.y,P,B,p,g,l,t.freeTransform),y||(b.repeat="repeat");const i=c(y);(m||i)&&(b.gap=function(t,e,i,s,r){let n,o;c(t)?(n=t.x,o=t.y):n=o=t;return{x:tu(n,i,r.width,e&&e.x),y:tu(o,s,r.height,e&&e.y)}}(m,i&&y,Jc.width,Jc.height,e));break;default:P&&tl.fillOrFitMode(b,e,Jc.x,Jc.y,P,B,p)}return b.transform||(e.x||e.y)&&Zc(b.transform=qc(),e.x,e.y),P&&(b.scaleX=P,b.scaleY=B),n&&n<1&&(b.opacity=n),v&&(b.filters=v),y&&(b.repeat=o(y)?"x"===y?"repeat-x":"repeat-y":"repeat"),w&&(b.interlace=h(w)||"percent"===w.type?{type:"x",offset:w}:w),b},stretchMode:function(t,e,i,s){const r=su(),{x:n,y:o}=e;n||o?ou(r,n,o):r.onlyScale=!0,lu(r,i,s),t.transform=r},fillOrFitMode:function(t,e,i,s,r,n,o){const a=su();ou(a,e.x+i,e.y+s),lu(a,r,n),o&&nu(a,{x:e.x+e.width/2,y:e.y+e.height/2},o),t.transform=a},clipMode:function(t,e,i,s,r,n,o,a,h,l){const d=su();uu(d,e,i,s,r,n,o,a),h&&(o||a?(ru(iu),au(iu,e,h,l),hu(d,iu)):au(d,e,h,l)),t.transform=d},repeatMode:function(t,e,i,s,r,n,o,a,h,l,d,c){const u=su();if(c)uu(u,e,r,n,o,a,h,l);else{if(h)if("center"===d)nu(u,{x:i/2,y:s/2},h);else switch(du(u,h),h){case 90:ou(u,s,0);break;case 180:ou(u,i,s);break;case 270:ou(u,0,i)}eu.x=e.x+r,eu.y=e.y+n,ou(u,eu.x,eu.y),o&&au(u,eu,o,a)}t.transform=u}},{toPoint:vu}=xt,{hasTransparent:wu}=Zh,xu={},bu={};function Eu(t,e,i,s){if(i){let r,n,a,h;for(let t=0,l=i.length;t<l;t++)r=i[t],o(r)?(a=t/(l-1),n=Zh.string(r,s)):(a=r.offset,n=Zh.string(r.color,s)),e.addColorStop(a,n),!h&&wu(n)&&(h=!0);h&&(t.isTransparent=!0)}}const{getAngle:Pu,getDistance:Bu}=ot,{get:Su,rotateOfOuter:Tu,scaleOfOuter:ku}=K,{toPoint:Ru}=xt,Cu={},Lu={};function Ou(t,e,i,s,r){let n;const{width:o,height:a}=t;if(o!==a||s){const t=Pu(e,i);n=Su(),r?(ku(n,e,o/a*(s||1),1),Tu(n,e,t+90)):(ku(n,e,1,o/a*(s||1)),Tu(n,e,t))}return n}const{getDistance:Du}=ot,{toPoint:Iu}=xt,Au={},Mu={};const Wu={linearGradient:function(t,e){let{from:i,to:s,type:r,opacity:n}=t;vu(i||"top",e,xu),vu(s||"bottom",e,bu);const o=Qt.canvas.createLinearGradient(xu.x,xu.y,bu.x,bu.y),a={type:r,style:o};return Eu(a,o,t.stops,n),a},radialGradient:function(t,e){let{from:i,to:s,type:r,opacity:n,stretch:o}=t;Ru(i||"center",e,Cu),Ru(s||"bottom",e,Lu);const a=Qt.canvas.createRadialGradient(Cu.x,Cu.y,0,Cu.x,Cu.y,Bu(Cu,Lu)),h={type:r,style:a};Eu(h,a,t.stops,n);const l=Ou(e,Cu,Lu,o,!0);return l&&(h.transform=l),h},conicGradient:function(t,e){let{from:i,to:s,type:r,opacity:n,stretch:o}=t;Iu(i||"center",e,Au),Iu(s||"bottom",e,Mu);const a=Qt.conicGradientSupport?Qt.canvas.createConicGradient(0,Au.x,Au.y):Qt.canvas.createRadialGradient(Au.x,Au.y,0,Au.x,Au.y,Du(Au,Mu)),h={type:r,style:a};Eu(h,a,t.stops,n);const l=Ou(e,Au,Mu,o||1,Qt.conicGradientRotate90);return l&&(h.transform=l),h},getTransform:Ou},{copy:Fu,move:Uu,toOffsetOutBounds:zu}=Nt,{max:Nu,abs:Yu}=Math,Xu={},Hu=new pt,ju={};function Vu(t,e){let i,s,r,n,o=0,a=0,h=0,l=0;return e.forEach(t=>{i=t.x||0,s=t.y||0,n=1.5*(t.blur||0),r=Yu(t.spread||0),o=Nu(o,r+n-s),a=Nu(a,r+n+i),h=Nu(h,r+n+s),l=Nu(l,r+n-i)}),o===a&&a===h&&h===l?o:[o,a,h,l]}function Gu(t,e,i){const{shapeBounds:s}=i;let r,n;Qt.fullImageShadow?(Fu(Xu,t.bounds),Uu(Xu,e.x-s.x,e.y-s.y),r=t.bounds,n=Xu):(r=s,n=e),t.copyWorld(i.canvas,r,n)}const{toOffsetOutBounds:Ku}=Nt,qu={};const Zu=Vu;const $u={shadow:function(t,e,i){let s,r;const{__nowWorld:n}=t,{shadow:o}=t.__,{worldCanvas:a,bounds:h,renderBounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=o.length-1;zu(h,ju,l),o.forEach((o,g)=>{let f=1;if(o.scaleFixed){const t=Math.abs(n.scaleX);t>1&&(f=1/t)}_.setWorldShadow(ju.offsetX+(o.x||0)*c*f,ju.offsetY+(o.y||0)*u*f,(o.blur||0)*c*f,Zh.string(o.color)),r=il.getShadowTransform(t,_,i,o,ju,f),r&&_.setTransform(r),Gu(_,ju,i),r&&_.resetTransform(),s=l,o.box&&(_.restore(),_.save(),a&&(_.copyWorld(_,l,n,"copy"),s=n),a?_.copyWorld(a,n,n,"destination-out"):_.copyWorld(i.canvas,d,h,"destination-out")),ao.copyCanvasByWorld(t,e,_,s,o.blendMode),p&&g<p&&_.clearWorld(s)}),_.recycle(s)},innerShadow:function(t,e,i){let s,r;const{__nowWorld:n}=t,{innerShadow:o}=t.__,{worldCanvas:a,bounds:h,renderBounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=o.length-1;Ku(h,qu,l),o.forEach((o,g)=>{let f=1;if(o.scaleFixed){const t=Math.abs(n.scaleX);t>1&&(f=1/t)}_.save(),_.setWorldShadow(qu.offsetX+(o.x||0)*c*f,qu.offsetY+(o.y||0)*u*f,(o.blur||0)*c*f),r=il.getShadowTransform(t,_,i,o,qu,f,!0),r&&_.setTransform(r),Gu(_,qu,i),_.restore(),a?(_.copyWorld(_,l,n,"copy"),_.copyWorld(a,n,n,"source-out"),s=n):(_.copyWorld(i.canvas,d,h,"source-out"),s=l),_.fillWorld(s,Zh.string(o.color),"source-in"),ao.copyCanvasByWorld(t,e,_,s,o.blendMode),p&&g<p&&_.clearWorld(s)}),_.recycle(s)},blur:function(t,e,i){const{blur:s}=t.__;i.setWorldBlur(s*t.__nowWorld.a),i.copyWorldToInner(e,t.__nowWorld,t.__layout.renderBounds),i.filter="none"},backgroundBlur:function(t,e,i){},getShadowRenderSpread:Vu,getShadowTransform:function(t,e,i,s,r,n,o){if(s.spread){const i=2*s.spread*n*(o?-1:1),{width:a,height:h}=t.__layout.strokeBounds;return Hu.set().scaleOfOuter({x:(r.x+r.width/2)*e.pixelRatio,y:(r.y+r.height/2)*e.pixelRatio},1+i/a,1+i/h),Hu}},isTransformShadow(t){},getInnerShadowSpread:Zu},{excludeRenderBounds:Qu}=fo;let Ju;function t_(t,e,i,s,r,n,o,a){switch(e){case"grayscale":Ju||(Ju=!0,r.useGrayscaleAlpha(t.__nowWorld));case"alpha":!function(t,e,i,s,r,n){const o=t.__nowWorld;i.resetTransform(),i.opacity=1,i.useMask(s,o),n&&s.recycle(o);i_(t,e,i,1,r,n)}(t,i,s,r,o,a);break;case"opacity-path":i_(t,i,s,n,o,a);break;case"path":a&&i.restore()}}function e_(t){return t.getSameCanvas(!1,!0)}function i_(t,e,i,s,r,n){const o=t.__nowWorld;e.resetTransform(),e.opacity=s,e.copyWorld(i,o,void 0,r),n?i.recycle(o):i.clearWorld(o)}t.Group.prototype.__renderMask=function(t,e){let i,s,r,n,o,a;const{children:h}=this;for(let l=0,d=h.length;l<d;l++){if(i=h[l],a=i.__.mask,a){o&&(t_(this,o,t,r,s,n,void 0,!0),s=r=null),"clipping"!==a&&"clipping-path"!==a||Qu(i,e)||i.__render(t,e),n=i.__.opacity,Ju=!1,"path"===a||"clipping-path"===a?(n<1?(o="opacity-path",r||(r=e_(t))):(o="path",t.save()),i.__clip(r||t,e)):(o="grayscale"===a?"grayscale":"alpha",s||(s=e_(t)),r||(r=e_(t)),i.__render(s,e));continue}const d=1===n&&i.__.__blendMode;d&&t_(this,o,t,r,s,n,void 0,!1),Qu(i,e)||i.__render(r||t,e),d&&t_(this,o,t,r,s,n,d,!1)}t_(this,o,t,r,s,n,void 0,!0)};const s_=">)]}%!?,.:;'\"",r_=s_+"_#~&*+\\=|",n_=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`).join("|"));function o_(t){const e={};return t.split("").forEach(t=>e[t]=!0),e}const a_=o_("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),h_=o_("{[(<'\""),l_=o_(s_),d_=o_(r_),c_=o_("- ");var u_;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}(u_||(u_={}));const{Letter:__,Single:p_,Before:g_,After:f_,Symbol:y_,Break:m_}=u_;function v_(t){return a_[t]?__:c_[t]?m_:h_[t]?g_:l_[t]?f_:d_[t]?y_:n_.test(t)?p_:__}const w_={trimRight(t){const{words:e}=t;let i,s=0,r=e.length;for(let n=r-1;n>-1&&(i=e[n].data[0]," "===i.char);n--)s++,t.width-=i.width;s&&e.splice(r-s,s)}};function x_(t,e,i){switch(e){case"title":return i?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:b_}=w_,{Letter:E_,Single:P_,Before:B_,After:S_,Symbol:T_,Break:k_}=u_;let R_,C_,L_,O_,D_,I_,A_,M_,W_,F_,U_,z_,N_,Y_,X_,H_,j_,V_=[];function G_(t,e){W_&&!M_&&(M_=W_),R_.data.push({char:t,width:e}),L_+=e}function K_(){O_+=L_,R_.width=L_,C_.words.push(R_),R_={data:[]},L_=0}function q_(){Y_&&(X_.paraNumber++,C_.paraStart=!0,Y_=!1),W_&&(C_.startCharSize=M_,C_.endCharSize=W_,M_=0),C_.width=O_,H_.width?b_(C_):j_&&Z_(),V_.push(C_),C_={words:[]},O_=0}function Z_(){O_>(X_.maxWidth||0)&&(X_.maxWidth=O_)}const{top:$_,right:Q_,bottom:J_,left:tp}=t.Direction4;function ep(t,e,i){const{bounds:s,rows:r}=t;s[e]+=i;for(let t=0;t<r.length;t++)r[t][e]+=i}const ip={getDrawData:function(t,e){o(t)||(t=String(t));let i=0,s=0,r=e.__getInput("width")||0,n=e.__getInput("height")||0;const{__padding:a}=e;a&&(r?(i=a[tp],r-=a[Q_]+a[tp],!r&&(r=.01)):e.autoSizeAlign||(i=a[tp]),n?(s=a[$_],n-=a[$_]+a[J_],!n&&(n=.01)):e.autoSizeAlign||(s=a[$_]));const h={bounds:{x:i,y:s,width:r,height:n},rows:[],paraNumber:0,font:Qt.canvas.font=e.__font};return function(t,e,i){X_=t,V_=t.rows,H_=t.bounds,j_=!H_.width&&!i.autoSizeAlign;const{__letterSpacing:s,paraIndent:r,textCase:n}=i,{canvas:o}=Qt,{width:a}=H_;if(i.__isCharMode){const t="none"!==i.textWrap,h="break"===i.textWrap;Y_=!0,U_=null,M_=A_=W_=L_=O_=0,R_={data:[]},C_={words:[]},s&&(e=[...e]);for(let i=0,l=e.length;i<l;i++)I_=e[i],"\n"===I_?(L_&&K_(),C_.paraEnd=!0,q_(),Y_=!0):(F_=v_(I_),F_===E_&&"none"!==n&&(I_=x_(I_,n,!L_)),A_=o.measureText(I_).width,s&&(s<0&&(W_=A_),A_+=s),z_=F_===P_&&(U_===P_||U_===E_)||U_===P_&&F_!==S_,N_=!(F_!==B_&&F_!==P_||U_!==T_&&U_!==S_),D_=Y_&&r?a-r:a,t&&a&&O_+L_+A_>D_&&(h?(L_&&K_(),O_&&q_()):(N_||(N_=F_===E_&&U_==S_),z_||N_||F_===k_||F_===B_||F_===P_||L_+A_>D_?(L_&&K_(),O_&&q_()):O_&&q_()))," "===I_&&!0!==Y_&&O_+L_===0||(F_===k_?(" "===I_&&L_&&K_(),G_(I_,A_),K_()):z_||N_?(L_&&K_(),G_(I_,A_)):G_(I_,A_)),U_=F_);L_&&K_(),O_&&q_(),V_.length>0&&(V_[V_.length-1].paraEnd=!0)}else e.split("\n").forEach(t=>{X_.paraNumber++,O_=o.measureText(t).width,V_.push({x:r||0,text:t,width:O_,paraStart:!0}),j_&&Z_()})}(h,t,e),a&&function(t,e,i,s,r){if(!s&&i.autoSizeAlign)switch(i.textAlign){case"left":ep(e,"x",t[tp]);break;case"right":ep(e,"x",-t[Q_])}if(!r&&i.autoSizeAlign)switch(i.verticalAlign){case"top":ep(e,"y",t[$_]);break;case"bottom":ep(e,"y",-t[J_])}}(a,h,e,r,n),function(t,e){const{rows:i,bounds:s}=t,r=i.length,{__lineHeight:n,__baseLine:o,__letterSpacing:a,__clipText:h,textAlign:l,verticalAlign:d,paraSpacing:c,autoSizeAlign:u}=e;let{x:_,y:p,width:g,height:f}=s,y=n*r+(c?c*(t.paraNumber-1):0),m=o;if(h&&y>f)y=Math.max(f,n),r>1&&(t.overflow=r);else if(f||u)switch(d){case"middle":p+=(f-y)/2;break;case"bottom":p+=f-y}m+=p;let v,w,x,b=g||u?g:t.maxWidth;for(let o=0,d=r;o<d;o++){if(v=i[o],v.x=_,v.width<g||v.width>g&&!h)switch(l){case"center":v.x+=(b-v.width)/2;break;case"right":v.x+=b-v.width}v.paraStart&&c&&o>0&&(m+=c),v.y=m,m+=n,t.overflow>o&&m>y&&(v.isOverflow=!0,t.overflow=o+1),w=v.x,x=v.width,a<0&&(v.width<0?(x=-v.width+e.fontSize+a,w-=x,x+=e.fontSize):x-=a),w<s.x&&(s.x=w),x>s.width&&(s.width=x),h&&g&&g<x&&(v.isOverflow=!0,t.overflow||(t.overflow=i.length))}s.y=p,s.height=y}(h,e),e.__isCharMode&&function(t,e,i){const{rows:s}=t,{textAlign:r,paraIndent:n,__letterSpacing:o}=e,a=i&&r.includes("both"),h=a||i&&r.includes("justify"),l=h&&r.includes("letter");let d,c,u,_,p,g,f,y,m,v;s.forEach(t=>{t.words&&(p=n&&t.paraStart?n:0,y=t.words.length,h&&(v=!t.paraEnd||a,c=i-t.width-p,l?_=c/(t.words.reduce((t,e)=>t+e.data.length,0)-1):u=y>1?c/(y-1):0),g=o||t.isOverflow||l?0:u?1:2,t.isOverflow&&!o&&(t.textMode=!0),2===g?(t.x+=p,function(t){t.text="",t.words.forEach(e=>{e.data.forEach(e=>{t.text+=e.char})})}(t)):(t.x+=p,d=t.x,t.data=[],t.words.forEach((e,i)=>{1===g?(f={char:"",x:d},d=function(t,e,i){return t.forEach(t=>{i.char+=t.char,e+=t.width}),e}(e.data,d,f),(t.isOverflow||" "!==f.char)&&t.data.push(f)):d=function(t,e,i,s,r){return t.forEach(t=>{(s||" "!==t.char)&&(t.x=e,i.push(t)),e+=t.width,r&&(e+=r)}),e}(e.data,d,t.data,t.isOverflow,v&&_),v&&(m=i===y-1,u?m||(d+=u,t.width+=u):_&&(t.width+=_*(e.data.length-(m?1:0))))})),t.words=null)})}(h,e,r),h.overflow&&function(t,e,i,s){if(!s)return;const{rows:r,overflow:n}=t;let{textOverflow:o}=e;if(r.splice(n),o&&"show"!==o){let t,a;"hide"===o?o="":"ellipsis"===o&&(o="...");const h=o?Qt.canvas.measureText(o).width:0,l=i+s-h;("none"===e.textWrap?r:[r[n-1]]).forEach(e=>{if(e.isOverflow&&e.data){let i=e.data.length-1;for(let s=i;s>-1&&(t=e.data[s],a=t.x+t.width,!(s===i&&a<l));s--){if(a<l&&" "!==t.char||!s){e.data.splice(s+1),e.width-=t.width;break}e.width-=t.width}e.width+=h,e.data.push({char:o,x:a}),e.textMode&&function(t){t.text="",t.data.forEach(e=>{t.text+=e.char}),t.data=null}(e)}})}}(h,e,i,r),"none"!==e.textDecoration&&function(t,e){let i,s=0;const{fontSize:r,textDecoration:n}=e;switch(t.decorationHeight=r/11,c(n)?(i=n.type,n.color&&(t.decorationColor=Zh.string(n.color)),n.offset&&(s=Math.min(.3*r,Math.max(n.offset,.15*-r)))):i=n,i){case"under":t.decorationY=[.15*r+s];break;case"delete":t.decorationY=[.35*-r];break;case"under-delete":t.decorationY=[.15*r+s,.35*-r]}}(h,e),h}};const sp={string:function(t,e){if(!t)return"#000";const i=h(e)&&e<1;if(o(t)){if(!i||!Zh.object)return t;t=Zh.object(t)}let s=r(t.a)?1:t.a;i&&(s*=e);const n=t.r+","+t.g+","+t.b;return 1===s?"rgb("+n+")":"rgba("+n+","+s+")"}};return Object.assign(qh,ip),Object.assign(Zh,sp),Object.assign(Jh,Uc),Object.assign(tl,mu),Object.assign(el,Wu),Object.assign(il,$u),Object.assign(le,{interaction:(t,e,i,s)=>new bc(t,e,i,s),hitCanvas:(t,e)=>new bh(t,e),hitCanvasManager:()=>new nc}),Bh(),t.AlignHelper=Pt,t.AroundHelper=xt,t.AutoBounds=Gt,t.BezierHelper=hi,t.Bounds=jt,t.BoundsEvent=Xo,t.BoundsHelper=Nt,t.BoxData=fl,t.BranchHelper=wo,t.BranchRender=Fa,t.CanvasData=Rl,t.CanvasManager=fe,t.ChildEvent=Fo,t.ColorConvert=Zh,t.Creator=le,t.Cursor=rc,t.DataHelper=_,t.Debug=ee,t.DragBoundsHelper=Ad,t.Dragger=Gd,t.Effect=il,t.EllipseData=xl,t.EllipseHelper=yi,t.Event=Wo,t.EventCreator=pe,t.Eventer=oa,t.Export=rl,t.FileHelper=Gr,t.Filter=sl,t.FourNumberHelper=E,t.FrameData=ml,t.GroupData=gl,t.HitCanvasManager=nc,t.ImageData=kl,t.ImageEvent=Yo,t.ImageManager=en,t.IncrementId=f,t.Interaction=bc,t.InteractionBase=sc,t.InteractionHelper=Nd,t.Keyboard=xd,t.LayoutEvent=$o,t.Layouter=Fh,t.LeafBounds=Ia,t.LeafBoundsHelper=fo,t.LeafData=g,t.LeafDataProxy=va,t.LeafEventer=ya,t.LeafHelper=ao,t.LeafLayout=Mo,t.LeafLevelList=wh,t.LeafList=vh,t.LeafMatrix=Sa,t.LeafRender=Aa,t.LeaferCanvas=bh,t.LeaferCanvasBase=Oe,t.LeaferData=yl,t.LeaferEvent=Jo,t.LeaferImage=on,t.LineData=vl,t.MathHelper=D,t.Matrix=pt,t.MatrixHelper=K,t.MyDragEvent=Ud,t.MyImage=pd,t.MyPointerEvent=Wd,t.MyTouchEvent=zd,t.NeedConvertToCanvasCommandMap=We,t.OneRadian=A,t.PI2=M,t.PI_2=W,t.Paint=Jh,t.PaintGradient=el,t.PaintImage=tl,t.PathArrow=Qh,t.PathBounds=Ar,t.PathCommandDataHelper=Bs,t.PathCommandMap=Ae,t.PathCommandNodeHelper=mi,t.PathConvert=is,t.PathCorner=Yr,t.PathCreator=Ys,t.PathData=Pl,t.PathDrawer=sr,t.PathHelper=De,t.PathNumberCommandLengthMap=Ne,t.PathNumberCommandMap=ze,t.PenData=Bl,t.Picker=Hh,t.Platform=Qt,t.Plugin=he,t.Point=ut,t.PointHelper=ot,t.PointerButton=bd,t.PolygonData=bl,t.PropertyEvent=zo,t.RectData=wl,t.RectHelper=Ye,t.RectRender=Ml,t.RenderEvent=Qo,t.Renderer=zh,t.ResizeEvent=qo,t.Resource=Jr,t.Run=ne,t.Selector=jh,t.StarData=El,t.State=nl,t.StringNumberMap=qt,t.TaskItem=Zr,t.TaskProcessor=$r,t.TextConvert=qh,t.TextData=Tl,t.Transition=ol,t.TwoPointBoundsHelper=ft,t.UIBounds=Ol,t.UICreator=ce,t.UIData=_l,t.UIEvent=Ed,t.UIRender=Il,t.UnitConvert=$h,t.UnitConvertHelper=Kt,t.WaitHelper=So,t.WatchEvent=Zo,t.Watcher=Th,t.affectRenderBoundsType=Tn,t.affectStrokeBoundsType=Pn,t.attr=cn,t.autoLayoutType=fn,t.boundsType=vn,t.canvasPatch=Vr,t.canvasSizeAttrs=Le,t.createAttr=function(t){return(e,i)=>{an(e,i,ln(i,t))}},t.createDescriptor=ln,t.cursorType=Fn,t.dataProcessor=Un,t.dataType=_n,t.decorateLeafAttr=dn,t.defineDataProcessor=zn,t.defineKey=an,t.defineLeafAttr=un,t.dimType=Rn,t.doBoundsType=xn,t.doStrokeType=Bn,t.effectType=Vh,t.emptyData=s,t.eraserType=Mn,t.extraPropertyEventMap=No,t.getBoundsData=U,t.getDescriptor=hn,t.getMatrixData=z,t.getPointData=F,t.hitType=Wn,t.isArray=d,t.isData=function(t){return c(t)&&!d(t)},t.isEmptyData=u,t.isFinite=a,t.isNull=n,t.isNumber=h,t.isObject=c,t.isString=o,t.isUndefined=r,t.layoutProcessor=function(t){return(e,i)=>{an(e,"__LayoutProcessor",{get:()=>t})}},t.leaferTransformAttrMap=ra,t.maskType=An,t.naturalBoundsType=wn,t.opacityType=Cn,t.path=Xr,t.pathInputType=bn,t.pathType=En,t.pen=Hr,t.positionType=pn,t.registerUI=Kn,t.registerUIEvent=qn,t.resizeType=Gh,t.rewrite=Hn,t.rewriteAble=jn,t.rotationType=mn,t.scaleType=yn,t.scrollType=gn,t.sortType=In,t.strokeType=Sn,t.surfaceType=kn,t.tempBounds=Vt,t.tempMatrix=gt,t.tempPoint=_t,t.tryToNumber=function(t){return"string"==typeof t&&l.test(t)?+t:t},t.useCanvas=Bh,t.useModule=Gn,t.version="2.0.0",t.visibleType=Ln,t.zoomLayerType=Kh,t}({});function Leafer(t){return new LeaferUI.Leafer(t)}Object.setPrototypeOf(Leafer,LeaferUI),Leafer.prototype=LeaferUI.Leafer.prototype;
//# sourceMappingURL=web.min.js.map
